[{"content":"Hugo ç›®å½•ç»“æ„\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 . â”œâ”€â”€ archetypes â”‚ â””â”€â”€ default.md\t# hugoæ–°å»ºæ–‡ç« çš„é»˜è®¤æ¨¡æ¿ â”œâ”€â”€ config.yaml # ç½‘ç«™é…ç½®æ–‡ä»¶ â”œâ”€â”€ content # ç«™ç‚¹å†…çš„å†…å®¹éƒ½åœ¨è¿™é‡Œ â”‚ â”œâ”€â”€ categories # â€œåˆ†ç±»â€é¡µé¢çš„é¦–é¡µ â”‚ â”‚ â””â”€â”€ Test # â€œåˆ†ç±»â€é¡µé¢ä¸‹çš„ä¸€ä¸ªå…·ä½“åˆ†ç±»é¡µé¢ â”‚ â”œâ”€â”€ page # æ˜¾ç¤ºåœ¨ç½‘ç«™ä¸»é¡µå·¦ä¾§è¾¹æ èœå•çš„é€‰é¡¹ï¼ˆå¯¼èˆªæ ï¼‰ â”‚ â”‚ â”œâ”€â”€ about # å·¦ä¾§è¾¹æ èœå•ä¸­çš„â€œå…³äºâ€é¡µé¢ â”‚ â”‚ â”œâ”€â”€ archives # å·¦ä¾§è¾¹æ èœå•ä¸­çš„â€œå½’æ¡£â€é¡µé¢ â”‚ â”‚ â”œâ”€â”€ links # å·¦ä¾§è¾¹æ èœå•ä¸­çš„â€œé“¾æ¥â€é¡µé¢ â”‚ â”‚ â””â”€â”€ search # å·¦ä¾§è¾¹æ èœå•ä¸­çš„â€œæœç´¢â€é¡µé¢ â”‚ â””â”€â”€ post # ç”¨æˆ·å†™çš„å¸–å­éƒ½æ”¾åœ¨è¿™é‡Œï¼Œæ¯ä¸ªå­æ–‡ä»¶å¤¹å¯¹åº”ä¸€ä¸ªå¸–å­ â”‚ â”œâ”€â”€ 2024 â”‚ â”œâ”€â”€ 09 â”‚ â”œâ”€â”€ æ–‡ç« ç›®å½• â”‚\tâ”œâ”€â”€ .md â”‚\tâ”œâ”€â”€ .img â”‚\tâ”œâ”€â”€ 10 â”‚ â”œâ”€â”€ æ–‡ç« ç›®å½• â”‚\tâ”œâ”€â”€ .md â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ LICENSE â”œâ”€â”€ README.md â”œâ”€â”€ resources â”‚ â””â”€â”€ _gen â”‚ â”œâ”€â”€ assets â”‚ â””â”€â”€ images â”œâ”€â”€ static # æ”¾ç”¨æˆ·è‡ªå®šä¹‰å­—ä½“ã€ç”¨æˆ·å¤´åƒã€ç½‘ç«™å°å›¾æ ‡ç­‰ â””â”€â”€ themes # æ”¾å„ç§ä¸»é¢˜ â””â”€â”€ hugo-theme-stack # stackä¸»é¢˜ â”œâ”€â”€ archetypes â”œâ”€â”€ assets â”œâ”€â”€ config.yaml â”œâ”€â”€ data â”œâ”€â”€ debug.sh â”œâ”€â”€ exampleSite â”œâ”€â”€ go.mod â”œâ”€â”€ i18n â”œâ”€â”€ images â”œâ”€â”€ layouts â”œâ”€â”€ LICENSE â”œâ”€â”€ netlify.toml â”œâ”€â”€ README.md â””â”€â”€ theme.toml hugo.yaml é…ç½®æ–‡ä»¶è¯¦è§£\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 baseurl: https://example.com/ languageCode: zh-cn theme: hugo-theme-stack # ä¸»é¢˜ title: é¢ï¼Œéšä¾¿æµ‹è¯• # è¿™ä¸ªæ²¡ç”¨ copyright: Wei Qi # è¿™ä¸ªæ˜¯åœ¨é¡µè„šæ˜¾ç¤ºçš„ TimeZone: Asia/Shanghai DefaultContentLanguage: zh-cn # ä¸­æ–‡æ”¯æŒ hasCJKLanguage: true # å¦‚æœæ˜¯ä¸­æ–‡å°±è®¾ç½®ä¸ºtrueï¼Œå¦åˆ™è®¾ç½®ä¸ºfalse languages: # å¤šè¯­è¨€æ”¯æŒ zh-cn: languageName: ä¸­æ–‡ title: ç½‘ç«™åç§° weight: 2 params: description: ç½‘ç«™æè¿° services: # ä¸»é¢˜é…ç½® disqus: shortname: \u0026#34;hugo-theme-stack\u0026#34; pagination: pagerSize: 6\t# é¡µé¢æ˜¾ç¤ºçš„æ–‡ç« æ•°é‡ params: mainSections: - post\t# é¦–é¡µæ˜¾ç¤ºçš„æ–‡ç« æ‰€åœ¨è·¯å¾„ï¼Œå³é¦–é¡µä¼šæ˜¾ç¤º hugo/content/post/ ä¸‹çš„æ‰€æœ‰æ–‡ç«  featuredImageField: image rssFullContent: true favicon: /favicon.ico # ç½‘ç«™çš„å›¾æ ‡ï¼Œæ”¾åˆ°ä¸»é¢˜æ ¹ç›®å½•ä¸‹ footer: since: 2024 # é¡µè„šæ˜¾ç¤ºå¹´ä»½çš„å¼€å§‹å¹´ä»½ dateFormat:\t# æ—¶é—´æ˜¾ç¤ºæ ¼å¼ published: 2006å¹´1æœˆ2æ—¥ # Jan 02, 2006 lastUpdated: 2006å¹´1æœˆ2æ—¥ 15:04 # Jan 02, 2006 15:04 MST sidebar: emoji: ğŸ¥ subtitle: Life is Passion ! # å¤´åƒä¸‹è¾¹çš„æ–‡å­— avatar: enabled: true local: false\t# false å¤´åƒæ‰æ˜¾ç¤ºæœ¬åœ°çš„å›¾ç‰‡ src: /img/tx.png\t# æ”¾åˆ° hugo/static/img/ ä¸‹è¾¹ï¼Œæ²¡æœ‰ img åˆ™æ–°å»º article: # æ–‡ç« é¡µé…ç½® math: false # å¯ç”¨æ•°å­¦å…¬å¼ toc: true # æ–‡ç« æ˜¾ç¤ºç›®å½• readingTime: true # æ–‡å­—æ˜¾ç¤ºé˜…è¯»æ—¶é—´ license: enabled: true default: Licensed under CC BY-NC-SA 4.0 # é»˜è®¤çš„ç‰ˆæƒè®¸å¯ comments: # è¯„è®ºç³»ç»Ÿ enabled: false\t# å¼€è¯„è®ºåˆ™ä¸º trueï¼Œéœ€è¦åˆ°ç½‘ä¸Šæœç´¢ç›¸å…³çš„é…ç½® provider: disqus widgets:\t# å³ä¾§å¯¼èˆªæ ï¼Œå³åœ¨é¡µé¢å³è¾¹æ˜¾ç¤ºï¼šæœç´¢ã€å½’æ¡£ã€æ ‡ç­¾ï¼Œå°†å¯¹åº”çš„ type æ³¨é‡Šæ‰åˆ™ä¸æ˜¾ç¤º homepage: - type: search # é¦–é¡µæœç´¢æ¡† - type: archives # é¦–é¡µå½’æ¡£ params: limit: 5 - type: categories # é¦–é¡µåˆ†ç±» params: limit: 10 - type: tag-cloud # é¦–é¡µæ ‡ç­¾äº‘ params: limit: 10 page: - type: toc # æ–‡ç« ç›®å½• colorScheme: # Display toggle toggle: true # æ˜¾ç¤ºåˆ‡æ¢æš—è‰²æ¨¡å¼æŒ‰é’® # Available values: auto, light, dark default: auto # é»˜è®¤ä¸»é¢˜æ¨¡å¼ imageProcessing: cover: enabled: true # æ˜¯å¦å¯ç”¨å°é¢å›¾ content: enabled: true # æ˜¯å¦å¯ç”¨å†…å®¹å›¾ç‰‡ menu: # èœå•ã€å¯¼èˆªæ  main: []\t# è¿™é‡Œä¸é…ç½®ï¼Œé…ç½®èœå•æœ€å¥½æ˜¯åœ¨ hugo/content/page/ ä¸‹åŠ  .md æ–‡ä»¶ social: # å¤´åƒä¸‹è¾¹çš„ç¤¾äº¤é“¾æ¥ - identifier: github name: GitHub url: # https://github.com/CaiJimmy/hugo-theme-stack params: icon: brand-github - identifier: twitter name: Twitter url: # https://twitter.com params: icon: brand-twitter related: # ç›¸å…³æ–‡ç«  includeNewer: true threshold: 60 toLower: false indices: - name: tags weight: 100 - name: categories weight: 200 markup: goldmark: # è¿™é‡Œæ˜¯ goldmark æ¸²æŸ“é€‰é¡¹ï¼Œé»˜è®¤å³å¯ tableOfContents: # æ–‡ç« ç›®å½•ï¼ˆå³è¾¹ï¼‰ï¼Œå±‚çº§ endLevel: 5\t# æ˜¾ç¤ºå‡ å±‚æ ‡é¢˜ ordered: true\t# æ ‡é¢˜æ˜¾ç¤ºåºå·ï¼Œfalseåˆ™æ— åº startLevel: 2\t# ä»ç¬¬å‡ çº§æ ‡é¢˜å¼€å§‹æ˜¾ç¤º highlight:\t# ä»£ç å—é«˜äº® noClasses: false\t# ä¸å¯ç”¨ç‰¹å®šcssç±»é«˜äº® codeFences: true\t# å¯ç”¨ä»£ç å— guessSyntax: true\t# è‡ªåŠ¨è¯†åˆ«è¯­æ³• # lineNoStart: 1 lineNos: true\t# å¯ç”¨è¡Œå· # lineNumbersInTable: true # tabWidth: 4 style: github-dark\t# ä»£ç å—æ ·å¼ frontmatter: lastmod: :fileModTime\t# æ–‡ç« æœ«å°¾æ˜¾ç¤ºæ–‡ç« çš„æ›´æ–°æ—¶é—´ ç«™ç‚¹é…ç½®\rç½‘ç«™å›¾æ ‡\ræ ¹æ®ä¸Šè¾¹çš„ ã€hugo.yaml é…ç½®æ–‡ä»¶ã€‘ï¼ŒæŠŠ .ico æ–‡ä»¶æ”¾åˆ°ä¸»é¢˜çš„æ ¹ç›®å½•ä¸‹ï¼Œç„¶åä¿®æ”¹\n1 favicon: /favicon.ico é¦–é¡µå¤´åƒ\ræ ¹æ®ä¸Šè¾¹çš„ ã€hugo.yaml é…ç½®æ–‡ä»¶ã€‘ï¼ŒæŠŠ .png æ”¾åˆ° hugo/static/img/ ä¸‹ï¼Œç„¶åä¿®æ”¹\n1 2 3 4 5 6 7 sidebar: emoji: ğŸ¥ subtitle: å¥½å¥½ç”Ÿæ´» # å¤´åƒä¸‹è¾¹çš„æ–‡å­— avatar: enabled: true local: false # true è¿™é‡Œè¦æ”¹ä¸º false æ‰ç”Ÿæ•ˆ src: /img/tx.png # å¤´åƒ ç½‘ç«™åç§°\ræ ¹æ®ä¸Šè¾¹çš„ ã€hugo.yaml é…ç½®æ–‡ä»¶ã€‘ï¼Œè‡ªå·±æ”¹æ”¹ languages\nå¯¼èˆªæ \ræ ¹æ®ä¸Šè¾¹çš„ ã€Hugo ç›®å½•ç»“æ„ã€‘ï¼Œå°† hugo-theme-stack\\exampleSite\\content çš„å†…å®¹æ”¾åˆ° hugo/content/ ä¸‹ï¼Œå…¶ä¸­ page ç›®å½•å°±æ˜¯å¯¼èˆªæ ã€‚\nç«™ç‚¹åº•éƒ¨æ–‡å­—\råº•éƒ¨æ–‡å­—åœ¨ hugo-theme-stack/layout/partials/footer/footer.html é‡Œï¼Œç›¸å…³çš„ç½‘å®‰å¤‡æ¡ˆã€ICPå¤‡æ¡ˆã€ä½¿ç”¨Hugoæ„å»ºã€æ–‡ç« æ•°é‡ã€è®¿é—®äººæ•°ç­‰æ–‡å­—éƒ½å†™åœ¨è¿™é‡Œã€‚\næ›´æ”¹â€œä½¿ç”¨ Hugo æ„å»º ä¸»é¢˜Stackç”±Jimmyè®¾è®¡â€ç­‰å­—æ ·\rhugo-theme-stack/layout/partials/footer/footer.html æ³¨é‡Šæ‰åŸå…ˆçš„ä»£ç ï¼Œæ³¨æ„æ˜¯ \u0026lt;section class=\u0026quot;powerby\u0026quot;\u0026gt; é‡Œè¾¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;section class=\u0026#34;powerby\u0026#34;\u0026gt; ...... \u0026lt;!-- {{- $Generator := `\u0026lt;a href=\u0026#34;https://gohugo.io/\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt;Hugo\u0026lt;/a\u0026gt;` -}} {{- $Theme := printf `\u0026lt;b\u0026gt;\u0026lt;a href=\u0026#34;https://github.com/CaiJimmy/hugo-theme-stack\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34; data-version=\u0026#34;%s\u0026#34;\u0026gt;Stack\u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt;` $ThemeVersion -}} {{- $DesignedBy := `\u0026lt;a href=\u0026#34;https://jimmycai.com\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt;Jimmy\u0026lt;/a\u0026gt;` -}} {{ T \u0026#34;footer.builtWith\u0026#34; (dict \u0026#34;Generator\u0026#34; $Generator) | safeHTML }} {{ T \u0026#34;footer.designedBy\u0026#34; (dict \u0026#34;Theme\u0026#34; $Theme \u0026#34;DesignedBy\u0026#34; $DesignedBy) | safeHTML }} --\u0026gt; \u0026lt;!-- åŠ å…¥è¿™ä¸² --\u0026gt; \u0026lt;section class=\u0026#34;powerby\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;https://gohugo.io/\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt;Hugo\u0026lt;/a\u0026gt; theme \u0026lt;b\u0026gt;\u0026lt;a href=\u0026#34;https://github.com/CaiJimmy/hugo-theme-stack\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34; data-version=\u0026#34;3.27.0\u0026#34;\u0026gt;Stack\u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;a\u0026gt;designed by Jimmy\u0026lt;/a\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;!-- ç»“æŸ --\u0026gt; \u0026lt;/section\u0026gt; æ•ˆæœå°±å¦‚ç°åœ¨çš„ç½‘ç«™ä¸€è‡´ã€‚\n[!CAUTION]\nç”±äºè‡ªå·±ä¸ä¼šå†™ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¿™ä¸ªæ“ä½œæ˜¯ï¼š\nåœ¨ç½‘é¡µä¸Šï¼ŒF12æ§åˆ¶å°æ‰¾åˆ°è¯¥ç›¸å…³å…ƒç´ ï¼Œå³é”®é€‰æ‹©ã€ç¼–è¾‘ä¸º HTML ã€‘ï¼Œå°†è¿™æ®µ HTML ä»£ç å¤åˆ¶è´´è´´åˆ° footer.html é‡Œï¼Œç„¶åå†ä¿®æ”¹æ–‡å­—\næ·»åŠ å¤‡æ¡ˆ\rhugo-theme-stack/layout/partials/footer/footer.html åœ¨ \u0026lt;section class=\u0026quot;powerby\u0026quot;\u0026gt; é‡Œè¾¹ï¼Œè‡ªå·±è°ƒæ•´ä»£ç çš„ä½ç½®ï¼Œçœ‹å¾—èˆ’æœå°±è¡Œã€‚\n1 2 \u0026lt;a href=\u0026#34;https://beian.miit.gov.cn/\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;X ICP å¤‡ 2024XXXXXX å·\u0026lt;/a\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;a href=\u0026#34;http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=XXXXXXXXXXXX\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;XXç½‘å®‰å¤‡ XXXXXXXXXX å·\u0026lt;/a\u0026gt; ç»Ÿè®¡ç«™ç‚¹æ–‡ç« æ•°é‡å’Œå­—æ•°\rå‚è€ƒï¼šå¤šè¯­è¨€ hugo æ·»åŠ æ€»å­—æ•°ç»Ÿè®¡å’Œå»ºç«™æ—¶é—´ - æ»‘ç¿”é—ª\u0026rsquo;S BLOG (huaxiangshan.com)\nhugo-theme-stack/layout/partials/footer/footer.html åœ¨ \u0026lt;section class=\u0026quot;powerby\u0026quot;\u0026gt; é‡Œè¾¹ï¼ŒåŠ å…¥\n1 2 3 4 5 6 7 {{ $articleCount := len .Site.RegularPages }} {{ $totalWordCount := 0 }} {{ range .Site.Pages }} {{ $totalWordCount = add $totalWordCount .WordCount }} {{ end }} \u0026lt;p\u0026gt;å‘å¸ƒäº† {{ $articleCount }} ç¯‡æ–‡ç«  | å…± {{$totalWordCount}} å­—\u0026lt;/p\u0026gt; æ•ˆæœå¦‚ä¸‹ï¼š\nä½†æ˜¯æˆ‘è§‰å¾—è¿™ä¸ªæ•ˆæœä¸å¥½ï¼Œç”¨ k æ¥åšå•ä½ä¼šæ›´ç›´è§‚ä¸€äº›ã€‚æ‰€ä»¥åšå¦‚ä¸‹ä¿®æ”¹ï¼š\n1 2 3 4 5 {{ $totalWordCountInK := div $totalWordCount 100.0 }} {{ $totalWordCountInKCeiling := math.Ceil $totalWordCountInK }} {{ $totalWordCountInKFloat := div $totalWordCountInKCeiling 10.0 | printf \u0026#34;%.1f\u0026#34;}} \u0026lt;p\u0026gt;å‘å¸ƒäº† {{ $articleCount }} ç¯‡æ–‡ç«  | å…± {{ $totalWordCountInKFloat }}K å­—\u0026lt;/p\u0026gt; æ•ˆæœå¦‚ä¸‹ï¼š\nç«™ç‚¹è®¿é—®äººæ•°ç»Ÿè®¡\rå‚è€ƒï¼šHugo+Stackä¸»é¢˜é›†æˆVercountç»Ÿè®¡ç½‘ç«™è®¿é—®ä¿¡æ¯ (farb.top)\n1ï¼‰åœ¨ hugo-theme-stack/layout/partials/footer/custom.html åŠ å…¥\n1 \u0026lt;script defer src=\u0026#34;https://cn.vercount.one/js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 2ï¼‰åœ¨ hugo-theme-stack/layout/partials/footer/footer.html åœ¨ \u0026lt;section class=\u0026quot;powerby\u0026quot;\u0026gt; é‡Œè¾¹ï¼ŒåŠ å…¥ï¼ˆåˆé€‚çš„ä½ç½®ï¼Œçœ‹ç€èˆ’æœå°±è¡Œï¼‰\n1 \u0026lt;a\u0026gt;æ€»è®¿å®¢æ•°: \u0026lt;/a\u0026gt;\u0026lt;span id=\u0026#39;busuanzi_value_site_uv\u0026#39;\u0026gt;Loading\u0026lt;/span\u0026gt; \u0026lt;a\u0026gt; | \u0026lt;/a\u0026gt; \u0026lt;a\u0026gt;æ€»è®¿é—®é‡: \u0026lt;/a\u0026gt;\u0026lt;span id=\u0026#39;busuanzi_value_site_pv\u0026#39;\u0026gt;Loading\u0026lt;/span\u0026gt;\u0026lt;/br\u0026gt; é¡µé¢åŠ è½½è¿›åº¦æ¡æ˜¾ç¤º\råœ¨ hugo-theme-stack/layout/partials/footer/custom.html åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;!-- layouts/partials/footer/custom.html --\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js\u0026#34; integrity=\u0026#34;sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css\u0026#34; integrity=\u0026#34;sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;script\u0026gt; NProgress.start(); document.addEventListener(\u0026#34;readystatechange\u0026#34;, () =\u0026gt; { if (document.readyState === \u0026#34;interactive\u0026#34;) NProgress.inc(0.8); if (document.readyState === \u0026#34;complete\u0026#34;) NProgress.done(); }); \u0026lt;/script\u0026gt; é¦–é¡µè®¾ç½®\ré¦–é¡µå…¨å±€é…ç½®\råœ¨ hugo-theme-stack/assets/scss/custom.scss é‡Œè¾¹ï¼ŒåŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 /*---------------å…¨å±€è®¾ç½®-------------*/ :root { --card-border-radius: 20px; //å°å¡ç‰‡åœ†è§’ --article-font-size: 1.7rem; // å…¨å±€å­—ä½“å¤§å° //--card-background: #ffffff;//å°å¡ç‰‡èƒŒæ™¯é¢œè‰² //--body-text-color: rgba(171, 169, 169, 0.58);//å­—ä½“é¢œè‰² } /*é€‰ä¸­æ–‡å­—é¢œè‰²*/ ::selection { color: #fff; background: #557697; } /*æ»šåŠ¨æ¡æ ·å¼*/ html { ::-webkit-scrollbar { width: 18px; //display: none; //éšè—æ»šåŠ¨æ¡ } ::-webkit-scrollbar-track { //background-color: #fff; //æ»šåŠ¨æ¡èƒŒæ™¯é¢œè‰² } ::-webkit-scrollbar-thumb { //é¼ æ ‡ç§»åŠ¨ä¸Šå»å‰çš„æ»šåŠ¨æ¡é¢œè‰² background-color: rgba(111, 114, 115, 0.65); border-radius: 20px; border: 6px solid transparent; background-clip: content-box; } ::-webkit-scrollbar-thumb:hover { //é¼ æ ‡ç§»åŠ¨ä¸Šå»æ—¶çš„æ»šåŠ¨æ¡é¢œè‰² background-color: #232525; } } é¦–é¡µæ¬¢è¿æ \r1ï¼‰åœ¨ hugo-theme-stack/layouts/index.html é‡ŒåŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- é¦–é¡µæ¬¢è¿å­—å¹… --\u0026gt; \u0026lt;div class=\u0026#34;welcome\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size: 2rem; text-align: center; font-weight: bold\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;shake\u0026#34;\u0026gt;ğŸ‘‹\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text1\u0026#34; \u0026gt; Welcome\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text2\u0026#34;\u0026gt; To \u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text3\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;Wei Qi\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text9\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;Blog\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- é¦–é¡µæ¬¢è¿å­—å¹… --\u0026gt; ä½ç½®å¦‚ä¸‹ï¼š\n2ï¼‰åœ¨ hugo-theme-stack/assets/scss/custom.scss é‡Œè¾¹ï¼ŒåŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 //é¦–é¡µæ¬¢è¿æ¿å—æ ·å¼ .welcome { color: var(--card-text-color-main); background: var(--card-background); box-shadow: var(--shadow-l2); border-radius: 30px; display: inline-block; } // ğŸ‘‹emojiå®ç°æ‘†åŠ¨æ•ˆæœ .shake { display: inline-block; animation: shake 1s; animation-duration: 1s; animation-timing-function: ease; animation-delay: 0s; animation-iteration-count: 1; animation-direction: normal; animation-fill-mode: none; animation-play-state: running; animation-name: shake; animation-timeline: auto; animation-range-start: normal; animation-range-end: normal; animation-delay: 2s; @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(45deg) scale(1.2); } 50% { transform: rotate(0) scale(1.2); } 75% { transform: rotate(45deg) scale(1.2); } 100% { transform: rotate(0); } } } // å®ç°å­—ç¬¦è·³åŠ¨åŠ¨ç”» .jump-text1 { display: inline-block; animation: jump 0.5s 1; } .jump-text2 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.1s; } .jump-text3 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.2s; } .jump-text4 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.3s; } .jump-text5 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.4s; } .jump-text6 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.5s; } .jump-text7 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.6s; } .jump-text8 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.7s; } .jump-text9 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.9s; } @keyframes jump { 0% { transform: translateY(0); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0); } } é¦–é¡µæ–‡ç« å¸ƒå±€\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 /*ä¸»é¡µå¸ƒå±€é—´è·è°ƒæ•´*/ .main-container { gap: 50px; //æ–‡ç« å®½åº¦ @include respond(md) { padding: 0 30px; gap: 40px; //ä¸­ç­‰å±å¹•æ—¶çš„æ–‡ç« å®½åº¦ } } .related-contents { overflow-x: visible; //æ˜¾ç¤ºéšè—çš„å›¾æ ‡ padding-bottom: 15px; } é¦–é¡µæ–‡ç« æ ·å¼\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 /*ä¸»é¡µæ–‡ç« å›¾ç‰‡æ ·å¼*/ $image-scale: 1.2; .article-list article .article-image img { width: 100%; height: 150px; object-fit: cover; //ä¸åŒæ˜¾ç¤ºå™¨ï¼ˆæ‰‹æœºï¼Œå°å±å¹•ç”µè„‘ï¼Œå¤§å±å¹•ç”µè„‘ï¼‰æ˜¾ç¤ºçš„å›¾ç‰‡é«˜åº¦å¤§å° @include respond(sm) { height: 305px; } @include respond(md) { height: 305px; } @include respond(xl) { height: 325px; } } /*ä¸»é¡µæ–‡ç« å›¾ç‰‡åœ†è§’*/ .article-list article { --card-border-radius: 24px; } /*æ–‡ç« æ ‡ç­¾åœ†è§’*/ .article-category a, .article-tags a { border-radius: 11px; } /*é¼ æ ‡ç§»åŠ¨åˆ°æ–‡ç« å›¾ç‰‡æ”¾å¤§*/ .article-list article .article-image { position: relative; overflow: hidden; //ä¸æ˜¾ç¤ºè¶…å‡ºçš„éƒ¨åˆ† } .article-list article .article-image img:hover { transform: scale($image-scale); //æ”¾å¤§å°ºå¯¸ } .article-list article .article-image img { transition: transform 0.85s ease-in-out;//æŒç»­æ—¶é—´ } æ–‡ç« å†…éƒ¨å›¾ç‰‡æ ·å¼\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /*æ–‡ç« å†…éƒ¨-é¡µè„š-ç›¸å…³æ–‡ç« å›¾ç‰‡åœ†è§’*/ .article-list--compact article .article-image img { border-radius: 17%; } /*æ–‡ç« å†…éƒ¨-é¡µè„š-ç›¸å…³æ–‡ç« å›¾ç‰‡æ”¾å¤§åŠ¨ç”»*/ .article-list--compact article \u0026gt; a { transition: .6s ease; } .article-list--compact article \u0026gt; a:hover { transform: scale(1.03, 1.03); overflow: visible; } é¦–é¡µå³ä¾§å¯¼èˆªæ ç¾åŒ–\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 /*------------------å³ä¾§å¯¼èˆªæ --------------*/ /*æœç´¢èœå•åŠ¨ç”»*/ .search-form.widget { transition: transform 0.6s ease; } .search-form.widget:hover { transform: scale(1.1, 1.1); } /*å½’æ¡£å°å›¾æ ‡æ”¾å¤§åŠ¨ç”»*/ .widget.archives .widget-archive--list { transition: transform .3s ease; } .widget.archives .widget-archive--list:hover { transform: scale(1.05, 1.05); } /*å³ä¾§æ ‡ç­¾æ”¾å¤§åŠ¨ç”»*/ .tagCloud .tagCloud-tags a { border-radius: 10px; font-size: 1.4rem; transition: transform .3s ease; } .tagCloud .tagCloud-tags a:hover { transform: scale(1.1, 1.1); } é¦–é¡µå·¦ä¾§å¯¼èˆªæ ç¾åŒ–\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 /*--------------------å·¦ä¾§å¯¼èˆªæ ---------------*/ .left-sidebar { --sidebar-avatar-size: 115px; //å·¦ä¾§å¤´åƒå¤§å° --sidebar-element-separation: 15px; //å¤´åƒä¸‹æ–¹é—´è· --emoji-size: 40px; //emojiå®¹å™¨å¤§å° --emoji-font-size: 25px; //emojiå­—ä½“å¤§å° } /*å¤´åƒæ—‹è½¬åŠ¨ç”»*/ .sidebar header .site-avatar .site-logo { transition: transform 1.65s ease-in-out; //æ—‹è½¬æ—¶é—´ } .sidebar header .site-avatar .site-logo:hover { transform: rotate(360deg); //æ—‹è½¬è§’åº¦ä¸º360åº¦ } /*ç¤¾äº¤èœå•å±…ä¸­*/ .social-menu svg { gap: 15px; justify-content: center; width: 30px; height: 30px; //ç¤¾äº¤èœå•å¤§å° stroke: var(--body-text-color); stroke-width: 1.33; } /*æš—è‰²æ¨¡å¼æŒ‰é’®è·ç¦»ä¸Šè¾¹æŒ‰é’®è¾¹è·è°ƒæ•´*/ .menu .menu-bottom-section { margin-top: 70px; } // #dark-mode-toggle { // gap: 30px; //æš—è‰²æ¨¡å¼æ¨ªå‘é•¿åº¦ // } /*ä¸‹æ‹‰èœå•ç¾åŒ–*/ .menu { list-style: none; flex-direction: column; overflow-x: hidden; overflow-y: scroll; //æ­é…èœå•æ»šåŠ¨æ¡ç¾åŒ–ä½¿ç”¨ flex-grow: 1; font-size: 1.7rem; // background-color: rgb(252, 252, 252); box-shadow: var(--shadow-l2); //æ”¹ä¸ªé˜´å½± display: none; margin: 0; //æ”¹ä¸º0 // border-radius: 20px; //åŠ ä¸ªåœ†è§’ è¿™ä¸ªåœ†è§’çœ‹èµ·æ¥æ€ªæ€ªçš„ï¼Œä¸é€‚åˆï¼Œæ³¨é‡Šæ‰ padding: 30px 30px; @include respond(xl) { padding: 15px 0; } \u0026amp;, .menu-bottom-section { gap: 30px; @include respond(xl) { gap: 25px; } } \u0026amp;.show { display: flex; } @include respond(md) { align-items: flex-end; display: flex; background-color: transparent; padding: 0; box-shadow: none; margin: 0; } li { position: relative; vertical-align: middle; padding: 0; @include respond(md) { width: 100%; } svg { stroke-width: 1.33; width: 20px; height: 20px; } a { height: 100%; display: inline-flex; align-items: center; color: var(--body-text-color); gap: var(--menu-icon-separation); } span { flex: 1; } \u0026amp;.current { a { color: var(--accent-color); font-weight: bold; } } } } /*æ‰‹æœºæ¨¡å¼ä¸‹çš„èœå•æ»šåŠ¨æ¡ç¾åŒ–*/ .menu::-webkit-scrollbar { display: none; //é˜²æ­¢å¤§å±å¹•æ—¶å‡ºç°æ»šåŠ¨æ¡ } .sidebar header .site-name { margin: 8px; font-size: 2rem; //å­—ä½“å¤§å° } // -------------------------------- // èœå•æ æ ·å¼ // ä¸‹æ‹‰èœå•æ”¹åœ†è§’æ ·å¼ .menu { padding-left: 0; list-style: none; flex-direction: column; overflow-x: hidden; overflow-y: scroll; flex-grow: 1; font-size: 1.6rem; background-color: var(--card-background); box-shadow: var(--shadow-l2); //æ”¹ä¸ªé˜´å½± display: none; margin: 0; //æ”¹ä¸º0 border-radius: 10px; //åŠ ä¸ªåœ†è§’ padding: 30px 30px; @include respond(xl) { padding: 15px 0; } \u0026amp;, .menu-bottom-section { gap: 30px; @include respond(xl) { gap: 25px; } } \u0026amp;.show { display: flex; } @include respond(md) { align-items: flex-end; display: flex; background-color: transparent; padding: 0; box-shadow: none; margin: 0; } li { position: relative; vertical-align: middle; padding: 0; @include respond(md) { width: 100%; } svg { stroke-width: 1.33; width: 20px; height: 20px; } a { height: 100%; display: inline-flex; align-items: center; color: var(--body-text-color); gap: var(--menu-icon-separation); } span { flex: 1; } \u0026amp;.current { a { color: var(--accent-color); font-weight: bold; } } } } å½’æ¡£é¡µé¢åŒæ æ ·å¼\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 /*----------------å½’æ¡£é¡µé¢---------------*/ /*å½’æ¡£é¡µé¢å¡ç‰‡ç¼©æ”¾*/ .article-list--tile article { transition: .6s ease; } .article-list--tile article:hover { transform: scale(1.03, 1.03); } /* å½’æ¡£é¡µé¢ä¸¤æ  */ @media (min-width: 1024px) { .article-list--compact { display: grid; grid-template-columns: 1fr 1fr; background: none; box-shadow: none; gap: 1rem; article { background: var(--card-background); border: none; box-shadow: var(--shadow-l2); margin-bottom: 8px; border-radius: 16px; } } } é“¾æ¥é¡µé¢ä¸‰æ æ ·å¼\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /*--------------*-é“¾æ¥é¡µé¢-----------------*/ /*å‹æƒ…é“¾æ¥è®¾ç½®æˆä¸‰æ æ ·å¼*/ @media (min-width: 1024px) { .article-list--compact.links { display: grid; grid-template-columns: 1fr 1fr 1fr; background: none; box-shadow: none; gap: 1rem; article { background: var(--card-background); border: none; box-shadow: var(--shadow-l2); margin-bottom: 8px; border-radius: var(--card-border-radius); \u0026amp;:nth-child(odd) { margin-right: 8px; } } } } é¦–é¡µæ˜¾ç¤ºæ–‡ç« \ræ ¹æ® ã€hugo.yaml é…ç½®æ–‡ä»¶è¯¦è§£ã€‘ï¼Œä¿®æ”¹å‚æ•° mainSections\n1 2 3 params: mainSections: - post # hugo/content/post/ ä¸‹çš„æ‰€æœ‰æ–‡ç« éƒ½èƒ½æ˜¾ç¤ºï¼Œä¸ç„¶é¦–é¡µä¸æ˜¾ç¤ºæ–‡ç«  å•é¡µæ–‡ç« æ•°é‡è®¾ç½®\ræ ¹æ® ã€hugo.yaml é…ç½®æ–‡ä»¶è¯¦è§£ã€‘ï¼Œä¿®æ”¹å‚æ•° pagerSize\n1 2 pagination: pagerSize: 8\t# æ”¹è¿™ä¸ª æ–‡ç« è®¾ç½®\ræ–‡ç« ç”Ÿæˆæ¨¡æ¿\rä¿®æ”¹ hugo/archetypes/default.md\n1 2 3 4 5 6 7 title = \u0026#39;{{ replace .File.ContentBaseName \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#39; date = {{ .Date }} draft = false categories = [\u0026#34;Category\u0026#34;] tags = [\u0026#34;Tag\u0026#34;] description = [\u0026#34;æè¿°\u0026#34;] keywords = [\u0026#34;å…³é”®è¯\u0026#34;] ç„¶åä½¿ç”¨ hugo new content/post/xxxx.md å‘½ä»¤æ—¶ï¼Œç”Ÿæˆçš„ .md æ–‡ä»¶ï¼Œå°±æ˜¯æ ¹æ®è¿™ä¸ªæ¨¡å—ç”Ÿæˆçš„ã€‚\næ–‡ç« ç›®å½•å±‚çº§æ˜¾ç¤ºé—®é¢˜\rå¦‚æœæˆ‘ä»¬åœ¨æ–‡ç« æ—¶ï¼Œæ ‡é¢˜å‰å–œæ¬¢å¸¦ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ï¼š\n1 2 3 1.æ ‡é¢˜ 1.1 æ ‡é¢˜ 1.1.1 æ ‡é¢˜ å¦‚æœ hugo.yaml ä¸­ï¼Œordered: true\n1 2 3 4 tableOfContents: # ä¾§è¾¹æ ç›®å½•ï¼ˆå³è¾¹ï¼‰ï¼Œå±‚çº§ endLevel: 5 ordered: true startLevel: 2 ç½‘é¡µæ¸²æŸ“æ—¶ï¼Œä¼šå˜æˆè¿™æ ·\n1 2 3 1 1.æ ‡é¢˜ 1.1 1.1 æ ‡é¢˜ 1.1.1 1.1.1 æ ‡é¢˜ 1ï¼‰ä¸€ç§æ˜¯æ–‡ç« é‡Œè‡ªå¸¦æ•°å­—æ ‡é¢˜ï¼Œåˆ™ ordered: false\n2ï¼‰å¦ä¸€ç§æ˜¯æ–‡ç« é‡Œæ ‡é¢˜ä¸å¸¦æ•°å­—ï¼Œåˆ™ ordered: true\næ–‡ç« å›¾ç‰‡ä¸æ˜¾ç¤ºé—®é¢˜\rå‚è€ƒï¼šå›¾ç‰‡ç±»å‹ - æ–‡æ¡£ - Hugo å›¾ç‰‡æ¨¡å— | HugoMods\næˆ‘ç”¨çš„ Typoraï¼Œå…¶ä»–åº”ç”¨å†™çš„ md å¤§æ¦‚ä¹Ÿæ˜¯è¿™æ ·\nåšæ³•ï¼š\n1ï¼‰æˆ‘åœ¨ hugo/content/post/2024/10/ åˆ›å»ºä¸€ä¸ªæ–‡ç« ç›®å½•ï¼šHugoStackä¸»é¢˜ç¾åŒ–\n2ï¼‰ç„¶ååˆ°é‡Œè¾¹ï¼Œhugo/content/post/2024/10/HugoStackä¸»é¢˜ç¾åŒ–/ åˆ›å»º index.md ï¼ˆåå­—ä¸€å®šè¦å« index ï¼‰\n3ï¼‰.md é‡Œå¯¹å›¾ç‰‡è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·ç›´æ¥æŠŠå›¾ç‰‡è´´è¿›å»å°±è¡Œäº†ã€‚\n4ï¼‰å¦‚æœä¸æ˜¯ Typoraï¼Œåˆ™éœ€è¦åœ¨ index.md çš„åŒçº§ç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚ hugo/content/post/2024/10/HugoStackä¸»é¢˜ç¾åŒ–/img/ ï¼Œå›¾ç‰‡æ”¾åˆ° img ç›®å½•ä¸‹ï¼Œç„¶åå¼•ç”¨ï¼š\n1 ![å›¾ç‰‡æè¿°å¯å¿½ç•¥](img/1727420925875.png) [!NOTE]\nHugo å¥½åƒæ˜¯åªæ¸²æŸ“ index.md çš„å›¾ç‰‡ï¼Œå¦‚æœ .md æ–‡ä»¶åä¸æ˜¯ index ï¼Œåˆ™é‡Œè¾¹çš„å›¾ç‰‡æ˜¯ä¸æ˜¾ç¤ºçš„ã€‚\næ–‡ç« ä»£ç å—æ ·å¼\rä»£ç å—é«˜äº®\råœ¨ hugo.yaml ä¸­ï¼Œæ·»åŠ  highlight å‚æ•°ï¼Œæˆ‘æ–‡ç« é‡Œçš„ä»£ç å—é…ç½®æ˜¯è¿™æ ·å­çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 markup: highlight: noClasses: false codeFences: true guessSyntax: true # lineNoStart: 1 lineNos: true # lineNumbersInTable: true # tabWidth: 4 style: github-dark ä»£ç å—æ ·å¼\råœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 //ä¸ºä»£ç å—é¡¶éƒ¨æ·»åŠ macosæ ·å¼ .article-content { .highlight:before { content: \u0026#34;\u0026#34;; display: block; background: #fc625d; border-radius: 50%; box-shadow: 20px 0 #fdbc40, 40px 0 #35cd4b; height: 12px; width: 12px; margin-bottom: 5px; } } // ä»£ç å—åŸºç¡€æ ·å¼ä¿®æ”¹ .highlight { max-width: 102% !important; background-color: var(--pre-background-color); padding: var(--card-padding); position: relative; border-radius: 20px; margin-left: -7px !important; margin-right: -12px; box-shadow: var(--shadow-l1) !important; \u0026amp;:hover { .copyCodeButton { opacity: 1; } } // keep Codeblocks LTR [dir=\u0026#34;rtl\u0026#34;] \u0026amp; { direction: ltr; } pre { margin: initial; padding: 0; margin: 0; width: auto; // background-color: #282c34 !important; } } // lightæ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼è°ƒæ•´ [data-scheme=\u0026#34;light\u0026#34;] .article-content .highlight { background-color: #fff9f3; } [data-scheme=\u0026#34;light\u0026#34;] .chroma { color: #ff6f00; background-color: #fff9f3cc; } æ–‡ç« ç»Ÿè®¡å­—æ•°\rå‚è€ƒï¼šä¸º Hugo åšå®¢æ·»åŠ å­—æ•°ç»Ÿè®¡ - Mogeko\u0026rsquo;s Blog\n1ï¼‰åœ¨ hugo-theme-stack/layouts/paritals/article/components/details.html åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;footer class=\u0026#34;article-time\u0026#34;\u0026gt; ... {{ if .WordCount }} \u0026lt;footer class=\u0026#34;article-wordcount\u0026#34;\u0026gt; \u0026lt;div\u0026gt; {{ partial \u0026#34;helper/å­—æ•°.svg\u0026#34; }} \u0026lt;span class=\u0026#34;article-wordcount--count\u0026#34;\u0026gt;{{ T \u0026#34;article.wordCount\u0026#34; .WordCount }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/footer\u0026gt; {{ end }} ... \u0026lt;/footer\u0026gt; æ³¨æ„ï¼š{{ partial \u0026quot;helper/å­—æ•°.svg\u0026quot; }} è¿™é‡Œæ˜¯æŠŠ .svg å›¾ç‰‡æ”¾åˆ° hugo-theme-stack/layouts/paritals/helper/å­—æ•°.svg ï¼Œè¿™é‡Œçœ‹ä»£ç å‰è¾¹çš„æ˜¾ç¤ºé˜…è¯»æ—¶é—´å¼•ç”¨äº† helper é‡Œçš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿæ”¾åˆ°è¿™é‡Œã€‚ä¸ç”¨å›¾ç‰‡çš„è¯å¯ä»¥åˆ æ‰ã€‚\n2ï¼‰åœ¨ hugo-theme-stack/i18n/zh-cn.yaml ä¸­çš„ article ä¸‹ï¼ŒåŠ å…¥\n1 2 wordCount: other: \u0026#34;å­—æ•°: {{ .Count }}\u0026#34; 3ï¼‰è¿™ä¸ªæ—¶å€™ï¼Œé¢„è§ˆä¼šå‘ç°ï¼Œå­—æ•°çš„å­—ä½“ç›¸å½“å¤§ï¼Œä¸æ—¥æœŸã€é˜…è¯»æ—¶é—´ä¸åè°ƒï¼Œæ‰€ä»¥å¾—æ›´æ”¹å®ƒä»¬çš„æ ·å¼ï¼Œä¿æŒç»Ÿä¸€ã€‚åœ¨ hugo-theme-stack/assets/scss/custom.scss åŠ å…¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // é˜…è¯»æ—¶é—´ã€å­—æ•°æ ·å¼ .article-time { display: flex; align-items: center; font-size: 14px; color: #666; } .article-time div { margin-right: 10px; } .article-time--count { font-size: 14px; color: #666; } æ•ˆæœï¼š\nå¦‚æœéœ€è¦åœ¨å­—æ•°å‰è¾¹åŠ ä¸ªå°å›¾æ ‡ï¼Œåˆ™éœ€è¦æŠŠå°å›¾æ ‡æ”¾åˆ°è¿™é‡Œ hugo-theme-stack/layouts/partials/helper/xxx.svg ä¸‹ï¼Œç„¶åéœ€è¦æŠŠ .svg æ–‡ä»¶é‡Œçš„å‰ç¼€ç»™åˆ æ‰ï¼Œè¿™ä¸ªå‰ç¼€åˆ æ‰æ‰å¯ä»¥ï¼š\n1 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; standalone=\u0026#34;no\u0026#34;?\u0026gt; æ•ˆæœï¼š\nè‡´è°¢\rç¾åŒ–è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒäº†å¾ˆå¤šä¼˜ç§€çš„åšä¸»åšå®¢ï¼š\nåšå®¢åˆ‡æ¢åˆ°STACK ä¸»é¢˜ (skfwe.cn)\nHugoåšå®¢ | stackä¸»é¢˜ä¿®æ”¹ç¬¬ä¸€ç«™ (munlelee.github.io)\nHugo-theme-Stack é­”æ”¹ç¾åŒ– | Naive Koala (xalaok.top)\nåŸºäº Hugo çš„ç½‘ç«™æ­å»ºæ—¥å¿— 02 (lovir.cn)\nä¸æ˜¯ä»é›¶å¼€å§‹çš„ Hugo å»ºç«™ç¬”è®° (fourxiajiao.github.io)\nHugo | Hugo-stack-theme ä¸»é¢˜é­”æ”¹ç‰ˆ (qjwhz.top)\nï¼ˆ3ï¼‰Stackä¸»é¢˜çš„è‡ªå®šä¹‰ (linsnow.cn)\nä½¿ç”¨ Hugo å¯¹åšå®¢çš„é‡å»ºä¸ Stack ä¸»é¢˜ä¼˜åŒ–è®°å½• (oxidane-uni.github.io)\nHUGO+Stack ä¸‹çš„ç¾åŒ–ä¿®æ”¹ (shimoko.com)\næ—¶éš”åŠå¹´ï¼Œåšå®¢åˆæœ‰äº†é‚£äº›æ–°å˜åŒ–ï¼Ÿï¼ (irithys.com)\nEND\r","date":"2024-10-15T11:12:41+08:00","permalink":"http://localhost:1313/posts/2024/10/hugo+stack%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/","title":"Hugo Stack ä¸»é¢˜ç¾åŒ–"},{"content":"Hugo å®‰è£…\rHugo Windows ç‰ˆæœ¬å®‰è£…ï¼Œéœ€è¦å…ˆå®‰è£…ä¾èµ–çš„ä¸œè¥¿ï¼š\nGolang Git Golang å®‰è£…\r1ï¼‰è¿›å…¥ï¼šGolang å®˜ç½‘ä¸‹è½½åœ°å€\n2ï¼‰é€‰æ‹© Windows ç‰ˆæœ¬çš„å®‰è£…åŒ…\n3ï¼‰å®‰è£… Golangï¼Œéœ€è¦è®°ä½å®‰è£…çš„è·¯å¾„ï¼ˆå®‰è£…è·¯å¾„æ¯”å¦‚ï¼šD:\\Program Files\\Go ï¼‰\né…ç½® Golang ç¯å¢ƒå˜é‡\r1ï¼‰å³é”®ã€æˆ‘çš„ç”µè„‘ã€‘-ã€å±æ€§ã€‘-ã€é«˜çº§ç³»ç»Ÿè®¾ç½®ã€‘-ã€ç¯å¢ƒå˜é‡ã€‘\n2ï¼‰åœ¨ã€ç³»ç»Ÿå˜é‡ã€‘ä¸­ï¼Œæ–°å»ºï¼š\n- GOROOTï¼ˆé…ç½® GO çš„å®‰è£…ç›®å½•ï¼Œå¿…å¡«ï¼Œ`D:\\Program Files\\Go` ï¼‰\r- GOPROXYï¼ˆé…ç½® GO çš„ä»£ç†åŠ é€Ÿï¼Œè¿™ä¸ªæ˜¯å›ºå®šçš„ï¼šhttps://goproxy.ioï¼‰\r- GOPATHï¼ˆé…ç½® GO çš„é¡¹ç›®ç›®å½•ï¼Œéå¿…å¡«ï¼Œå¯å¿½ç•¥ï¼‰\rå¦‚å›¾ï¼š\n3ï¼‰åŒæ—¶åœ¨ã€ç³»ç»Ÿå˜é‡ã€‘-ã€Pathã€‘ä¸­ï¼ŒåŠ å…¥ï¼š\nGOROOT çš„è·¯å¾„ï¼šD:\\Program Files\\Go GO çš„ bin ç›®å½•ï¼š%GOROOT%\\bin å¦‚å›¾ï¼šE:\\goproject å’Œ %GOPATH%\\bin æ˜¯æˆ‘çš„ Go é¡¹ç›®ç›®å½•ï¼ˆè¿™ä¸¤ä¸ªå¯å¿½ç•¥ï¼‰\n4ï¼‰ä½¿ç”¨ cmd çª—å£ï¼Œæ‰§è¡Œ go version å‡ºç°ç‰ˆæœ¬å·ï¼Œå³é…ç½®å®Œæˆ\n1 2 C:\\Users\\Administrator\u0026gt;go version go version go1.23.0 windows/amd64 Git å®‰è£…\r1ï¼‰è¿›å…¥å®˜ç½‘ï¼šGit - Downloads (git-scm.com)\n2ï¼‰é€‰æ‹©ä¸è‡ªå·±ç”µè„‘åŒ¹é…çš„ Windows ç‰ˆæœ¬åŒ…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­æœ‰å‹¾é€‰çš„åœ°æ–¹ï¼Œé»˜è®¤å°±è¡Œã€‚\n[!NOTE]\nå®‰è£… Git æ˜¯ä¸ºäº†æ¨é€åˆ° Github ä¸Šã€‚\nHugo å®‰è£…\rWindows | Hugoå®˜æ–¹æ–‡æ¡£ (opendocs.io)\nåœ¨ Windows ä¸Šï¼Œä½¿ç”¨å¼€æºçš„åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Chocolatey åŒ…ç®¡ç†å™¨è¿›è¡Œä¸‹è½½ã€‚\n1ï¼‰æ¡Œé¢ ã€Shift + å³é”®ã€‘æ‰“å¼€ Windows PowerShell ï¼Œæ³¨æ„ä¸æ˜¯æ‰“å¼€ cmd ã€‚\n2ï¼‰æ‰§è¡Œ\n1 Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(\u0026#39;https://community.chocolatey.org/install.ps1\u0026#39;)) 3ï¼‰å®‰è£… Chocolatey å®Œæˆåï¼Œå†æ‰§è¡Œ\n1 choco install hugo-extended 4ï¼‰æŸ¥çœ‹ Hugo ç‰ˆæœ¬\n1 2 C:\\Users\\Administrator\u0026gt;hugo version hugo v0.134.3-5fb333b9f5ff4ec018f9d78910177d0bec1befb0+extended windows/amd64 BuildDate=2024-09-19T14:28:20Z VendorInfo=gohugoio ç„¶åï¼Œè¿™ä¸ªå®‰è£…è·¯å¾„å¤§æ¦‚æ˜¯åœ¨ C:\\ProgramData\\chocolatey\\lib\\hugo-extended\\tools ï¼Œè¿™ä¸ªè·¯å¾„ä¸‹ï¼Œæœ‰ä¸€ä¸ª hugo.exe å’Œ hugo_extended_0.134.3_windows-amd64.zip å‹ç¼©åŒ…ï¼ŒæŠŠè¿™ä¸ªå‹ç¼©åŒ…å¤åˆ¶è´´è´´åˆ°ä½ æƒ³å­˜æ”¾çš„ä½ç½®ä¸Šï¼Œè§£å‹å‡ºæ¥ã€‚æ¯”å¦‚æˆ‘æ”¾åˆ° F:\\hugo\nHugo é…ç½®\råˆ›å»ºç«™ç‚¹\rä¸Šè¾¹è§£å‹çš„ä½ç½® F:\\hugo\\hugo_extended_0.134.3_windows-amd64\\ï¼Œåœ¨è§£å‹çš„ç›®å½•ä¸­ä¼šæœ‰ä¸€ä¸ª hugo.exe ã€‚\nåœ¨è¿™é‡Œä½¿ç”¨ã€Shift + å³é”®ã€‘é€‰æ‹©ã€åœ¨æ­¤å¤„æ‰“å¼€ Powershell çª—å£ã€‘ï¼Œæ‰§è¡Œ\n1 hugo new site blog (blogæ˜¯åšå®¢ç›®å½•åç§°ï¼Œä»»æ„èµ·) ä¸‹è½½ä¸»é¢˜\råœ¨ blog/themes/ ç›®å½•ä¸‹è¾¹ï¼Œã€Shift + å³é”®ã€‘é€‰æ‹©ã€Git Bash hereã€‘ï¼Œæ‰§è¡Œï¼š\n1 git clone https://github.com/CaiJimmy/hugo-theme-stack.git æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯ Stack ä¸»é¢˜ï¼Œå…¶ä»–ä¸»é¢˜ä¹Ÿä¸€æ ·çš„ï¼šgit clone ä¸»é¢˜åœ°å€ å‘½ä»¤\næ›´å¤šä¸»é¢˜ï¼šComplete List | Hugo Themes (gohugo.io)\næ›¿æ¢ä¸»é¢˜ç¤ºä¾‹æ–‡ä»¶\r[!NOTE]\næ¯ä¸ªä¸»é¢˜éƒ½æœ‰ exampleSite æ–‡ä»¶å¤¹ï¼Œé‡Œè¾¹å­˜æ”¾ç€ä¸»é¢˜çš„ç¤ºä¾‹æ–‡ä»¶ã€‚\n1ï¼‰å°† blog/themes/hugo-theme-stack/exampleSite é‡Œçš„ hugo.yaml å’Œ content ç›®å½•éƒ½å¤åˆ¶åˆ° blog/ ç›®å½•ä¸‹æ›¿æ¢æ‰ï¼ˆæ³¨æ„å…ˆå¤‡ä»½ä¸€ä¸‹ï¼‰\n2ï¼‰* å› ä¸º Stack ä¸»é¢˜ï¼Œæˆ‘æŠŠcontent/post ä¸‹çš„å†…å®¹éƒ½åˆ äº†ï¼ˆæˆ‘çš„è¿™ä¸ªç‰ˆæœ¬ä¸åˆ çš„è¯ï¼Œåè¾¹å¯åŠ¨ hugo æœåŠ¡ä¼šæŠ¥é”™ï¼‰ã€‚è¿™ä¸ªæ˜¯å­˜æ”¾æ–‡ç« çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œå»ºéšæ„å»ºä¸€ä¸ª .md æ–‡ä»¶ï¼Œæ ¹æ®ç¤ºä¾‹é‡Œçš„æ–‡ç« æ”¹æ”¹æ ‡é¢˜å•¥çš„ã€‚\nHugo å¯åŠ¨\råœ¨ cmd é‡Œæ‰§è¡Œ\n1 hugo server å»ºè®®è¿™æ ·ï¼š\n1 2 # è‡ªåŠ¨é‡å®šå‘ï¼Œä¿®æ”¹é…ç½®æˆ–å†…å®¹åè‡ªåŠ¨æ›´æ–°ï¼Œå‘å¸ƒè‰ç¨¿å†…å®¹ hugo server --navigateToChanged -D ç„¶åå¯ä»¥åœ¨ http://localhost:1313/ åœ°å€ä¸Šçœ‹åˆ° blog çš„å†…å®¹\nä¸»é¢˜ç¾åŒ–\rå•ç‹¬å†™ä¸€ç¯‡ï¼Œæ€»ç»“ä¸»é¢˜ç¾åŒ–çš„å†…å®¹ã€‚ä¹Ÿå¯ä»¥ä¸ç¾åŒ–ï¼Œåæ­£ä¸»è¦è¿˜æ˜¯å†…å®¹ä¸ºä¸»ã€‚\nå‘å¸ƒæ–‡ç« \r1ï¼‰åœ¨ hugo/content/post/ ç›®å½•ä¸‹ï¼Œæ–°å»º .md æ–‡ä»¶\n2ï¼‰æˆ–è€…åœ¨ Hugo ç«™ç‚¹ç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤ hugo new content/post/ç¤ºä¾‹.md\næ³¨æ„ï¼š\næ–‡ç« çš„å¤´éƒ¨è‡³å°‘éœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼Œç„¶å draft = false è¡¨ç¤ºè¿™ç¯‡æ–‡ç« ä¸æ˜¯è‰ç¨¿ã€‚\n1 2 3 4 5 6 7 +++ title = \u0026#39;Hugo stack ä¸»é¢˜é…åˆ Github æ­å»ºä¸ªäººåšå®¢\u0026#39; date = 2024-10-15T09:08:41+08:00 draft = false categories = [\u0026#34;Hugo\u0026#34;] tags = [\u0026#34;Hugo\u0026#34;] +++ ä¿å­˜åï¼Œå¯ä»¥ä¸Š http://localhost:1313/ è¿›è¡Œæœ¬åœ°é¢„è§ˆã€‚\næ¨é€åˆ° Github\r1ï¼‰éœ€è¦è¦åˆ° Github æ–°å»ºä¸€ä¸ªæ–°çš„ä»“åº“\n2ï¼‰ä»“åº“åç§°å¿…é¡»å¾—æ˜¯ username.github.io ï¼Œä¸ç„¶æ‰˜ç®¡ä¸äº†çš„\n3ï¼‰ä»“åº“å¿…é¡»æ˜¯å…¬å¼€çš„ï¼Œå…¬å¼€çš„ï¼Œæ‰˜ç®¡ç«™ç‚¹æ˜¯å…è´¹çš„\né¦–æ¬¡æ¨é€\r1ï¼‰è¿›å»åˆ° Hugo ç«™ç‚¹ç›®å½•é‡Œï¼Œæ‰“å¼€ Powershell ï¼Œæ‰§è¡Œ\n1 # hugo ä¼šåœ¨ Hugo ç«™ç‚¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª public ç›®å½•\n2ï¼‰è¿›å» public ç›®å½•ï¼Œã€Shift + å³é”®ã€‘é€‰æ‹©ã€Git Bash hereã€‘ï¼Œæ‰“å¼€ git å‘½ä»¤çª—å£ï¼Œæ‰§è¡Œ\n1 2 3 4 5 git init ##åˆå§‹åŒ–ä»“åº“ git remote add origin https://github.com/username/username.github.io.git ##é“¾æ¥è¿œç¨‹ä»“åº“ git add . git commit -m \u0026#34;first commit\u0026#34;\t# æäº¤ git push -u origin main\t# æ¨é€ åç»­æ¨é€\rè¿›å» public ç›®å½•ï¼Œã€Shift + å³é”®ã€‘é€‰æ‹©ã€Git Bash hereã€‘ï¼Œæ‰“å¼€ git å‘½ä»¤çª—å£ï¼Œæ‰§è¡Œ\n1 2 3 git add . git commit -m \u0026#34;add blog\u0026#34; git push -u origin main ","date":"2024-10-15T09:08:41+08:00","permalink":"http://localhost:1313/posts/2024/10/hugo+stack%E4%B8%BB%E9%A2%98%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","title":"Hugo stack ä¸»é¢˜é…åˆ Github æ­å»ºä¸ªäººåšå®¢"},{"content":"Dockerfile å®è·µ\rDockerfile æ¨¡æ¿\rDockerfile æœ‰å¾ˆå¤šå‘½ä»¤ï¼Œä½†æ˜¯å¸¸ç”¨çš„å°±ä¸‹è¾¹è¿™äº›\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¼•ç”¨åŸºç¡€é•œåƒ FROM åŸºç¡€é•œåƒ:æ ‡ç­¾ # ç»™é•œåƒæ·»åŠ å¤‡æ³¨ LABEL REMARK=\u0026#34;æµ‹è¯•ä½¿ç”¨\u0026#34; # ç»™é•œåƒæ·»åŠ ç¯å¢ƒå˜é‡ ENV PATH $PATH:/usr/local/bin APP_HOME=/home/app # æ·»åŠ ä¸»æœºç›®å½•åˆ°å®¹å™¨ç›®å½• ADD . /home # æ‰§è¡ŒæŒ‡ä»¤ RUN å‘½ä»¤1 \\ \u0026amp;\u0026amp; å‘½ä»¤2 \\ \u0026amp;\u0026amp; å‘½ä»¤3 \u0026amp;\u0026amp; å‘½ä»¤4 # è®¾ç½®é•œåƒçš„ä¸»ç›®å½• WORKDIR /home/app # å¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤, æ¯”å¦‚ CMD /bin/bash CMD å‘½ä»¤ æ„å»ºæ€è·¯\rå…¶å®å°±æ˜¯ç›¸å½“äºæ‰‹åŠ¨åœ¨ Centos é‡Œå®‰è£…åº”ç”¨çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡è¿™ä¸ªè¿‡ç¨‹ç”± Dockerfile å‘½ä»¤è‡ªåŠ¨åŒ–è¿›è¡Œäº†ã€‚\næ‰€ä»¥åœ¨æ„å»º Dockerfile ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£éœ€è¦å®‰è£…çš„åº”ç”¨ï¼Œå®ƒåˆ°åº•æ€ä¹ˆå®‰è£…ï¼Œè¿™ä¸ªå®‰è£…çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ã€‚\nå®è·µä¸€ï¼šä»¥ anolisos ä¸ºåŸºç¡€é•œåƒï¼Œæ„å»º tomcat é•œåƒ\ranolisos æ˜¯é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªå›½äº§ Linux ç³»ç»Ÿ\næ‹‰å– anolisos é•œåƒ\r1 [root@status docker]# docker pull registry.openanolis.cn/openanolis/anolisos:8 è¿›å…¥ anolisos é•œåƒ\r1 [root@status docker]# docker run -it --name anolisos registry.openanolis.cn/openanolis/anolisos:8 /bin/bash è¿›å…¥é‡Œè¾¹å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ tomcat åŒ…ä»å“ªé‡Œæ¥ï¼Ÿ\nä½¿ç”¨ Yum æºä¸‹è½½ï¼ˆä¸æ¨èï¼Œè‡ªå·±çš„ç©å…·é¡¹ç›®å¯ä»¥ï¼‰ æ”¾ä¸€ä¸ªåˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ ADD æˆ–è€… COPY æŒ‡ä»¤ï¼Œæ·»åŠ åˆ°å®¹å™¨ä¸­ï¼ˆä½¿ç”¨è¿™ä¸ªï¼‰ é…ç½® JDK å¹¶å®‰è£… tomcat\r1ï¼‰å®‰è£… JDK\nå› ä¸ºåŸºç¡€é•œåƒä¸­ä¸€åˆ‡ä»ç®€ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ JDK çš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…\n1 yum install -y java-1.8.0-openjdk 2ï¼‰æŸ¥çœ‹ JDK çš„å®‰è£…ç›®å½•\n1 2 3 4 5 6 [root@ae813af28fd9 /]# whereis java java: /usr/bin/java /usr/lib/java /etc/java /usr/share/java /usr/share/man/man1/java.1.gz [root@ae813af28fd9 /]# ls -l /usr/bin/java lrwxrwxrwx 1 root root 22 Sep 18 01:49 /usr/bin/java -\u0026gt; /etc/alternatives/java [root@ae813af28fd9 /]# ls -l /etc/alternatives/java lrwxrwxrwx 1 root root 75 Sep 18 01:49 /etc/alternatives/java -\u0026gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.422.b05-2.0.2.an8.x86_64/jre/bin/java JDK çš„å®‰è£…ç›®å½•å°±æ˜¯ /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.422.b05-2.0.2.an8.x86_64/jre/bin/java\n3ï¼‰é…ç½®ç¯å¢ƒå˜é‡\n1 2 3 4 5 6 vi ~/.bash_profile # åŠ å…¥ export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.422.b05-2.0.2.an8.x86_64/jre export PATH=$JAVA_HOME/bin:$PATH # åˆ·æ–°ç¯å¢ƒå˜é‡ source ~/.bash_profile 4ï¼‰å®‰è£… tomcat\n5ï¼‰å¯åŠ¨ tomcat\næ ¹æ®æ“ä½œæ­¥éª¤ç¼–å†™ dockerfile\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # åŸºäºåŸºç¡€é•œåƒ FROM registry.openanolis.cn/openanolis/anolisos:8 LABEL Author=\u0026#34;test\u0026#34; LABEL Remark=\u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº anolisos åˆ¶ä½œ Tomcat é•œåƒ\u0026#34; # é…ç½® JDK ç¯å¢ƒå˜é‡ ENV JAVA_HOME /home/tomcat/jre ENV PATH $JAVA_HOME/bin:$PATH # åˆ›å»ºä¸€ä¸ªç›®å½•å­˜æ”¾ JDK å’Œ tomcat å®‰è£…åŒ…ï¼Œæ³¨æ„é¡ºåºï¼Œå¾—å…ˆæœ‰è¿™ä¸ªç›®å½•ï¼Œåç»­æ‰èƒ½æ”¾åˆ°è¿™ä¸ªç›®å½• RUN mkdir -p /home/tomcat # è®¾ç½® tomcat ä¸»ç›®å½• å¦‚æœåè¾¹çš„å‘½ä»¤ä¸éœ€è¦åŸºäºè¿™ä¸ªä¸»ç›®å½•å»æ‰§è¡Œï¼Œä¹Ÿå¯ä¸è®¾ç½® WORKDIR /home/tomcat # æ·»åŠ  JDK åŒ…å’Œ tomcat åŒ…åˆ°å®¹å™¨å†…éƒ¨ï¼Œç¡®ä¿åŒ…å’Œ dockerfile éƒ½åœ¨ä¸€ä¸ªç›®å½•ä¸‹ # ADD å‘½ä»¤ä¼šè‡ªåŠ¨å°† tar åŒ…è§£å‹ ADD jdk.tar.gz /home/tomcat ADD apache-tomcat-10.1.30.tar.gz /home/tomcat # æš´éœ²ç«¯å£ EXPOSE 8080 # å¯åŠ¨ tomcat CMD [\u0026#34;/home/tomcat/apache-tomcat-10.1.30/bin/catalina.sh\u0026#34;,\u0026#34;run\u0026#34;] ä½¿ç”¨ Dockerfile æ„å»ºé•œåƒ\ræ³¨æ„ï¼šDockerfile ä¸ JDK \\ tomcat çš„ tar åŒ…è¦å¤„äºåŒä¸€ä¸ªç›®å½•ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 [root@status dockerfile]# docker build -t test:v1 . Sending build context to Docker daemon 65.99 MB Step 1/11 : FROM registry.openanolis.cn/openanolis/anolisos:8 ---\u0026gt; ef65d5c9c386 Step 2/11 : LABEL Author \u0026#34;test\u0026#34; ---\u0026gt; Running in 3f756590b7cd ---\u0026gt; 27aab3b7f5b3 Removing intermediate container 3f756590b7cd Step 3/11 : LABEL Remark \u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº é¾™èœ¥ç³»ç»Ÿ åˆ¶ä½œ Tomcat é•œåƒ\u0026#34; ---\u0026gt; Running in b5fc72ee8fac ---\u0026gt; 68a7c28837a0 Removing intermediate container b5fc72ee8fac Step 4/11 : ENV JAVA_HOME /home/tomcat/jre ---\u0026gt; Running in 1136456bdb18 ---\u0026gt; 0ea43384acec Removing intermediate container 1136456bdb18 Step 5/11 : ENV PATH $JAVA_HOME/bin:$PATH ---\u0026gt; Running in 598616ebc31f ---\u0026gt; ddbc3d112a6b Removing intermediate container 598616ebc31f Step 6/11 : RUN mkdir -p /home/tomcat ---\u0026gt; Running in 9fb8f361d189 ---\u0026gt; 621e6817887f Removing intermediate container 9fb8f361d189 Step 7/11 : WORKDIR /home/tomcat ---\u0026gt; 1a893a18a343 Removing intermediate container 009c81d31fc1 Step 8/11 : ADD jdk.tar.gz /home/tomcat ---\u0026gt; 92064443362d Removing intermediate container de35da461b5d Step 9/11 : ADD apache-tomcat-10.1.30.tar.gz /home/tomcat ---\u0026gt; 006acfe8ee17 Removing intermediate container b5d3283e5c4a Step 10/11 : EXPOSE 8080 ---\u0026gt; Running in 5460b8f751fb ---\u0026gt; 9f59ded402c3 Removing intermediate container 5460b8f751fb Step 11/11 : CMD /home/tomcat/apache-tomcat-10.1.30/bin/catalina.sh run ---\u0026gt; Running in 99352d2ca9f8 ---\u0026gt; 56c59b8f7d84 Removing intermediate container 99352d2ca9f8 Successfully built 56c59b8f7d84 æˆåŠŸäº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ªé•œåƒçš„ä¿¡æ¯\n1 2 3 [root@status dockerfile]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE test v1 1ae021027b9c About a minute ago 386 MB 1 docker inspect test:v1 å¯åŠ¨é•œåƒ\r1 2 3 4 5 6 7 8 9 10 [root@status dockerfile]# docker run -it --name tomcat_aliyun -p 8080:8080 test:v1 Using CATALINA_BASE: /home/tomcat/apache-tomcat-10.1.30 Using CATALINA_HOME: /home/tomcat/apache-tomcat-10.1.30 Using CATALINA_TMPDIR: /home/tomcat/apache-tomcat-10.1.30/temp Using JRE_HOME: /home/tomcat/jre Using CLASSPATH: /home/tomcat/apache-tomcat-10.1.30/bin/bootstrap.jar:/home/tomcat/apache-tomcat-10.1.30/bin/tomcat-juli.jar Using CATALINA_OPTS: Unrecognized option: --add-opens=java.base/java.lang=ALL-UNNAMED Error: Could not create the Java Virtual Machine. Error: A fatal exception has occurred. Program will exit. è¿™é‡Œå¯åŠ¨ tomcat æŠ¥é”™äº†\nå…·ä½“åŸå› ï¼šè§£å†³ideatomcatUnrecognized option:\u0026ndash;add-opens=java.base/java.lang=ALL-UNNAMEDError:Could not create th_unrecognized option: \u0026ndash;add-opens-CSDNåšå®¢\nåæ­£å°±æ˜¯ JDK1.8.0 ä¸ tomcat10 ä¸åŒ¹é…ï¼ŒæŠŠ tomcat ç‰ˆæœ¬é™ä¸€ä¸‹ï¼Œæ¢æˆ tomcat9\næ¢äº† tomcat9 åˆæŠ¥é”™äº†\n1 Caused by: java.lang.Error: java.io.FileNotFoundException: /home/tomcat/jre/lib/tzdb.dat (No such file or directory) åœ¨ dockerfile é‡Œé…ç½®ä¸€ä¸‹ jre_home ç¯å¢ƒå˜é‡\né‡æ–°è°ƒæ•´ dockerfile\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åŸºäºanolisos FROM registry.openanolis.cn/openanolis/anolisos:8 LABEL Author=\u0026#34;test\u0026#34; LABEL Remark=\u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº anolisos åˆ¶ä½œ Tomcat é•œåƒ\u0026#34; # é…ç½® JDK ç¯å¢ƒå˜é‡ ENV JAVA_HOME /home/tomcat/jdk1.8.0_202 ENV JRE_HOME /home/tomcat/jdk1.8.0_202/jre ENV CLASSPATH $JAVA_HOME/lib:$JRE_HOME/lib ENV PATH $JAVA_HOME/bin:$PATH # åˆ›å»ºä¸€ä¸ªç›®å½•å­˜æ”¾ JDK å’Œ tomcat å®‰è£…åŒ…ï¼Œæ³¨æ„é¡ºåºï¼Œå¾—å…ˆæœ‰è¿™ä¸ªç›®å½•ï¼Œåç»­æ‰èƒ½æ”¾åˆ°è¿™ä¸ªç›®å½• RUN mkdir -p /home/tomcat # è®¾ç½® tomcat ä¸»ç›®å½• å¦‚æœåè¾¹çš„å‘½ä»¤ä¸éœ€è¦åŸºäºè¿™ä¸ªä¸»ç›®å½•å»æ‰§è¡Œï¼Œä¹Ÿå¯ä¸è®¾ç½® WORKDIR /home/tomcat # æ·»åŠ  JDK åŒ…å’Œ tomcat åŒ…åˆ°å®¹å™¨å†…éƒ¨ï¼Œç¡®ä¿åŒ…å’Œ dockerfile éƒ½åœ¨ä¸€ä¸ªç›®å½•ä¸‹ # ADD å‘½ä»¤ä¼šè‡ªåŠ¨å°† tar åŒ…è§£å‹ ADD jdk-8u202-linux-i586.tar.gz /home/tomcat ADD apache-tomcat-9.0.95.tar.gz /home/tomcat # æš´éœ²ç«¯å£ EXPOSE 8080 # å¯åŠ¨ tomcat CMD [\u0026#34;/home/tomcat/apache-tomcat-9.0.95/bin/catalina.sh\u0026#34;,\u0026#34;run\u0026#34;] ä½¿ç”¨è¿™ä¸ª dockerfile æ„å»ºé•œåƒ\nç„¶åå¯åŠ¨å®ƒ\nè¿˜æ˜¯æŠ¥é”™äº†\n1 2 3 4 5 6 7 8 [root@status dockerfile]# docker run -it --name tomcat_aliyun -p 8080:8080 test:v1 Using CATALINA_BASE: /home/tomcat/apache-tomcat-9.0.95 Using CATALINA_HOME: /home/tomcat/apache-tomcat-9.0.95 Using CATALINA_TMPDIR: /home/tomcat/apache-tomcat-9.0.95/temp Using JRE_HOME: /home/tomcat/jdk1.8.0_202/jre Using CLASSPATH: /home/tomcat/apache-tomcat-9.0.95/bin/bootstrap.jar:/home/tomcat/apache-tomcat-9.0.95/bin/tomcat-juli.jar Using CATALINA_OPTS: /home/tomcat/apache-tomcat-9.0.95/bin/catalina.sh: line 421: /home/tomcat/jdk1.8.0_202/jre/bin/java: No such file or directory æ„Ÿè§‰æ˜¯è¿™ä¸ª JDK ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œé‡æ–°ä¸‹ä¸€ä¸ª x64 ç‰ˆæœ¬çš„ jdk\næœ€ç»ˆè°ƒæ•´ dockerfile\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # åŸºäºanolisos FROM registry.openanolis.cn/openanolis/anolisos:8 LABEL Author=\u0026#34;test\u0026#34; LABEL Remark=\u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº anolisos åˆ¶ä½œ Tomcat é•œåƒ\u0026#34; # åˆ›å»ºä¸€ä¸ªç›®å½•å­˜æ”¾ JDK å’Œ tomcat å®‰è£…åŒ…ï¼Œæ³¨æ„é¡ºåºï¼Œå¾—å…ˆæœ‰è¿™ä¸ªç›®å½•ï¼Œåç»­æ‰èƒ½æ”¾åˆ°è¿™ä¸ªç›®å½• RUN mkdir -p /home/tomcat # æ·»åŠ  JDK åŒ…å’Œ tomcat åŒ…åˆ°å®¹å™¨å†…éƒ¨ï¼Œç¡®ä¿åŒ…å’Œ dockerfile éƒ½åœ¨ä¸€ä¸ªç›®å½•ä¸‹ # ADD å‘½ä»¤ä¼šè‡ªåŠ¨å°† tar åŒ…è§£å‹ ADD jdk-8u202-linux-x64.tar.gz /home/tomcat ADD apache-tomcat-9.0.95.tar.gz /home/tomcat # è®¾ç½® tomcat ä¸»ç›®å½• å¦‚æœåè¾¹çš„å‘½ä»¤ä¸éœ€è¦åŸºäºè¿™ä¸ªä¸»ç›®å½•å»æ‰§è¡Œï¼Œä¹Ÿå¯ä¸è®¾ç½® WORKDIR /home/tomcat # é…ç½® JDK ç¯å¢ƒå˜é‡ ENV JAVA_HOME /home/tomcat/jdk1.8.0_202 ENV JRE_HOME /home/tomcat/jdk1.8.0_202/jre ENV CLASSPATH /home/tomcat/jdk1.8.0_202/lib:/home/tomcat/jdk1.8.0_202/jre/lib ENV PATH $JAVA_HOME/bin:$PATH # éªŒè¯ä¸€ä¸‹ JDK æ˜¯å¦é…ç½® RUN $JAVA_HOME/bin/java -version # æš´éœ²ç«¯å£ EXPOSE 8080 # å¯åŠ¨ tomcat CMD [\u0026#34;/home/tomcat/apache-tomcat-9.0.95/bin/catalina.sh\u0026#34;,\u0026#34;run\u0026#34;] æ„å»ºè¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 [root@status dockerfile]# docker build test:v1 . \u0026#34;docker build\u0026#34; requires exactly 1 argument(s). See \u0026#39;docker build --help\u0026#39;. Usage: docker build [OPTIONS] PATH | URL | - Build an image from a Dockerfile [root@status dockerfile]# docker build -t test:v1 . Sending build context to Docker daemon 206.8 MB Step 1/14 : FROM registry.openanolis.cn/openanolis/anolisos:8 ---\u0026gt; ef65d5c9c386 Step 2/14 : LABEL Author \u0026#34;test\u0026#34; ---\u0026gt; Running in ec01334f21ac ---\u0026gt; 88b417c6fcff Removing intermediate container ec01334f21ac Step 3/14 : LABEL Remark \u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº é¾™èœ¥ç³»ç»Ÿ åˆ¶ä½œ Tomcat é•œåƒ\u0026#34; ---\u0026gt; Running in efbab43c84cf ---\u0026gt; f64ab9b3ca4b Removing intermediate container efbab43c84cf Step 4/14 : RUN mkdir -p /home/tomcat ---\u0026gt; Running in 0bd99be045f6 ---\u0026gt; 4535e994046e Removing intermediate container 0bd99be045f6 Step 5/14 : ADD jdk-8u202-linux-x64.tar.gz /home/tomcat ---\u0026gt; 103c0a0d137d Removing intermediate container 778a257c323e Step 6/14 : ADD apache-tomcat-9.0.95.tar.gz /home/tomcat ---\u0026gt; 6e3b3068a3f6 Removing intermediate container 4860b4330b7c Step 7/14 : WORKDIR /home/tomcat ---\u0026gt; 4a6354a3c4ca Removing intermediate container 2f3bf66b733c Step 8/14 : ENV JAVA_HOME /home/tomcat/jdk1.8.0_202 ---\u0026gt; Running in a02da957f0e5 ---\u0026gt; fbb98637fc47 Removing intermediate container a02da957f0e5 Step 9/14 : ENV JRE_HOME /home/tomcat/jdk1.8.0_202/jre ---\u0026gt; Running in 15a12e697856 ---\u0026gt; 576b7678f857 Removing intermediate container 15a12e697856 Step 10/14 : ENV CLASSPATH /home/tomcat/jdk1.8.0_202/lib:/home/tomcat/jdk1.8.0_202/jre/lib ---\u0026gt; Running in 28af34ebfcff ---\u0026gt; d87b8a7680af Removing intermediate container 28af34ebfcff Step 11/14 : ENV PATH $JAVA_HOME/bin:$PATH ---\u0026gt; Running in 440870ff6cbf ---\u0026gt; eb633e75c31b Removing intermediate container 440870ff6cbf Step 12/14 : RUN $JAVA_HOME/bin/java -version ---\u0026gt; Running in b888421b5460 # æ³¨æ„çœ‹è¿™é‡Œ ################# java version \u0026#34;1.8.0_202\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_202-b08) Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode) ############################## ---\u0026gt; 585c6ee10358 Removing intermediate container b888421b5460 Step 13/14 : EXPOSE 8080 ---\u0026gt; Running in fa69ece8e180 ---\u0026gt; c4af6c5056bc Removing intermediate container fa69ece8e180 Step 14/14 : CMD /home/tomcat/apache-tomcat-9.0.95/bin/catalina.sh run ---\u0026gt; Running in 2a007a3fd78f ---\u0026gt; e184d618916b Removing intermediate container 2a007a3fd78f Successfully built e184d618916b çœ‹ç€åº”è¯¥æ²¡é—®é¢˜\nå¯åŠ¨é•œåƒçœ‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 [root@status dockerfile]# docker run -d --name test_tomcat -p 8080:8080 test:v1 d14c7820921dd0150c1d4c9e9ff786164201f10f86c7dc63db6522ded8b2405a [root@status dockerfile]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES d14c7820921d test:v1 \u0026#34;/home/tomcat/apac...\u0026#34; 7 seconds ago Up 6 seconds 0.0.0.0:8080-\u0026gt;8080/tcp test_tomcat ae813af28fd9 registry.openanolis.cn/openanolis/anolisos:8 \u0026#34;/bin/bash\u0026#34; 5 hours ago Up 5 hours anolisos [root@status dockerfile]# docker logs test_tomcat 18-Sep-2024 07:16:34.224 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name: Apache Tomcat/9.0.95 18-Sep-2024 07:16:34.246 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built: Sep 13 2024 18:07:47 UTC 18-Sep-2024 07:16:34.247 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version number: 9.0.95.0 18-Sep-2024 07:16:34.247 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name: Linux 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version: 3.10.0-1160.118.1.el7.x86_64 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture: amd64 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home: /home/tomcat/jdk1.8.0_202/jre 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Version: 1.8.0_202-b08 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Vendor: Oracle Corporation 18-Sep-2024 07:16:34.248 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE: /home/tomcat/apache-tomcat-9.0.95 18-Sep-2024 07:16:34.249 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME: /home/tomcat/apache-tomcat-9.0.95 18-Sep-2024 07:16:34.263 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.config.file=/home/tomcat/apache-tomcat-9.0.95/conf/logging.properties 18-Sep-2024 07:16:34.263 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager 18-Sep-2024 07:16:34.263 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djdk.tls.ephemeralDHKeySize=2048 18-Sep-2024 07:16:34.263 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.protocol.handler.pkgs=org.apache.catalina.webresources 18-Sep-2024 07:16:34.264 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 18-Sep-2024 07:16:34.264 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dignore.endorsed.dirs= 18-Sep-2024 07:16:34.265 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.base=/home/tomcat/apache-tomcat-9.0.95 18-Sep-2024 07:16:34.265 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.home=/home/tomcat/apache-tomcat-9.0.95 18-Sep-2024 07:16:34.265 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.io.tmpdir=/home/tomcat/apache-tomcat-9.0.95/temp 18-Sep-2024 07:16:34.284 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent The Apache Tomcat Native library which allows using OpenSSL was not found on the java.library.path: [/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib] 18-Sep-2024 07:16:35.498 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\u0026#34;http-nio-8080\u0026#34;] 18-Sep-2024 07:16:35.604 INFO [main] org.apache.catalina.startup.Catalina.load Server initialization in [2074] milliseconds 18-Sep-2024 07:16:35.719 INFO [main] org.apache.catalina.core.StandardService.startInternal Starting service [Catalina] 18-Sep-2024 07:16:35.720 INFO [main] org.apache.catalina.core.StandardEngine.startInternal Starting Servlet engine: [Apache Tomcat/9.0.95] 18-Sep-2024 07:16:35.749 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/host-manager] 18-Sep-2024 07:16:36.660 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/host-manager] has finished in [910] ms 18-Sep-2024 07:16:36.661 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/docs] 18-Sep-2024 07:16:36.750 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/docs] has finished in [89] ms 18-Sep-2024 07:16:36.751 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/examples] 18-Sep-2024 07:16:37.540 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/examples] has finished in [789] ms 18-Sep-2024 07:16:37.540 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/ROOT] 18-Sep-2024 07:16:37.641 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/ROOT] has finished in [100] ms 18-Sep-2024 07:16:37.642 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/manager] 18-Sep-2024 07:16:37.730 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/home/tomcat/apache-tomcat-9.0.95/webapps/manager] has finished in [87] ms 18-Sep-2024 07:16:37.767 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [\u0026#34;http-nio-8080\u0026#34;] 18-Sep-2024 07:16:37.799 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in [2194] milliseconds çœ‹ç€å¯åŠ¨èµ·æ¥äº†\nè®¿é—® tomcat å‰å°çœ‹çœ‹ï¼Œæ²¡é—®é¢˜äº†\næ€»ç»“\rç¼–å†™ dockerfile çš„æ€è·¯ï¼Œå…¶å®å°±æ˜¯å®é™…æ‰‹åŠ¨é…ç½®çš„æ€è·¯ã€‚\nå°±ä»¥æ„å»º tomcat é•œåƒæ¥è¯´ï¼Œå¦‚æœæ˜¯æ‰‹å·¥æ“ä½œï¼š\néœ€è¦å‡†å¤‡ JDKã€tomcat åŒ… éœ€è¦è§£å‹ JDKã€tomcat åŒ… éœ€è¦é…ç½® JDK çš„ç¯å¢ƒå˜é‡ éœ€è¦å¼€é€š tomcat çš„ 8080 ç«¯å£ åœ¨ç¼–å†™ dockerfile çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯åŒç†ï¼š\nå‡†å¤‡å¥½çš„ JDKã€tomcat åŒ…æ”¾åˆ°é•œåƒçš„ä»€ä¹ˆåœ°æ–¹ï¼Ÿ ADD æŒ‡ä»¤ä¼šè‡ªåŠ¨è§£å‹ JDKã€tomcat åŒ…ï¼Œä»£æ›¿äº†æ‰‹åŠ¨æ‰§è¡Œ tar å‘½ä»¤ é…ç½® JDK çš„ç¯å¢ƒå˜é‡ æš´éœ² tomcat çš„ 8080 ç«¯å£ æœ€åï¼Œä½¿ç”¨ CMD æŒ‡ä»¤ï¼Œæ‰§è¡Œå¯åŠ¨ tomcat çš„å‘½ä»¤ è¿˜æœ‰å°±æ˜¯ï¼Œä¸€å®šå¾—æ³¨æ„ tomcat ç‰ˆæœ¬åº”è¯¥ä¸ JDK ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚\nå®è·µäºŒï¼šä»¥ anolisos ä¸ºåŸºç¡€é•œåƒï¼Œæ„å»º nginx é•œåƒ\rè¿˜æ˜¯ä»¥ anolisos ä¸ºåŸºç¡€é•œåƒï¼Œå¹¶åœ¨é‡Œè¾¹è¿è¡Œä¸€ä¸ª nginx æœåŠ¡ã€‚\nå®‰è£… nginx\ræ ¹æ®æ­¤æ–‡\nLinux å®‰è£… Nginx å¹¶é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼ˆè¶…è¯¦ç»†ï¼‰-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)\n1ï¼‰ä¸‹è½½ nginx å¹¶è§£å‹\n1 2 wget http://nginx.org/download/nginx-1.25.1.tar.gz tar -xzvf nginx-1.25.1.tar.gz /home/dockerfile_nginx 2ï¼‰é…ç½® nginx\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ./configure # å‡ºç°ä¸‹è¾¹è¡¨ç¤ºæˆåŠŸ Configuration summary + using system PCRE library + OpenSSL library is not used + md5: using system crypto library + sha1: using system crypto library + using system zlib library nginx path prefix: \u0026#34;/usr/local/nginx\u0026#34; nginx binary file: \u0026#34;/usr/local/nginx/sbin/nginx\u0026#34; nginx configuration prefix: \u0026#34;/usr/local/nginx/conf\u0026#34; nginx configuration file: \u0026#34;/usr/local/nginx/conf/nginx.conf\u0026#34; nginx pid file: \u0026#34;/usr/local/nginx/logs/nginx.pid\u0026#34; nginx error log file: \u0026#34;/usr/local/nginx/logs/error.log\u0026#34; nginx http access log file: \u0026#34;/usr/local/nginx/logs/access.log\u0026#34; nginx http client request body temporary files: \u0026#34;client_body_temp\u0026#34; nginx http proxy temporary files: \u0026#34;proxy_temp\u0026#34; nginx http fastcgi temporary files: \u0026#34;fastcgi_temp\u0026#34; nginx http uwsgi temporary files: \u0026#34;uwsgi_temp\u0026#34; nginx http scgi temporary files: \u0026#34;scgi_temp\u0026#34; ä¸€èˆ¬æ¥è®²ï¼Œè¿˜æ˜¯éœ€è¦å®‰è£… gcc ä¹‹ç±»çš„ä¾èµ–çš„ï¼Œå› ä¸ºæˆ‘è¿™ä¸ªæ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œé‡Œè¾¹çš„å†…å®¹éƒ½æ¯”è¾ƒå®Œæ•´ï¼Œå¯ä»¥ç›´æ¥é…ç½®ã€‚\n3ï¼‰ç¼–è¯‘å®‰è£…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 make \u0026amp;\u0026amp; make install # å‡ºç°ä¸‹è¾¹è¿™ä¸ª make -f objs/Makefile install make[1]: Entering directory `/home/dockerfile_nginx/nginx-1.9.9\u0026#39; test -d \u0026#39;/usr/local/nginx\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx\u0026#39; test -d \u0026#39;/usr/local/nginx/sbin\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx/sbin\u0026#39; test ! -f \u0026#39;/usr/local/nginx/sbin/nginx\u0026#39; || mv \u0026#39;/usr/local/nginx/sbin/nginx\u0026#39; \u0026#39;/usr/local/nginx/sbin/nginx.old\u0026#39; cp objs/nginx \u0026#39;/usr/local/nginx/sbin/nginx\u0026#39; test -d \u0026#39;/usr/local/nginx/conf\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/koi-win \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/koi-utf \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/win-utf \u0026#39;/usr/local/nginx/conf\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/mime.types\u0026#39; || cp conf/mime.types \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/mime.types \u0026#39;/usr/local/nginx/conf/mime.types.default\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/fastcgi_params\u0026#39; || cp conf/fastcgi_params \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/fastcgi_params \u0026#39;/usr/local/nginx/conf/fastcgi_params.default\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/fastcgi.conf\u0026#39; || cp conf/fastcgi.conf \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/fastcgi.conf \u0026#39;/usr/local/nginx/conf/fastcgi.conf.default\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/uwsgi_params\u0026#39; || cp conf/uwsgi_params \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/uwsgi_params \u0026#39;/usr/local/nginx/conf/uwsgi_params.default\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/scgi_params\u0026#39; || cp conf/scgi_params \u0026#39;/usr/local/nginx/conf\u0026#39; cp conf/scgi_params \u0026#39;/usr/local/nginx/conf/scgi_params.default\u0026#39; test -f \u0026#39;/usr/local/nginx/conf/nginx.conf\u0026#39; || cp conf/nginx.conf \u0026#39;/usr/local/nginx/conf/nginx.conf\u0026#39; cp conf/nginx.conf \u0026#39;/usr/local/nginx/conf/nginx.conf.default\u0026#39; test -d \u0026#39;/usr/local/nginx/logs\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx/logs\u0026#39; test -d \u0026#39;/usr/local/nginx/logs\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx/logs\u0026#39; test -d \u0026#39;/usr/local/nginx/html\u0026#39; || cp -R html \u0026#39;/usr/local/nginx\u0026#39; test -d \u0026#39;/usr/local/nginx/logs\u0026#39; || mkdir -p \u0026#39;/usr/local/nginx/logs\u0026#39; make[1]: Leaving directory `/home/dockerfile_nginx/nginx-1.9.9\u0026#39; å®ƒåˆ›å»ºäº† /usr/local/nginx ç›®å½•ï¼Œè¿™ä¸ªå°±æ˜¯ nginx çš„å®‰è£…ç›®å½•äº†ï¼Œæ—¥å¿—ã€å¯åŠ¨æ–‡ä»¶éƒ½åœ¨è¿™é‡Œã€‚\n4ï¼‰å¯åŠ¨å¹¶è®¿é—®\n1 2 3 4 5 6 7 [root@status sbin]# pwd /usr/local/nginx/sbin [root@status sbin]# ./nginx [root@status sbin]# ps -ef | grep nginx root 11694 1 0 15:53 ? 00:00:00 nginx: master process ./nginx nobody 11695 11694 0 15:53 ? 00:00:00 nginx: worker process root 11700 8800 0 15:53 pts/10 00:00:00 grep --color=auto nginx æ ¹æ®æ“ä½œæ­¥éª¤ç¼–å†™ dockerfile\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 # åŸºäºanolisos FROM registry.openanolis.cn/openanolis/anolisos:8 LABEL Author=\u0026#34;test\u0026#34; LABEL Remark=\u0026#34;æµ‹è¯•ä½¿ç”¨, åŸºäº anolisos åˆ¶ä½œ Nginx é•œåƒ\u0026#34; # è§£å‹åŒ…åˆ°å·¥ä½œç›®å½• ADD nginx-1.25.1.tar.gz /usr/local # å®‰è£…ç¼–è¯‘Nginxæ‰€éœ€çš„ä¾èµ– RUN yum install -y gcc make openssl-devel pcre-devel zlib-devel # è®¾ç½®ä¸»ç›®å½• WORKDIR /usr/local/nginx-1.25.1 # é…ç½®ã€ç¼–è¯‘å’Œå®‰è£…Nginx RUN ./configure \\ --prefix=/usr/local/nginx \\ --sbin-path=/usr/sbin/nginx \\ --conf-path=/etc/nginx/nginx.conf \\ --error-log-path=/var/log/nginx/error.log \\ --http-log-path=/var/log/nginx/access.log \\ --pid-path=/var/run/nginx.pid \\ --lock-path=/var/run/nginx.lock \\ --http-client-body-temp-path=/var/cache/nginx/client_temp \\ --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\ --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\ --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\ --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\ --user=nginx \\ --group=nginx \\ --with-http_ssl_module \\ --with-http_realip_module \\ --with-http_addition_module \\ --with-http_sub_module \\ --with-http_dav_module \\ --with-http_flv_module \\ --with-http_mp4_module \\ --with-http_gunzip_module \\ --with-http_gzip_static_module \\ --with-http_random_index_module \\ --with-http_secure_link_module \\ --with-http_stub_status_module \\ --with-mail \\ --with-mail_ssl_module \\ --with-file-aio \\ --with-ipv6 \\ --with-http_v2_module \\ --with-cc-opt=\u0026#34;-Wno-error\u0026#34; \\ \u0026amp;\u0026amp; make \\ \u0026amp;\u0026amp; make install # åˆ›å»ºæ—¥å¿—å’Œç¼“å­˜ç›®å½• RUN mkdir -p /var/log/nginx \u0026amp;\u0026amp; \\ mkdir -p /var/cache/nginx # æ‹·è´Nginxé…ç½®æ–‡ä»¶ COPY nginx.conf /etc/nginx/nginx.conf # æš´éœ²80ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—® EXPOSE 80 # å¯åŠ¨ nginx CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] nginx é…ç½®\ræŠŠ nginx.conf æ–‡ä»¶æ”¾åˆ° dockerfile ç›®å½•ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 user root; # é•œåƒé‡Œæ²¡æœ‰åˆ›å»º nginx ç”¨æˆ·ï¼ŒæŒ‡å®š root ç”¨æˆ·æ¥å¯åŠ¨æœåŠ¡ï¼Œä¸ç„¶ä¼šæŠ¥é”™ worker_processes auto; events { worker_connections 512; use epoll; } http { include mime.types; default_type application/octet-stream; access_log off; sendfile on; keepalive_timeout 75; server { listen 80; server_name 139.196.97.87; location / { proxy_pass http://139.196.97.87:8080; } } } æ„å»ºé•œåƒ\r1 2 3 4 5 6 7 8 [root@status dockerfile_nginx]# docker build -t nginx:v1 . ... Step 11/11 : CMD nginx -g daemon off; ---\u0026gt; Running in 145e8f62d60c ---\u0026gt; dcfd18bb9209 Removing intermediate container 145e8f62d60c Successfully built dcfd18bb9209 å¯åŠ¨é•œåƒ\r1 2 3 4 [root@status dockerfile_nginx]# docker run -d --name nginx -p 80:80 nginx:v1 a4f70aab39a1665802135a47d7a5bc2edf6c15093e0fef27fa4db82d0690f917 [root@status dockerfile_nginx]# docker logs nginx nginx: [emerg] getpwnam(\u0026#34;nginx\u0026#34;) failed è¿™é‡ŒæŠ¥é”™äº†ï¼Œæ²¡æœ‰æ‰¾åˆ° nginx ç”¨æˆ·ã€‚\n1ï¼‰åœ¨å®¹å™¨é‡Œåˆ›å»ºä¸€ä¸ª nginx ç”¨æˆ· 2ï¼‰æŒ‡å®š root ç”¨æˆ·ä¸ºå¯åŠ¨ Nginx çš„ç”¨æˆ· å¦‚æœæ˜¯ä½¿ç”¨ 1 æ–¹æ¡ˆçš„è¯ï¼Œåº”è¯¥å¾—åœ¨ dockerfile é‡Œ RUN ä¸€æ¡åˆ›å»º nginx ç”¨æˆ·çš„å‘½ä»¤\n1 useradd -r -s /sbin/nologin nginx æˆ‘ä½¿ç”¨äº† 2 æ–¹æ¡ˆï¼ŒæŒ‡å®š root ç”¨æˆ·å¯åŠ¨ã€‚åœ¨ nginx.conf æ·»åŠ ä¸€è¡Œ\n1 user root; æ·»åŠ åé‡æ–°æ„å»ºé•œåƒï¼Œç„¶åå¯åŠ¨ã€‚\n1 2 3 4 5 6 7 8 [root@status dockerfile_nginx]# docker run -d --name nginx -p 80:80 nginx:v1 ef443ef68ec75631a11ee52eeb2d8831610582a257154350cadb5af5ac72a97e [root@status dockerfile_nginx]# docker logs nginx [root@status dockerfile_nginx]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ef443ef68ec7 nginx:v1 \u0026#34;nginx -g \u0026#39;daemon ...\u0026#34; 50 seconds ago Up 48 seconds 0.0.0.0:80-\u0026gt;80/tcp nginx d14c7820921d test:v1 \u0026#34;/home/tomcat/apac...\u0026#34; 18 hours ago Up 18 hours 0.0.0.0:8080-\u0026gt;8080/tcp test_tomcat ae813af28fd9 registry.openanolis.cn/openanolis/anolisos:8 \u0026#34;/bin/bash\u0026#34; 24 hours ago Up 24 hours anolisos ä¸€åˆ‡æ­£å¸¸ï¼Œè®¿é—® IP:80 ç«¯å£ï¼ŒæˆåŠŸè·³è½¬åˆ° tomcat:8080 é¡µé¢ã€‚\næ„å»º Dockerfile è¿‡ç¨‹çš„é—®é¢˜\rå¦‚ä½•å°†æœ¬åœ°çš„æŸä¸ªåŒ…æ”¾åˆ°å®¹å™¨å†…éƒ¨ï¼Ÿ\réœ€è¦å°† rpm åŒ…æ”¾åˆ° centos å®¹å™¨å†…\n1.å¤åˆ¶æ–‡ä»¶å‘½ä»¤ cp\n1 [root@status home]# docker container cp wget-1.14-18.el7_6.1.x86_64.rpm centos7:/home/ 1 2 3 [root@9fb9bacc6189 home]# ll total 548 -rw-r--r-- 1 root root 560272 Sep 13 07:45 wget-1.14-18.el7_6.1.x86_64.rpm 2.åŠ è½½æ•°æ®å·ï¼Œä½†æ˜¯å®¹å™¨å†…å¯¹æ•°æ®å·é‡Œçš„å†…å®¹åšä¿®æ”¹ä¹Ÿä¼šå¯¼è‡´ä¸»æœºçš„å†…å®¹è¢«ä¿®æ”¹ï¼Œè¿™ä¸ªä¸é€‚ç”¨äºç°åœ¨çš„æƒ…å†µ\n3.æ„å»º Docker é•œåƒæ—¶ï¼Œä½¿ç”¨ ADD å‘½ä»¤æˆ–è€… COPY å‘½ä»¤ï¼Œå°†æ–‡ä»¶æ·»åŠ è¿›å»\n1 COPY /home/wget-1.14-18.el7_6.1.x86_64.rpm /home å¦‚ä½•å°†å®¹å™¨é‡Œæ‰“åŒ…å¥½çš„æ–‡ä»¶ä¼ å›ä¸»æœºï¼Ÿ\rç›´æ¥å¤åˆ¶åˆ°ä¸»æœº æŒ‚è½½æ•°æ®å·å®¹å™¨ é€šè¿‡ docker çš„ç®¡é“ - ä¼ å›ä¸»æœº å¤åˆ¶\rä»å®¹å™¨å¤åˆ¶åˆ°ä¸»æœº\n1 2 3 4 [root@status dockerfile]# docker container cp anolisos:/home/jdk.tar.gz /home/dockerfile/ [root@status dockerfile]# ll total 51100 -rw-r--r-- 1 root root 52325939 Sep 18 10:57 jdk.tar.gz Network å®è·µ\rå®è·µä¸€ï¼šnginx å®¹å™¨ä¸ tomcat å®¹å™¨äº’è”\rå‰æ\rä»ä¸Šè¾¹çš„å®è·µä¸€å’Œå®è·µäºŒï¼Œå¯ä»¥æˆåŠŸçš„æ„å»ºäº† tomcat é•œåƒä¸ nginx é•œåƒ\nå› ä¸ºæˆ‘çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ç½‘ç»œç­–ç•¥ï¼Œæ˜¯æŠŠ tomcat 8080 ç«¯å£å’Œ nginx 80 ç«¯å£éƒ½æ‰“å¼€äº†ï¼Œä¸Šè¾¹çš„ä¸¤ä¸ªé•œåƒï¼ŒæˆåŠŸçš„é€šè¿‡ nginx è·³è½¬åˆ° tomcat é¡µé¢ã€‚\n[!IMPORTANT]\nå®é™…é¡¹ç›®ä¸­ï¼Œå¦‚æœå¯¹å¤–ä½¿ç”¨äº† nginx åšåå‘ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡ï¼Œåˆ™ tomcatï¼ˆåº”ç”¨ï¼‰ çš„ IPå’Œç«¯å£æ˜¯ä¸å¯¹å¤–å¼€æ”¾çš„ï¼Œç»Ÿä¸€é€šè¿‡ nginx è·³è½¬åº”ç”¨ã€‚\næ‰€ä»¥æˆ‘æŠŠé˜¿é‡Œäº‘æœåŠ¡å™¨ç½‘ç»œç­–ç•¥ä¸­ tomcat 8080 ç«¯å£å…³æ‰ï¼Œè¿™æ · tomcat å°±æ— æ³•è®¿é—®ï¼ŒåŒæ—¶ nginx å°±è·³è½¬ä¸åˆ° tomcat ä¸Šäº†ã€‚\n[!IMPORTANT]\nåœ¨ä¸»æœº 8080 ç«¯å£å…³é—­çš„å‰æä¸‹ï¼Œä¸ºäº†èƒ½å¤Ÿè®© nginx æˆåŠŸè·³è½¬åˆ° tomcat ï¼Œä»å®¹å™¨å†…éƒ¨å‡ºå‘ã€‚ä½¿ç”¨ docker çš„ network æœºåˆ¶ï¼Œå°† nginx å®¹å™¨å’Œ tomcat å®¹å™¨éƒ½åŠ å…¥åˆ°åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œè®©å®ƒä»¬èƒ½å¤Ÿäº’ç›¸è®¿é—®ã€‚\nè¿™æ ·ï¼Œå¤–éƒ¨åªéœ€è¦è®¿é—® nginx ï¼Œç„¶å nginx é€šè¿‡ docker network è®¿é—® tomcat ã€‚\nè¿™ä¸ªå®è·µæ˜¯åŸºäºä¸Šè¾¹çš„å®è·µä¸€ã€å®è·µäºŒæ¥æ“ä½œçš„ã€‚ é…ç½® network å®¹å™¨äº’è”\råˆ›å»ºç½‘ç»œï¼Œå°† nginx å’Œ tomcat å®¹å™¨éƒ½æ‹‰è¿›æ¥\n1 2 3 4 [root@status dockerfile_nginx]# docker network create ng_web_network ddc7f8925ad5df07beabacb8c0f556f152fef9f937cf48c97fdd8078a3f49e14 [root@status dockerfile_nginx]# docker network connect ng_web_network nginx [root@status dockerfile_nginx]# docker network connect ng_web_network test_tomcat æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…ï¼Œé‡Œè¾¹æœ‰ä¸¤ä¸ªå®¹å™¨äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [root@status dockerfile_nginx]# docker network inspect ng_web_network [ { \u0026#34;Name\u0026#34;: \u0026#34;ng_web_network\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;ddc7f8925ad5df07beabacb8c0f556f152fef9f937cf48c97fdd8078a3f49e14\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2024-09-19T09:55:24.921745354+08:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.19.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.19.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;d14c7820921dd0150c1d4c9e9ff786164201f10f86c7dc63db6522ded8b2405a\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;test_tomcat\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;da006a7767d6937f310880a114c7d24a085c87573c84a9b47b91c99f79211473\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:13:00:03\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.19.0.3/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ef443ef68ec75631a11ee52eeb2d8831610582a257154350cadb5af5ac72a97e\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nginx\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;19569264099f4fdd3723309ff9512a2dbe9b6eea3b51e7318b2e8c1dba1a4074\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:13:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.19.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: {}, \u0026#34;Labels\u0026#34;: {} } ] nginx è·³è½¬ tomcat å¤±è´¥\r[!IMPORTANT]\nnginx è¿˜æ˜¯è·³è½¬ä¸åˆ° tomcatï¼Œé—®äº† AI ï¼š\nå› ä¸ºæˆ‘åœ¨ã€dockerfile å®è·µä¸€ã€‘é‡Œï¼Œå¯¹ tomcat å®¹å™¨çš„ç«¯å£è¿›è¡Œæ˜ å°„ï¼Œå°† tomcat 8080 ç«¯å£æ˜ å°„åˆ°äº†ä¸»æœº 8080 ç«¯å£ã€‚ä¸çŸ¥é“ä¸ºå•¥ä¸èƒ½è¿™æ ·ï¼Œå…ˆè¯•è¯•ã€‚\næ‰€ä»¥æˆ‘ç”¨é•œåƒå†ç”Ÿæˆä¸€ä¸ªæ²¡æœ‰æ˜ å°„ç«¯å£çš„ tomcat å®¹å™¨ï¼Œçœ‹çœ‹æ•ˆæœã€‚\n1ï¼‰é‡æ–°æ‰§è¡Œé•œåƒï¼Œå¹¶åŠ å…¥åˆ° network ä¸­\n1 2 [root@status ~]# docker run -d --name tomcat --network ng_web_network test:v1 fe5b1183ab41931e8e4c33c8c6cd4b03b4c098cd6212c91986a78b006c9a2533 2ï¼‰æŠŠæœ‰ç«¯å£æ˜ å°„çš„å®¹å™¨ä»è¿™ä¸ª network ä¸­ç§»é™¤\n1 docker network disconnect ng_web_network test_tomcat 3ï¼‰æ‰“å¼€ä»£ç†åœ°å€çœ‹çœ‹èƒ½å¦è·³è½¬\nä¸€èˆ¬å‡ºç°äº†è¿æ¥è¶…æ—¶ï¼Œè‚¯å®šæ˜¯ç½‘ç»œæ²¡é€š\næŸ¥çœ‹ç½‘ç»œï¼Œæ²¡ååº”ï¼Œè¯´æ˜æ²¡é€š\n1 [root@status ~]# docker exec -it nginx curl http://139.196.97.87:808 ç½‘ç»œæ²¡é€šçš„åŸå› \r[!IMPORTANT]\nDocker ç½‘ç»œå†…éƒ¨ä½¿ç”¨ DNS æœåŠ¡æ¥è§£æå®¹å™¨åç§°åˆ°å…¶ IP åœ°å€çš„æ˜ å°„ã€‚\nå½“åœ¨ä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­å¯åŠ¨å®¹å™¨æ—¶ï¼ŒDocker ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ï¼Œå¹¶æ³¨å†Œå…¶å®¹å™¨åç§°åˆ° Docker å†…éƒ¨ DNS æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œåœ¨åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–å®¹å™¨å¯ä»¥ä½¿ç”¨å®¹å™¨åç§°æ¥è®¿é—®å®ƒã€‚\nçœ‹ä¸€ä¸‹è¿™ä¸ª network é‡Œè¾¹å®¹å™¨çš„ IP\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [root@status ~]# docker network inspect ng_web_network ... \u0026#34;Containers\u0026#34;: { \u0026#34;ef443ef68ec75631a11ee52eeb2d8831610582a257154350cadb5af5ac72a97e\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nginx\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;19569264099f4fdd3723309ff9512a2dbe9b6eea3b51e7318b2e8c1dba1a4074\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:13:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.19.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;fe5b1183ab41931e8e4c33c8c6cd4b03b4c098cd6212c91986a78b006c9a2533\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;tomcat\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;0c304895c8bdb0c149cb8ded2511d79d851be71059174e35551fbe80ce2e14e1\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:13:00:04\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.19.0.4/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } ... åœ¨ã€Dockerfile å®è·µ - å®è·µäºŒ - 3 nginx é…ç½®ã€‘ä¸­ï¼Œé…ç½®çš„è·³è½¬çš„ IP æ˜¯æˆ‘ä¸»æœºçš„ IPï¼Œè€Œè¿™ä¸ª tomcat æ˜¯è¿è¡Œåœ¨å®¹å™¨é‡Œçš„ï¼Œå®é™…çš„ tomcat åœ°å€åº”è¯¥æ˜¯ 172.19.0.4:8080 ï¼Œæˆ‘é€šè¿‡ nginx çš„åœ°å€ 139.196.97.87:80 è·³è½¬åˆ° 172.19.0.4:8080 æ‰å¯¹ã€‚å› ä¸º docker network æ˜¯ä½¿ç”¨å®¹å™¨åæ¥è§£æå®¹å™¨çš„ IPï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±éœ€è¦è·³è½¬åˆ° tomcat:8080 ã€‚\nè§£å†³é—®é¢˜\rå¥½äº†ï¼Œæ˜ç™½åŸå› ï¼Œæ”¹ä¸€ä¸‹ nginx.conf é…ç½®ï¼Œç„¶åæ›´æ–°åˆ° nginx å®¹å™¨å†…éƒ¨ /etc/nginx/nginx.conf\n1ï¼‰nginx.conf é…ç½®æ”¹ä¸ºè¿™æ ·\n1 2 3 4 5 6 server { listen 80; server_name 139.196.97.87; location / { proxy_pass http://tomcat:8080; } 2ï¼‰ä½¿ç”¨ cp å‘½ä»¤ä¼ è¿›å»ï¼Œç„¶åé‡å¯ nginx æœåŠ¡\n1 2 3 4 # ä¼ è¿›å» docker container cp nginx.conf nginx:/etc/nginx/nginx.conf # é‡å¯ docker exec nginx nginx -s reload nginx -s reload æ˜¯é‡å¯ nginx å‘½ä»¤\nç„¶åè®¿é—® 139.196.97.87:80 ï¼ŒæˆåŠŸè·³è½¬\næ€»ç»“\råº”ç”¨å¦‚æœæ˜¯é€šè¿‡ nginx è·³è½¬ï¼Œåˆ™åº”ç”¨å®¹å™¨ä¸éœ€è¦æ˜ å°„ç«¯å£ åº”ç”¨é€šè¿‡ nginx è·³è½¬ï¼Œå°†åº”ç”¨å’Œ nginx å®¹å™¨éƒ½åŠ å…¥åˆ°åŒä¸€ä¸ª network ä¸­å³å¯å®ç°äº’ç›¸è®¿é—® åœ¨åŒä¸€ä¸ª network ä¸­ï¼Œä½¿ç”¨å®¹å™¨åè§£æå®¹å™¨çš„IPï¼Œæ‰€ä»¥ç›¸å…³é…ç½®åº”è¯¥å¡«å†™å®¹å™¨å ç–‘é—®\r1.å¦‚æœå…ˆæ˜ å°„äº†ç«¯å£ï¼Œåç»­æƒ³ç”¨ nginx åšä»£ç†çš„è¯ï¼Œå¦‚ä½•æ¸…é™¤åŸæ¥çš„ç«¯å£æ˜ å°„ï¼Ÿå¦‚æœé‡æ–°ç”Ÿæˆå®¹å™¨ï¼ŒåŸæ¥çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ\n2.æ—¥å¿—æ€ä¹ˆå¤„ç†ï¼Ÿåº”ç”¨çš„æ—¥å¿—ã€nginx çš„æ—¥å¿—æ€ä¹ˆå¿«é€Ÿçš„æŸ¥çœ‹ï¼Ÿæ€ä¹ˆåšå½’é›†åˆ°ä¸“é—¨çš„æ—¥å¿—ç›®å½•é‡Œï¼Ÿ\n","date":"2024-09-13T13:56:41+08:00","permalink":"http://localhost:1313/posts/2024/09/docker-dockerfile%E4%B8%8Enetwork%E5%AE%9E%E8%B7%B5/","title":"Docker dockerfileæ„å»ºé•œåƒä¸networkå®è·µ"},{"content":" æ ¹æ®ã€Šdocker æŠ€æœ¯å…¥é—¨ä¸å®è·µï¼ˆç¬¬ 3 ç‰ˆï¼‰ã€‹è¿›è¡Œå­¦ä¹ \nå¯¹å‘½ä»¤æœ‰ç–‘é—®ï¼Œå¯ä½¿ç”¨ï¼š\n1ï¼‰docker å‘½ä»¤ \u0026ndash;help\n2ï¼‰man docker å‘½ä»¤\næŸ¥çœ‹å¸®åŠ©ï¼Œå…¶ä¸­ man docker å‘½ä»¤ é‡Œè¾¹æœ‰è¯¦ç»†çš„è§£é‡Šï¼ŒåŒ…æ‹¬ç¤ºä¾‹\nDocker å®‰è£…çš„ç›®å½•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 [root@status volumes]# cd /var/lib/docker/ [root@status docker]# ll total 36 drwx------ 4 root root 4096 Aug 30 13:23 containers\t# å®¹å™¨ drwx------ 3 root root 4096 Jul 22 14:58 image\t# é•œåƒ drwxr-x--- 3 root root 4096 Jul 22 14:58 network\t# ç½‘ç»œ drwx------ 10 root root 4096 Aug 30 13:28 overlay2 drwx------ 4 root root 4096 Jul 22 14:58 plugins drwx------ 2 root root 4096 Jul 22 14:58 swarm drwx------ 2 root root 4096 Aug 29 14:52 tmp drwx------ 2 root root 4096 Jul 22 14:58 trust drwx------ 3 root root 4096 Aug 30 16:27 volumes\t# æ•°æ®å· Docker æ ¸å¿ƒæ¦‚å¿µ\rä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µï¼š\né•œåƒ image å®¹å™¨ container ä»“åº“ repository Docker å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯å›´ç»•è¿™ä¸‰ä¸ªæ ¸å¿ƒè¿›è¡Œ\né•œåƒ\ré•œåƒæ˜¯åˆ›å»ºå®¹å™¨çš„åŸºç¡€ï¼šè¿è¡Œé•œåƒ \u0026raquo; ç”Ÿæˆå®¹å™¨ é•œåƒæœ¬èº«æ˜¯åªè¯»çš„ã€‚ [!IMPORTANT]\nå¯åŠ¨é•œåƒç”Ÿæˆå®¹å™¨çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šåœ¨é•œåƒçš„æœ€ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ã€‚ å¯ä»¥æŠŠé•œåƒçœ‹ä½œä¸€å—å…‰ç›˜ï¼Œé‡Œè¾¹æœ‰é»‘ç¥è¯ï¼Œç›´æ¥æ’å…¥å…‰ç›˜ï¼Œæ¸¸æˆå°±å¯ä»¥è¿è¡Œï¼Œçœå»ä¸åŒå¹³å°ä¸‹è½½å®‰è£…çš„éº»çƒ¦ã€‚\nå®¹å™¨\rå®¹å™¨å°±æ˜¯ä¸€ä¸ªç›’å­ï¼Œé‡Œè¾¹æ‰“åŒ…æ”¾äº†å¾ˆå¤šä¸œè¥¿ï¼šæ“ä½œç³»ç»Ÿã€è¿›ç¨‹ã€ç½‘ç»œã€ç”¨æˆ·ç­‰ã€‚\nä»“åº“\rä»“åº“æ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä»“åº“å°±æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œå„ä¸ªé•œåƒæ–‡ä»¶é€šè¿‡ä¸åŒçš„æ ‡ç­¾è¿›è¡ŒåŒºåˆ†ã€‚\nä»“åº“æœ‰å…¬å¼€ä»“åº“å’Œç§æœ‰ä»“åº“\nDocker åŸºç¡€\rDocker é•œåƒ\ræœç´¢é•œåƒ\rä½¿ç”¨ search å‘½ä»¤åœ¨ Docker ä»“åº“ä¸­æœç´¢é•œåƒ\n1 2 3 4 5 docker search é•œåƒå # ä¾‹å­ docker search nginx docker search centos è·å–é•œåƒ\r1 docker pull é•œåƒå[:æ ‡ç­¾] è¿™é‡Œçš„æ ‡ç­¾å°±æ˜¯è¿™ä¸ªé•œåƒçš„ç‰ˆæœ¬å·ï¼Œå¯å¿½ç•¥ï¼Œä¸æŒ‡å®šçš„è¯ä¼šé»˜è®¤ä¸‹è½½ä»“åº“ä¸­æœ€æ–°ç‰ˆæœ¬ï¼ˆlatestï¼‰çš„é•œåƒã€‚ä¸€èˆ¬ä»ç¨³å®šæ€§è€ƒè™‘ï¼Œæœ€å¥½è¿˜æ˜¯è¾“å…¥æ ‡ç­¾ï¼Œè®©å„ä¸ªç¯å¢ƒçš„ç‰ˆæœ¬ä¸€è‡´ã€‚\nä½†æ˜¯ä¸€å¼€å§‹å¦‚ä½•çŸ¥é“ pull äº†ä»€ä¹ˆç‰ˆæœ¬çš„é•œåƒå‘¢ï¼Ÿ\nå½“æˆ‘ä»¬ pull é•œåƒåˆ°æœ¬æœºï¼Œå¯ä»¥ä½¿ç”¨ docker inspect æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯ã€‚ç„¶åé‡Œè¾¹ä¼šæœ‰ç›¸å…³çš„ä¿¡æ¯ç‰ˆæœ¬ï¼Œæ¯”å¦‚è¿™é‡Œçš„ nginx_version=1.21.5\n1 2 3 4 5 6 \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;NGINX_VERSION=1.21.5\u0026#34;, \u0026#34;NJS_VERSION=0.7.1\u0026#34;, \u0026#34;PKG_RELEASE=1~bullseye\u0026#34; ] ç„¶åå¯ä»¥ç»™è¿™ä¸ªé•œåƒæ‰“ä¸Šç‰ˆæœ¬çš„ tag\n1 docker tag nginx:latest naginx:1.21.5 æŸ¥çœ‹é•œåƒä¿¡æ¯\rDocker é•œåƒçš„ä¿¡æ¯å¯ä»¥é€šè¿‡ç›¸å…³å‘½ä»¤æŸ¥çœ‹\nä½¿ç”¨ images å‘½ä»¤åˆ—å‡ºé•œåƒ\r1 2 3 # 2 ç§æŸ¥çœ‹å‘½ä»¤ docker images docker image ls åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šå·²æœ‰é•œåƒçš„åŸºæœ¬ä¿¡æ¯\n1 2 3 4 5 6 [root@status ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB [root@status ~]# docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB åŸºæœ¬ä¿¡æ¯è§£é‡Šå¦‚ä¸‹ï¼š\nREPOSITORY - æ¥æºå“ªä¸ªåº“\nTAG - é•œåƒæ ‡ç­¾ï¼ˆç‰ˆæœ¬ï¼‰\nIMAGE_ID - é•œåƒID\nCREATED - åˆ›å»ºæ—¶é—´\nSIZE - é•œåƒå¤§å°\nä½¿ç”¨ tag å‘½ä»¤æ·»åŠ é•œåƒæ ‡ç­¾\rå¯ä»¥ä½¿ç”¨ docker tag å‘½ä»¤ä¸ºæœ¬åœ°é•œåƒæ·»åŠ æ–°çš„æ ‡ç­¾\n1 docker tag é•œåƒå:æ ‡ç­¾ æ–°é•œåƒå:æ–°æ ‡ç­¾ ç›¸ç­‰äºè¿™ä¸ªé•œåƒçš„åˆ«åï¼Œå› ä¸ºæ·»åŠ æ–°çš„æ ‡ç­¾ï¼Œå®ƒä¿©çš„é•œåƒIDæ˜¯ä¸€æ ·çš„ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªé•œåƒã€‚è·Ÿ Linux é‡Œçš„ é“¾æ¥ ç±»ä¼¼ã€‚\nè¿™ä¸ªä¾‹å­ï¼Œç»™ centos:latest é•œåƒæ·»åŠ æ–°çš„æ ‡ç­¾ test:10086\n1 2 3 4 5 [root@status ~]# docker tag centos:latest test:10086 [root@status ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB test 10086 5d0da3dc9764 2 years ago 231 MB ä½¿ç”¨ inspect å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯\rä½¿ç”¨ docker inspect å‘½ä»¤è·å–é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼šåˆ¶ä½œè€…ã€é€‚ç”¨æ¡†æ¶ã€å„å±‚æ•°å­—æ‘˜è¦ç­‰\n1 2 docker inspect é•œåƒå[:æ ‡ç­¾] docker inspect é•œåƒID ä½¿ç”¨ history å‘½ä»¤æŸ¥çœ‹é•œåƒå†å²\ré•œåƒæ–‡ä»¶ç”±å¤šä¸ªå±‚ç»„æˆï¼ŒæŸ¥çœ‹å„ä¸ªå±‚çš„å†…å®¹å…·ä½“æ˜¯ä»€ä¹ˆï¼Œä½¿ç”¨ history å‘½ä»¤\n1 2 3 4 5 [root@status test]# docker history centos IMAGE CREATED CREATED BY SIZE COMMENT 5d0da3dc9764 2 years ago /bin/sh -c #(nop) CMD [\u0026#34;/bin/bash\u0026#34;] 0 B \u0026lt;missing\u0026gt; 2 years ago /bin/sh -c #(nop) LABEL org.label-schema.... 0 B \u0026lt;missing\u0026gt; 2 years ago /bin/sh -c #(nop) ADD file:805cb5e15fb6e0b... 231 MB åˆ é™¤é•œåƒ\rdocker rmi æˆ–è€… docker image rm å‘½ä»¤å¯ä»¥åˆ é™¤é•œåƒ\nä½¿ç”¨åç§°+æ ‡ç­¾åˆ é™¤é•œåƒ\r1 2 3 4 5 docker rmi é•œåƒå[:æ ‡ç­¾] docker image rm é•œåƒå[:æ ‡ç­¾] docker rmi [options] é•œåƒå[:æ ‡ç­¾] docker image rm [options] é•œåƒå[:æ ‡ç­¾] è¯¥å‘½ä»¤æ”¯æŒçš„é€‰é¡¹ï¼š\n-force å¼ºåˆ¶åˆ é™¤é•œåƒï¼Œæœ‰å®¹å™¨ä¾èµ–è¿™ä¸ªé•œåƒï¼Œä¹Ÿä¼šåˆ é™¤ -no-prune ä¸è¦æ¸…ç†æœªå¸¦æ ‡ç­¾çš„çˆ¶é•œåƒ 1 docker rmi -force -no-prune é•œåƒå[:æ ‡ç­¾] ä¾‹å­ï¼šåˆ é™¤ã€1.3.2ã€‘æ­¥éª¤ä¸­çš„ test:10086 é•œåƒæ ‡ç­¾\n1 2 3 4 5 6 [root@status test]# docker rmi test:10086 Untagged: test:10086 Untagged: docker.io/centos@sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177 [root@status test]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB ä¾‹å­ï¼šå½»åº•åˆ é™¤é•œåƒï¼Œå½“è¯¥é•œåƒæ²¡æœ‰ä»»ä½•æ ‡ç­¾çš„æ—¶å€™ï¼Œåˆ é™¤é•œåƒï¼Œå°±çœŸçš„æ²¡æœ‰äº†\n1 [root@status test]# docker rmi centos:latest ä½¿ç”¨é•œåƒIDåˆ é™¤é•œåƒ\rä½¿ç”¨é•œåƒIDè¿›è¡Œåˆ é™¤ï¼Œä¼šå°†è¯¥é•œåƒ+å®ƒçš„æ ‡ç­¾ï¼Œä¸€èµ·åˆ é™¤\n1 docker rmi é•œåƒID é•œåƒå·²ç»è¿è¡Œï¼Œç”Ÿæˆå®¹å™¨äº†ï¼Œé‚£è¿™ä¸ªé•œåƒæ˜¯æ— æ³•è¢«åˆ é™¤çš„ã€‚å¯ä»¥é€šè¿‡ -force å¼ºåˆ¶åˆ é™¤ã€‚ 1 docker rmi -force é•œåƒID ä¸æ¨èç›´æ¥åˆ é™¤é•œåƒçš„ï¼Œåº”è¯¥å…ˆåˆ é™¤è¯¥é•œåƒç›¸å…³çš„å®¹å™¨ï¼Œå†åˆ é™¤é•œåƒ 1 2 docker rm å®¹å™¨ID docker rmi é•œåƒID æ¸…ç†é•œåƒ\råœ¨ Docker ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå¯èƒ½ä¼šé—ç•™ä¸€äº›ä¸´æ—¶çš„é•œåƒæ–‡ä»¶ï¼Œä»¥åŠä¸€äº›æ²¡æœ‰ä½¿ç”¨çš„é•œåƒï¼Œå¯ä»¥é€šè¿‡ docker image prune å‘½ä»¤æ¸…ç†æ‰ã€‚\n1 docker image prune è¯¥å‘½ä»¤æ”¯æŒçš„é€‰é¡¹ï¼š\n-a åˆ é™¤æ‰€æœ‰æ— ç”¨é•œåƒï¼ˆä¸´æ—¶ + æ²¡æœ‰è¢«ä½¿ç”¨çš„ï¼‰ -f å¼ºåˆ¶åˆ é™¤ -filter åªæ¸…ç†å¤æ ¸ç»™å®šè¿‡æ»¤å™¨çš„é•œåƒ ä¾‹å­ï¼šè‡ªåŠ¨æ¸…ç†ä¸´æ—¶çš„é•œåƒæ–‡ä»¶å±‚\n1 2 [root@status test]# docker image prune -f Total reclaimed space: 0 B åˆ›å»ºé•œåƒ\råˆ›å»ºé•œåƒçš„æ–¹æ³•ï¼š\nåŸºäºå·²æœ‰å®¹å™¨åˆ›å»ºï¼ˆå‰ææ˜¯è¿™ä¸ªå®¹å™¨çš„é•œåƒè¿˜åœ¨ï¼‰ åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥ åŸºäº Dockerfile åˆ›å»º åŸºäºå·²æœ‰å®¹å™¨åˆ›å»º\rä½¿ç”¨ docker commit å‘½ä»¤\n1 docker commit å®¹å™¨ID é•œåƒå[:æ ‡ç­¾] æ”¯æŒçš„é€‰é¡¹ï¼š\n-a ä½œè€…ä¿¡æ¯ -m ç»™è¿™ä¸ªé•œåƒæ·»åŠ å¤‡æ³¨ï¼ˆå¯ä»¥ä½¿ç”¨ docker inspect é•œåƒå[:æ ‡ç­¾] æŸ¥çœ‹ï¼Œå…·ä½“è§ã€1.3.3ã€‘æ­¥éª¤ï¼‰ -p æäº¤æ—¶æš‚åœå®¹å™¨çš„è¿è¡Œï¼ˆä¸€èˆ¬ä¸ç”¨çš„å§ï¼Ÿï¼‰ ä¾‹å­\r1ï¼‰å…ˆå¯åŠ¨ä¸€ä¸ªé•œåƒï¼Œå¹¶åˆ°å®¹å™¨é‡Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤\n1 2 3 4 [root@status go]# docker run -it centos:latest /bin/bash [root@720ef900dddc /]# touch test [root@720ef900dddc /]# exit exit è¿™ä¸ªå®¹å™¨ID = 720ef900dddc\nè¿™ä¸ªå®¹å™¨ï¼Œå› ä¸ºå·²ç»åœ¨é‡Œè¾¹è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œå®¹å™¨å†…å®¹ä¸å®ƒçš„é•œåƒå†…å®¹å·²ç»ä¸ä¸€æ ·äº†ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥åŸºäºè¿™ä¸ªå®¹å™¨è¿›è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå‡ºæ¥ã€‚\n2ï¼‰åŸºäºè¿™ä¸ªå®¹å™¨åˆ›å»ºæ–°çš„é•œåƒ\n1 2 [root@status go]# docker commit -m \u0026#34;Add a new file\u0026#34; -a \u0026#34;weiqi\u0026#34; 720ef900dddc test:20240829_V1 sha256:9e0017db11d154d7c08c964a14745afd25a667a7b82b68a8a61381bd7a5de205 è¯¦è§£ï¼š\n-m ç»™è¿™ä¸ªé•œåƒåŠ å¤‡æ³¨\n-a ä½œè€…ä¿¡æ¯\n720ef900dddc å®¹å™¨ID\ntest:20240829_V1 é•œåƒå:æ ‡ç­¾\n3ï¼‰æŸ¥çœ‹é•œåƒåˆ—è¡¨\n1 2 3 4 [root@status go]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE test 20240829_V1 9e0017db11d1 50 seconds ago 231 MB docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„é•œåƒ test\nå¯ä»¥ä½¿ç”¨ docker inspect 9e0017db11d1 æŸ¥çœ‹å®ƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé‡Œè¾¹å°±æœ‰ä½œè€…ä¿¡æ¯ã€é•œåƒçš„å¤‡æ³¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 [root@status go]# docker inspect 9e0017db11d1 [ { \u0026#34;Id\u0026#34;: \u0026#34;sha256:9e0017db11d154d7c08c964a14745afd25a667a7b82b68a8a61381bd7a5de205\u0026#34;, \u0026#34;RepoTags\u0026#34;: [ \u0026#34;test:20240829_V1\u0026#34; ], \u0026#34;RepoDigests\u0026#34;: [], \u0026#34;Parent\u0026#34;: \u0026#34;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6\u0026#34;, \u0026#34;Comment\u0026#34;: \u0026#34;Add a new file\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2024-08-29T06:26:49.211537969Z\u0026#34;, \u0026#34;Container\u0026#34;: \u0026#34;720ef900dddc4666e553ed9c26458b6fd4df541fa0939930b4479925d2ca2f0e\u0026#34;, \u0026#34;ContainerConfig\u0026#34;: { \u0026#34;Hostname\u0026#34;: \u0026#34;720ef900dddc\u0026#34;, \u0026#34;Domainname\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;User\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;AttachStdin\u0026#34;: true, \u0026#34;AttachStdout\u0026#34;: true, \u0026#34;AttachStderr\u0026#34;: true, \u0026#34;Tty\u0026#34;: true, \u0026#34;OpenStdin\u0026#34;: true, \u0026#34;StdinOnce\u0026#34;: true, \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34; ], \u0026#34;Cmd\u0026#34;: [ \u0026#34;/bin/bash\u0026#34; ], \u0026#34;Image\u0026#34;: \u0026#34;centos:latest\u0026#34;, \u0026#34;Volumes\u0026#34;: null, \u0026#34;WorkingDir\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Entrypoint\u0026#34;: null, \u0026#34;OnBuild\u0026#34;: null, \u0026#34;Labels\u0026#34;: { \u0026#34;org.label-schema.build-date\u0026#34;: \u0026#34;20210915\u0026#34;, \u0026#34;org.label-schema.license\u0026#34;: \u0026#34;GPLv2\u0026#34;, \u0026#34;org.label-schema.name\u0026#34;: \u0026#34;CentOS Base Image\u0026#34;, \u0026#34;org.label-schema.schema-version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;org.label-schema.vendor\u0026#34;: \u0026#34;CentOS\u0026#34; } }, \u0026#34;DockerVersion\u0026#34;: \u0026#34;1.13.1\u0026#34;, \u0026#34;Author\u0026#34;: \u0026#34;weiqi\u0026#34;, \u0026#34;Config\u0026#34;: { \u0026#34;Hostname\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Domainname\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;User\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;AttachStdin\u0026#34;: false, \u0026#34;AttachStdout\u0026#34;: false, \u0026#34;AttachStderr\u0026#34;: false, \u0026#34;Tty\u0026#34;: false, \u0026#34;OpenStdin\u0026#34;: false, \u0026#34;StdinOnce\u0026#34;: false, \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34; ], \u0026#34;Cmd\u0026#34;: [ \u0026#34;/bin/bash\u0026#34; ], \u0026#34;Image\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Volumes\u0026#34;: null, \u0026#34;WorkingDir\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Entrypoint\u0026#34;: null, \u0026#34;OnBuild\u0026#34;: null, \u0026#34;Labels\u0026#34;: { \u0026#34;org.label-schema.build-date\u0026#34;: \u0026#34;20210915\u0026#34;, \u0026#34;org.label-schema.license\u0026#34;: \u0026#34;GPLv2\u0026#34;, \u0026#34;org.label-schema.name\u0026#34;: \u0026#34;CentOS Base Image\u0026#34;, \u0026#34;org.label-schema.schema-version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;org.label-schema.vendor\u0026#34;: \u0026#34;CentOS\u0026#34; } }, \u0026#34;Architecture\u0026#34;: \u0026#34;amd64\u0026#34;, \u0026#34;Os\u0026#34;: \u0026#34;linux\u0026#34;, \u0026#34;Size\u0026#34;: 231268873, \u0026#34;VirtualSize\u0026#34;: 231268873, \u0026#34;GraphDriver\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;Data\u0026#34;: { \u0026#34;LowerDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/c36ca0390a29eaefd180fcb6f80d57f127acfa92b9bedbd09a6d84c3a2e6e9f2/diff\u0026#34;, \u0026#34;MergedDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/8548138b25638a23cdff292a6548e6e8698d59d98afde1866ea91684cfd2600b/merged\u0026#34;, \u0026#34;UpperDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/8548138b25638a23cdff292a6548e6e8698d59d98afde1866ea91684cfd2600b/diff\u0026#34;, \u0026#34;WorkDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/8548138b25638a23cdff292a6548e6e8698d59d98afde1866ea91684cfd2600b/work\u0026#34; } }, \u0026#34;RootFS\u0026#34;: { \u0026#34;Type\u0026#34;: \u0026#34;layers\u0026#34;, \u0026#34;Layers\u0026#34;: [ \u0026#34;sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59\u0026#34;, \u0026#34;sha256:b43592c44888d32269515c418d4f4d02b9517cc0642ef2960bbe9c4efbd0924c\u0026#34; ] } } ] åŸºäºæœ¬åœ°æ¨¡æ¿å¯¼å…¥é•œåƒ\rä½¿ç”¨ docker import å‘½ä»¤\n1 docker import fileName - é•œåƒå:æ ‡ç­¾ è¿™ä¸ªå°±ä¸è¯•äº†ï¼Œæ²¡æœ‰æœ¬åœ°æ¨¡æ¿\nåŸºäº Dockerfile åˆ›å»ºé•œåƒ\rå®é™…å·¥ä½œä¸­ï¼Œè¿™ä¸ªæ–¹å¼æœ€å¸¸è§\nDockerfile æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ©ç”¨ç»™å®šçš„æŒ‡ä»¤æè¿°åŸºäºæŸä¸ªçˆ¶é•œåƒåˆ›å»ºæ–°çš„é•œåƒã€‚å®ƒé‡Œè¾¹ç›¸å½“äºæè¿°äº†åˆ›å»ºçš„è¿‡ç¨‹ã€‚\nä¾‹å­\ræ²¡æœ‰ä¾‹å­ï¼Œå…ˆäº†è§£ï¼Œåè¾¹å†è¡¥å……\nå­˜å‡ºå’Œè½½å…¥é•œåƒ\rå­˜å‡ºå’Œè½½å…¥é•œåƒå¦‚ä½•ç†è§£ï¼Ÿå°±æ˜¯å¯¼å‡ºå’Œå¯¼å…¥çš„æ„æ€ã€‚\nå­˜å‡ºé•œåƒï¼šå°±æ˜¯å°†é•œåƒä¿å­˜åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿ç»™åˆ«çš„æœºå™¨ä½¿ç”¨ è½½å…¥é•œåƒï¼šåœ¨æ–°æœºå™¨æŠŠé•œåƒæ–‡ä»¶ç»™åŠ è½½å‡ºæ¥ä½¿ç”¨ å­˜å‡ºé•œåƒ\rä½¿ç”¨ docker save å‘½ä»¤\n1 2 docker save -o å­˜å‡ºçš„æ–‡ä»¶å é•œåƒå:æ ‡ç­¾ docker save -o å­˜å‡ºçš„æ–‡ä»¶å é•œåƒID -o å°±æ˜¯ output çš„æ„æ€\nä¾‹å­\n1 2 3 4 5 6 [root@status go]# docker save -o centos.tar.gz centos:latest [root@status go]# docker save -o test.tar.gz 9e0017db11d1 [root@status go]# ll total 466000 -rw------- 1 root root 238581248 Aug 29 14:50 centos.tar.gz -rw------- 1 root root 238587904 Aug 29 14:52 test.tar.gz è¿™ä¸¤ä¸ªå°±æ˜¯é•œåƒæ–‡ä»¶äº†ï¼ŒæŠŠè¿™ä¸ªæ‹¿ç»™åˆ«äººï¼Œç›´æ¥åŠ è½½ä½¿ç”¨å°±å¯ä»¥\nè½½å…¥é•œåƒ\rä½¿ç”¨ docker load å‘½ä»¤\n1 2 docker load -i centos.tar.gz docker load -i test.tar.gz ç„¶åå†ä½¿ç”¨ docker images æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼Œçœ‹çœ‹åŠ è½½æˆåŠŸæ²¡ï¼Œå°±å¯ä»¥äº†ã€‚\nä¸Šä¼ é•œåƒ\rä½¿ç”¨ docker push å‘½ä»¤æ¨é€é•œåƒåˆ°é•œåƒä»“åº“ï¼Œé»˜è®¤æ˜¯æ¨é€åˆ° Docker Hub çš„ã€‚\n1 docker push é•œåƒå:æ ‡ç­¾ | ä»“åº“IP:ä»“åº“ç«¯å£/é•œåƒå:æ ‡ç­¾ ä¾‹å­\rç”¨æˆ· WeiQ æƒ³è¦æ¨é€æœ¬åœ°çš„é•œåƒ centos:latest åˆ°ä»“åº“ä¸­ï¼Œæ€ä¹ˆæ¨ï¼Ÿ\nå…ˆç»™è¦æ¨é€çš„é•œåƒæ·»åŠ æ–°çš„æ ‡ç­¾ï¼Œå†æ¨é€è¿™ä¸ªæ ‡ç­¾çš„é•œåƒï¼Œæ–¹ä¾¿åŒºåˆ†æ˜¯ WeiQ æ¨é€çš„\n1 2 docker tag centos:latest WeiQ/centos:latest docker push WeiQ/centos:latest è¿è¡Œé•œåƒ\rä½¿ç”¨ docker run å‘½ä»¤ï¼Œå®ƒæ˜¯è¿è¡Œé•œåƒï¼Œç”Ÿæˆå¯¹åº”çš„å®¹å™¨ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥å½’ä¸ºè¿è¡Œå®¹å™¨ã€‚\nä¸å¯åŠ¨å®¹å™¨å‘½ä»¤æ˜¯ä¸€æ ·çš„\nDocker å®¹å™¨\rå®¹å™¨ï¼Œæ˜¯è¿è¡Œé•œåƒç”Ÿæˆçš„ï¼Œå¹¶ä¸”æ˜¯æœ‰å¯å†™æ–‡ä»¶å±‚çš„ å®¹å™¨ï¼Œæ˜¯é›†åˆäº† åº”ç”¨ + æ“ä½œç¯å¢ƒ çš„ä¸€ä¸ªç›’å­ åˆ›å»ºå®¹å™¨\råˆ›å»ºå®¹å™¨æ¶‰åŠåˆ°\ncreate åˆ›å»º start å¯åŠ¨å®¹å™¨ run åˆ›å»ºå¹¶å¯åŠ¨ wait logs æ–°å»ºå®¹å™¨\råˆ›å»ºå®¹å™¨çš„å‘½ä»¤æ˜¯ docker create ï¼Œåˆ›å»ºçš„å®¹å™¨æ˜¯éè¿è¡ŒçŠ¶æ€ï¼›å¯é€šè¿‡ docker ps -a æŸ¥çœ‹æ–°åˆ›å»ºçš„å®¹å™¨\n1 docker create -it é•œåƒå:æ ‡ç­¾ å®ƒæ”¯æŒçš„é€‰é¡¹å¾ˆå¤šï¼Œä¸€èˆ¬å¸¸ç”¨å°± -it --name -d -p -e\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 --nameï¼šä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ã€‚ -itï¼šè¿™æ˜¯ä¸¤ä¸ªé€‰é¡¹çš„ç»„åˆï¼Œ-i å…è®¸ä½ é€šè¿‡ STDIN ä¸å®¹å™¨äº¤äº’ï¼Œ-t åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚ -dï¼šä»¥å®ˆæŠ¤æ€ï¼ˆåå°ï¼‰è¿è¡Œå®¹å™¨ã€‚ -pï¼šæ˜ å°„å®¹å™¨çš„ç«¯å£åˆ°å®¿ä¸»æœºçš„ç«¯å£ã€‚ -Pï¼šéšæœºæ˜ å°„æ‰€æœ‰æš´éœ²çš„ç«¯å£åˆ°å®¿ä¸»æœºçš„ç«¯å£ã€‚ -vï¼šæŒ‚è½½å®¿ä¸»æœºçš„ä¸€ä¸ªå·åˆ°å®¹å™¨å†…ã€‚ -eï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚ --env-fileï¼šä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡ã€‚ --networkï¼šå°†å®¹å™¨è¿æ¥åˆ°æŒ‡å®šçš„ç½‘ç»œã€‚ --restartï¼šè®¾ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ã€‚ --cpusï¼šé™åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU æ•°é‡ã€‚ --memoryï¼šé™åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ --memory-swapï¼šé™åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨çš„å†…å­˜åŠ ä¸Šäº¤æ¢ç©ºé—´çš„æ€»å’Œã€‚ --entrypointï¼šè¦†ç›–é•œåƒçš„é»˜è®¤å…¥å£ç‚¹ã€‚ --cmdï¼šè¦†ç›–é•œåƒçš„é»˜è®¤å‘½ä»¤ã€‚ --labelï¼šè®¾ç½®å®¹å™¨çš„å…ƒæ•°æ®æ ‡ç­¾ã€‚ --userï¼šæŒ‡å®šè¿è¡Œå®¹å™¨çš„ç”¨æˆ·ã€‚ --workdirï¼šæŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•ã€‚ --hostnameï¼šè®¾ç½®å®¹å™¨çš„ä¸»æœºåã€‚ --mac-addressï¼šè®¾ç½®å®¹å™¨çš„ MAC åœ°å€ã€‚ --ipï¼šè®¾ç½®å®¹å™¨çš„ IPv4 åœ°å€ï¼ˆå½“ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œæ—¶ï¼‰ã€‚ --add-hostï¼šæ·»åŠ è‡ªå®šä¹‰çš„ host-to-IP æ˜ å°„ï¼ˆhost:IPï¼‰ã€‚ --volume-driverï¼šæŒ‡å®šå®¹å™¨çš„å·é©±åŠ¨ã€‚ --stop-signalï¼šè®¾ç½®åœæ­¢å®¹å™¨çš„ä¿¡å·ã€‚ ä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªåˆ«åä¸º centos7 çš„å®¹å™¨\n1 2 3 4 5 [root@status ~]# docker create --name centos7 -it centos:latest 77c3b94004ddb337d7a1fd66aa4b7a4c45347918a1664020618e82eb1438655a [root@status ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 77c3b94004dd centos:latest \u0026#34;/bin/bash\u0026#34; 2 seconds ago Created centos7 å¯åŠ¨å®¹å™¨\rä½¿ç”¨ docker start å‘½ä»¤\n1 2 docker start å®¹å™¨å docker start å®¹å™¨ID ç„¶åå¯ä»¥ä½¿ç”¨ docker ps æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨\n1 2 3 4 5 [root@status ~]# docker start centos7 centos7 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 77c3b94004dd centos:latest \u0026#34;/bin/bash\u0026#34; 23 minutes ago Up 6 seconds centos7 æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨\rä½¿ç”¨ docker run å‘½ä»¤\n1 2 3 docker run -it é•œåƒå:æ ‡ç­¾ docker run -it é•œåƒID docker run -it --name å®¹å™¨åç§° é•œåƒID -i\tè®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿å­˜æ‰“å¼€ï¼Œå°±æ˜¯æ‰“å¼€å®¹å™¨çš„æ‰§è¡Œçª—å£\n-t\tè®© Docker åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Š\n1 2 3 4 5 [root@status ~]# docker run -d --name centos7 -it centos:latest c0121f9cb884f0783b86c077cb027025cc472515fe2d9267d4073e7000a9bd7c [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c0121f9cb884 centos:latest \u0026#34;/bin/bash\u0026#34; 30 minutes ago Up 30 minutes centos7 æ‰§è¡Œ docker run çš„åŸç†\ræ‰§è¡Œæ—¶ï¼Œdocker åœ¨åå°çš„æ“ä½œï¼š\n1ï¼‰æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨é•œåƒï¼Œä¸å­˜åœ¨åˆ™ä»å…±æœ‰ä»“åº“æ‹‰å–\n2ï¼‰åˆ©ç”¨é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å¯åŠ¨å®¹å™¨\n3ï¼‰åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç»™å®¹å™¨ï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚\n4ï¼‰ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­\n5ï¼‰ä»ç½‘æ¡¥çš„åœ°å€æ± é…ç½®ä¸€ä¸ª IP åœ°å€ç»™å®¹å™¨\n6ï¼‰æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº\nexit é€€å‡ºé”€æ¯å®¹å™¨ *\rdocker run æ˜¯ä¼šç”Ÿæˆå®¹å™¨çš„ï¼Œé‚£è¿™é‡Œçš„åˆ›å»ºå®¹å™¨æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿå› ä¸ºåˆ›å»ºæ–°å®¹å™¨ï¼Œå®ƒé‡Œè¾¹ä¸å°±ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Ÿ\n[!IMPORTANT]\nrun å‘½ä»¤å…¶å®æ˜¯ create ä¸ start å‘½ä»¤çš„åˆé›†ï¼Œå®ƒç­‰äºåˆ›å»ºå®¹å™¨ã€å¯åŠ¨å®¹å™¨\néªŒè¯ï¼š\n1ï¼‰è¿è¡Œé•œåƒï¼Œè¿›å…¥å®¹å™¨è¿›è¡Œå¢åˆ æ”¹æ“ä½œ\n1 2 3 4 5 [root@status ~]# docker run -it centos:latest [root@b0d385386935 /]# cd /home/ [root@b0d385386935 home]# touch test.txt [root@b0d385386935 home]# ls test.txt 2ï¼‰ç„¶åé€€å‡ºå®¹å™¨ï¼Œçœ‹çœ‹å®¹å™¨æ˜¯å¦å­˜åœ¨\n1 2 3 4 [root@b0d385386935 home]# exit exit [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 3ï¼‰ä¸å­˜åœ¨å®¹å™¨ï¼Œé‡æ–°è¿è¡Œé•œåƒï¼Œè¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹åˆšåˆšåˆ›å»ºçš„ test.txt æ–‡ä»¶\n1 2 3 4 [root@status ~]# docker run -it centos:latest [root@6e198af7152d /]# cd /home/ [root@6e198af7152d home]# ls [root@6e198af7152d home]# å·²ç»æ²¡æœ‰äº†ï¼Œä¸”è¿™ä¸ªå®¹å™¨IDä¹Ÿæ”¹å˜äº†ã€‚\n[!IMPORTANT]\nç»“è®ºï¼Œè¿è¡Œé•œåƒç”Ÿæˆå®¹å™¨ï¼Œåœ¨å®¹å™¨å†…ä½¿ç”¨ exit å‘½ä»¤é€€å‡ºçš„æ—¶å€™ï¼Œå®¹å™¨ä¹Ÿä¼šé”€æ¯ã€‚é‡æ–°è¿è¡Œé•œåƒåˆ™æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ã€‚\n20241009ï¼šè¿™é‡Œå…¶å®æ˜¯é€€å‡ºå®¹å™¨ï¼Œå¹¶ä¸”è¿™ä¸ªå®¹å™¨å› ä¸ºæ‰§è¡Œå®Œå‘½ä»¤äº†ï¼Œå¤„äºé€€å‡ºçš„çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰é”€æ¯ï¼Œå¯ä½¿ç”¨ docker ps -a æŸ¥çœ‹å®ƒã€‚\né€€å‡ºä¸é”€æ¯å®¹å™¨ *\råœ¨å®¹å™¨å†…éƒ¨ï¼Œæˆ‘é€€å‡ºçš„æ—¶å€™ï¼Œä¸é”€æ¯å®¹å™¨ï¼Œè®©å®¹å™¨ç»§ç»­è¿è¡Œï¼Œåº”è¯¥å¦‚ä½•æ“ä½œï¼Ÿ\n1ï¼‰ä½¿ç”¨ ctrl + p å†ä½¿ç”¨ ctrl + q\n1 2 3 4 5 6 [root@status ~]# docker run -it centos:latest # ctrl + p # ctrl + q [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 7f64fc558ccb centos:latest \u0026#34;/bin/bash\u0026#34; 14 seconds ago Up 13 seconds loving_swanson 2ï¼‰å¯ä»¥é‡æ–°è¿›å…¥è¿™ä¸ªå®¹å™¨\n1 2 [root@status ~]# docker exec -it 7f64fc558ccb /bin/bash [root@7f64fc558ccb /]# é€€å‡ºå®¹å™¨ *\rå¦‚æœæ˜¯é€€å‡ºå¹¶é”€æ¯å®¹å™¨ï¼Œä½¿ç”¨ exit å‘½ä»¤ï¼›\nå¦‚æœæ˜¯é€€å‡ºä½†ä¿ç•™å®¹å™¨åœ¨åå°è¿è¡Œï¼Œä½¿ç”¨ ctrl + p å†ä½¿ç”¨ ctrl + q\nåå°è¿è¡Œå®¹å™¨\rè®©å®¹å™¨åœ¨åå°è¿è¡Œï¼Œä½¿ç”¨ -d é€‰é¡¹\n1 docker run -d é•œåƒå:æ ‡ç­¾ æŸ¥çœ‹å®¹å™¨è¾“å‡º\r1 docker logs [é€‰é¡¹] å®¹å™¨ID é€‰é¡¹å¯ä»¥æœ‰ï¼š\n\u0026ndash;detail\tæ‰“å°è¯¦ç»†ä¿¡æ¯\n-f\tæŒç»­ä¿æŒè¾“å‡º\n\u0026ndash;tail string\tè¾“å‡ºä»æŸä¸ªæ—¶é—´å¼€å§‹çš„æ—¥å¿—\nåˆ—å‡ºå®¹å™¨\rä½¿ç”¨ docker ps å‘½ä»¤ï¼Œåˆ—å‡ºå®¹å™¨åˆ—è¡¨\n[!IMPORTANT]\ndocker ps åˆ—å‡ºå½“å‰è¿è¡Œçš„å®¹å™¨\næ”¯æŒçš„å‚æ•°ï¼š\n-a åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨ï¼ˆè¿è¡Œ + å·²åœæ­¢ï¼‰\n-q\tåªåˆ—å‡ºå®¹å™¨ ID\n-aq\tåˆ—å‡ºæ‰€æœ‰å®¹å™¨ID\n-l\tæ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ä¿¡æ¯\n-n 5\tæ˜¾ç¤ºæœ€ååˆ›å»ºçš„ 5 ä¸ªå®¹å™¨ä¿¡æ¯\nåœæ­¢å®¹å™¨\ræœ‰æš‚åœå®¹å™¨ã€æœ‰ç»ˆæ­¢å®¹å™¨ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ\n[!IMPORTANT]\nå¯ä»¥æŠŠå®¹å™¨çœ‹ä½œä¸€ä¸ªåº”ç”¨è¿›ç¨‹ï¼Œæš‚åœå®¹å™¨ï¼Œå°±æ˜¯æŠŠè¿›ç¨‹å…ˆæš‚åœï¼Œåç»­è¿˜å¯ä»¥ç›´æ¥æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚\nç»ˆæ­¢å®¹å™¨ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªåº”ç”¨è¿›ç¨‹ç»™ KILL æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå®¹å™¨è¢«å½»åº•å…³æ‰äº†ã€‚\npause unpause stop prune æš‚åœå®¹å™¨\rä½¿ç”¨ docker pause å‘½ä»¤æš‚åœå®¹å™¨çš„è¿è¡Œï¼ˆåªæ˜¯æš‚åœè¿è¡Œï¼Œéé”€æ¯\\åˆ é™¤ï¼‰ï¼Œä½¿ç”¨ docker ps å‘½ä»¤è¿˜èƒ½æŸ¥åˆ°\n1 2 docker pause å®¹å™¨å docker pause å®¹å™¨ID 1 2 3 4 5 6 7 8 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c0121f9cb884 centos:latest \u0026#34;/bin/bash\u0026#34; 30 minutes ago Up 30 minutes centos7 [root@status ~]# docker pause centos7 centos7 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c0121f9cb884 centos:latest \u0026#34;/bin/bash\u0026#34; 32 minutes ago Up 32 minutes (Paused) centos7 åœæ­¢ä¹‹åï¼ŒSTUTAS å˜ä¸ºäº† Paused\næ¢å¤è¿è¡Œ\rä½¿ç”¨ docker unpause å‘½ä»¤æ¢å¤å®¹å™¨çš„è¿è¡Œ\n1 2 docker unpause å®¹å™¨å docker unpause å®¹å™¨ID ç»ˆæ­¢å®¹å™¨\rä½¿ç”¨ docker stop å‘½ä»¤ã€‚æŠŠå®¹å™¨ç»™ KILL æ‰ï¼Œä½¿ç”¨ docker ps æŸ¥çœ‹ä¸åˆ°äº†ã€‚ï¼ˆè¿™ä¸ªä¸æ˜¯åˆ é™¤å®¹å™¨ï¼ï¼‰\n1 2 docker stop å®¹å™¨å docker stop å®¹å™¨ID 1 2 3 4 [root@status ~]# docker stop centos7 centos7 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ä½¿ç”¨ docker ps -a è¿˜æ˜¯å¯ä»¥çœ‹åˆ°è¿™ä¸ªå®¹å™¨\né‡å¯å®¹å™¨\rå…¶å®å°±æ˜¯ã€2.1.2 å¯åŠ¨å®¹å™¨ã€‘æ­¥éª¤\n1 2 3 4 5 6 docker start å®¹å™¨å docker start å®¹å™¨ID # é‡å¯ docker restart å®¹å™¨å docker restart å®¹å™¨ID 1 2 3 4 5 [root@status ~]# docker start centos7 centos7 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c0121f9cb884 centos:latest \u0026#34;/bin/bash\u0026#34; 46 minutes ago Up 5 seconds centos7 è¿›å…¥å®¹å™¨\råœ¨ã€2.1.3 æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ã€‘æ­¥éª¤ä¸­ï¼Œé€šè¿‡ -d è®©å®¹å™¨åå°è¿è¡Œ\n1 docker run --name centos7 -itd centos:latest å®¹å™¨åå°è¿è¡Œï¼Œæ˜¯ä¸ä¼šè¿›å…¥åˆ°å®¹å™¨å†…éƒ¨çš„\néœ€è¦è¿›å…¥å®¹å™¨ï¼Œä½¿ç”¨ docker exec å‘½ä»¤\n1 2 docker exec -it å®¹å™¨å /bin/bash docker exec -it å®¹å™¨ID /bin/bash 1 2 [root@status ~]# docker exec -it centos7 /bin/bash [root@c0121f9cb884 /]# è¿™é‡Œä¸ä½¿ç”¨ /bin/bash ï¼Œä¼šè¿›ä¸å»\nåˆ é™¤å®¹å™¨\rdocker rm å‘½ä»¤æ˜¯åˆ é™¤å®¹å™¨\ndocker rmi å‘½ä»¤æ˜¯åˆ é™¤é•œåƒ\næ³¨æ„åŒºåˆ«\nåˆ é™¤å®¹å™¨ï¼Œé€šå¸¸æ˜¯åªèƒ½åˆ é™¤éè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½¿ç”¨ pause æš‚åœçš„å®¹å™¨ä¹Ÿåˆ é™¤ä¸äº†ã€‚å¿…é¡»æ˜¯ docker ps å‘½ä»¤æŸ¥ä¸åˆ°çš„å®¹å™¨ å¼ºè¡Œåˆ é™¤ï¼ŒåŠ å…¥ -f å‚æ•°ï¼Œæˆ–è€…å…ˆä½¿ç”¨ stop ç»ˆæ­¢å®¹å™¨ 1 2 docker rm -f å®¹å™¨å docker rm -f å®¹å™¨ID 1 2 docker stop å®¹å™¨å\u0026amp;å®¹å™¨ID docker rm å®¹å™¨å\u0026amp;å®¹å™¨ID 1 2 3 4 5 6 7 8 9 10 11 12 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c0121f9cb884 centos:latest \u0026#34;/bin/bash\u0026#34; 2 hours ago Up 2 hours centos7 [root@status ~]# docker stop centos7 centos7 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@status ~]# docker rm centos7 centos7 [root@status ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@status ~]# å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨\rè¿™ä¸ªå°±è·Ÿ ã€1.7 å­˜å‡ºå’Œè½½å…¥é•œåƒã€‘ç±»ä¼¼ï¼Œå°†æ•´ä½“å®¹å™¨å¯¼å‡ºåˆ°æ–‡ä»¶ï¼Œç„¶åå¯¼å…¥åˆ°å…¶ä»–æœºå™¨ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚\nå¯¼å‡ºå®¹å™¨\rä½¿ç”¨ docker export å‘½ä»¤\n1 docker export -o æ–‡ä»¶å.tar.gz å®¹å™¨åæˆ–è€…å®¹å™¨ID 1 2 3 4 5 6 7 8 9 10 11 [root@status ~]# docker run --name centos7 -itd centos:latest 9fb9bacc6189204e54463401d3e91326a1256a8bec59d4737e600bc76d789d11 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 9fb9bacc6189 centos:latest \u0026#34;/bin/bash\u0026#34; 3 seconds ago Up 2 seconds centos7 8a848522fedf centos:latest \u0026#34;/bin/bash\u0026#34; 29 seconds ago Up 28 seconds stupefied_swartz [root@status ~]# docker export -o container_centos7.tar.gz centos7 [root@status ~]# ll total 233008 -rw------- 1 root root 238592512 Aug 30 13:24 container_centos7.tar.gz å¯¼å…¥å®¹å™¨\rä½¿ç”¨ docker import å‘½ä»¤ï¼Œå¯¼å…¥å®¹å™¨ï¼Œå°†å˜ä¸ºé•œåƒæ–‡ä»¶\n1 docker import åŒ…å åç§°:æ ‡ç­¾ ä¾‹å­\r1 2 3 4 5 6 7 [root@status ~]# docker import container_centos7.tar.gz test_import/centos:20240830_V1 sha256:592397d362e5fb6e89f5718e13c19a9f8a74562a7f97c10108aa4b30c9e3c0f2 [root@status ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE test_import/centos 20240830_V1 592397d362e5 7 seconds ago 231 MB test 20240829_V1 9e0017db11d1 23 hours ago 231 MB docker.io/centos latest 5d0da3dc9764 2 years ago 231 MB å°† container_centos7.tar.gz å¯¼å…¥ï¼Œç”Ÿæˆä¸€ä¸ª test_import/centos çš„é•œåƒæ–‡ä»¶ï¼Œæ ‡ç­¾æ˜¯ 20240830_V1\nè¿ç§»ç¯å¢ƒæœ‰ 2 ç§æ–¹å¼\r1 æ‰“åŒ…é•œåƒ\r1ï¼‰æ‰“åŒ…é•œåƒï¼Œã€1.6.1 åŸºäºå·²æœ‰å®¹å™¨åˆ›å»ºã€‘ç« èŠ‚ï¼Œä»¥ç°åœ¨å®¹å™¨åˆ›å»ºä¸€ä¸ªé•œåƒæ–‡ä»¶\n2ï¼‰å°†è¿™ä¸ªé•œåƒæ–‡ä»¶ï¼Œæ”¾åˆ°å…¶ä»–æœºå™¨é‡Œï¼Œè½½å…¥é•œåƒæ–‡ä»¶ï¼Œã€1.7.2 è½½å…¥é•œåƒã€‘ç« èŠ‚ã€‚\n2 æ‰“åŒ…å®¹å™¨\r1ï¼‰æ‰“åŒ…å®¹å™¨ï¼Œã€2.6.1 å¯¼å‡ºå®¹å™¨ã€‘ï¼Œç”Ÿæˆä¸€ä¸ªå®¹å™¨æ–‡ä»¶\n2ï¼‰å°†è¿™ä¸ªå®¹å™¨æ–‡ä»¶ï¼Œæ”¾åˆ°å…¶ä»–æœºå™¨é‡Œï¼Œå¯¼å…¥å®¹å™¨æ–‡ä»¶ï¼Œã€2.6.2 å¯¼å…¥å®¹å™¨ã€‘\n3 åŒºåˆ«\rå…¶å®æ²¡å•¥åŒºåˆ«ï¼Œé™¤äº†æ‰§è¡Œçš„å‘½ä»¤æœ‰åŒºåˆ«ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯å°†è¿™ä¸ªå®¹å™¨æ‰“åŒ…æˆæ–‡ä»¶ï¼Œç„¶ååœ¨å…¶ä»–æœºå™¨ä¸ŠåŠ è½½ç”Ÿæˆæ–°é•œåƒï¼Œç„¶åè¿è¡Œè¿™ä¸ªé•œåƒå°±å¯ä»¥å¾—åˆ°ä¸€æ¨¡ä¸€æ ·çš„å®¹å™¨äº†ã€‚\næŸ¥çœ‹å®¹å™¨\råœ¨ã€1.3 æŸ¥çœ‹é•œåƒä¿¡æ¯ã€‘ç« èŠ‚ï¼Œå¯ä»¥ä½¿ç”¨ inspect æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯\nå…¶å® inspect è¿˜å¯ä»¥æŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯\næŸ¥çœ‹é•œåƒä¿¡æ¯æ˜¯ docker inspect æŸ¥çœ‹å®¹å™¨ä¿¡æ¯æ˜¯ docker container inspect æŸ¥çœ‹å®¹å™¨è¯¦æƒ…\r1 2 3 docker container inspect å®¹å™¨å\\å®¹å™¨ID docker container [options] inspect å®¹å™¨å\\å®¹å™¨ID æ”¯æŒçš„é€‰é¡¹ï¼š\nä½¿ç”¨ docker container inspect --help æŸ¥çœ‹ï¼Œæˆ–è€…\nä½¿ç”¨ man docker container inspect æŸ¥çœ‹\n1 [root@status ~]# docker container inspect centos7 ä¼šæœ‰å®¹å™¨IDã€åˆ›å»ºæ—¶é—´ã€è·¯å¾„ã€çŠ¶æ€ã€é•œåƒã€é…ç½®ç­‰\næŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹\r1 2 3 docker container top å®¹å™¨å\\å®¹å™¨ID docker top å®¹å™¨å\\å®¹å™¨ID ä½¿ç”¨ docker container top æ–¹ä¾¿åŒºåˆ†æ˜¯å®¹å™¨çš„æ“ä½œå‘½ä»¤\n1 2 3 [root@status ~]# docker container top centos7 UID PID PPID C STIME TTY TIME CMD root 31467 31450 0 13:23 pts/2 00:00:00 /bin/bash æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯\r1 2 3 docker container stats å®¹å™¨å\\å®¹å™¨ID docker container stats [options] å®¹å™¨å\\å®¹å™¨ID æ”¯æŒçš„é€‰é¡¹ï¼š\n-a\tè¾“å‡ºæ‰€æœ‰å®¹å™¨ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸åŠ å°±æ˜¯æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ä¿¡æ¯\n\u0026ndash;format string\tæ ¼å¼åŒ–è¾“å‡ºä¿¡æ¯\n\u0026ndash;no-stream\tä¸æŒç»­è¾“å‡ºï¼Œé»˜è®¤æ˜¯è‡ªåŠ¨æ›´æ–°å®æ—¶ç»“æœçš„\nå…¶ä»–å®¹å™¨å‘½ä»¤\rcp diff port update å¤åˆ¶æ–‡ä»¶ cp\rcp å‘½ä»¤æ”¯æŒåœ¨å®¹å™¨ä¸ä¸»æœºä¹‹é—´å¤åˆ¶æ–‡ä»¶\n1 docker container cp ä¸»æœºå†…å®¹ å®¹å™¨:/å®¹å™¨è·¯å¾„/ ä¹Ÿå¯ä»¥ä»å®¹å™¨ä¼ åˆ°ä¸»æœº\n1 docker container cp å®¹å™¨:/è·¯å¾„/æ–‡ä»¶ /ä¸»æœºè·¯å¾„ ä¾‹å­\nå°†æœ¬åœ°çš„ sh æ–‡ä»¶å¤åˆ¶åˆ° centos7 å®¹å™¨çš„ tmp ç›®å½•ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 [root@status shell]# docker container cp /home/shell/serviceCheckDay.sh centos7:/tmp [root@status shell]# docker exec -it centos7 /bin/bash [root@9fb9bacc6189 /]# cd tmp/ [root@9fb9bacc6189 tmp]# ls ks-script-4luisyla ks-script-o23i7rc2 ks-script-x6ei4wuu serviceCheckDay.sh [root@9fb9bacc6189 tmp]# ls -l total 16 -rwx------ 1 root root 701 Sep 15 2021 ks-script-4luisyla -rwx------ 1 root root 671 Sep 15 2021 ks-script-o23i7rc2 -rwx------ 1 root root 291 Sep 15 2021 ks-script-x6ei4wuu -rwxr-xr-x 1 root root 2467 Jul 23 03:13 serviceCheckDay.sh æŸ¥çœ‹å˜æ›´ diff\rdiff å‘½ä»¤\n1 docker container diff å®¹å™¨å\\å®¹å™¨ID 1 2 3 4 5 [root@status shell]# docker container diff centos7 C /run D /run/secrets C /tmp A /tmp/serviceCheckDay.sh æœ‰å˜æ›´çš„ç›®å½•å’Œæ–‡ä»¶éƒ½æ˜¾ç¤ºå‡ºæ¥\næŸ¥çœ‹ç«¯å£æ˜ å°„ port\rport å‘½ä»¤\n1 docker container port å®¹å™¨å\\å®¹å™¨ID æ›´æ–°é…ç½® update\rupdate å‘½ä»¤\n1 docker container update å®¹å™¨å\\å®¹å™¨ID --éœ€è¦æ›´æ–°çš„å‚æ•° å‚æ•°ï¼šç”¨åˆ°å†çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [root@status shell]# docker container update --help Usage: docker container update [OPTIONS] CONTAINER [CONTAINER...] Update configuration of one or more containers Options: --blkio-weight uint16 Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0) --cpu-period int Limit CPU CFS (Completely Fair Scheduler) period --cpu-quota int Limit CPU CFS (Completely Fair Scheduler) quota --cpu-rt-period int Limit the CPU real-time period in microseconds --cpu-rt-runtime int Limit the CPU real-time runtime in microseconds -c, --cpu-shares int CPU shares (relative weight) --cpuset-cpus string CPUs in which to allow execution (0-3, 0,1) --cpuset-mems string MEMs in which to allow execution (0-3, 0,1) --help Print usage --kernel-memory string Kernel memory limit -m, --memory string Memory limit --memory-reservation string Memory soft limit --memory-swap string Swap limit equal to memory plus swap: \u0026#39;-1\u0026#39; to enable unlimited swap --restart string Restart policy to apply when a container exits ä»“åº“\rå®˜æ–¹ä»“åº“ Docker Hub ï¼Œç°åœ¨å·²ç»è¢«å¢™äº†\nä½¿ç”¨å›½å†…çš„ä»“åº“æºå°±å¯ä»¥\nå…·ä½“é…ç½®äº†ä¸€ä¸ªé˜¿é‡Œäº‘çš„é•œåƒä»“åº“ï¼Œçœ‹ã€ŠDocker å®‰è£…ä¸é…ç½®ã€‹ï¼Œé…ç½®æ–‡ä»¶ä¸º /etc/docker/daemon.json\næ­å»ºæœ¬åœ°ç§æœ‰ä»“åº“ *\rå…ˆä¸çœ‹\nDocker è¿›é˜¶\rDocker æ•°æ®ç®¡ç†\råœ¨ç”Ÿæˆç¯å¢ƒç§ä½¿ç”¨ Docker ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“æ”¾åœ¨ Docker é‡Œï¼Œæˆ–è€…åº”ç”¨ä¸­ä¸Šä¼ çš„æ–‡ä»¶ã€èµ„æ–™ç­‰ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦åˆ™åœ¨è¿›è¡Œåº”ç”¨ç‰ˆæœ¬å‡çº§æˆ–è€…å®¹å™¨æŒ‚æ‰åï¼Œé‡æ–°åˆ©ç”¨é•œåƒç”Ÿæˆå®¹å™¨ï¼Œæ•°æ®å…¨æ²¡äº†ã€‚\nä¹‹å‰åšæŸé“¶è¡Œçš„å®¡è®¡å†…æ§é¡¹ç›®ï¼Œä½¿ç”¨çš„ Docker éƒ¨ç½²åº”ç”¨ï¼Œæ¯å½“åº”ç”¨éœ€è¦ä¿®æ”¹æˆ–è€…ä¼˜åŒ–çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é‡æ–°ä¸Šä¼ åº”ç”¨åŒ…åˆ°æŸä¸ªåœ°æ–¹ï¼Œç„¶åéƒ¨ç½²ã€‚ä»–ä»¬åº”è¯¥ä½¿ç”¨ devops ä¸€é”®éƒ¨ç½²çš„ï¼Œæˆ‘ä¸Šä¼ åŒ…åˆ°å¯¹åº”çš„åœ°æ–¹ï¼Œç„¶åæ‰§è¡Œä¸€ä¸ª yaml å‘½ä»¤ï¼Œæ¯æ¬¡éƒ½æ˜¯é‡æ–°ç”Ÿæˆå®¹å™¨ï¼ŒåŸå…ˆçš„ä¸œè¥¿å°±å…¨æ²¡äº†ã€‚\næ•°æ®ç®¡ç†æœ‰ 2 ç§æ–¹å¼ï¼š\næ•°æ®å· Data Volumnsï¼šå®¹å™¨å†…æ•°æ®ç›´æ¥æ˜ å°„åˆ°æœ¬åœ°ä¸»æœºç¯å¢ƒ æ•°æ®å·å®¹å™¨ Data Volume Containersï¼šä½¿ç”¨ç‰¹å®šå®¹å™¨ç»´æŠ¤æ•°æ®å· å¦‚ä½•åœ¨å®¹å™¨å†…åˆ›å»ºæ•°æ®å·ï¼Ÿ\nå¦‚ä½•æŠŠæœ¬åœ°ç›®å½•æˆ–è€…æ–‡ä»¶æŒ‚åˆ°å®¹å™¨å†…çš„æ•°æ®å·ï¼Ÿ\nå¦‚ä½•åœ¨å®¹å™¨å’Œä¸»æœºä¹‹é—´å…±äº«æ•°æ®ï¼Ÿ\nå¦‚ä½•å®ç°å®¹å™¨æ•°æ®çš„å¤‡ä»½å’Œæ¢å¤ï¼Ÿ\næ•°æ®å·\ræ•°æ®å·æ˜¯å°†ä¸»æœºçš„ç›®å½•æ˜ å°„è¿›å®¹å™¨ï¼Œç±»ä¼¼ linux çš„ mount æŒ‚è½½å…±äº«ç›˜ã€‚\næ•°æ®å·ï¼Œåœ¨å„ä¸ªå®¹å™¨ä¹‹é—´éƒ½å¯ä»¥å…±äº«æ•°æ® å¯¹æ•°æ®å·å†…çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå®¹å™¨å’Œæœ¬æœºçš„æ•°æ®ä¹Ÿä¼šä¿®æ”¹ã€‚å¹¶ä¸”å®¹å™¨å¯ä»¥ä¿®æ”¹æ•°æ®å·é‡Œçš„å†…å®¹ï¼Œæœ¬æœºä¹Ÿå¯ä»¥ æ•°æ®å·å†…çš„æ•°æ®ä¿®æ”¹ï¼Œä¸ä¼šå½±å“åˆ°é•œåƒ åˆ›å»ºæ•°æ®å·\rä½¿ç”¨ docker volume å‘½ä»¤\n1 docker volume create -d local æ•°æ®å·åç§° -d\tè¡¨ç¤ºå­—ç¬¦ä¸²æŒ‡å®šå·é©±åŠ¨ç¨‹åºåç§°ï¼ˆé»˜è®¤ä¸ºâ€œlocalâ€ï¼‰\nä¾‹å­\n1ï¼‰åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª vol_test æ•°æ®å·\n1 2 [root@status /]# docker volume create -d local vol_test vol_test 2ï¼‰å¯ä»¥åœ¨ Docker å®‰è£…ç›®å½•ä¸‹æŸ¥çœ‹æ•°æ®å·\n1 2 3 4 5 [root@status /]# cd /var/lib/docker/volumes [root@status volumes]# ll total 28 -rw------- 1 root root 32768 Aug 30 16:27 metadata.db drwxr-xr-x 3 root root 4096 Aug 30 16:27 vol_test æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯\rä½¿ç”¨ docker volume inspect å‘½ä»¤\n1 2 3 4 5 6 7 8 9 10 11 [root@status /]# docker volume inspect vol_test [ { \u0026#34;Driver\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Labels\u0026#34;: {}, \u0026#34;Mountpoint\u0026#34;: \u0026#34;/var/lib/docker/volumes/vol_test/_data\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;vol_test\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34; } ] åˆ—å‡ºæ‰€æœ‰æ•°æ®å·\rä½¿ç”¨ docker volume ls å‘½ä»¤\n1 2 3 [root@status /]# docker volume ls DRIVER VOLUME NAME local vol_test æ¸…ç†æ— ç”¨æ•°æ®å·\rä½¿ç”¨ docker volume prune å‘½ä»¤\n1 2 3 4 5 6 7 8 9 [root@status /]# docker volume prune WARNING! This will remove all volumes not used by at least one container. Are you sure you want to continue? [y/N] y Deleted Volumes: vol_test Total reclaimed space: 0 B [root@status /]# docker volume ls DRIVER VOLUME NAME åˆ é™¤æ•°æ®å·\rä½¿ç”¨ docker volume rm å‘½ä»¤\n1 docker volume rm æ•°æ®å·åç§° 1 2 3 4 5 6 7 8 9 [root@status /]# docker volume create -d local data_test data_test [root@status /]# docker volume ls DRIVER VOLUME NAME local data_test [root@status /]# docker volume rm data_test data_test [root@status /]# docker volume ls DRIVER VOLUME NAME ç»‘å®šæ•°æ®å·\råˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å°†æœ¬åœ°çš„ä»»æ„è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨å†…ä½œä¸ºæ•°æ®å·ï¼Œè¿™ç§å½¢å¼æœ¬è´¨ä¸Šä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ªæ•°æ®å·ï¼Œåªä¸è¿‡å®ƒæ˜¯åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ç›´æ¥ç»‘å®šäº†ï¼Œæ‰€ä»¥å«ç»‘å®šæ•°æ®å·ã€‚\nä½¿ç”¨ -mount å‘½ä»¤è¿›è¡Œç»‘å®šï¼Œå®ƒæœ‰ 3 ç§ç±»å‹çš„æ•°æ®å·ï¼š\nvolume æ™®é€šæ•°æ®å·ï¼Œæ˜ å°„åˆ°ä¸»æœº /var/lib/docker/volume è·¯å¾„ä¸‹ bind ç»‘å®šæ•°æ®å·ï¼Œæ˜ å°„åˆ°ä¸»æœºæŒ‡å®šè·¯å¾„ä¸‹ tmpfs ä¸´æ—¶æ•°æ®å·ï¼Œåªå­˜åœ¨å†…å­˜ä¸­ ä¾‹å­ï¼š\nå°†æœ¬åœ°çš„ /home/go ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ /opt/web å†…ï¼Œä½œä¸ºå®¹å™¨å·\n1 docker run -d -P --name web -v /home/go:/opt/web centos:latest -P æ˜¯æ˜ å°„æ‰€æœ‰ç«¯å£ è¿™é‡Œç›´æ¥ç»‘å®šæ•°æ®å·çš„å®¹å™¨ï¼Œä½¿ç”¨ docker ps -a å‘½ä»¤æŸ¥çœ‹ï¼Œå®ƒçš„çŠ¶æ€æ˜¯ï¼šExited\n1 2 3 [root@status ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 3577d310d7b1 centos:latest \u0026#34;/bin/bash\u0026#34; 4 minutes ago Exited (0) 4 minutes ago web ä¸æ¸…æ¥šå•¥åŸå› ï¼Œå…ˆæŠŠå®ƒåˆ äº†ï¼š\n1 docker rm 3577d310d7b1 å†é‡æ–°åˆ›å»ºå®¹å™¨å¹¶ç»‘å®šæ•°æ®å·ï¼Œè¿™æ¬¡åœ¨å‘½ä»¤åè¾¹æ¥æ‰§è¡Œå‘½ä»¤\n1 docker run -d -P --name web -v /home/go:/opt/web centos:latest /bin/bash å•Šï¼Œä¸è¡Œï¼Œå…ˆè·³è¿‡ï¼Œè¿™ä¸ªä¸çŸ¥é“ä¸ºå•¥\næ•°æ®å·å®¹å™¨\rå¦‚æœéœ€è¦åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å…±äº«ä¸€äº›æŒç»­æ›´æ–°çš„æ•°æ®ï¼Œä½¿ç”¨æ•°æ®å·å®¹å™¨æ˜¯æœ€ç®€å•çš„æ–¹å¼ã€‚\næ•°æ®å·å®¹å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œåªä¸è¿‡å®ƒæä¾›æ•°æ®å·ï¼Œç»™å…¶ä»–å®¹å™¨æŒ‚è½½ã€‚\nä¾‹å­\r1ï¼‰åˆ›å»ºä¸€ä¸ªæ•°æ®å·å®¹å™¨ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œå°†æœ¬åœ°çš„ /dbdata æŒ‚è½½åˆ°å®¹å™¨ dbdata é‡Œ\n1 2 3 4 [root@status ~]# docker run -it -v /dbdata --name dbdata centos:latest [root@bab3308ef270 /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@bab3308ef270 /]# [root@status ~]# ä½¿ç”¨ ctrl+p å† ctrl+q è®©å®¹å™¨åœ¨åå°è¿è¡Œ\n2ï¼‰åœ¨å…¶ä»–å®¹å™¨ä¸­ä½¿ç”¨ --volumes-from æ¥æŒ‚è½½å®¹å™¨ä¸­çš„æ•°æ®å·\nå¯ä»¥åˆ›å»ºæ–°çš„å®¹å™¨ï¼Œå¹¶æŒ‚è½½è¿™ä¸ªæ•°æ®å·å®¹å™¨\n1 2 3 [root@status ~]# docker run -it --volumes-from dbdata --name db1 centos:latest [root@64e8cf50b3be /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var è¿™é‡Œ db1 å®¹å™¨é‡Œï¼Œå·²ç»æœ‰äº†è¿™ä¸ª dbdata æ•°æ®å·å®¹å™¨äº†\n3ï¼‰åœ¨å®¹å™¨å†…ï¼Œå¾€æ•°æ®å·å®¹å™¨åˆ›å»ºæ–°æ–‡ä»¶ï¼Œçœ‹çœ‹æ•°æ®å·å®¹å™¨æ˜¯å¦ä¹Ÿè¢«åˆ›å»º\nè¿›å…¥æ•°æ®å·å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯å¯ä»¥åŒæ­¥çš„\n1 2 3 4 [root@status ~]# docker exec -it dbdata /bin/bash [root@bab3308ef270 /]# cd /dbdata/ [root@bab3308ef270 dbdata]# ls test.go 4ï¼‰å†åˆ›å»ºä¸€ä¸ªå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·å®¹å™¨\n1 2 3 4 5 6 [root@status ~]# docker run -it --volumes-from dbdata --name db2 centos:latest [root@0bcca546d72d /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@0bcca546d72d /]# cd dbdata/ [root@0bcca546d72d dbdata]# ls test.go 5ï¼‰åœ¨æ•°æ®å·å®¹å™¨é‡Œæ“ä½œï¼Œå…¶ä»–å®¹å™¨ä¹ŸåŒæ—¶ç”Ÿæ•ˆï¼Œå› ä¸ºé‡Œè¾¹çš„æ•°æ®æ˜¯å…±äº«çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@status ~]# docker exec -it dbdata /bin/bash [root@bab3308ef270 /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@bab3308ef270 /]# cd dbdata/ [root@bab3308ef270 dbdata]# ls test.go [root@bab3308ef270 dbdata]# mkdir test1 test2 test3 [root@bab3308ef270 dbdata]# ls test.go test1 test2 test3 [root@bab3308ef270 dbdata]# rm -rf test.go [root@bab3308ef270 dbdata]# [root@status ~]# [root@status ~]# docker exec -it db2 /bin/bash [root@0bcca546d72d /]# cd dbdata/ [root@0bcca546d72d dbdata]# ls test1 test2 test3 [!IMPORTANT]\næ€»ç»“\næ­£å¸¸çš„ï¼Œæ•°æ®å·å®¹å™¨åªè¦å­˜åœ¨ï¼Œå°±å¯ä»¥ç›¸å½“äº NFS æˆ–è€… NAS ä¸€æ ·ï¼Œä½œä¸ºä¸€ä¸ªæŒ‚è½½ç›˜åœ¨å®¹å™¨ä¹‹é—´å…±äº«ã€‚åªè¦è¿™ä¸ªå®¹å™¨ä¸è¢«é”€æ¯ã€‚\næ³¨æ„\ræ•°æ®å·å®¹å™¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œåªä¸è¿‡å®ƒæ˜¯æŒ‚è½½äº†æ•°æ®å·ï¼Œç„¶ååˆå°†è¿™ä¸ªå®¹å™¨æŒ‚è½½åˆ°å…¶ä»–å®¹å™¨ä¸­ã€‚\nä½¿ç”¨ docker volume ls æŸ¥çœ‹çš„æ˜¯æ•°æ®å· ä½¿ç”¨ docker ps æŸ¥çœ‹çš„æ˜¯æ•°æ®å·å®¹å™¨ åˆ©ç”¨æ•°æ®å·å®¹å™¨è¿›è¡Œæ•°æ®è¿ç§»\rå› ä¸ºæ•°æ®å·å®¹å™¨ï¼Œå®ƒå°±æ˜¯ä¸ªå®¹å™¨ï¼Œå°†è¿™ä¸ªå®¹å™¨å¯¼å‡ºæ¥ï¼Œæ”¾åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œå¯ä»¥å®ç°æ•°æ®çš„è¿ç§»ã€å¤‡ä»½ã€‚\nä½¿ç”¨æ•°æ®å·å®¹å™¨å¤‡ä»½æ•°æ®\rç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼ŒéªŒè¯ä¸€ä¸‹çœ‹çœ‹ï¼š\n1ï¼‰å¯¼å‡ºå®¹å™¨\n1 2 3 4 [root@status ~]# docker export -o bak.tar.gz dbdata [root@status ~]# ll total 233008 -rw------- 1 root root 238593024 Sep 3 16:13 bak.tar.gz 2ï¼‰å¯¼å…¥å®¹å™¨\n1 2 3 4 5 [root@status ~]# docker import bak.tar.gz bak_test:20240903V1 sha256:01b390296306643a0ea36d203a846b306d185069937ab3f618fbb864fc1a47a5 [root@status ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE bak_test 20240903V1 01b390296306 4 minutes ago 231 MB 3ï¼‰è¿›å…¥å®¹å™¨ï¼Œçœ‹çœ‹æ˜¯å¦ dbdata ç›®å½•æ˜¯å¦è¿˜æœ‰æ–‡ä»¶ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 [root@status ~]# docker run -d -it bak_test:20240903V1 /bin/bash 17a3da2583a3a37c153b6d34afb19c65f8b9f202377ab04af9e315a2edb1db7b [root@status ~]# ls bak.tar.gz [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 17a3da2583a3 bak_test:20240903V1 \u0026#34;/bin/bash\u0026#34; 18 seconds ago Up 17 seconds heuristic_jang [root@status ~]# docker exec -it heuristic_jang /bin/bash [root@17a3da2583a3 /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@17a3da2583a3 /]# cd dbdata/ [root@17a3da2583a3 dbdata]# ls [root@17a3da2583a3 dbdata]# dbdata é‡Œè¾¹æ²¡æœ‰æ•°æ®ï¼Œå¾ˆå¥‡æ€ª\n4ï¼‰æŸ¥çœ‹æ•°æ®å·å®¹å™¨\n1 2 3 4 5 6 [root@status ~]# docker exec -it dbdata /bin/bash [root@bab3308ef270 /]# ls bin dbdata dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@bab3308ef270 /]# cd dbdata/ [root@bab3308ef270 dbdata]# ls test1 test2 test3 æ•°æ®å·å®¹å™¨çš„æ–‡ä»¶è¿˜æ˜¯æœ‰çš„ï¼Œä½†æ˜¯å¯¼å‡ºçš„æ—¶å€™å¥½åƒå¹¶æ²¡æœ‰å¯¼å‡ºæ¥ï¼Ÿ\ndocker å®¹å™¨æ˜¯åŸºäºé•œåƒç”Ÿæˆçš„ï¼Œé•œåƒæ˜¯ä¸€ä¸ªé™æ€çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä¸ä¼šè‡ªåŠ¨åŒ…å«å¯¼å…¥æ—¶é™„å¸¦çš„æ•°æ®å·çš„ã€‚\nå¦‚æœéœ€è¦å¯¼å…¥æ—¶åŒ…å«æ•°æ®å·é‡Œçš„æ•°æ®ï¼Œå¯ä»¥ç»‘å®šæ•°æ®å·ï¼Œå°†è¿™ä¸ª bak.tar.gz æ˜ å°„åˆ°å®¹å™¨å†…ï¼Œç„¶åè§£å‹å®ƒã€‚\nç»“è®ºï¼š\nä¸èƒ½ä½¿ç”¨æ•°æ®å·å®¹å™¨å¤‡ä»½æ•°æ®\nä½¿ç”¨æ•°æ®å·å®¹å™¨å¤‡ä»½æ•°æ®å·\rä¸èƒ½ä½¿ç”¨æ•°æ®å·å®¹å™¨åšå¤‡ä»½ï¼Œä½†æ˜¯å¯ä»¥å¤‡ä»½å®ƒé‡Œè¾¹çš„æ•°æ®å·ï¼Œä½¿ç”¨ docker run å‘½ä»¤\n1 docker run --volumes-from æ•°æ®å·å®¹å™¨ -v $(pwd):/bakup --name æ–°å®¹å™¨å é•œåƒå:æ ‡ç­¾ æ‰§è¡Œçš„å‘½ä»¤ ä¾‹å­\n1 docker run --volumes-from dbdata -v $(pwd):/bakup --name worker centos:latest tar -cvf /bakup/bakup.tar.gz /dbdata å‘½ä»¤è¯¦è§£ï¼š\n--volumes-from æ˜¯è®©å®¹å™¨ worker æŒ‚è½½ dbdata æ•°æ®å·å®¹å™¨ -v $(pwd):/bakup æ˜¯å°†å½“å‰ç›®å½•ï¼Œéƒ½æ˜ å°„åˆ° worker å®¹å™¨é‡Œçš„ /bakup ç›®å½• tar å‘½ä»¤ï¼Œå°±æ˜¯è¿è¡Œå®¹å™¨ä¹‹åï¼Œç«‹é©¬æ‰§è¡Œçš„å‘½ä»¤ æ³¨æ„\rè¿™ä¸ªå‘½ä»¤ç”Ÿæˆçš„å®¹å™¨ï¼Œå› ä¸º tar å‘½ä»¤æ˜¯å‰å°å‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œå®¹å™¨ä¼šåœæ­¢ã€‚å¦‚æœéœ€è¦åœ¨åå°ç»§ç»­è¿è¡Œè¯¥å®¹å™¨ï¼Œåˆ™å¯ä»¥è¿™æ ·\n1 docker run -it --volumes-from dbdata -v $(pwd):/bakup --name worker centos:latest /bin/bash -c \u0026#34;tar -cvf /bakup/bakup.tar.gz /dbdata\u0026#34; ä½¿ç”¨æ•°æ®å·å®¹å™¨æ¢å¤æ•°æ® *\rè¿™ä¸ªç™¾åº¦æˆ–è€…é—®é—® AI\næ¶‰åŠåˆ°æ•°æ®å¤‡ä»½å’Œæ¢å¤çš„ï¼Œéƒ½æ˜¯æŒºé‡è¦çš„ç« èŠ‚ï¼Œçœ‹çœ‹æ€ä¹ˆå•ç‹¬å®è·µä¸€å¼ ã€‚\nç«¯å£æ˜ å°„ã€å®¹å™¨äº’è”\rç”Ÿäº§ä¸Šï¼Œé€šå¸¸å„ä¸ªå®¹å™¨ä¼šäº’ç›¸åä½œï¼Œç‰¹åˆ«æ˜¯å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ï¼Œæ¯ä¸ªæœåŠ¡ä¸€ä¸ªå®¹å™¨ã€‚è¿˜æœ‰æ•°æ®åº“ä¸åº”ç”¨ä¹‹é—´çš„äº’è”ï¼Œåº”ç”¨éœ€è¦è®¿é—®åˆ°æ•°æ®åº“çš„ç«¯å£ã€‚\næ˜ å°„å®¹å™¨å†…åº”ç”¨çš„æœåŠ¡ç«¯å£åˆ°æœ¬åœ°ä¸»æœº äº’è”æœºåˆ¶å®ç°å¤šä¸ªå®¹å™¨é—´é€šè¿‡å®¹å™¨åæ¥å¿«é€Ÿè®¿é—® å®¹å™¨çš„ç«¯å£æ˜ å°„\rå¦‚æœåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šå¯¹åº”çš„ç«¯å£å‚æ•°ï¼Œå®¹å™¨å¤–éƒ¨æ˜¯æ— æ³•é€šè¿‡ç½‘ç»œè®¿é—®å®¹å™¨å†…çš„åº”ç”¨æœåŠ¡çš„ã€‚\né€šè¿‡ -p æˆ–è€… -P å‚æ•°è¿›è¡Œç«¯å£æ˜ å°„\n-p å¯ä»¥æŒ‡å®šå…·ä½“çš„ç«¯å£ -P æ˜¯éšæœºæ˜ å°„ä¸€ä¸ª 49000 ~ 49900 çš„ç«¯å£ é¦–å…ˆï¼Œè¦çŸ¥é“ï¼Œå®¹å™¨ä¸€æ—¦è¿è¡Œèµ·æ¥æ˜¯ä¸èƒ½ä¿®æ”¹å…¶ç«¯å£æ˜ å°„çš„ï¼Œå¿…é¡»é‡æ–°è¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶åœ¨å¯åŠ¨æ—¶å°±è¿›è¡Œæ˜ å°„ã€‚\n1 dokcer run -d --name å®¹å™¨å -p å¤–éƒ¨æ˜ å°„ç«¯å£:å®¹å™¨åº”ç”¨ç«¯å£ é•œåƒå:æ ‡ç­¾ ä»å¤–éƒ¨è®¿é—®å®¹å™¨åº”ç”¨\r1ï¼‰å¯åŠ¨ nginx å®¹å™¨ï¼Œå¹¶è¿›è¡Œç«¯å£æ˜ å°„\n1 2 3 4 5 [root@status ~]# docker run -d --name nginx -p 8088:80 nginx:1.21.5 1bb6ac4fee9793393c1fa9066f61105201a5f94e3cb5bc1fb4fe463f96bbe647 [root@status ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 1bb6ac4fee97 nginx:1.21.5 \u0026#34;/docker-entrypoin...\u0026#34; 6 seconds ago Up 5 seconds 0.0.0.0:8088-\u0026gt;80/tcp nginx å¯ä»¥çœ‹åˆ° 0.0.0.0:8088 -\u0026gt; 80/tcp ï¼Œè¯´æ˜å¤–éƒ¨çš„ 8088 ç«¯å£æ˜ å°„åˆ°äº†å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåœ¨å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨ 8088 ç«¯å£è®¿é—®åˆ°å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£äº†\n2ï¼‰é€šè¿‡å®¿ä¸»æœº IP:PORT çš„å½¢å¼è®¿é—® nginx\nå› ä¸ºä½¿ç”¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨çš„ IP:8088 å»è®¿é—® nginxï¼Œå‰ææ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šå¼€é€š 8088 ç«¯å£\næŠŠ é˜¿é‡Œäº‘çš„å®‰å…¨ç»„çš„è®¿é—®è§„åˆ™å¼€é€šä¸€ä¸‹ 8088 ç«¯å£ï¼Œç„¶åå°±å¯ä»¥è®¿é—®äº†\n3ï¼‰æŸ¥çœ‹ docker nginx æ—¥å¿—\n1 2 3 4 5 [root@status ~]# docker logs nginx ...... 140.207.163.4 - - [06/Sep/2024:02:31:56 +0000] \u0026#34;GET / HTTP/1.1\u0026#34; 200 615 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0\u0026#34; \u0026#34;-\u0026#34; 2024/09/06 02:31:56 [error] 30#30: *1 open() \u0026#34;/usr/share/nginx/html/favicon.ico\u0026#34; failed (2: No such file or directory), client: 140.207.163.4, server: localhost, request: \u0026#34;GET /favicon.ico HTTP/1.1\u0026#34;, host: \u0026#34;139.196.97.87:8088\u0026#34;, referrer: \u0026#34;http://139.196.97.87:8088/\u0026#34; 140.207.163.4 - - [06/Sep/2024:02:31:56 +0000] \u0026#34;GET /favicon.ico HTTP/1.1\u0026#34; 404 555 \u0026#34;http://139.196.97.87:8088/\u0026#34; \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0\u0026#34; \u0026#34;-\u0026#34; å¯ä»¥çœ‹åˆ°é‡Œè¾¹è®°å½•ç€è°è®¿é—®äº†è¿™ä¸ªåœ°å€\næ˜ å°„æ‰€æœ‰æ¥å£åœ°å€\rä½¿ç”¨ -p port:å®¹å™¨port çš„å½¢å¼ï¼Œå°±æ˜¯é»˜è®¤æ˜ å°„æ‰€æœ‰åœ°å€çš„ï¼Œå°±ä¸Šè¾¹ã€2.1.1ã€‘æ­¥éª¤ï¼Œè¿™ä¸ªå°±æ˜¯æ‰€æœ‰åœ°å€éƒ½å¯ä»¥è®¿é—®åˆ° 8088 ç«¯å£\n1 dokcer run -d --name å®¹å™¨å -p å¤–éƒ¨æ˜ å°„ç«¯å£:å®¹å™¨åº”ç”¨ç«¯å£ é•œåƒå:æ ‡ç­¾ æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„æŒ‡å®šç«¯å£\rä½¿ç”¨ -p æŒ‡å®šåœ°å€:æŒ‡å®šç«¯å£:å®¹å™¨ç«¯å£ å¯ä»¥æŒ‡å®šæ˜ å°„çš„åœ°å€å’Œç«¯å£\n1 docker run -d --name å®¹å™¨å -p æŒ‡å®šå¤–éƒ¨åœ°å€:æŒ‡å®šå¤–éƒ¨æ˜ å°„ç«¯å£:å®¹å™¨åº”ç”¨ç«¯å£ é•œåƒå:æ ‡ç­¾ æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„ä»»æ„ç«¯å£\rä½¿ç”¨ -p æŒ‡å®šåœ°å€::å®¹å™¨ç«¯å£ å¯ä»¥æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„æ‰€æœ‰ç«¯å£\n1 docker run -d --name å®¹å™¨å -p æŒ‡å®šå¤–éƒ¨åœ°å€::å®¹å™¨åº”ç”¨ç«¯å£ é•œåƒå:æ ‡ç­¾ æŸ¥çœ‹æ˜ å°„ç«¯å£çš„é…ç½®\rä½¿ç”¨ docker port å®¹å™¨å å‘½ä»¤æŸ¥çœ‹å®¹å™¨å½“å‰æ˜ å°„çš„ç«¯å£é…ç½®\n1 2 [root@status ~]# docker port nginx 80/tcp -\u0026gt; 0.0.0.0:8088 æŸ¥çœ‹å®¹å™¨çš„ IP\rå¯ä»¥ä½¿ç”¨ docker container inspect æŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å« IP\n1 docker container inspect å®¹å™¨å å®¹å™¨äº’è”\rå®¹å™¨äº’è”ï¼Œå¯ä»¥è®©å¤šä¸ªå®¹å™¨ä¹‹é—´çš„åº”ç”¨è¿›è¡Œäº’ç›¸è®¿é—®ï¼Œæœ€å¸¸è§çš„å°±æ˜¯åº”ç”¨å®¹å™¨å¾—è®¿é—®åˆ°æ•°æ®åº“å®¹å™¨ï¼Œåº”ç”¨æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚\nå®¹å™¨çš„äº’ç›¸è¿æ¥ï¼Œé‡‡ç”¨å®¹å™¨åçš„æ–¹å¼è¿æ¥\nä½¿ç”¨ --link å‚æ•°ï¼Œå¯ä»¥è®©å®¹å™¨äº’è” [!CAUTION]\nAIå›ç­”ï¼š\n\u0026ndash;link æ˜¯æ—§ç‰ˆ docker çš„ç”¨æ³•ï¼Œæ–°ç‰ˆï¼ˆdocker 1.9ï¼‰å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œå› ä¸ºå®ƒéœ€è¦åœæ­¢å®¹å™¨åï¼Œé‡æ–° run å®¹å™¨æ‰èƒ½è®¾ç½®äº’è”ã€‚\næ–°ç‰ˆä½¿ç”¨ network ï¼ˆdocker çš„ç½‘ç»œåŠŸèƒ½ï¼‰è¿æ¥å®¹å™¨ï¼Œåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œç„¶åå°†éœ€è¦äº’è”çš„å®¹å™¨éƒ½æ”¾åˆ°åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œå°±å¯ä»¥å®ç°å®¹å™¨äº’è”ã€‚\næ‰€ä»¥ï¼Œæ›´æ¨è network ç”¨æ³•\nnetwork ç”¨æ³•\ræ¨¡æ¿\n1 docker network å‘½ä»¤é€‰é¡¹ ç½‘ç»œå create åˆ›å»º connection å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ disconnection å°†å®¹å™¨ä»ç½‘ç»œä¸­ç§»é™¤ inspect å±•ç¤ºç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ ls å±•ç¤ºç½‘ç»œåˆ—è¡¨ prune åˆ é™¤æ‰€æœ‰ä¸åœ¨ä½¿ç”¨çš„ç½‘ç»œ rm åˆ é™¤ç½‘ç»œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1.åˆ›å»º docker network create ç½‘ç»œåç§° # 2.å°†å®¹å™¨åŠ å…¥ç½‘ç»œä¸­ docker network connect ç½‘ç»œåç§° \u0026lt;å®¹å™¨1çš„IDæˆ–åå­—\u0026gt; docker network connect ç½‘ç»œåç§° \u0026lt;å®¹å™¨2çš„IDæˆ–åå­—\u0026gt; # 3.å°†å®¹å™¨ä»ç½‘ç»œä¸­ç§»é™¤ docker network disconnect ç½‘ç»œåç§° \u0026lt;å®¹å™¨1çš„IDæˆ–åå­—\u0026gt; # 4.å±•ç¤ºç½‘ç»œè¯¦ç»†ä¿¡æ¯ docker network inspect ç½‘ç»œåç§° # 5.ç½‘ç»œåˆ—è¡¨ docker network ls # 6.åˆ é™¤æ‰€æœ‰ä¸åœ¨ä½¿ç”¨çš„ç½‘ç»œ docker network prune # 7.åˆ é™¤ç½‘ç»œ docker network rm ç½‘ç»œåç§° ä¾‹å­\rå°†ç°æœ‰çš„ nginx å®¹å™¨ä¸ tomcat å®¹å™¨è¿›è¡Œäº’è”ï¼ˆè¿™é‡Œä½¿ç”¨ network è¿›è¡Œå®¹å™¨äº’è”ï¼‰\n1ï¼‰å¯åŠ¨ä¸€ä¸ª tomcat å®¹å™¨ï¼Œä¸è®¾ç½®æ˜ å°„ç«¯å£ï¼ˆä¸€èˆ¬é€šè¿‡ nginx è¿›è¡Œè®¿é—® tomcatï¼Œæ‰€ä»¥æœ‰ nginx èƒ½åœ¨å¤–éƒ¨è®¿é—®åˆ°å°±è¡Œï¼‰\n1 2 [root@status ~]# docker run -d --name tomcat tomcat:10.0.14 59c519066587ee0ad708f99b91a8d04f0a66c2e087a9327dfdf003832140503c 2ï¼‰åˆ›å»ºä¸€ä¸ª docker ç½‘ç»œ\n1 2 3 4 5 6 7 8 [root@status ~]# docker network create web_network 5b1463443f2a443e2f7fa8277ac96eafcc0c9f0866302b910ce507394d667714 [root@status ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 833b114c72d5 bridge bridge local ea34ff8ed89e host host local c142124b84e6 none null local 5b1463443f2a web_network bridge local 3ï¼‰å°† tomcat å®¹å™¨å’Œ nginx å®¹å™¨éƒ½æ‹‰è¿›æ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 [root@status ~]# docker network connect web_network tomcat [root@status ~]# docker network connect web_network nginx [root@status ~]# docker network inspect web_network [ { \u0026#34;Name\u0026#34;: \u0026#34;web_network\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;5b1463443f2a443e2f7fa8277ac96eafcc0c9f0866302b910ce507394d667714\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2024-09-06T11:21:49.319643032+08:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.18.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.18.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;1bb6ac4fee9793393c1fa9066f61105201a5f94e3cb5bc1fb4fe463f96bbe647\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nginx\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;405bee2c3142c87ac6e9d007e021dd4ea4a95e9191ae72dd394343e7fead50e3\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:12:00:03\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.18.0.3/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;59c519066587ee0ad708f99b91a8d04f0a66c2e087a9327dfdf003832140503c\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;tomcat\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;2296bfc0dbf18154fac66e0100b770cf342b2e8556cde98432bc694839b06ba9\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:12:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.18.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: {}, \u0026#34;Labels\u0026#34;: {} } ] Dockerfile æ„å»ºé•œåƒ\rDockerfile é‡Œå„ä¸ªæŒ‡ä»¤å¡«å†™çš„æ–‡ä»¶ç›®å½•ï¼Œä¸€èˆ¬æ˜¯ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œä¸éœ€è¦åŠ è·¯å¾„ã€‚åªæœ‰æ”¾å…¥é•œåƒå†…éƒ¨çš„è·¯å¾„æ‰å¡«å†™ç»å¯¹è·¯å¾„ã€‚\nDockerfile æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸»è¦å†…å®¹ï¼š\nåŸºç¡€é•œåƒä¿¡æ¯ FROM ç»´æŠ¤è€…ä¿¡æ¯ LABEL é•œåƒæ“ä½œæŒ‡ä»¤ RUN å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ CMD è®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡ ENV ä½¿ç”¨ FROM æŒ‡ä»¤æŒ‡æ˜åŸºäºå“ªä¸ªåŸºç¡€é•œåƒåˆ›å»º\nä½¿ç”¨ LABEL æŒ‡ä»¤è¯´æ˜ä½œè€…ä¿¡æ¯\nä½¿ç”¨ RUN æŒ‡ä»¤åœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤\nä½¿ç”¨ CMD æŒ‡ä»¤æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œå“ªäº›å‘½ä»¤\nDockerfile ä¸»è¦æŒ‡ä»¤\rDockerfile æŒ‡ä»¤ è¯´æ˜ FROM æŒ‡å®šåŸºç¡€é•œåƒï¼Œç”¨äºåç»­çš„æŒ‡ä»¤æ„å»ºã€‚ MAINTAINER æŒ‡å®šDockerfileçš„ä½œè€…/ç»´æŠ¤è€…ã€‚ï¼ˆå·²å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨LABELæŒ‡ä»¤ï¼‰ LABEL æ·»åŠ é•œåƒçš„å…ƒæ•°æ®ï¼Œä½¿ç”¨é”®å€¼å¯¹çš„å½¢å¼ã€‚ RUN åœ¨æ„å»ºè¿‡ç¨‹ä¸­åœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ã€‚ CMD æŒ‡å®šå®¹å™¨åˆ›å»ºæ—¶çš„é»˜è®¤å‘½ä»¤ã€‚ï¼ˆå¯ä»¥è¢«è¦†ç›–ï¼‰ ENTRYPOINT è®¾ç½®å®¹å™¨åˆ›å»ºæ—¶çš„ä¸»è¦å‘½ä»¤ã€‚ï¼ˆä¸å¯è¢«è¦†ç›–ï¼‰ EXPOSE å£°æ˜å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç‰¹å®šç½‘ç»œç«¯å£ã€‚ ENV åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ ADD å°†æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹URLå¤åˆ¶åˆ°é•œåƒä¸­ã€‚ COPY å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ VOLUME ä¸ºå®¹å™¨åˆ›å»ºæŒ‚è½½ç‚¹æˆ–å£°æ˜å·ã€‚ WORKDIR è®¾ç½®åç»­æŒ‡ä»¤çš„å·¥ä½œç›®å½•ã€‚ USER æŒ‡å®šåç»­æŒ‡ä»¤çš„ç”¨æˆ·ä¸Šä¸‹æ–‡ã€‚ ARG å®šä¹‰åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼ é€’ç»™æ„å»ºå™¨çš„å˜é‡ï¼Œå¯ä½¿ç”¨ \u0026ldquo;docker build\u0026rdquo; å‘½ä»¤è®¾ç½®ã€‚ ONBUILD å½“è¯¥é•œåƒè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºè¿‡ç¨‹çš„åŸºç¡€æ—¶ï¼Œæ·»åŠ è§¦å‘å™¨ã€‚ STOPSIGNAL è®¾ç½®å‘é€ç»™å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚ HEALTHCHECK å®šä¹‰å‘¨æœŸæ€§æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€çš„å‘½ä»¤ã€‚ SHELL è¦†ç›–Dockerä¸­é»˜è®¤çš„shellï¼Œç”¨äºRUNã€CMDå’ŒENTRYPOINTæŒ‡ä»¤ã€‚ é…ç½®æŒ‡ä»¤\rFROM\rDockerfileä¸­ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»æ˜¯ FROM æŒ‡ä»¤\n1 FROM é•œåƒå[:æ ‡ç­¾] [AS åˆ«å] ä¸ºäº†ä¿è¯é•œåƒç²¾ç®€ï¼Œå¯ä»¥ä½¿ç”¨åŒ…å°çš„é•œåƒï¼Œæ¯”å¦‚ Alpine \\ Debian ä½œä¸ºåŸºç¡€é•œåƒ\n1 2 3 4 5 6 7 8 9 10 å¥½åƒæ˜¯å¯ä»¥æœ‰å‡ ä¸ª FROM çš„ï¼Ÿ FROM RUN ... FROM RUN .... FROM RUN ..ã€‚ LABEL\rLABELæŒ‡ä»¤æ˜¯ç»™é•œåƒæ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ä¿¡æ¯çš„ï¼ŒåŒ…å«é•œåƒçš„åŸºæœ¬ä¿¡æ¯ï¼Œé”®å€¼å¯¹çš„å½¢å¼ã€‚å¯ä»¥æœ‰å¤šä¸ª LABEL ã€‚\n1 2 3 4 LABEL é”®1=å€¼1 LABEL é”®2=å€¼2 LABEL é”®3=å€¼3 ... 1 2 3 4 LABEL version=\u0026#34;V1.0\u0026#34; LABEL author=\u0026#34;Weii\u0026#34; LABEL description=\u0026#34;è¿™é‡Œä¸€ä¸ªä¾‹å­\\ å¯ä»¥æ¢è¡Œ\u0026#34; EXPOSE\rå£°æ˜é•œåƒå†…æœåŠ¡ç›‘å¬çš„ç«¯å£ã€‚ä»…ä»…æ˜¯å£°æ˜ï¼Œä¸ä¼šè‡ªåŠ¨å®Œæˆç«¯å£æ˜ å°„ï¼Œæ˜ å°„è¿˜å¾—æ˜¯å¯åŠ¨å®¹å™¨æ—¶çš„ -p å‚æ•°ã€2.1ã€‘æ­¥éª¤ã€‚\n1 EXPOSE ç«¯å£ ENV\ræŒ‡å®šé•œåƒçš„ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡åœ¨å¯åŠ¨å®¹å™¨æ—¶ä¹Ÿä¼šå­˜åœ¨ã€‚é”®å€¼å¯¹çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ª ENVã€‚\n1 2 3 4 ENV é”®1=å€¼1 ENV é”®2=å€¼2 ENV é”®3=å€¼3 ... 1 2 3 4 ENV JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64 ENV JRE_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64/jre ENV CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib ENV PATH=$JAVA_HOME/bin:$PATH VOLUME\ræ•°æ®å·ï¼Œç»™é•œåƒåˆ›å»ºä¸€ä¸ªæ•°æ®å·æŒ‚è½½ç‚¹\n1 VOLUME [\u0026#34;/path\u0026#34;] å¯ä»¥åœ¨ Dockerfile ç›´æ¥ç”¨ VOLUME åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ã€‚åˆ°æ—¶å€™å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨å‚æ•°æŒ‚è½½æ•°æ®å·ã€‚\nUSER\ræŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åï¼ˆæŒ‡æœåŠ¡å™¨ç”¨æˆ·åï¼‰\n1 USER ç”¨æˆ·å WORKDIR\ré…ç½®å®¹å™¨çš„ä¸»å·¥ä½œç›®å½•ï¼Œç»™åç»­çš„ RUN \\ CMD ç­‰æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•ï¼ŒRUN \\ CMD æ‰§è¡Œçš„å‘½ä»¤ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡Œçš„\n1 WORKDIR /path/to/dir SHELL\ræŒ‡å®šä½¿ç”¨ shell æ—¶çš„é»˜è®¤ shell ç±»å‹\næ“ä½œæŒ‡ä»¤\rRUN\rè¿è¡ŒæŒ‡ä»¤\n1 2 3 4 5 6 7 RUN å‘½ä»¤1 RUN å‘½ä»¤2 RUN å‘½ä»¤3 RUN å‘½ä»¤4 \u0026amp;\u0026amp; å‘½ä»¤5 \u0026amp;\u0026amp; å‘½ä»¤6 RUN å‘½ä»¤7 \\ \u0026amp;\u0026amp; å‘½ä»¤8 \\ \u0026amp;\u0026amp; å‘½ä»¤9 æ³¨æ„ï¼š\næ¯æ¡ RUN æŒ‡ä»¤éƒ½ä¼šç”Ÿæˆä¸€å±‚é•œåƒå±‚ï¼Œéƒ½æ˜¯åœ¨ä¸Šä¸€å±‚çš„åŸºç¡€ä¸Šç”Ÿæˆæ–°çš„ä¸€å±‚ã€‚ å¯ä»¥ä½¿ç”¨ \\ æ¥æ¢è¡Œ åˆç†çš„åˆ©ç”¨ RUN åˆ†å±‚ï¼Œå¯ä»¥æä¾›æ„å»ºæ•ˆç‡ CMD\ræŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤\n1 CMD å‘½ä»¤ æ³¨æ„ï¼š\næ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ CMD æŒ‡ä»¤ï¼Œå¦‚æœæœ‰å¤šæ¡ï¼Œåˆ™ä¼šè¢«æœ€åä¸€æ¡è¦†ç›–ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šæ‰§è¡Œã€‚ å¦‚æœå¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šäº†æ‰§è¡Œå‚æ•°ï¼Œåˆ™ä¼šè¦†ç›–æ‰ CMD æŒ‡ä»¤ docker run -d \u0026ndash;name å®¹å™¨å é•œåƒå:æ ‡ç­¾ æ‰§è¡Œçš„å‘½ä»¤\nè¿™é‡Œæ‰§è¡Œçš„å‘½ä»¤ï¼Œä¼šè¦†ç›–æ‰ Dockerfile é‡Œçš„ CMD æŒ‡ä»¤\nADD\ræ·»åŠ å†…å®¹åˆ°é•œåƒï¼Œä¸€èˆ¬å¡«å†™é•œåƒé‡Œçš„ç»å¯¹è·¯å¾„ï¼›\nå¤åˆ¶çš„è·¯å¾„ï¼Œåˆ™æ˜¯ dockerfile æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰€æœ‰åŒ…éƒ½éœ€è¦åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œä¸èƒ½åŠ è·¯å¾„ã€‚\n1 ADD éœ€è¦å¤åˆ¶çš„è·¯å¾„ å®¹å™¨é‡Œçš„ç»å¯¹è·¯å¾„ æ¯”å¦‚ï¼šå¤åˆ¶å½“å‰ç›®å½•å†…å®¹åˆ°å®¹å™¨å†…çš„ /home ç›®å½•\n1 ADD . /home æ¯”å¦‚\n1 2 ADD jdk.tar.gz /home/install ADD apache-tomcat-10.1.30.tar.gz /home/install å®ƒä¼šç›´æ¥è§£å‹è¿™ä¸ª tar åŒ…åˆ° /home/install é‡Œï¼Œæ‰€ä»¥ RUN å‘½ä»¤ä¸ç”¨è·Ÿç€ tar -xzvf å‘½ä»¤äº†ã€‚\nCOPY\rå¤åˆ¶å†…å®¹åˆ°é•œåƒï¼Œè·Ÿ ADD å·®ä¸å¤šï¼Œç”¨ ADDã€‚\nåˆ›å»ºé•œåƒ\råœ¨ç¼–å†™å®Œ Dockerfile åï¼Œä½¿ç”¨ docker image build å‘½ä»¤åˆ›å»ºé•œåƒ\n1 docker image build -t é•œåƒåç§°:æ ‡ç­¾ Dockerfileçš„è·¯å¾„ è¯¥å‘½ä»¤çš„é€æ¡æ‰§è¡Œ Dockerfile é‡Œçš„ RUN æŒ‡ä»¤ï¼Œå¦‚æœ RUN æŒ‡ä»¤è¿‡å¤šï¼Œä¼šå¯¼è‡´åˆ›å»ºé•œåƒç¼“æ…¢ã€‚å› ä¸ºæ¯ä¸€æ¡ RUN æŒ‡ä»¤ï¼Œéƒ½ä¼šç”Ÿæˆä¸€å±‚æ–°é•œåƒï¼Œæœ€åæ‰åˆå¹¶åˆ°ä¸€èµ·ã€‚\nåŒæ ·çš„ï¼Œdocker image build æ”¯æŒå¾ˆå¤šé€‰é¡¹ï¼Œå…·ä½“å¯éœ€è¦æ—¶ç™¾åº¦\né€‰æ‹©çˆ¶é•œåƒ\rç”Ÿæˆæ–°çš„é•œåƒéƒ½æ˜¯åŸºäº Dockerfile çš„ FROM æŒ‡ä»¤ä¸­æŒ‡å®šçš„çˆ¶é•œåƒï¼Œçˆ¶é•œåƒæ˜¯ç”Ÿæˆé•œåƒçš„åŸºç¡€ï¼Œä¼šå½±å“åˆ°ç”Ÿæˆé•œåƒçš„å¤§å°å’ŒåŠŸèƒ½ã€‚\nä½¿ç”¨ .dockerignore æ–‡ä»¶\rä¸çœ‹\nå¤šæ­¥éª¤åˆ›å»º\ræ€»ç»“\r[!IMPORTANT]\ndocker ä¸»è¦æ˜¯4ä¸ªå¤§éƒ¨åˆ†çš„å‘½ä»¤ï¼š\né•œåƒå‘½ä»¤ å®¹å™¨å‘½ä»¤ æ•°æ®å·å‘½ä»¤ ç½‘ç»œå‘½ä»¤ inspect éƒ½æ˜¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯\nls éƒ½æ˜¯åˆ—å‡ºåˆ—è¡¨\n","date":"2024-09-01T13:56:41+08:00","permalink":"http://localhost:1313/posts/2024/09/docker-%E5%9F%BA%E7%A1%80/","title":"Docker åŸºç¡€ä¸å…¥é—¨"},{"content":"æŸè¯åˆ¸çš„å¼‚å¸¸äº¤æ˜“é¡¹ç›®çš„æµ‹è¯•ç¯å¢ƒå·²ç»æ—©æ²¡äº†ï¼Œåªæœ‰ç”Ÿäº§ç¯å¢ƒã€‚å› ä¸ºéƒ½æ˜¯ç¨³å®šè¿è¡Œçš„é¡¹ç›®ï¼Œä¸€èˆ¬å¼€å‘å®Œç›´æ¥ä¸Šç”Ÿäº§ï¼Œå…·ä½“é‡åˆ°é—®é¢˜åœ¨ç”Ÿäº§ä¸Šæ’æŸ¥ã€‚ä½†æ˜¯ç”±äºæµç¨‹é€æ¸ä¸¥æ ¼ï¼Œæ‰€æœ‰å‘åŒ…å¿…é¡»èµ°æµç¨‹ï¼Œç»æµ‹è¯•éƒ¨éªŒè¯åæ‰èƒ½ä¸Šäº§çº¿ï¼Œæ‰€ä»¥éœ€è¦æ­ä¸ªæµ‹è¯•ç¯å¢ƒã€‚ä½†æ˜¯è¿™ä¸ªé¡¹ç›®å·²ç»å¾ˆæ—©äº†ï¼Œå…³äºé¡¹ç›®çš„æ•°æ®åº“ç”¨æˆ·ï¼Œæœ‰æ¡†æ¶ç”¨æˆ·ã€äº§å“ç”¨æˆ·ï¼Œè¿˜æœ‰å®¢æˆ·ç»™è‡ªå·±åˆ›å»ºçš„ç”¨æˆ·ï¼Œæ€»å…± 100 + ã€‚å½“æ—¶çœ‹ç€å®¢æˆ·æä¾›è¿‡æ¥çš„éœ€åˆ›å»ºçš„ç”¨æˆ·ï¼Œå¤´å¤§ã€‚æ‰€ä»¥å°±æœ‰äº†æ‰¹é‡åˆ›å»ºçš„æƒ³æ³•ã€‚\né¦–å…ˆéœ€è¦çŸ¥é“ï¼Œåˆ›å»ºè¡¨ç©ºé—´ã€åˆ›å»ºç”¨æˆ·çš„è¯­å¥\n1 2 3 4 5 6 7 8 -- åˆ›å»ºè¡¨ç©ºé—´ CREATE TABLESPACE \u0026#34;TS_TEST\u0026#34; DATAFILE \u0026#39;/home/dmdba/data/TS_TEST.DBF\u0026#39; SIZE 500 AUTOEXTEND ON NEXT 40 MAXSIZE UNLIMITED; -- åˆ›å»ºç”¨æˆ· CREATE USER \u0026#34;TEST\u0026#34; IDENTIFIED BY \u0026#34;123456789\u0026#34; DEFAULT TABLESPACE TS_TEST; -- *** ä¸Šæ–¹ä½¿ç”¨åŒå¼•å·æ˜¯ä¸ºäº†åŒºåˆ†å¤§å°å†™ï¼Œä¸ç”¨åŒå¼•å·éƒ½é»˜è®¤å¤§å†™ *** 1 2 3 -- åˆ›å»ºè¡¨ç©ºé—´ CREATE TABLESPACE TABLESPACE_NAME DATAFILE \u0026#39;/home/ORACLE/data/TS_TEST.DBF\u0026#39; SIZE 500 AUTOEXTEND ON NOLOGGING EXTENT MANAGEMENT LOCAL; å®ç°æ–¹å¼ä¸€\r1.éœ€è¦åˆ›å»ºçš„è¡¨ç©ºé—´å’Œç”¨æˆ·ä½¿ç”¨ excel æ•´ç†å¥½ï¼Œä¸€ä¸€å¯¹åº”\n2.åˆ›å»ºè¡¨ï¼Œå­˜æ”¾è¡¨ç©ºé—´å’Œç”¨æˆ·æ•°æ®\n1 CREATE TABLE TEST.T_TABLESPACE_USER(TABLESPACE_NAME VARCHAR2(200), USER_NAME VARCHAR2(200)); 3.å¼€é”ï¼ŒæŠŠæ•´ç†å¥½çš„æ•°æ®æ’å…¥è¡¨ä¸­\n1 SELECT TABLESPACE_NAME, USER_NAME, ROWID FROM TEST.T_TABLESPACE_USER; 4.ç¼–å†™å­˜å‚¨è¿‡ç¨‹ï¼Œå¾ªç¯åˆ›å»º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 CREATE OR REPLACE PROCEDURE TEST.P_CREATE_TABLESPACE(I_BUSI_DATE IN VARCHAR2, O_RETURN_MSG OUT VARCHAR2, O_RETURN_CODE OUT INTEGER) IS --===================================================== -- AUTHOR: WQ -- MARK: æ‰¹é‡åˆ›å»ºè¡¨ç©ºé—´\\ç”¨æˆ·ç¨‹åº --===================================================== -- å˜é‡ V_DATAFILE_PATH VARCHAR2(1000) DEFAULT \u0026#39;/home/oracle/data/testdb/\u0026#39;; -- è¡¨ç©ºé—´è·¯å¾„ V_SIZE VARCHAR2(20) DEFAULT \u0026#39;100M\u0026#39;;\t-- è¡¨ç©ºé—´é»˜è®¤å¤§å° --===================================================== -- ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ BEGIN DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´åˆ›å»ºï¼šå¼€å§‹\u0026#39;); -- éå†è¡¨ç©ºé—´åç§° FOR TABLESPACE_REC IN (SELECT TABLESPACE_NAME FROM TEST.T_TABLESPACE_USER) LOOP EXECUTE IMMEDIATE \u0026#39;CREATE BIGFILE TABLESPACE \u0026#39; || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39; DATAFILE \u0026#39;\u0026#39;\u0026#39; || V_DATAFILE_PATH || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39;.DBF\u0026#39;\u0026#39;\u0026#39; || \u0026#39; SIZE \u0026#39; || V_SIZE || \u0026#39; AUTOEXTEND ON NOLOGGING EXTENT MANAGEMENT LOCAL\u0026#39;; -- è¾“å‡ºï¼Œæ–¹ä¾¿æŸ¥çœ‹åˆ›å»ºç»“æœ DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´ \u0026#39; || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39; åˆ›å»ºæˆåŠŸã€‚\u0026#39;); END LOOP; DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´åˆ›å»ºï¼šç»“æŸ\u0026#39;); -- è®¾ç½®è¿”å›å€¼ O_RETURN_CODE := 1; O_RETURN_MSG := \u0026#39;æ‰§è¡ŒæˆåŠŸ\u0026#39;; EXCEPTION WHEN OTHERS THEN O_RETURN_CODE := SQLCODE; O_RETURN_MSG := SQLERRM; ROLLBACK; END; å¥‡æ€ªï¼Œè¾¾æ¢¦é‡Œè¾¹æŠ¥ è¯­æ³•åˆ†æé”™è¯¯ï¼Œä¸å¤ªç†è§£ã€‚\n\u0026hellip; æ²¡è®¾ç½®å…¼å®¹ ORACLE è¯­æ³•ï¼ŒæŠŠ dm.ini çš„ COMPATIBLE_MODE æ”¹ä¸º 2 å³å¯\næ”¹æ­£å\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 CREATE OR REPLACE PROCEDURE TEST.P_CREATE_TABLESPACE(I_BUSI_DATE IN VARCHAR2, O_RETURN_MSG OUT VARCHAR2, O_RETURN_CODE OUT INTEGER) IS --===================================================== -- AUTHOR: WQ -- MARK: æ‰¹é‡åˆ›å»ºè¡¨ç©ºé—´\\ç”¨æˆ·ç¨‹åº --===================================================== -- å˜é‡ V_DATAFILE_PATH VARCHAR2(1000) DEFAULT \u0026#39;/home/dmdba/data/DAMENG/\u0026#39;; -- è¡¨ç©ºé—´è·¯å¾„ V_SIZE VARCHAR2(20) DEFAULT \u0026#39;100M\u0026#39;;\t-- è¡¨ç©ºé—´é»˜è®¤å¤§å° --===================================================== -- ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ BEGIN DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´åˆ›å»ºï¼šå¼€å§‹\u0026#39;); -- éå†è¡¨ç©ºé—´åç§° FOR TABLESPACE_REC IN (SELECT TABLESPACE_NAME FROM TEST.T_TABLESPACE_USER) LOOP BEGIN EXECUTE IMMEDIATE \u0026#39;CREATE TABLESPACE \u0026#39; || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39; DATAFILE \u0026#39;\u0026#39;\u0026#39; || V_DATAFILE_PATH || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39;.DBF\u0026#39;\u0026#39;\u0026#39; || \u0026#39; SIZE \u0026#39; || V_SIZE || \u0026#39; AUTOEXTEND ON NEXT 40 MAXSIZE UNLIMITED\u0026#39;; -- è¾“å‡ºï¼Œæ–¹ä¾¿æŸ¥çœ‹åˆ›å»ºç»“æœ DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´ \u0026#39; || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39; åˆ›å»ºæˆåŠŸã€‚\u0026#39;); EXCEPTION WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´ \u0026#39; || TABLESPACE_REC.TABLESPACE_NAME || \u0026#39; åˆ›å»ºå¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯ï¼š\u0026#39; || SQLERRM); END; END LOOP; DBMS_OUTPUT.PUT_LINE(\u0026#39;è¡¨ç©ºé—´åˆ›å»ºï¼šç»“æŸ\u0026#39;); DBMS_OUTPUT.PUT_LINE(\u0026#39;ç”¨æˆ·åˆ›å»ºï¼šå¼€å§‹\u0026#39;); -- éå†ç”¨æˆ·åç§° FOR USER_REC IN (SELECT TABLESPACE_NAME, USER_NAME FROM TEST.T_TABLESPACE_USER) LOOP BEGIN EXECUTE IMMEDIATE \u0026#39;CREATE USER \u0026#39; || USER_REC.USER_NAME || \u0026#39; IDENTIFIED BY \u0026#39;\u0026#39;123456789\u0026#39;\u0026#39; \u0026#39; || \u0026#39;DEFAULT TABLESPACE \u0026#39; || USER_REC.TABLESPACE_NAME; -- è¾“å‡ºï¼Œæ–¹ä¾¿æŸ¥çœ‹åˆ›å»ºç»“æœ DBMS_OUTPUT.PUT_LINE(\u0026#39;ç”¨æˆ· \u0026#39; || USER_REC.USER_NAME || \u0026#39; åˆ›å»ºæˆåŠŸã€‚\u0026#39;); EXCEPTION WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE(\u0026#39;ç”¨æˆ· \u0026#39; || USER_REC.USER_NAME || \u0026#39; åˆ›å»ºå¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯ï¼š\u0026#39; || SQLERRM); END; END LOOP; DBMS_OUTPUT.PUT_LINE(\u0026#39;ç”¨æˆ·åˆ›å»ºï¼šç»“æŸ\u0026#39;); -- è®¾ç½®è¿”å›å€¼ O_RETURN_CODE := 1; O_RETURN_MSG := \u0026#39;æ‰§è¡ŒæˆåŠŸ\u0026#39;; EXCEPTION WHEN OTHERS THEN O_RETURN_CODE := SQLCODE; O_RETURN_MSG := SQLERRM; -- ROLLBACK; END; 5.æˆæƒåˆ›å»ºè¡¨ç©ºé—´\n1 grant create tablespace to TEST; 6.æ‰§è¡Œ SP å³å¯\nå®ç°æ–¹å¼äºŒ\rå…¶å®ä¹Ÿä¸ç”¨å†™å­˜å‚¨è¿‡ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 -- è¡¨ç©ºé—´è¯­å¥ SELECT \u0026#39;CREATE TABLESPACE \u0026#39; || A.TABLESPACE_NAME || \u0026#39; DATAFILE \u0026#39;\u0026#39;\u0026#39; || \u0026#39;/home/dmdba/data/testdb/\u0026#39; || A.TABLESPACE_NAME || \u0026#39;.DBF\u0026#39;\u0026#39;\u0026#39; || \u0026#39; SIZE 500M AUTOEXTEND ON NEXT 40 MAXSIZE UNLIMITED;\u0026#39; FROM TEST.T_TABLESPACE_USER A; -- ç”¨æˆ·è¯­å¥ SELECT \u0026#39;CREATE USER \u0026#39; || A.USER_NAME || \u0026#39; IDENTIFIED BY \u0026#34;123456789\u0026#34; DEFAULT TABLESPACE \u0026#39; || A.TABLESPACE_NAME || \u0026#39;;\u0026#39; FROM TEST.T_TABLESPACE_USER A; ","date":"2024-08-28T21:02:51+08:00","permalink":"http://localhost:1313/posts/2024/08/sp-%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%92%8C%E7%94%A8%E6%88%B7/","title":"SP æ‰¹é‡åˆ›å»ºè¡¨ç©ºé—´å’Œç”¨æˆ·"},{"content":" å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šç‰©ç†å¤‡ä»½è¿˜åŸ | è¾¾æ¢¦æŠ€æœ¯æ–‡æ¡£ (dameng.com)\nå¤‡ä»½è¿˜åŸè¿‡ç¨‹ä¸­çš„é—®é¢˜è§£å†³æ–¹æ¡ˆå‚è€ƒï¼šå¤‡ä»½è¿˜åŸ | è¾¾æ¢¦æŠ€æœ¯æ–‡æ¡£ (dameng.com)\nå¤‡ä»½è¿˜åŸå…¶å®ä¹ŸæŒºç®€å•ï¼Œå°±æ˜¯å¤‡ä»½ï¼Œä¸€èˆ¬æ•´åº“å¤‡ä»½ï¼Œä¸€èˆ¬å¼€å¯è”æœºå¤‡ä»½ã€‚å°±æ˜¯æŠŠå…¨åº“å¯¼å‡ºæ¥ï¼Œç„¶åé‡æ–°åˆ·è¿›å»çš„è¿‡ç¨‹\nå¤‡ä»½ï¼šå°±æ˜¯ä»æ•°æ®åº“æ–‡ä»¶æ‹·è´å‡ºæœ‰æ•ˆçš„æ•°æ®é¡µä¿å­˜åˆ°å¤‡ä»½é›†ä¸­\nè¿˜åŸï¼šå°±æ˜¯å¤‡ä»½çš„é€†è¿‡ç¨‹ï¼Œå°†å¤‡ä»½é›†ä¸­çš„æ•°æ®å†…å®¹ï¼ˆæ•°æ®æ–‡ä»¶ã€æ•°æ®é¡µã€å½’æ¡£æ–‡ä»¶ï¼‰é‡æ–°å†™å…¥åˆ°ç›®æ ‡æ•°æ®æ–‡ä»¶çš„è¿‡ç¨‹ã€‚\næ¢å¤ï¼šé€šè¿‡é‡åšå½’æ¡£æ—¥å¿—ï¼Œå°†æ•°æ®åº“æ¢å¤åˆ°å¤‡ä»½ç»“æŸæ—¶çš„çŠ¶æ€ï¼Œæˆ–è€…æ¢å¤åˆ°æŒ‡å®šçš„æ—¶é—´ç‚¹å’ŒLSNã€‚\nå¤‡ä»½è¿˜åŸåŸºç¡€\rç›¸å…³æœ¯è¯­\rè”æœºå¤‡ä»½è¿˜åŸï¼šæ•°æ®åº“å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè¿›è¡Œçš„å¤‡ä»½è¿˜åŸæ“ä½œ è„±æœºå¤‡ä»½è¿˜åŸï¼šæ•°æ®åº“æœåŠ¡å…³é—­çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œçš„å¤‡ä»½è¿˜åŸæ“ä½œ å¤‡ä»½é›†ï¼šå­˜æ”¾å¤‡ä»½æ•°æ® å¤‡ä»½çš„å‰æ\rå¯¹æ•°æ®åº“å®ä¾‹å¼€å¯å½’æ¡£æ¨¡å¼ï¼Œå¹¶å¤„äºæ‰“å¼€çš„çŠ¶æ€ï¼ˆå¦‚æœæ˜¯é›†ç¾¤çš„è¯ï¼Œå°±ä¸éœ€è¦å†æ‰“å¼€äº†ï¼Œå› ä¸ºé›†ç¾¤æ­å»ºæ—¶å°±ä¼šæ‰“å¼€å½’æ¡£ã€‚å¦‚æœæ˜¯å•æœºç‰ˆï¼Œæœ‰å¯èƒ½æ²¡æœ‰æ‰“å¼€å½’æ¡£æ¨¡å¼ï¼Œéœ€è¦å…ˆæ‰“å¼€ï¼‰\n1 2 3 4 ALTER DATABASE MOUNT; ALTER DATABASE ARCHIVELOG; ALTER DATABASE ADD ARCHIVELOG \u0026#39;DEST=/home/dmdba/dmdbms/DMDB/arch, TYPE=LOCAL, FILE_SIZE=1024, SPACE_LIMIT=10240\u0026#39;; ALTER DATABASE OPEN; ç„¶åé‡æ–°å¯åŠ¨ä¸€ä¸‹ è¾¾æ¢¦ç®¡ç†å·¥å…· ï¼Œä¸ç„¶è¾¾æ¢¦ç®¡ç†å·¥å…·æ²¡åˆ·æ–°ç”Ÿæ•ˆã€‚å»ºè®®ç›´æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šä½¿ç”¨ ./disql æ“ä½œ\nè”æœºä¸è„±æœºå¤‡ä»½è¿˜åŸçš„åŒºåˆ«\rå¤‡ä»½è¿˜åŸ\rå¤‡ä»½\rè”æœºå¤‡ä»½ï¼Œå°±æ˜¯æ•°æ®åº“è¿è¡Œæ—¶è¿›è¡Œå¤‡ä»½ã€‚æ”¯æŒçš„å¤‡ä»½æœ‰ï¼š\næ•°æ®åº“å¤‡ä»½ ç”¨æˆ·è¡¨ç©ºé—´å¤‡ä»½ ç”¨æˆ·è¡¨å¤‡ä»½ å½’æ¡£å¤‡ä»½ è„±æœºå¤‡ä»½ï¼Œåªæ”¯æŒï¼š\næ•°æ®åº“å¤‡ä»½ å½’æ¡£å¤‡ä»½ è¡¨ç©ºé—´å¤‡ä»½ã€è¡¨å¤‡ä»½ï¼Œåªèƒ½è”æœºå¤‡ä»½ï¼\næ•°æ®åº“å¤‡ä»½å‘½ä»¤\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å…¨å¤‡ BACKUP DATABASE FULL BACKUPSET \u0026#39;/opt/dmdbms/BAK/db_full_bak_01\u0026#39;; # å¢å¤‡ BACKUP DATABASE INCREMENT BACKUPSET \u0026#39;/opt/dmdbms/BAK/db_full_bak_01\u0026#39;; # è®¾ç½®å¤‡ä»½å‹ç¼©ç­‰çº§ COMPRESSED LEVEL BACKUP DATABASE FULL BACKUPSET \u0026#39;/home/dm_bak/db_bak_3_06\u0026#39; COMPRESSED LEVEL 5; # è®¾ç½®å¹¶è¡Œå¤‡ä»½ PARALLEL BACKUP DATABASE FULL BACKUPSET \u0026#39;/home/dm_bak/db_bak_3_07\u0026#39; PARALLEL 8; # è®¾ç½®åˆ‡ç‰‡å¤§å° MAXPIECESIZE BACKUP DATABASE FULL BACKUPSET \u0026#39;/home/dm_bak/db_bak_3_05\u0026#39; MAXPIECESIZE 300; # è®¾ç½®å¤‡ä»½æ–‡ä»¶çš„åç§° TO BAK_NAME BACKUP DATABASE TO WEEKLY_FULL_BAK BACKUPSET \u0026#39;/home/dm_bak/db_bak_3_02\u0026#39;; # æ·»åŠ å¤‡ä»½å¤‡æ³¨ BACKUPINFO BACKUP DATABASE BACKUPSET \u0026#39;/home/dm_bak/db_bak_3_04\u0026#39; BACKUPINFO \u0026#39;å®Œå…¨å¤‡ä»½\u0026#39;; ç»“åˆèµ·æ¥å°±æ˜¯è¿™æ ·çš„ï¼š\n1 backup database full to \u0026#34;DB_DAMENG_FULL_2024_09_11_16_12_29\u0026#34; backupset \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DAMENG_FULL_2024_09_11_16_12_29\u0026#39; backupinfo \u0026#39;å…¨é‡å¤‡ä»½\u0026#39; compressed level 1 parallel 8; å½’æ¡£å¤‡ä»½å‘½ä»¤\r1 BACKUP ARCHIVE LOG ALL BACKUPSET \u0026#39;arch_bak_01\u0026#39;; è¿™ä¸ªåº”è¯¥æ˜¯å…¨å¤‡ï¼Ÿå‚æ•°ä¹Ÿè·Ÿã€æ•°æ®åº“å¤‡ä»½å‘½ä»¤ã€‘ä¸€æ ·\nè¿˜åŸ\rè¾¾æ¢¦çš„è”æœºè¿˜åŸï¼Œåªæ”¯æŒè¡¨çš„è¿˜åŸã€‚åº“ã€è¡¨ç©ºé—´ç­‰å‡ä¸æ”¯æŒã€‚\nä¸æ¨èè”æœºè¿˜åŸï¼Œå½“æ•°æ®åº“éœ€è¦è¿˜åŸæ—¶ï¼Œè‚¯å®šå‘ç”Ÿäº†ä¸€äº›å¤§æ“ä½œï¼Œä½¿ç”¨è„±æœºæ›´å¥½ã€‚\nè¿˜åŸå¯ä»¥è¿˜åŸåˆ°æŒ‡å®šçš„å¤‡ä»½é›†ï¼ˆä¸ç®¡æ˜¯è”æœºå¤‡ä»½æ•°æ®åº“å¤‡ä»½é›†ï¼Œè¿˜æ˜¯è„±æœºå¤‡ä»½çš„æ•°æ®åº“å¤‡ä»½é›†ï¼‰ï¼Œä¹Ÿå¯ä»¥è¿˜åŸåˆ°æŒ‡å®šçš„å½’æ¡£æ–‡ä»¶ã€‚\nè¿˜åŸæ“ä½œç»Ÿä¸€æœ‰ä¸€ä¸ªå·¥å…· ./dmrman\nDMRMANï¼ˆDM RECOVERY MANAGERï¼‰æ˜¯è„±æœºå¤‡ä»½è¿˜åŸå‘½ä»¤è¡Œå·¥å…·ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼Œç”±å®ƒæ¥ç»Ÿä¸€è´Ÿè´£åº“çº§è„±æœºå¤‡ä»½ã€è„±æœºè¿˜åŸã€è„±æœºæ¢å¤ç­‰ç›¸å…³æ“ä½œï¼Œè¯¥å·¥å…·æ”¯æŒå‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°æ–¹å¼å’Œæ§åˆ¶å°äº¤äº’æ–¹å¼æ‰§è¡Œï¼Œé™ä½ç”¨æˆ·çš„æ“ä½œéš¾åº¦ã€‚\n1 2 3 4 5 6 ##å¯åŠ¨DMRMAN ./dmrman ##é€€å‡ºDMRMAN ##å¯åŠ¨åæ§åˆ¶å°ä¸­è¾“å…¥ exit å‘½ä»¤ RMAN\u0026gt;exit; å¤‡ä»½è¿˜åŸå®è·µï¼ˆå•æœºç‰ˆï¼‰\ræœ¬æ¬¡éªŒè¯è¾¾æ¢¦å•æœºç‰ˆä¸Šçš„å¤‡ä»½ä¸è¿˜åŸï¼Œä»¥é˜²ä»¥åé‡åˆ°åä¸´æ—¶æŠ±ä½›è„šã€‚\næ³¨æ„ï¼š\nè¯·ç¡®ä¿å¼€å¯äº†å½’æ¡£æ¨¡å¼ï¼ä¸ç„¶æ— æ³•å¤‡ä»½çš„ã€‚ è”æœºå¤‡ä»½åº“ã€è„±æœºè¿˜åŸåº“ æ‰€æœ‰æ“ä½œæ²¡æœ‰ç‰¹å®šè¯´æ˜ï¼Œå‡ä½¿ç”¨ dmdba ç”¨æˆ·è¿›è¡Œæ“ä½œ æœ¬æ¬¡ä¸º å…¨é‡å¤‡ä»½ + å¢é‡å¤‡ä»½ è¿˜åŸæ•°æ®åº“çš„å®è·µ\næ³¨æ„ï¼š\nå½“æœ‰å…¨é‡å¤‡ä»½ + å¢é‡å¤‡ä»½æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨æœ€æ–°çš„å¢é‡å¤‡ä»½è¿›è¡Œè¿˜åŸå³å¯ã€‚ä½†æ˜¯å…¨é‡å¤‡ä»½æ–‡ä»¶ä¸å¯åˆ é™¤ï¼Œå¿…é¡»å­˜åœ¨ã€‚ ä¹Ÿå¯ä»¥åªä½¿ç”¨å…¨é‡ï¼Œä½†æ˜¯ä¼šé€ æˆæœŸé—´æ•°æ®çš„ä¸¢å¤±ã€‚ åœºæ™¯ä¸€ï¼šåˆ è¡¨è¿˜åŸï¼ˆå…¨å¤‡ + å¢å¤‡è¿˜åŸï¼‰\rä½¿ç”¨å…¨å¤‡ + å¢å¤‡ï¼Œé€šè¿‡æœ€æ–°çš„å¢å¤‡æ–‡ä»¶è¿›è¡Œè¿˜åŸ å¤‡ä»½\rå› ä¸ºæˆ‘çš„æµ‹è¯•åº“å·²ç»æœ‰ä¸€ä¸ª TEST ç”¨æˆ·å¹¶ä¸”å…·æœ‰ DBA æƒé™ï¼Œæ‰€ä»¥æ­¤å¤„ç›´æ¥å¼€å§‹é€ æ•°æ®ï¼Œçœç•¥äº†å»ºç«‹è¡¨ç©ºé—´ã€ç”¨æˆ·ã€æˆæƒçš„å‰ç½®æ­¥éª¤ã€‚\nåœ¨æ•°æ®åº“ä¸­æ’å…¥æµ‹è¯•æ•°æ®\r1 2 3 4 5 6 7 8 9 10 CREATE TABLE TEST.T_BAKUP_TEST( ID INT, BUSI_DATE DATE, DESCRIPTION VARCHAR2(200) ); INSERT INTO TEST.T_BAKUP_TEST VALUES(1, SYSDATE(), \u0026#39;è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œç”¨äºå¤‡ä»½è¿˜åŸçš„éªŒè¯\u0026#39;); INSERT INTO TEST.T_BAKUP_TEST VALUES(2, SYSDATE(), \u0026#39;aoedtl\u0026#39;); SELECT * FROM TEST.T_BAKUP_TEST; æ•°æ®å¦‚ä¸‹ï¼š\n1 2 1\t2024-09-11 15:07:55\tè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œç”¨äºå¤‡ä»½è¿˜åŸçš„éªŒè¯ 2\t2024-09-11 15:08:44\taoedtl å½“ç„¶ä¹Ÿæœ‰å…¶ä»–çš„æµ‹è¯•è¡¨ã€æ•°æ®ã€SPã€è¡¨ç©ºé—´ã€ç”¨æˆ·ç­‰ï¼Œé¡ºä¾¿å‡†å¤‡å°±è¡Œã€‚\næ‰§è¡Œå…¨å¤‡\r1 BACKUP DATABASE FULL TO DB_DM_FULL_20240911_154700 BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak\u0026#39; COMPRESSED LEVEL 5 ; è¿™ä¸ªä¸ºå•¥å¤‡ä»½äº†ï¼Œåå­—æ²¡æœ‰æŒ‰ç…§å‘½ä»¤è®¾ç½®ï¼Ÿ\n1 2 3 4 5 [root@status bak]# ll total 369736 -rw-r--r-- 1 dmdba dm 11264 Sep 11 16:01 bak_1.bak -rw-r--r-- 1 dmdba dm 378478080 Sep 11 16:01 bak.bak -rw-r--r-- 1 dmdba dm 116224 Sep 11 16:01 bak.meta å¾—è¿™æ ·ï¼š\n1 BACKUP DATABASE FULL TO \u0026#34;DB_DM_FULL_20240911_1618\u0026#34; BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240911_1618\u0026#39; COMPRESSED LEVEL 1; æ‰§è¡Œå¢å¤‡\rç¬¬ä¸€æ¬¡å¢å¤‡\rå¾€æ•°æ®åº“é‡Œæ·»åŠ ç‚¹æ–°æ•°æ®\n1 2 INSERT INTO TEST.T_BAKUP_TEST VALUES(3, SYSDATE(), \u0026#39;ç¬¬2æ¡\u0026#39;); INSERT INTO TEST.T_BAKUP_TEST VALUES(4, SYSDATE(), \u0026#39;ç¬¬3æ¡\u0026#39;); ç„¶åæ‰§è¡Œå¢å¤‡\n1 BACKUP DATABASE INCREMENT TO \u0026#34;DB_DM_INCREMENT_20240911_1623\u0026#34; BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1623\u0026#39; COMPRESSED LEVEL 1; ç¬¬äºŒæ¬¡å¢å¤‡\r1 2 3 4 INSERT INTO TEST.T_BAKUP_TEST VALUES(5, SYSDATE(), \u0026#39;ç¬¬4æ¡\u0026#39;); INSERT INTO TEST.T_BAKUP_TEST VALUES(6, SYSDATE(), \u0026#39;ç¬¬5æ¡\u0026#39;); BACKUP DATABASE INCREMENT TO \u0026#34;DB_DM_INCREMENT_20240911_1625\u0026#34; BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39; COMPRESSED LEVEL 1; æŸ¥çœ‹å¤‡ä»½é›†\råˆ°æœåŠ¡å™¨é‡Œçœ‹çœ‹ï¼Œå¤‡ä»½é›†\n1 2 3 4 5 [root@status bak]# ll total 12 drwxr-xr-x 2 dmdba dm 4096 Sep 11 16:19 DB_DM_FULL_20240911_1618 drwxr-xr-x 2 dmdba dm 4096 Sep 11 16:24 DB_DM_INCREMENT_20240911_1623 drwxr-xr-x 2 dmdba dm 4096 Sep 11 16:25 DB_DM_INCREMENT_20240911_1625 è¿˜åŸ\rå…¨å¤‡ + å¢å¤‡åè¿˜åŸï¼Œçœ‹çœ‹è¡¨æ•°æ®æ˜¯å¦æ¢å¤æ­£å¸¸\nåˆ é™¤è¡¨\rä¸Šè¾¹å·²ç»å¤‡ä»½å®Œæˆäº†ï¼Œç›´æ¥æŠŠä¸Šè¾¹åˆ›å»ºçš„è¡¨åˆ äº†ï¼Œç„¶åè¿›è¡Œè¿˜åŸæ“ä½œï¼Œçœ‹çœ‹æ˜¯å¦æ¢å¤ã€‚\n1 DROP TABLE TEST.T_BAKUP_TEST; è¿˜åŸæ“ä½œ\r1ï¼‰å…³é—­æ•°æ®åº“æœåŠ¡\n1 2 3 [root@status bak]# cd /home/dmdba/dmdbms/bin [root@status bin]# ./DmServiceDASERVER stop Stopping DmServiceDASERVER: [ OK ] 2ï¼‰å¯åŠ¨ ./dmrman æœåŠ¡è¿›è¡Œæ ¡éªŒå¤‡ä»½é›†\n1 2 3 4 5 6 7 8 9 [root@status bin]# ./dmrman dmrman V8 # æ ¡éªŒæœ€æ–°çš„å¢é‡å¤‡ä»½é›† RMAN\u0026gt; CHECK BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; CHECK BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; [Percent:100.00%][Speed:0.00M/s][Cost:00:00:00][Remaining:00:00:00] check backupset successfully. time used: 166.999(ms) 3ï¼‰è¿˜åŸ\n1 2 3 4 5 6 7 8 9 RMAN\u0026gt; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL [Percent:0.00%][Speed:0.00M/s][Cost:00:00:03][Remaining:00:00:00] [-8024]:æ•°æ®æ–‡ä»¶è¯»å†™å‡ºé”™ è¿™é‡Œè¿˜åŸæ—¶ï¼ŒæŠ¥é”™äº† [-8024]\næŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼šå¤‡ä»½è¿˜åŸ | è¾¾æ¢¦æŠ€æœ¯æ–‡æ¡£ (dameng.com)\nå› ä¸ºç”¨æˆ·å¿˜äº†åˆ‡æ¢ï¼Œä½¿ç”¨äº† root ç”¨æˆ·è¿›è¡Œæ“ä½œã€‚éœ€è¦ä½¿ç”¨ dmdba ç”¨æˆ·è¿›è¡Œæ“ä½œæ‰è¡Œï¼Œä¹Ÿè¦æ³¨æ„å¤‡ä»½çš„æ–‡ä»¶ dmdba ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¯»å†™ã€‚\nåˆ‡æ¢dmdba é‡æ–°æ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 RMAN\u0026gt; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; file dm.key not found, use default license! os_file_open_low_real error! desc: Permission denied, path: /home/dmdba/data/DAMENG/SYSTEM.DBF, code: 13 os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165939_295566.ctl\u0026#39;, code: 13, desc: Permission denied os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165845_735048.ctl\u0026#39;, code: 13, desc: Permission denied os_file_open_low_real error! desc: Permission denied, path: /home/dmdba/data/DAMENG/DAMENG01.log, code: 13 os_file_open_low_real error! desc: Permission denied, path: /home/dmdba/data/DAMENG/DAMENG02.log, code: 13 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL [Percent:100.00%][Speed:0.00M/s][Cost:00:00:19][Remaining:00:00:00]os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165939_295566.ctl\u0026#39;, code: 13, desc: Permission denied os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165845_735048.ctl\u0026#39;, code: 13, desc: Permission denied [Percent:100.00%][Speed:0.00M/s][Cost:00:00:19][Remaining:00:00:00] restore successfully. time used: 00:00:19.990 error æŠ¥é”™éƒ½æ˜¯ Permission denied ï¼ŒæŒ¨ä¸ªçœ‹çœ‹ç›®å½•ã€æ–‡ä»¶çš„ç”¨æˆ·ä¸»ç»„æ˜¯å¦éƒ½æ˜¯ dmdba\nå…ˆä¸ç®¡ï¼Œå¾€ä¸‹æ‰§è¡Œçœ‹çœ‹æœ€åèƒ½ä¸èƒ½æˆåŠŸï¼Ÿ\nä¹Ÿèƒ½æˆåŠŸï¼Œä½¿ç”¨ dmdba ç”¨æˆ·æ‰§è¡Œçš„è¯ï¼Œæ˜¯ä¸ä¼šæœ‰æƒé™æ‹’ç»çš„æƒ…å†µçš„\næ¢å¤æ“ä½œ\ræ®åº“æ¢å¤æ˜¯æŒ‡é‡åš REDO æ—¥å¿—ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šä»å¤‡ä»½é›†æ¢å¤ï¼Œå³é‡åšå¤‡ä»½é›†ä¸­çš„ REDO æ—¥å¿—ï¼›æˆ–ä»å½’æ¡£æ¢å¤ï¼Œå³é‡åšå½’æ¡£ä¸­çš„ REDO æ—¥å¿—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 RMAN\u0026gt; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_INCREMENT_20240911_1625\u0026#39;; Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[3756051], file_lsn[3756051] [Percent:100.00%][Speed:0.00PKG/s][Cost:00:00:00][Remaining:00:00:00] recover successfully! time used: 00:00:02.726 æ¢å¤æˆåŠŸ\næ›´æ–°æ“ä½œ\ræ•°æ®åº“æ›´æ–°æ˜¯æŒ‡æ›´æ–°æ•°æ®åº“çš„ DB_MAGICï¼Œå¹¶å°†æ•°æ®åº“è°ƒæ•´ä¸ºå¯æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œä¸æ•°æ®åº“æ¢å¤ä¸€æ ·ä½¿ç”¨ RECOVER å‘½ä»¤å®Œæˆã€‚æ•°æ®åº“æ›´æ–°å‘ç”Ÿåœ¨é‡åš REDO æ—¥å¿—æ¢å¤æ•°æ®åº“åã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 RMAN\u0026gt; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; UPDATE DB_MAGIC; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; UPDATE DB_MAGIC; Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[3756064], file_lsn[3756064] os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165939_295566.ctl\u0026#39;, code: 13, desc: Permission denied os_file_open_normal_rw error! path: \u0026#39;/home/dmdba/data/DAMENG/ctl_bak/dm_20240911165845_735048.ctl\u0026#39;, code: 13, desc: Permission denied recover successfully! time used: 00:00:01.182 è¿™ä¸ª DB_MAGIC å°±æ˜¯é­”æ•°ï¼Œé­”æ•°ï¼Œå°±æ˜¯æ¯ä¸ªæ•°æ®æ–‡ä»¶ã€REDO \\ UNRO æ—¥å¿—å¼€å¤´çš„ä¸€ä¸ªæ ‡è¯†\né‡å¯æ•°æ®åº“éªŒè¯è¿˜åŸæƒ…å†µ\ræ‰§è¡Œæ›´æ–°æ“ä½œåï¼Œæ•°æ®åº“å°±ç®—è¿˜åŸæˆåŠŸäº†ã€‚è¿™ä¸ªæ—¶å€™å¯åŠ¨æ•°æ®åº“å®ä¾‹ï¼Œè¿›å»çœ‹çœ‹æœ‰æ²¡æœ‰è¿˜åŸã€2.1.1ã€‘æ­¥éª¤ä¸­åˆ é™¤çš„è¡¨ã€‚\n1 2 SELECT * FROM SYS.ALL_OBJECTS A WHERE A.OWNER = \u0026#39;TEST\u0026#39; AND A.OBJECT_NAME = \u0026#39;T_BAKUP_TEST\u0026#39;; SELECT * FROM TEST.T_BAKUP_TEST; éƒ½æ­£å¸¸\nåœºæ™¯äºŒï¼šåˆ è¡¨ç©ºé—´ä¸ç”¨æˆ·\ræ–°å»ºè¡¨ç©ºé—´ä¸ç”¨æˆ·ï¼Œå¹¶åœ¨é‡Œè¾¹æ·»åŠ ç‚¹æ•°æ®ï¼Œç„¶åè¿›è¡Œå…¨é‡å¤‡ä»½ï¼Œä½¿ç”¨å…¨é‡å¤‡ä»½é›†è¿˜åŸã€‚ ç”¨ SYSDBA å°† TEST BAKUSER éƒ½åˆ æ‰ï¼Œç„¶åæ¢å¤ã€‚å…·ä½“ï¼šåˆ é™¤ TEST ç”¨æˆ·ï¼Œåˆ é™¤ BAKUSER ç”¨æˆ·ä¸å¯¹åº”è¡¨ç©ºé—´ã€‚ éªŒè¯è¡¨ç©ºé—´ã€ç”¨æˆ·ã€æƒé™æ˜¯å¦éƒ½æ¢å¤ã€‚ å‡†å¤‡å·¥ä½œ\ræ–°å»ºè¡¨ç©ºé—´ã€ç”¨æˆ·ã€æˆæƒ\rä½¿ç”¨ SYSDBA åˆ›å»ºæµ‹è¯•çš„è¡¨ç©ºé—´ã€ç”¨æˆ·ï¼Œå¹¶ç»™ 4 ä¸ªæƒé™\n1 2 3 4 5 6 7 8 -- åˆ›å»ºè¡¨ç©ºé—´ CREATE TABLESPACE \u0026#34;TS_BACKUP_TEST\u0026#34; DATAFILE \u0026#39;/home/dmdba/data/DAMENG/TS_BACKUP_TEST.DBF\u0026#39; SIZE 128 AUTOEXTEND ON NEXT 40 MAXSIZE 1024; -- åˆ›å»ºç”¨æˆ· CREATE USER BAKUSER IDENTIFIED BY \u0026#34;test123456\u0026#34; DEFAULT TABLESPACE TS_BACKUP_TEST; GRANT CREATE SESSION TO BAKUSER; GRANT CREATE TABLE TO BAKUSER; GRANT INSERT ANY TABLE TO BAKUSER; GRANT INSERT TABLE TO BAKUSER; æŸ¥çœ‹å®ƒçš„æƒé™\n1 2 3 4 5 6 SELECT * FROM DBA_SYS_PRIVS A WHERE A.GRANTEE = \u0026#39;BAKUSER\u0026#39;; ----------------------------- BAKUSER\tCREATE TABLE\tNO BAKUSER\tINSERT TABLE\tNO BAKUSER\tINSERT ANY TABLE\tNO BAKUSER\tCREATE SESSION\tNO æ·»åŠ æµ‹è¯•æ•°æ®\rä½¿ç”¨åˆ›å»ºå¥½çš„ç”¨æˆ· BAKUSER é€ ç‚¹æ•°æ®\n1 2 3 4 5 6 CREATE TABLE BAKUSER.T_TEST( ID INT, MARK VARCHAR2(200) ); INSERT INTO BAKUSER.T_TEST VALUES (1, \u0026#39;ç”¨æ¥éªŒè¯è¿˜åŸæ“ä½œçš„æ•°æ®\u0026#39;); å¤‡ä»½\rç›´æ¥å…¨å¤‡ï¼Œä¸ç”¨å¢å¤‡äº†\n1 BACKUP DATABASE FULL TO \u0026#34;DB_DM_FULL_20240912_093400\u0026#34; BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39; COMPRESSED LEVEL 1; è¿˜åŸ\råˆ é™¤è¡¨ç©ºé—´ã€ç”¨æˆ·\råˆ é™¤ TEST ç”¨æˆ· åˆ é™¤ BAKUSER ç”¨æˆ·ã€åˆ é™¤å®ƒçš„è¡¨ç©ºé—´ 1 2 3 4 -- ä½¿ç”¨çº§è”åˆ é™¤ DROP USER BAKUSER CASCADE; DROP TABLESPACE TS_BACKUP_TEST; DROP USER TEST CASCADE; è¿˜åŸæ“ä½œ\r1ï¼‰å…³é—­æ•°æ®åº“\n1 2 3 [dmdba@status /]$ cd /home/dmdba/dmdbms/bin [dmdba@status bin]$ ./DmServiceDASERVER stop Stopping DmServiceDASERVER: [ OK ] 2ï¼‰æ£€éªŒå¤‡ä»½é›†\n1 2 3 4 5 6 7 [dmdba@status bin]$ ./dmrman dmrman V8 RMAN\u0026gt; CHECK BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; CHECK BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; [Percent:100.00%][Speed:0.00M/s][Cost:00:00:01][Remaining:00:00:00] check backupset successfully. time used: 00:00:01.752 3ï¼‰è¿˜åŸæ“ä½œ\n1 2 3 4 5 6 7 8 9 10 11 RMAN\u0026gt; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; RESTORE DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; file dm.key not found, use default license! Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL [Percent:100.00%][Speed:0.00M/s][Cost:00:00:18][Remaining:00:00:00] restore successfully. time used: 00:00:18.930 æ¢å¤æ“ä½œ\r1 2 3 4 5 6 7 8 9 10 11 12 RMAN\u0026gt; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/data/DAMENG/bak/DB_DM_FULL_20240912_093400\u0026#39;; Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[3756229], file_lsn[3756229] [Percent:100.00%][Speed:0.00PKG/s][Cost:00:00:00][Remaining:00:00:00] recover successfully! time used: 00:00:02.774 æ›´æ–°æ“ä½œ\r1 2 3 4 5 6 7 8 9 10 11 RMAN\u0026gt; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; UPDATE DB_MAGIC; RECOVER DATABASE \u0026#39;/home/dmdba/data/DAMENG/dm.ini\u0026#39; UPDATE DB_MAGIC; Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[3756333], file_lsn[3756333] recover successfully! time used: 00:00:01.182 é‡å¯æ•°æ®åº“éªŒè¯è¿˜åŸæƒ…å†µ\r1 2 [dmdba@status bin]$ ./DmServiceDASERVER start Starting DmServiceDASERVER: [ OK ] 1 2 3 4 5 6 7 8 9 -- æŸ¥çœ‹ç”¨æˆ· SELECT * FROM SYS.ALL_USERS; --------------------------------------------------- SYS\t50331648\t2024-06-24 16:33:25.403980 SYSDBA\t50331649\t2024-06-24 16:33:25.403980 SYSAUDITOR\t50331650\t2024-06-24 16:33:25.403980 SYSSSO\t50331651\t2024-06-24 16:33:25.403980 TEST\t50331748\t2024-06-24 17:02:49.225244 BAKUSER\t50331749\t2024-09-12 09:04:08.170548 1 2 3 4 5 6 7 8 9 -- æŸ¥çœ‹è¡¨ç©ºé—´ SELECT * FROM V$TABLESPACE; --------------------------------------------------- 0\tSYSTEM\t1\t0\t0\t9472\t1\t3008\t0\t0\t64\t404\t1 1\tROLL\t1\t0\t0\t16384\t1\t336\t0\t0\t64\t1003\t38 3\tTEMP\t2\t0\t0\t1280\t1\t48\t0\t0\t64\t77\t34 4\tMAIN\t1\t0\t0\t16384\t1\t256\t0\t0\t64\t1008\t1 5\tTS_TEST\t1\t0\t0\t197120\t1\t195904\t0\t0\t64\t76\t1 6\tTS_BACKUP_TEST\t1\t0\t0\t16384\t1\t32\t0\t0\t64\t1022\t1 1 2 3 4 5 6 7 -- æŸ¥çœ‹ç”¨æˆ·æƒé™ SELECT * FROM DBA_SYS_PRIVS A WHERE A.GRANTEE = \u0026#39;BAKUSER\u0026#39;; --------------------------------------------------- BAKUSER\tCREATE TABLE\tNO BAKUSER\tINSERT TABLE\tNO BAKUSER\tINSERT ANY TABLE\tNO BAKUSER\tCREATE SESSION\tNO 1 2 3 4 -- æŸ¥çœ‹æµ‹è¯•è¡¨æ•°æ® SELECT * FROM BAKUSER.T_TEST; --------------------------------------------------- 1\tç”¨æ¥éªŒè¯è¿˜åŸæ“ä½œçš„æ•°æ® éƒ½è¿˜åŸæˆåŠŸäº†ã€‚\nå®é™…é¡¹ç›®çš„å¤‡ä»½æ–¹æ¡ˆ\ræ¯å‘¨å…­å…¨é‡å¤‡ä»½ + æ¯å¤©æ™šä¸Š 9 ç‚¹è¿›è¡Œå¢é‡å¤‡ä»½ï¼ˆå®šæ—¶å¤‡ä»½ï¼‰ ä¿ç•™ä¸¤å‘¨çš„å¤‡ä»½æ–‡ä»¶ï¼Œå®šæœŸåˆ é™¤ä¸¤å‘¨ä»¥å‰çš„å¤‡ä»½æ–‡ä»¶ï¼ˆå®šæœŸåˆ é™¤ï¼‰ ç®¡ç†å·¥å…·å¤‡ä»½\rç®¡ç†æ§åˆ¶å°å…¨é‡å¤‡ä»½\rè¿›å…¥è¾¾æ¢¦ç®¡ç†å·¥å…· - å³é”®ä»£ç† - æ–°å»ºä»£ç†ç¯å¢ƒ - ä½œä¸š - æ–°å»ºä½œä¸š\n1ï¼‰å¡«å†™ä½œä¸šå\n2ï¼‰è®¾ç½®æ­¥éª¤åç§°ã€å¤‡ä»½è·¯å¾„ã€å¤‡ä»½æ–¹å¼ã€å‹ç¼©çº§åˆ«\nå¤‡ä»½è·¯å¾„ï¼šå¡«å†™æ•°æ®åº“æœåŠ¡å™¨çš„è·¯å¾„ 3ï¼‰è®¾ç½®é¢‘ç‡ã€æŒç»­å®è·µ\nå…¨é‡ä¸ºæ¯å‘¨å…­ï¼Œä¸­åˆ12ç‚¹ï¼ˆå¯ä»¥è‡ªå·±å®šï¼‰ å¢é‡å¯ä»¥æ¯å¤©æ™šä¸Š9ç‚¹ 4ï¼‰æ‰§è¡Œåï¼Œåœ¨æœåŠ¡é‡Œå¯ä»¥çœ‹åˆ°å·²ç»å¤‡ä»½äº†\n1 2 3 4 5 6 7 8 9 10 11 [root@YD-FXQDB01-3-161 bak]# pwd /u01/amop/AMOP/bak [root@YD-FXQDB01-3-161 bak]# ll æ€»ç”¨é‡ 0 drwxr-xr-x 2 dmdba dinstall 141 9æœˆ 12 11:21 DB_AMOP_FULL_2024_09_12_11_21_56 [root@YD-FXQDB01-3-161 bak]# cd DB_AMOP_FULL_2024_09_12_11_21_56/ [root@YD-FXQDB01-3-161 DB_AMOP_FULL_2024_09_12_11_21_56]# ll æ€»ç”¨é‡ 14004 -rw-r--r-- 1 dmdba dinstall 1312768 9æœˆ 12 11:21 DB_AMOP_FULL_2024_09_12_11_21_56_1.bak -rw-r--r-- 1 dmdba dinstall 12913152 9æœˆ 12 11:21 DB_AMOP_FULL_2024_09_12_11_21_56.bak -rw-r--r-- 1 dmdba dinstall 108032 9æœˆ 12 11:21 DB_AMOP_FULL_2024_09_12_11_21_56.meta å…¨é‡å¤‡ä»½çš„åç§°æ˜¯ DB_å®ä¾‹å_FULL_æ—¥æœŸ ç®¡ç†æ§åˆ¶å°å¢é‡å¤‡ä»½\ræ­¥éª¤éƒ½å·®ä¸å¤šï¼ŒåŒºåˆ«å°±æ˜¯å¢é‡å¤‡ä»½éœ€è¦åŸºäºä¸€ä¸ªå…¨é‡å¤‡ä»½é›†ã€‚\nSQL å¤‡ä»½\rSQL å…¨é‡å¤‡ä»½\r1 2 3 4 5 6 7 8 9 10 11 call SP_CREATE_JOB(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;,1,0,\u0026#39;\u0026#39;,0,0,\u0026#39;\u0026#39;,0,\u0026#39;æ¯å‘¨å…­å®šæ—¶å…¨é‡å¤‡ä»½æ•°æ®åº“\u0026#39;); call SP_JOB_CONFIG_START(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;); call SP_ADD_JOB_STEP(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;, \u0026#39;DB_DM_FULL_BACKUP\u0026#39;, 6, \u0026#39;01000000/u01/amop/AMOP/bak\u0026#39;, 0, 0, 0, 0, NULL, 0); call SP_ADD_JOB_SCHEDULE(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;, \u0026#39;DB_DM_FULL_BACKUP\u0026#39;, 1, 2, 1, 64, 0, \u0026#39;12:00:00\u0026#39;, NULL, \u0026#39;2024-09-12 11:15:41\u0026#39;, NULL, \u0026#39;\u0026#39;); call SP_JOB_CONFIG_COMMIT(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;); call SP_JOB_SET_SCHEMA(\u0026#39;å…¨é‡å¤‡ä»½_å‘¨å…­\u0026#39;, \u0026#39;SYSDBA\u0026#39;); SP è¯¦è§£\rSP_CREATE_JOB\r1 2 3 4 5 6 7 8 9 10 11 SP_CREATE_JOB( JOB_NAME,\t-- ä½œä¸šåç§° ENABLED,\t-- ä½œä¸šæ˜¯å¦å¯ç”¨ 1-å¯ç”¨ï¼Œ0-ä¸å¯ç”¨ ENABLE_EMAIL,\t-- æ˜¯å¦å¼€å¯é‚®ä»¶ç³»ç»Ÿ 1-å¯ç”¨ï¼Œ0-ä¸å¯ç”¨ EMAIL_OPTR_NAME,\t-- æ“ä½œå‘˜åç§°ï¼Œæ²¡æœ‰ä¸º \u0026#39;\u0026#39; ç©º EMAIL_TYPE,\t-- ä»€ä¹ˆæƒ…å†µä¸‹å‘é‚®ä»¶ 0-æˆåŠŸåå‘ 1-å¤±è´¥å‘ 2-ç»“æŸå°±å‘ ENABLED_ENTSEND,\t-- æ˜¯å¦å¼€å¯ç½‘ç»œä½œä¸š 1-å¼€ 0-ä¸å¼€ NETSEND_OPTR_NAME,\t-- æ“ä½œå‘˜ï¼Œæ²¡æœ‰ä¸º \u0026#39;\u0026#39; ç©º ENTSEND_TYPE,\t-- ä»€ä¹ˆæƒ…å†µä¸‹å‘æ¶ˆæ¯ï¼Œ0-æˆåŠŸå‘ 1-å¤±è´¥å‘ 2-ç»“æŸå°±å‘ DESCRIBE\t-- ä½œä¸šæè¿°ï¼Œå¯ä»¥ä¸º \u0026#39;\u0026#39; ç©º ) SP_JOB_CONFIG_START\r1 2 3 SP_JOB_CONFIG_START( JOB_NAME\t-- å¼€å§‹é…ç½®æŸä¸ªä½œä¸šï¼Œä¼ ä½œä¸šåç§° ) é¢ï¼Œå…·ä½“è¯¦è§ã€ŠDM8ä½œä¸šç³»ç»Ÿä½¿ç”¨æ‰‹å†Œ.pdfã€‹ï¼Œä¸å†çœ‹äº†ï¼Œç”¨è¾¾æ¢¦ç®¡ç†å·¥å…·å°±è¡Œäº†ã€‚\nSQL å¢é‡å¤‡ä»½\r1 2 3 4 5 6 7 8 9 10 11 call SP_CREATE_JOB(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;,1,0,\u0026#39;\u0026#39;,0,0,\u0026#39;\u0026#39;,0,\u0026#39;\u0026#39;); call SP_JOB_CONFIG_START(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;); call SP_ADD_JOB_STEP(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;, \u0026#39;DayBackup\u0026#39;, 6, \u0026#39;11000000/u01/amop/AMOP/bak/|/u01/amop/AMOP/bak\u0026#39;, 0, 0, 0, 0, NULL, 0); call SP_ADD_JOB_SCHEDULE(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;, \u0026#39;DayBackup\u0026#39;, 1, 1, 1, 0, 0, \u0026#39;21:00:00\u0026#39;, NULL, \u0026#39;2024-09-12 13:09:05\u0026#39;, NULL, \u0026#39;\u0026#39;); call SP_JOB_CONFIG_COMMIT(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;); call SP_JOB_SET_SCHEMA(\u0026#39;å¢é‡å¤‡ä»½_æ¯æ—¥\u0026#39;, \u0026#39;SYSDBA\u0026#39;); å®šæœŸåˆ é™¤æ—§å¤‡ä»½æ–‡ä»¶\råˆ é™¤æ—§å¤‡ä»½ï¼Œç¡®ä¿ä¸ä¼šæŠŠæ‰€æœ‰çš„å¤‡ä»½éƒ½åˆ é™¤ï¼Œè¦ç¡®ä¿ä¸€ä¸ªæœ€æ–°çš„å¢é‡å¤‡ä»½ä»¥åŠå®ƒçš„åŸºå¤‡ä»½å­˜åœ¨ï¼ˆåæ­£å°±æ˜¯ç•™ç€æœ€æ–°çš„å…¨é‡ + å¢é‡å¤‡ä»½é›†ï¼‰\nåŠ ä¸€ä¸ªåˆ é™¤å¤‡ä»½çš„ä½œä¸šæ­¥éª¤ åœ¨ä¸Šä¸€ä¸ªä½œä¸šæ­¥éª¤è®¾ç½®ï¼Œæ‰§è¡ŒæˆåŠŸåç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ï¼šåˆ é™¤å¤‡ä»½çš„ä½œä¸š åˆ é™¤å¤‡ä»½çš„SPå¦‚ä¸‹ï¼š\n1 2 3 4 -- æ·»åŠ å¤‡ä»½ç›®å½• SF_BAKSET_BACKUP_DIR_ADD(\u0026#39;DISK\u0026#39;,\u0026#39;/u01/amop/AMOP/bak\u0026#39;); -- åˆ  30 å¤©å‰çš„å¤‡ä»½æ–‡ä»¶ CALL SP_DB_BAKSET_REMOVE_BATCH(\u0026#39;DISK\u0026#39;,SYSDATE-30); æ€»ç»“\rè¿˜åŸå°±æ˜¯ä½¿ç”¨ å…¨é‡ + å¢é‡ å¤‡ä»½é›†è¿›è¡Œè¿˜åŸ è¿˜åŸæ“ä½œ RESTORE DATABASE åï¼Œæ•°æ®åº“è¿˜ä¸èƒ½æ“ä½œï¼Œéœ€è¦ä½¿ç”¨ RECOVER æ¢å¤æ•°æ®åº“å·¥ä½œï¼Œæœ€åæ›´æ–°æ•°æ®åº“çš„ DB_MAGIC é­”æ•° å®é™…é¡¹ç›®ä¸Šçš„æ–¹æ¡ˆï¼šæ¯å‘¨å…¨é‡ + æ¯å¤©å¢é‡ + ä¿ç•™ 14 å¤©å¤‡ä»½é›† ","date":"2024-08-28T13:56:41+08:00","permalink":"http://localhost:1313/posts/2024/08/%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%AE%9E%E8%B7%B5%E5%9B%9B/","title":"ä¸»å¤‡é›†ç¾¤ è¾¾æ¢¦æ•°æ®åº“å¤‡ä»½è¿˜åŸå®è·µï¼ˆå››ï¼‰"},{"content":"é—®é¢˜\rç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰äº›é¡¹ç›®çš„ç”¨æˆ·æ˜¯ä¸ç»™ DBA æƒé™çš„ï¼Œå¯¼è‡´äº†æ‰§è¡Œäº†è¿™ä¸ªSQLï¼Œä½†æ˜¯è€—æ—¶å¾ˆä¹…å½¢æˆé˜»å¡ï¼Œæƒ³ KILL å®ƒï¼Œæ€ä¹ˆåŠï¼Ÿ\næ€è·¯\r1.ä½¿ç”¨ DBA ç”¨æˆ·åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼Œé‡Œè¾¹å†™ KILL æ‰è‡ªå·±ä¼šè¯çš„ä»£ç \nå†™æ³•ä¸€\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 CREATE OR REPLACE PROCEDURE DBAUSER.CLOSE_USER_SESSION(SESSION_ID BIGINT) AS CURR_NAME VARCHAR(32); SESS_NAME VARCHAR(32); BEGIN --æ ¡éªŒç”¨æˆ·ï¼Œåªèƒ½æ€è‡ªå·±æ‰§è¡Œçš„ SELECT USER INTO CURR_NAME; SELECT USER_NAME INTO SESS_NAME FROM V$SESSIONS WHERE SESS_ID=SESSION_ID; IF CURR_NAME = SESS_NAME THEN SP_CLOSE_SESSION(SESSION_ID); ELSE PRINT \u0026#39; \u0026#39;; PRINT \u0026#39;æ‰§è¡Œå¤±è´¥,åªèƒ½å…³é—­å½“å‰ç”¨æˆ·è¿æ¥çš„ä¼šè¯!!!\u0026#39; ; END IF; EXCEPTION WHEN NO_DATA_FOUND THEN PRINT \u0026#39; \u0026#39;; PRINT \u0026#39;æ‰§è¡Œå¤±è´¥,æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯ !!!\u0026#39;; WHEN OTHERS THEN PRINT \u0026#39; \u0026#39;; PRINT SQLCODE||\u0026#39; \u0026#39;||SQLERRM; END; å†™æ³•äºŒ\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 CREATE OR REPLACE PROCEDURE CLOSE_USER_SESSION( SESSION_ID IN BIGINT, O_RETURN_MSG OUT VARCHAR2, O_RETURN_CODE OUT INTEGER ) IS --========================================================================= -- AUTHOR: WQ -- CREATE_DATE: 20240719 -- VERSION: 1.0 -- MARK: æ™®é€šç”¨æˆ· KILL ä¼šè¯çš„æ–¹å¼ --========================================================================= --========================================================================= -- ä¸šåŠ¡å˜é‡ CURR_NAME VARCHAR(32); SESS_NAME VARCHAR(32); --========================================================================= BEGIN -- æ ¡éªŒç”¨æˆ·ï¼Œåªèƒ½æ€è‡ªå·±æ‰§è¡Œçš„ SELECT USER INTO CURR_NAME; SELECT USER_NAME INTO SESS_NAME FROM V$SESSIONS WHERE SESS_ID=SESSION_ID; -- å½“å‰ç”¨æˆ· = V$SESSIONé‡Œå½“å‰ä¼šè¯IDç”¨æˆ· IF CURR_NAME = SESS_NAME THEN -- å…³é—­ä¼šè¯ SP_CLOSE_SESSION(SESSION_ID); ELSE O_RETURN_CODE := \u0026#39; \u0026#39;; O_RETURN_MSG := \u0026#39;æ‰§è¡Œå¤±è´¥ï¼Œéå½“å‰ç”¨æˆ·çš„ä¼šè¯\u0026#39;; END IF; O_RETURN_CODE := \u0026#39;1\u0026#39;; O_RETURN_MSG := \u0026#39;æ‰§è¡ŒæˆåŠŸ\u0026#39;; EXCEPTION /* -- NO_DATA_FOUND æ˜¯è¾¾æ¢¦è‡ªå¸¦çš„é¢„å®šä¹‰å¼‚å¸¸ï¼Œä¸ºæè¿°æ•°æ®æœªæ‰¾åˆ° WHEN NO_DATA_FOUND THEN PRINT \u0026#39; \u0026#39;; PRINT \u0026#39;æ‰§è¡Œå¤±è´¥,æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯ !!!\u0026#39;; */ WHEN OTHERS THEN O_RETURN_CODE := SQLCODE; O_RETURN_MSG := SQLERRM; ROLLBACK; END; 2.æŠŠå­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œæƒé™æˆäºˆæ™®é€šç”¨æˆ·\n1 GRANT EXECUTE ON DBAUSER.CLOSE_USER_SESSION TO TESTUSER; 3.æ™®é€šç”¨æˆ·æŸ¥è¯¢éœ€è¦ KILL çš„ä¼šè¯ID å¹¶ æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹\n1 2 3 4 5 -- æŸ¥è¯¢ ä¼šè¯ ID SELECT * FROM SYS.V$SESSIONS A WHERE A.STATE = \u0026#39;ACTIVE\u0026#39;; -- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ CALL TEST.CLOSE_USER_SESSION(\u0026#39;140052047263656\u0026#39;,NULL,NULL); ","date":"2024-08-27T21:01:48+08:00","permalink":"http://localhost:1313/posts/2024/08/sp-%E6%97%A0dba%E6%9D%83%E9%99%90%E5%A6%82%E4%BD%95kill%E4%BC%9A%E8%AF%9D/sp-%E6%97%A0dba%E6%9D%83%E9%99%90%E5%A6%82%E4%BD%95kill%E4%BC%9A%E8%AF%9D/","title":"SP æ— DBAæƒé™å¦‚ä½•KILLä¼šè¯"},{"content":"èƒŒæ™¯\råœ¨å¯¹é¡¹ç›®è¿›è¡Œä¿¡åˆ›è¿ç§»ï¼Œä» ORALCE è¿ç§»åˆ°è¾¾æ¢¦æ•°æ®åº“ï¼Œä¸ºäº†æ›´å¥½çš„å¹³æ»‘è¿‡æ¸¡ï¼Œå¯¹è¾¾æ¢¦å®ä¾‹ dm.ini æ–‡ä»¶ä¸­ä¿®æ”¹ COMPATIBLE_MODE = 2å¼€å¯å…¼å®¹ ORACLE è¯­æ³•çš„æ¨¡å¼ã€‚ç„¶åä½¿ç”¨ DTS è¿›è¡Œè¿ç§»æ—¶ï¼Œä¼šå°† ORACLE ä¸­çš„ DATE DATETIME æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º TIMESTAMP ç±»å‹ã€‚ä¸”ç»è¿‡éªŒè¯ï¼Œåç»­çš„å»ºè¡¨ï¼Œå¦‚æœæ˜¯åŒ…å«äº† DATE DATETIME ç±»å‹ï¼Œåˆ›å»ºåä¹Ÿä¼šè¢«è½¬æ¢ä¸º TIMESTAMP ç±»å‹ã€‚\nè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœåœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨ DATEDIFF å‡½æ•°ï¼Œä¼šå‡ºç°æ•°æ®ç±»å‹ä¸å¯¹çš„æŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œç›¸åº”çš„æ”¹é€ ã€‚\næœ‰ä¸¤ä¸ªåŠæ³•ï¼š\n1ï¼‰å¯¹ç›¸åº”çš„å¤„ç†é€»è¾‘è¿›è¡Œæ‰‹åŠ¨ä¿®æ”¹ï¼ˆè§£å†³æ–¹æ³•ä¸€ï¼‰\n2ï¼‰åœ¨ DTS è¿ç§»æ—¶ï¼Œå¯¹ ORACLE - DM è¿›è¡Œæ•°æ®ç±»å‹æ˜ å°„ï¼ˆè§£å†³æ–¹æ³•äºŒï¼Œè¯¥æ–¹æ³•ç»å’¨è¯¢è¾¾æ¢¦æŠ€æœ¯æ–¹è·å–ï¼‰\nè§£å†³æ–¹æ³•ä¸€\råŸå…ˆå¯¹äº DATEæ•°æ®ç±»å‹ä½¿ç”¨ DATEDIFF è¿›è¡Œæ—¥æœŸç›¸å‡\nç°åœ¨ä½¿ç”¨ TRUNC å‡½æ•°å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºæ—¥æœŸï¼Œå†è¿›è¡Œæ—¥æœŸç›¸å‡\nTRUNCæ˜¯æˆªæ–­æ•°å­—ï¼Œä¹Ÿæœ‰æˆªæ–­æ—¥æœŸçš„ç”¨æ³•\næµ‹è¯•ç”¨ä¾‹\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 DROP TABLE IF EXISTS TEST.T_WEATHER; CREATE TABLE TEST.T_WEATHER( ID INT, RECORDDATE DATE, TEMPERATURE INT ); INSERT INTO TEST.T_WEATHER VALUES(1, \u0026#39;2024-08-10\u0026#39;, 37); INSERT INTO TEST.T_WEATHER VALUES(2, \u0026#39;2024-08-11\u0026#39;, 36); INSERT INTO TEST.T_WEATHER VALUES(3, \u0026#39;2024-08-12\u0026#39;, 38); INSERT INTO TEST.T_WEATHER VALUES(4, \u0026#39;2024-08-13\u0026#39;, 39); INSERT INTO TEST.T_WEATHER VALUES(5, \u0026#39;2024-08-14\u0026#39;, 37); INSERT INTO TEST.T_WEATHER VALUES(6, \u0026#39;2024-08-15\u0026#39;, 37); COMMIT; åŸå…ˆçš„å¤„ç†é€»è¾‘\r1 2 3 4 5 6 7 8 9 10 11 12 SELECT T.* FROM ( SELECT A.ID, A.RECORDDATE, A.TEMPERATURE, LEAD(A.RECORDDATE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS DD, LEAD(A.TEMPERATURE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS WD FROM TEST.T_WEATHER A ) T WHERE T.WD \u0026gt; T.TEMPERATURE AND DATEDIFF(T.DD, T.RECORDDATE) = 1 ; æŠ¥é”™\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [æ‰§è¡Œè¯­å¥1]: SELECT T.* FROM ( SELECT A.ID, A.RECORDDATE, A.TEMPERATURE, LEAD(A.RECORDDATE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS DD, LEAD(A.TEMPERATURE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS WD FROM TEST.T_WEATHER A ) T WHERE T.WD \u0026gt; T.TEMPERATURE AND DATEDIFF(T.DD, T.RECORDDATE) = 1 ; æ‰§è¡Œå¤±è´¥(è¯­å¥1) -2007: ç¬¬ 12 è¡Œ, ç¬¬ 26 åˆ—[T]é™„è¿‘å‡ºç°é”™è¯¯: è¯­æ³•åˆ†æå‡ºé”™ æ”¹é€ åçš„å¤„ç†é€»è¾‘\r1 2 3 4 5 6 7 8 9 10 11 12 SELECT T.* FROM ( SELECT A.ID, A.RECORDDATE, A.TEMPERATURE, LEAD(A.RECORDDATE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS DD, LEAD(A.TEMPERATURE, 1, NULL) OVER(ORDER BY A.RECORDDATE) AS WD FROM TEST.T_WEATHER A ) T WHERE T.WD \u0026gt; T.TEMPERATURE AND TRUNC(T.DD - 1) = TRUNC(T.RECORDDATE) ; æ­£å¸¸æ‰§è¡Œ\né™„ï¼šTRUNC ç”¨æ³•\ræˆªå–æ—¥æœŸ\r1 2 3 4 5 6 7 SELECT TRUNC(A.RECORDDATE, \u0026#39;YYYY\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“å¹´ç¬¬ä¸€å¤© SELECT TRUNC(A.RECORDDATE, \u0026#39;MM\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“æœˆç¬¬ä¸€å¤© SELECT TRUNC(A.RECORDDATE, \u0026#39;DD\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“å‰å¹´æœˆæ—¥ï¼Œç¼ºçœå€¼ DD SELECT TRUNC(A.RECORDDATE, \u0026#39;HH\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“å‰å°æ—¶ SELECT TRUNC(A.RECORDDATE, \u0026#39;MI\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“å‰æ—¶é—´ï¼Œæ²¡æœ‰ç§’ SELECT TRUNC(A.RECORDDATE, \u0026#39;D\u0026#39;) FROM TEST.T_WEATHER A; -- è¿”å›å½“å‰æ˜ŸæœŸçš„ç¬¬ä¸€å¤©ï¼ˆæ˜ŸæœŸå¤©ä¸ºç¬¬ä¸€å¤©ï¼‰ æ—¥æœŸè®¡ç®—\r1 2 3 4 -- åœ¨å½“å‰æ—¥æœŸçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€å¤©ï¼ˆå‡å°‘å°± - ï¼‰ SELECT TRUNC(A.RECORDDATE, \u0026#39;YYYY\u0026#39;) + 1 FROM TEST.T_WEATHER A; SELECT TRUNC(A.RECORDDATE, \u0026#39;MM\u0026#39;) + 1 FROM TEST.T_WEATHER A; SELECT TRUNC(A.RECORDDATE, \u0026#39;DD\u0026#39;) + 1 FROM TEST.T_WEATHER A; è§£å†³æ–¹æ³•äºŒ\råœ¨ DTS ä¸­ä½¿ç”¨æ•°æ®ç±»å‹æ˜ å°„ï¼Œæ­¤æ–¹æ³•ä¸ºè¿ç§»æ—¶ä½¿ç”¨ã€‚æˆ–è€…åœ¨ä½¿ç”¨ DTS å·¥å…·åˆ·å…¥ SQL è„šæœ¬æ—¶ä½¿ç”¨ã€‚\n","date":"2024-08-26T21:02:51+08:00","permalink":"http://localhost:1313/posts/2024/08/sql-%E8%BE%BE%E6%A2%A6date%E7%B1%BB%E5%9E%8B%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2%E4%B8%BAtimestamp%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","title":"SQL è¾¾æ¢¦DATEç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºTIMESTAMPç±»å‹çš„è§£å†³æ–¹æ³•"},{"content":"æ–°å¢å®ä¾‹ä¸æ•°æ®å®ˆæŠ¤ã€ç›‘è§†å™¨\rè¯´æ˜\råœ¨åŸå…ˆçš„ A ã€B æœºå™¨æ­å»ºå¥½çš„å®æ—¶ä¸»å¤‡é›†ç¾¤å·²æœ‰å®ä¾‹çš„åŸºç¡€ä¸Šï¼Œæ–°å¢ä¸€ä¸ªå®ä¾‹ï¼Œå³ä¸€ä¸ªé›†ç¾¤ï¼Œå¤šä¸ªå®ä¾‹çš„æ•ˆæœ\nå¹¶ä¸”ï¼Œä¸€å®šè¦äº‹å…ˆè§„åˆ’å¥½ç«¯å£é…ç½®ã€å®ä¾‹åã€è·¯å¾„ã€æ•°æ®å®ˆæŠ¤ç»„å\n1.è§„åˆ’çš„ç«¯å£æ˜¯å¦ä¸ç°æœ‰çš„å®ä¾‹ç«¯å£å†²çª\n2.ä¸»å¤‡æœºå™¨ç«¯å£ä¹‹é—´æ˜¯å¦æ‰“é€š\n3.å®ä¾‹è·¯å¾„ã€æ•°æ®å®ˆæŠ¤ç»„éƒ½è¦é…ç½®ç«¯å£çš„\néƒ¨ç½²ä¿¡æ¯\rAæœºå™¨ Bæœºå™¨ IP 192.168.163.9 192.168.163.10 å®ä¾‹å GRP_TEST_01 GRP_TEST_02 å®ä¾‹ç«¯å£ 5236 5236 å®ˆæŠ¤è¿›ç¨‹ç«¯å£ 5536 5536 MALç«¯å£ 5336 5336 å®ˆæŠ¤ç»„ GRP1 GPR1 å®‰è£…ç›®å½• /home/dmdba/dmdbms /home/dmdba/dmdbms å®ä¾‹ç›®å½• /home/dmdba/dmdbms/DMDB /home/dmdba/dmdbms/DMDB å½’æ¡£ä¸Šé™ 51200 51200 æ–°å¢å®ä¾‹è§„åˆ’\rAæœºå™¨ Bæœºå™¨ IP 192.168.163.9 192.168.163.10 å®ä¾‹å GRP_ADDTEST_01 GRP_ADDTEST_02 å®ä¾‹ç«¯å£ 5237 5237 å®ˆæŠ¤è¿›ç¨‹ç«¯å£ 5537 5537 MALç«¯å£ 5337 5337 å®ˆæŠ¤ç»„ GRP2 GPR2 å®ä¾‹ç›®å½• /home/dmdba/ADDTEST_data /home/dmdba/ADDTEST_data å½’æ¡£ä¸Šé™ 51200 51200 åˆå§‹åŒ–å®ä¾‹\ræœ¬æ¬¡æ–°å¢å¹¶æ²¡æœ‰åœæ­¢å·²æœ‰å®ä¾‹æœåŠ¡\næ³¨æ„ï¼š\né™¤éå¿…è¦è¯´æ˜ï¼Œé»˜è®¤ä½¿ç”¨ dmdba æ•°æ®åº“ç”¨æˆ·è¿›è¡Œæ“ä½œ é…ç½®è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨å¯¹äºçš„ç›®å½•ï¼Œç›®å½•åˆ«æ•´é”™äº† A æœºå™¨æ–°å¢å®ä¾‹\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [root@linux1 bin]# ./dminit path=/home/dmdba/ADDTEST_data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=y CHARSET=0 DB_NAME=ADDTEST INSTANCE_NAME=GRP_ADDTEST_01 PORT_NUM=5237 initdb V8 db version: 0x7000c file dm.key not found, use default license! License will expire on 2025-03-21 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL log file path: /home/dmdba/ADDTEST_data/ADDTEST/ADDTEST01.log log file path: /home/dmdba/ADDTEST_data/ADDTEST/ADDTEST02.log write to dir [/home/dmdba/ADDTEST_data/ADDTEST]. create dm database success. 2024-07-27 10:09:55 è¿™é‡Œæˆ‘å¿˜è®°äº†åˆ‡æ¢åˆ° dmdba ç”¨æˆ·ä¸‹äº†ï¼Œé—®é¢˜ä¸å¤§ï¼Œæˆ‘æ›´æ”¹å®ä¾‹ç›®å½•æƒé™ï¼Œå°†ç›®å½•æƒé™æ”¹æˆ dmdba\n1 2 cd /home/dmdba chown dmdba:dinstall -R ADDTEST_data/ B æœºå™¨æ–°å¢å®ä¾‹\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [root@linux2 bin]# su - dmdba ä¸Šä¸€æ¬¡ç™»å½•ï¼šä¸€ 7æœˆ 22 22:01:45 CST 2024pts/0 ä¸Š [dmdba@linux2 ~]$ cd /home/dmdba/dmdbms/bin [dmdba@linux2 bin]$ ./dminit path=/home/dmdba/ADDTEST_data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=y CHARSET=0 DB_NAME=ADDTEST INSTANCE_NAME=GRP_ADDTEST_01 PORT_NUM=5237 initdb V8 db version: 0x7000c file dm.key not found, use default license! License will expire on 2025-03-21 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL log file path: /home/dmdba/ADDTEST_data/ADDTEST/ADDTEST01.log log file path: /home/dmdba/ADDTEST_data/ADDTEST/ADDTEST02.log write to dir [/home/dmdba/ADDTEST_data/ADDTEST]. create dm database success. 2024-07-27 10:15:34 é…ç½® A æœºå™¨\rå¯åŠ¨æ–°å¢çš„å®ä¾‹æœåŠ¡\rå‰å°å‘½ä»¤å¯åŠ¨ï¼Œå¯åŠ¨åè¯¥çª—å£ä¸èƒ½åŠ¨ï¼Œéœ€è¦é‡æ–°å¼€ä¸€ä¸ªçª—å£\n1 2 [dmdba@linux1 ~]$ cd /home/dmdba/dmdbms/bin [dmdba@linux1 bin]$ ./dmserver /home/dmdba/ADDTEST_data/ADDTEST/dm.ini å¼€å¯å½’æ¡£\ræ³¨æ„ï¼š\nè¿™é‡Œä½¿ç”¨ @IP:PORT çš„å½¢å¼ï¼Œæ¥åŒºåˆ†è¿›å…¥å“ªä¸ªå®ä¾‹ å½’æ¡£è·¯å¾„åˆ«å¡«é”™äº†ï¼Œåœ¨æ–°å¢çš„å®ä¾‹æ•°æ®æ–‡ä»¶ç›®å½•ä¸‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA@192.168.163.9:5237 æœåŠ¡å™¨[192.168.163.9:5237]:å¤„äºæ™®é€šæ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 7.226(ms) disql V8 SQL\u0026gt; ALTER DATABASE MOUNT; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 2.814(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE ARCHIVELOG; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 23.121(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE ADD ARCHIVELOG \u0026#39;DEST=/home/dmdba/ADDTEST_data/ADDTEST/arch, TYPE=LOCAL, FILE_SIZE=1024, SPACE_LIMIT=10240\u0026#39;; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 3.945(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE OPEN; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 22.566(æ¯«ç§’). æ‰§è¡Œå·:0. å¤‡ä»½æ•°æ®\r1 2 3 SQL\u0026gt; BACKUP DATABASE BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39;; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 00:00:07.540. æ‰§è¡Œå·:64401. ä¿®æ”¹ dm.ini\r1 2 3 4 5 6 SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;PORT_NUM\u0026#39;,5237); #æ•°æ®åº“å®ä¾‹ç›‘å¬ç«¯å£ï¼Œé…ç½®æˆæ–°çš„ç«¯å£ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;DW_INACTIVE_INTERVAL\u0026#39;,60); #æ¥æ”¶å®ˆæŠ¤è¿›ç¨‹æ¶ˆæ¯è¶…æ—¶æ—¶é—´ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); #ä¸å…è®¸æ‰‹å·¥æ–¹å¼ä¿®æ”¹å®ä¾‹æ¨¡å¼/çŠ¶æ€/OGUID SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;ENABLE_OFFLINE_TS\u0026#39;,2); #ä¸å…è®¸å¤‡åº“ OFFLINE è¡¨ç©ºé—´ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;MAL_INI\u0026#39;,1); #æ‰“å¼€ MAL ç³»ç»Ÿ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;RLOG_SEND_APPLY_MON\u0026#39;,64); #ç»Ÿè®¡æœ€è¿‘ 64 æ¬¡çš„æ—¥å¿—é‡æ¼”ä¿¡æ¯ é€€å‡ºå¹¶å…³é—­æ•°æ®åº“æœåŠ¡\r1 2 3 SQL\u0026gt; exit; # åˆ°å¼€å¯æœåŠ¡çš„linuxçª—å£ï¼Œç»ˆæ­¢å‰å°æœåŠ¡ ä¿®æ”¹ dmarch.ini\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [dmdba@linux1 bin]$ vi /home/dmdba/ADDTEST_data/ADDTEST/dmarch.ini #DaMeng Database Archive Configuration file #this is comments ARCH_WAIT_APPLY = 0 [ARCHIVE_LOCAL1] ARCH_TYPE = LOCAL ARCH_DEST = /home/dmdba/ADDTEST_data/ADDTEST/arch ARCH_FILE_SIZE = 1024 ARCH_SPACE_LIMIT = 10240 ARCH_FLUSH_BUF_SIZE = 0 ARCH_HANG_FLAG = 1 [ARCHIVE_REALTIME1] ARCH_TYPE = REALTIME ARCH_DEST = GRP_ADDTEST_02 åˆ›å»º dmmal.ini\ræ³¨æ„ï¼šæ–‡ä»¶ç›®å½•ã€å®ä¾‹åã€ç«¯å£åˆ«é…ç½®é”™äº†ï¼ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 [dmdba@linux1 bin]$ vi /home/dmdba/ADDTEST_data/ADDTEST/dmmal.ini MAL_CHECK_INTERVAL = 10 #MAL é“¾è·¯æ£€æµ‹æ—¶é—´é—´éš” MAL_CONN_FAIL_INTERVAL = 10 #åˆ¤å®š MAL é“¾è·¯æ–­å¼€çš„æ—¶é—´ MAL_TEMP_PATH = /home/dmdba/ADDTEST_data/ADDTEST/malpath/ #ä¸´æ—¶æ–‡ä»¶ç›®å½• MAL_BUF_SIZE = 512 #å•ä¸ª MAL ç¼“å­˜å¤§å°ï¼Œå•ä½ MB MAL_SYS_BUF_SIZE = 2048 #MAL æ€»å¤§å°é™åˆ¶ï¼Œå•ä½ MB MAL_COMPRESS_LEVEL = 0 #MAL æ¶ˆæ¯å‹ç¼©ç­‰çº§ï¼Œ0 è¡¨ç¤ºä¸å‹ç¼© [MAL_INST1] MAL_INST_NAME = GRP_ADDTEST_01 #å®ä¾‹åï¼Œå’Œ dm.ini çš„ INSTANCE_NAME ä¸€è‡´ MAL_HOST = 192.168.163.9 #MAL ç³»ç»Ÿç›‘å¬ TCP è¿æ¥çš„ IP åœ°å€ MAL_PORT = 5337 #MAL ç³»ç»Ÿç›‘å¬ TCP è¿æ¥çš„ç«¯å£ MAL_INST_HOST = 192.168.163.9 #å®ä¾‹çš„å¯¹å¤–æœåŠ¡ IP åœ°å€ MAL_INST_PORT = 5237 #å®ä¾‹å¯¹å¤–æœåŠ¡ç«¯å£ï¼Œå’Œ dm.ini çš„ PORT_NUM ä¸€è‡´ MAL_DW_PORT = 5437 #å®ä¾‹å¯¹åº”çš„å®ˆæŠ¤è¿›ç¨‹ç›‘å¬ TCP è¿æ¥çš„ç«¯å£ MAL_INST_DW_PORT = 5537 #å®ä¾‹ç›‘å¬å®ˆæŠ¤è¿›ç¨‹ TCP è¿æ¥çš„ç«¯å£ [MAL_INST2] MAL_INST_NAME = GRP_ADDTEST_02 MAL_HOST = 192.168.163.10 MAL_PORT = 5337 MAL_INST_HOST = 192.168.163.10 MAL_INST_PORT = 5237 MAL_DW_PORT = 5437 MAL_INST_DW_PORT = 5537 åˆ›å»º dmwatcher.ini\ræ³¨æ„ï¼š\næ•°æ®å®ˆæŠ¤ç»„åï¼Œåˆ«é”™äº†ï¼Œè¿™é‡Œæ˜¯ [GRP2] å®ä¾‹è·¯å¾„ä¹Ÿåˆ«æ•´é”™äº† æ•°æ®å®ˆæŠ¤çš„ OGUID éœ€è¦å”¯ä¸€ï¼Œä¸å…¶ä»–å®ä¾‹çš„ OGUID ä¸èƒ½ç›¸åŒï¼Œä¹Ÿéœ€è¦æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 [dmdba@linux1 bin]$ vi /home/dmdba/ADDTEST_data/ADDTEST/dmwatcher.ini [GRP2] DW_TYPE = GLOBAL #å…¨å±€å®ˆæŠ¤ç±»å‹ DW_MODE = AUTO #MANUALï¼šæ•…éšœæ‰‹åˆ‡ AUTOï¼šæ•…éšœè‡ªåˆ‡ DW_ERROR_TIME = 20 #è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹æ•…éšœè®¤å®šæ—¶é—´ INST_ERROR_TIME = 20 #æœ¬åœ°å®ä¾‹æ•…éšœè®¤å®šæ—¶é—´ INST_RECOVER_TIME = 60 #ä¸»åº“å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ¢å¤çš„é—´éš”æ—¶é—´ INST_OGUID = 45332 #å®ˆæŠ¤ç³»ç»Ÿå”¯ä¸€ OGUID å€¼ INST_INI = /home/dmdba/ADDTEST_data/ADDTEST/dm.ini #dm.ini æ–‡ä»¶è·¯å¾„ INST_AUTO_RESTART = 1 #æ‰“å¼€å®ä¾‹çš„è‡ªåŠ¨å¯åŠ¨åŠŸèƒ½ INST_STARTUP_CMD = /home/dmdba/dmdbms/bin/dmserver #å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨ RLOG_SEND_THRESHOLD = 0 #æŒ‡å®šä¸»åº“å‘é€æ—¥å¿—åˆ°å¤‡åº“çš„æ—¶é—´é˜ˆå€¼ï¼Œé»˜è®¤å…³é—­ RLOG_APPLY_THRESHOLD = 0 #æŒ‡å®šå¤‡åº“é‡æ¼”æ—¥å¿—çš„æ—¶é—´é˜ˆå€¼ï¼Œé»˜è®¤å…³é—­ æ‹·è´å¤‡ä»½æ–‡ä»¶åˆ°å¤‡åº“\rå¤‡ä»½æ–‡ä»¶å°±æ˜¯ã€2.3 æ­¥éª¤ã€‘æ‰§è¡Œçš„\n1 BACKUP DATABASE BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39;; ç”Ÿæˆçš„ BACKUP_FILE_ADDTEST æ–‡ä»¶\nå¦‚ä¸‹æ‹·è´\n1 2 3 4 5 [dmdba@linux1 bin]$ scp -r /home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST dmdba@192.168.163.10:/home/dmdba/ADDTEST_data/ADDTEST/bak/ dmdba@192.168.163.10\u0026#39;s password: !@#$qwer BACKUP_FILE_ADDTEST.bak 100% 30MB 19.7MB/s 00:01 BACKUP_FILE_ADDTEST_1.bak 100% 41KB 13.9MB/s 00:00 BACKUP_FILE_ADDTEST.meta 100% 110KB 9.6MB/s 00:00 æ³¨å†ŒæœåŠ¡\rä½¿ç”¨ root ç”¨æˆ·æ“ä½œ\næ³¨æ„ï¼š\nå®ä¾‹è·¯å¾„åˆ«é”™ã€å®ä¾‹ååˆ«é”™ æ•°æ®å®ˆæŠ¤çš„åç§°è®°å¾—ä¹Ÿæ”¹ä¸€ä¸‹ï¼Œåˆ«å†²çª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@linux1 ~]# cd /home/dmdba/dmdbms/script/root/ #################### # åˆ›å»ºæ•°æ®åº“æœåŠ¡ #################### [root@linux1 root]# ./dm_service_installer.sh -t dmserver -p GRP_ADDTEST_01 -dm_ini /home/dmdba/ADDTEST_data/ADDTEST/dm.ini -m mount Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceGRP_ADDTEST_01.service to /usr/lib/systemd/system/DmServiceGRP_ADDTEST_01.service. åˆ›å»ºæœåŠ¡(DmServiceGRP_ADDTEST_01)å®Œæˆ #################### # åˆ›å»ºæ•°æ®å®ˆæŠ¤æœåŠ¡ # æ•°æ®å®ˆæŠ¤æœåŠ¡çš„åç§°åˆ«è·ŸåŸæœ‰çš„å†²çª -p å‚æ•° #################### [root@linux1 root]# ./dm_service_installer.sh -t dmwatcher -p WatcherADDTEST -watcher_ini /home/dmdba/ADDTEST_data/ADDTEST/dmwatcher.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmWatcherServiceWatcherADDTEST.service to /usr/lib/systemd/system/DmWatcherServiceWatcherADDTEST.service. åˆ›å»ºæœåŠ¡(DmWatcherServiceWatcherADDTEST)å®Œæˆ å¦‚æœéœ€è¦åˆ é™¤æœåŠ¡\r1 2 [root@~]# ./dm_service_uninstaller.sh -n DmServiceGRP_ADDTEST_01 [root@~]# ./dm_service_uninstaller.sh -n DmWatcherServiceWatcherADDTEST é…ç½® B æœºå™¨\rB æœºå™¨ä¸Šæ˜¯å¤‡åº“ï¼Œå°†æ•°æ®è¿˜åŸä¸ A æœºå™¨çš„ä¸»åº“ä¸€è‡´\næ— å¿…è¦è¯´æ˜ï¼Œé»˜è®¤ä½¿ç”¨ dmdba ç”¨æˆ·æ“ä½œ\nå¤‡åº“æ¢å¤æ•°æ®\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RESTORE DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39;\u0026#34; dmrman V8 RESTORE DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39; file dm.key not found, use default license! Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL [Percent:100.00%][Speed:0.00M/s][Cost:00:00:03][Remaining:00:00:00] restore successfully. time used: 00:00:03.464 [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RECOVER DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39;\u0026#34; dmrman V8 RECOVER DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/bak/BACKUP_FILE_ADDTEST\u0026#39; file dm.key not found, use default license! Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[42819], file_lsn[42819] [Percent:100.00%][Speed:0.00PKG/s][Cost:00:00:00][Remaining:00:00:00] recover successfully! time used: 00:00:03.146 [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RECOVER DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; UPDATE DB_MAGIC\u0026#34; dmrman V8 RECOVER DATABASE \u0026#39;/home/dmdba/ADDTEST_data/ADDTEST/dm.ini\u0026#39; UPDATE DB_MAGIC file dm.key not found, use default license! Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[42900], file_lsn[42900] recover successfully! time used: 00:00:01.192 å¦‚æœå°‘æ‰§è¡Œäº†ä¸­é—´çš„ RECOVER DATABASE æ­¥éª¤ï¼Œåˆ™ä¼šæŠ¥é”™\n1 2 [-8308]:éœ€è¦å…ˆæ‰§è¡ŒRECOVER DATABASEæ“ä½œï¼Œå†æ‰§è¡ŒRECOVER DATABASE UPDATE DB_MAGICæ“ä½œ dmrman_main end, code[-8308], return -1. åˆ›å»º dmarch.ini\rA æœºå™¨å¼€äº†å½’æ¡£ï¼Œ B æœºå™¨ä¹Ÿè¦å¼€å½’æ¡£ï¼ˆå¯ä»¥ç®€å•çš„ç†è§£é€šè¿‡å½’æ¡£åŒæ­¥æ•°æ®ï¼‰\nå› ä¸ºæ²¡å¯ B æœºå™¨çš„å¤‡åº“å®ä¾‹æœåŠ¡ï¼Œè¦æ‰‹åŠ¨åˆ›å»º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [dmdba@linux2 bin]$ vi /home/dmdba/ADDTEST_data/ADDTEST/dmarch.ini ARCH_WAIT_APPLY = 0 #0ï¼šé«˜æ€§èƒ½ 1ï¼šäº‹åŠ¡ä¸€è‡´ [ARCHIVE_LOCAL] ARCH_TYPE = LOCAL #æœ¬åœ°å½’æ¡£ç±»å‹ ARCH_DEST = /home/dmdba/ADDTEST_data/ADDTEST/arch/ #æœ¬åœ°å½’æ¡£å­˜æ”¾è·¯å¾„ ARCH_FILE_SIZE = 1024 #å•ä¸ªå½’æ¡£å¤§å°ï¼Œå•ä½ MB ARCH_SPACE_LIMIT = 10240 #å½’æ¡£ä¸Šé™ï¼Œå•ä½ MB ARCH_FLUSH_BUF_SIZE = 0 ARCH_HANG_FLAG = 1 [ARCHIVE_REALTIME1] ARCH_TYPE = REALTIME #å®æ—¶å½’æ¡£ç±»å‹ ARCH_DEST = GRP_ADDTEST_01 #å®æ—¶å½’æ¡£ç›®æ ‡å®ä¾‹åï¼Œè¿™é‡Œåˆ™å¡«ä¸»åº“çš„å®ä¾‹ ä¿®æ”¹ dm.ini\rå¹¶ä¸”ç¡®ä¿æ–‡ä»¶é‡Œçš„å®ä¾‹åä¸ºï¼šGRP_ADDTEST_02 ï¼Œç«¯å£ä¸º 5237 ï¼Œå¹¶ä¸”é…ç½®å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 [dmdba@linux2 DMDB]$ vi /home/dmdba/dmdbms/DMDB/dm.ini INSTANCE_NAME = GRP_TEST_02 PORT_NUM = 5237 #æ•°æ®åº“å®ä¾‹ç›‘å¬ç«¯å£ DW_INACTIVE_INTERVAL = 60 #æ¥æ”¶å®ˆæŠ¤è¿›ç¨‹æ¶ˆæ¯è¶…æ—¶æ—¶é—´ ALTER_MODE_STATUS = 0 #ä¸å…è®¸æ‰‹å·¥æ–¹å¼ä¿®æ”¹å®ä¾‹æ¨¡å¼/çŠ¶æ€/OGUID ENABLE_OFFLINE_TS = 2 #ä¸å…è®¸å¤‡åº“ OFFLINE è¡¨ç©ºé—´ MAL_INI = 1 #æ‰“å¼€ MAL ç³»ç»Ÿ ARCH_INI = 1 #æ‰“å¼€å½’æ¡£é…ç½® RLOG_SEND_APPLY_MON = 64 #ç»Ÿè®¡æœ€è¿‘ 64 æ¬¡çš„æ—¥å¿—é‡æ¼”ä¿¡æ¯ åˆ›å»º dmmal.ini\råŒä¸»åº“é…ç½®\nåˆ›å»º dmwatcher.ini\råŒä¸»åº“é…ç½®\næ³¨å†ŒæœåŠ¡\rä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@linux2 ~]# cd /home/dmdba/dmdbms/script/root/ #################### # åˆ›å»ºæ•°æ®åº“æœåŠ¡ #################### [root@linux2 root]# ./dm_service_installer.sh -t dmserver -p GRP_ADDTEST_02 -dm_ini /home/dmdba/ADDTEST_data/ADDTEST/dm.ini -m mount Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceGRP_ADDTEST_01.service to /usr/lib/systemd/system/DmServiceGRP_ADDTEST_01.service. åˆ›å»ºæœåŠ¡(DmServiceGRP_ADDTEST_01)å®Œæˆ #################### # åˆ›å»ºæ•°æ®å®ˆæŠ¤æœåŠ¡ # æ•°æ®å®ˆæŠ¤æœåŠ¡çš„åç§°åˆ«è·ŸåŸæœ‰çš„å†²çª -p å‚æ•° #################### [root@linux2 root]# ./dm_service_installer.sh -t dmwatcher -p WatcherADDTEST -watcher_ini /home/dmdba/ADDTEST_data/ADDTEST/dmwatcher.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmWatcherServiceWatcherADDTEST.service to /usr/lib/systemd/system/DmWatcherServiceWatcherADDTEST.service. åˆ›å»ºæœåŠ¡(DmWatcherServiceWatcherADDTEST)å®Œæˆ é…ç½®æ–°å®ä¾‹çš„ç›‘è§†å™¨\rä½¿ç”¨ dmdba æ“ä½œ\nåˆ›å»º dmmonitor.ini\råœ¨ä¸»åº“æœºå™¨ä¸Šåˆ›å»ºï¼ŒA æœºå™¨ï¼ˆåœ¨ B æœºå™¨æˆ–è€…ç¬¬ä¸‰å°æœºå™¨ä¸Šéƒ½å¯ä»¥ï¼Œéšæ„ï¼‰ï¼Œè¿™ä¸ªæ˜¯ç¡®è®¤ç›‘è§†å™¨\nç›‘è§†å™¨çš„æ—¥å¿—è·¯å¾„æœ€å¥½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä¸ç„¶å°±æ˜¯é»˜è®¤åœ¨è¾¾æ¢¦æ•°æ®åº“çš„æŒ‰ç…§ç›®å½•ä¸‹\nè¿˜æœ‰å°±æ˜¯ï¼Œæ—¥å¿—è·¯å¾„æœ€å¥½ä¸åŸæœ‰çš„å®ä¾‹ç›‘è§†å™¨æ—¥å¿—è·¯å¾„åŒºåˆ†ï¼Œå¦åˆ™ä¸¤ä¸ªå®ä¾‹çš„ç›‘è§†å™¨æ—¥å¿—ä¼šå†™åˆ°ä¸€èµ·\n1 2 3 4 5 6 7 8 9 10 11 12 13 [dmdba@linux1 root]# vi /home/dmdba/ADDTEST_data/ADDTEST/dmmonitor.ini MON_DW_CONFIRM = 1 #0ï¼šéç¡®è®¤ï¼ˆæ•…éšœæ‰‹åˆ‡ï¼‰ 1ï¼šç¡®è®¤ï¼ˆæ•…éšœè‡ªåˆ‡ï¼‰ MON_LOG_PATH = ../log_monitor/ADDTEST #ç›‘è§†å™¨æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„ MON_LOG_INTERVAL = 60 #æ¯éš” 60s å®šæ—¶è®°å½•ç³»ç»Ÿä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ MON_LOG_FILE_SIZE = 32 #å•ä¸ªæ—¥å¿—å¤§å°ï¼Œå•ä½ MB MON_LOG_SPACE_LIMIT = 1024 #æ—¥å¿—ä¸Šé™ï¼Œå•ä½ MB [GRP2] MON_INST_OGUID = 45332 #ç»„ GRP2 çš„å”¯ä¸€ OGUID å€¼ MON_DW_IP = 192.168.163.9:5437 #IP å¯¹åº” MAL_HOSTï¼ŒPORT å¯¹åº” MAL_DW_PORT MON_DW_IP = 192.168.163.10:5437 åˆ›å»º dmmonitor_manual.ini\réç¡®è®¤ç›‘è§†å™¨ï¼Œé…ç½®åŒä¸Šï¼Œé™¤äº† MON_DW_CONFIRM æ˜¯ 0 å¤–\n1 2 3 4 5 6 7 8 9 10 11 12 [dmdba@linux1 root]# vi /home/dmdba/ADDTEST_data/ADDTEST/dmmonitor_manual.ini MON_DW_CONFIRM = 1 #0ï¼šéç¡®è®¤ï¼ˆæ•…éšœæ‰‹åˆ‡ï¼‰ 1ï¼šç¡®è®¤ï¼ˆæ•…éšœè‡ªåˆ‡ï¼‰ MON_LOG_PATH = ../log_monitor/ADDTEST #ç›‘è§†å™¨æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„ MON_LOG_INTERVAL = 60 #æ¯éš” 60s å®šæ—¶è®°å½•ç³»ç»Ÿä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ MON_LOG_FILE_SIZE = 32 #å•ä¸ªæ—¥å¿—å¤§å°ï¼Œå•ä½ MB MON_LOG_SPACE_LIMIT = 1024 #æ—¥å¿—ä¸Šé™ï¼Œå•ä½ MB [GRP2] MON_INST_OGUID = 45332 #ç»„ GRP2 çš„å”¯ä¸€ OGUID å€¼ MON_DW_IP = 192.168.163.9:5437 #IP å¯¹åº” MAL_HOSTï¼ŒPORT å¯¹åº” MAL_DW_PORT MON_DW_IP = 192.168.163.10:5437 æ³¨å†Œç›‘è§†å™¨æœåŠ¡\rä½¿ç”¨root ç”¨æˆ·æ“ä½œ\n1 2 3 [root@linux1 root]# ./dm_service_installer.sh -t dmmonitor -p MonitorADDTEST -monitor_ini /home/dmdba/ADDTEST_data/ADDTEST/dmmonitor.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmMonitorServiceMonitorADDTEST.service to /usr/lib/systemd/system/DmMonitorServiceMonitorADDTEST.service. åˆ›å»ºæœåŠ¡(DmMonitorServiceMonitorADDTEST)å®Œæˆ å¯åŠ¨ç›‘è§†å™¨æœåŠ¡\r1 2 [dmdba@linux1 bin]$ ./DmMonitorServiceMonitorADDTEST start Starting DmMonitorServiceMonitorADDTEST: [ FAILED ] ç›‘è§†å™¨éœ€è¦åœ¨å®ä¾‹æœåŠ¡èµ·æ¥åæ‰èƒ½å¯ï¼Œé¡ºåºå¦‚ä¸‹ï¼š\næ•°æ®åº“å®ä¾‹ \u0026raquo; å®ˆæŠ¤è¿›ç¨‹ \u0026raquo; ç›‘è§†å™¨\nå¯åŠ¨æœåŠ¡\rå¯åŠ¨æ•°æ®åº“å¹¶ä¿®æ”¹å‚æ•°\rA æœºå™¨å¯åŠ¨ã€ä¿®æ”¹\rå¯åŠ¨å®ä¾‹æœåŠ¡æŠ¥é”™\rä¸»è¦æ˜¯ä¿®æ”¹ OGUIDï¼ˆå°±æ˜¯æ•°æ®å®ˆæŠ¤çš„ç»„ï¼‰ ä¸æ•°æ®åº“æ¨¡å¼\n1 2 [dmdba@linux1 bin]$ ./DmServiceGRP_ADDTEST_01 start Starting DmServiceGRP_ADDTEST_01: [ FAILED ] æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 cd ../log [dmdba@linux1 log]$ ls -lrt æ€»ç”¨é‡ 2384 -rw-r--r--. 1 dmdba dinstall 400805 7æœˆ 21 00:02 install_ant.log -rwxr-xr-x. 1 dmdba dinstall 480 7æœˆ 21 00:02 install.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 21 00:03 DmAPService.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 21 00:43 DmServiceDMSERVER.log -rw-r--r--. 1 dmdba dinstall 97806 7æœˆ 21 00:57 dm_DMDBSERVER_202407.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 21 11:19 DmServiceGRP_TEST_01.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 21 14:48 DmWatcherServiceWatcher.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 22 21:34 DmMonitorServiceMonitor.log -rw-r--r--. 1 dmdba dinstall 540272 7æœˆ 27 09:47 dm_dmwatcher_GRP_TEST_01_202407.log -rw-r--r--. 1 root root 2193 7æœˆ 27 10:09 dm_GRP_ADDTEST_01_202407.log -rw-r--r--. 1 dmdba dinstall 2385 7æœˆ 27 10:26 dm_dmap_202407.log -rw-r--r--. 1 dmdba dinstall 1188 7æœˆ 27 10:26 dm_dmap_br_202407.log -rw-r--r--. 1 dmdba dinstall 36265 7æœˆ 27 10:26 dm_BAKRES_202407.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 27 11:45 DmMonitorServiceMonitorADDTEST.log -rw-r--r--. 1 dmdba dinstall 1329521 7æœˆ 27 11:56 dm_GRP_TEST_01_202407.log -rw-r--r--. 1 dmdba dinstall 0 7æœˆ 27 11:56 DmServiceGRP_ADDTEST_01.log -rw-r--r--. 1 dmdba dinstall 5324 7æœˆ 27 11:56 dm_unknown_202407.log -rw-r--r--. 1 dmdba dinstall 4353 7æœˆ 27 11:57 dmsvc_sh.log æœ€è¿‘æ›´æ–°çš„æ—¥å¿— dmsvc_sh.log ï¼ŒæŸ¥çœ‹æ—¥å¿—\n1 2 3 [dmdba@linux1 log]$ tail -f dmsvc_sh.log [2024-07-27 11:56:52] [localhost] [2886311096] [DmServiceGRP_ADDTEST_01] start service by dmdba [2024-07-27 11:57:08] [localhost] [2886311096] [DmServiceGRP_ADDTEST_01] failed to start service by dmdba (code:0) æ—¢ç„¶æ˜¯ dmsvc_sh.log æŠ¥é”™äº†ï¼ŒçŒœæµ‹ä¸ dm_svc.conf é…ç½®æœ‰å…³ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥é…ç½®æœåŠ¡åè¿æ¥çš„æ–‡ä»¶\næ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 TIME_ZONE=(480) LANGUAGE=(CN) GRP1=(192.168.163.9:5236,192.168.163.10:5236) # æœåŠ¡é…ç½® [GRP1] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(0) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) å°è¯•æ·»åŠ æ–°å¢çš„å®ä¾‹æœåŠ¡åè¿›å»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 TIME_ZONE=(480) LANGUAGE=(CN) GRP1=(192.168.163.9:5236,192.168.163.10:5236) GRP2=(192.168.163.9:5237,192.168.163.10:5237) # æœåŠ¡é…ç½® [GRP1] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(0) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) [GRP2] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(0) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) è¿˜æ˜¯æŠ¥é”™\né¢ã€‚ã€‚ã€‚\nç†è®ºä¸Šè®²ï¼Œå®ä¾‹çš„æŠ¥é”™åº”è¯¥æ˜¯å†™å…¥å®ä¾‹çš„æ—¥å¿—æ–‡ä»¶å•Šï¼Ÿæ€ä¹ˆæœ€è¿‘å†™å…¥çš„æ—¥å¿—åªæœ‰ dmsvc_sh.log ï¼Ÿ\nå‘ç°å¯åŠ¨æŠ¥é”™çš„æ—¥å¿—æ²¡å†™è¿›å»ï¼ŒåŸæ¥æ˜¯æ—¥å¿—æ–‡ä»¶çš„ç”¨æˆ·ä¸»ç»„æ˜¯ rootï¼Œå…ˆç”¨ root å˜æ›´\n1 chown -R dmdba:dinstall /home/dmdba/dmdbms/log/* é‡å¯åˆ‡æ¢åˆ° dmdba å¯åŠ¨æ–°å¢çš„å®ä¾‹æœåŠ¡ï¼Œå¹¶æŸ¥çœ‹å®ä¾‹æ—¥å¿— ``\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 [dmdba@linux1 bin]$ ./DmServiceGRP_ADDTEST_01 start Starting DmServiceGRP_ADDTEST_01: [ FAILED ] [dmdba@linux1 log]$ tail -f dm_GRP_ADDTEST_01_202407.log 2024-07-27 12:13:15.145 [INFO] database P0000080255 T0000000000000080298 dm_mal_tsk_thd started, src_site:0, dest_site:1, port_data 2024-07-27 12:13:15.145 [INFO] database P0000080255 T0000000000000080297 dm_mal_recv_thd started, src_site:0, dest_site:0, port_data 2024-07-27 12:13:15.195 [INFO] database P0000080255 T0000000000000080255 rsys_rarch_obj_fil_collect path:[/home/dmdba/ADDTEST_data/ADDTEST/arch] begin. 2024-07-27 12:13:15.200 [INFO] database P0000080255 T0000000000000080255 rsys_rarch_obj_fil_collect seqno[0] end, total 1 rfils, last_g_seqno:5043 2024-07-27 12:13:15.200 [INFO] database P0000080255 T0000000000000080255 rsys_rarch_obj_fil_collect seqno[0] end, total_size 69632. 2024-07-27 12:13:15.201 [INFO] database P0000080255 T0000000000000080255 rsys_rarch_obj_fil_collect path:[GRP_ADDTEST_02] begin. 2024-07-27 12:13:15.203 [FATAL] database P0000080255 T0000000000000080304 comm_create_lsnr_sockets_low failed to create socket or listen port:5336, errno:107. 2024-07-27 12:13:15.203 [FATAL] database P0000080255 T0000000000000080304 [for dem]SYSTEM SHUTDOWN ABORT. 2024-07-27 12:13:15.204 [FATAL] database P0000080255 T0000000000000080304 MAL listener can not get the address information 2024-07-27 12:13:15.204 [INFO] database P0000080255 T0000000000000080304 total 0 rfil opened! æ³¨æ„ FATAL ç±»å‹çš„æ—¥å¿—ï¼Œè¿™ä¸ªå°±æ˜¯å…³é”®ä¿¡æ¯ï¼\n1 2 comm_create_lsnr_sockets_low failed to create socket or listen port:5336, errno:107. MAL listener can not get the address information é—®é¢˜å°±å‡ºç°åœ¨ MAL çš„ 5336 ç«¯å£ä¸Š\næŸ¥çœ‹ dmmal.ini æ–‡ä»¶ï¼Œæœç„¶ï¼ŒMAL_PORT å¿˜æ”¹äº†ï¼Œè¿˜æ˜¯åŸæ¥çš„å®ä¾‹ç«¯å£ï¼Œæ–°å®ä¾‹çš„ MAL ç«¯å£ä¸ä¹‹å‰çš„å†²çªäº†ï¼Œä¿®æ”¹å®ƒä¸º 5337\næ­£å¸¸å¯åŠ¨\r1 2 [dmdba@linux1 bin]$ ./DmServiceGRP_ADDTEST_01 start Starting DmServiceGRP_ADDTEST_01: [ OK ] ä¿®æ”¹å‚æ•°\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA@192.168.163.9:5237 æœåŠ¡å™¨[192.168.163.9:5237]:å¤„äºæ™®é€šé…ç½®çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 6.374(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 12.962(æ¯«ç§’). æ‰§è¡Œå·:1. SQL\u0026gt; SP_SET_OGUID(45332); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 5.791(æ¯«ç§’). æ‰§è¡Œå·:2. SQL\u0026gt; ALTER DATABASE PRIMARY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 16.329(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 28.218(æ¯«ç§’). æ‰§è¡Œå·:3. B æœºå™¨å¯åŠ¨ã€ä¿®æ”¹\r1 2 3 4 5 6 7 8 9 [dmdba@linux2 bin]$ ./DmServiceGRP_ADDTEST_02 start Starting DmServiceGRP_ADDTEST_02: [ FAILED ] dmdba@linux2 log]$ cat dm_GRP_ADDTEST_02_202407.log 2024-07-27 12:26:28.172 [INFO] database P0000076312 T0000000000000076312 INI parameter DW_PORT changed, the original value 0, new value 5537 2024-07-27 12:26:28.173 [ERROR] database P0000076312 T0000000000000076312 Read ini file(/home/dmdba/ADDTEST_data/ADDTEST/dmarch.ini) error in line 13, code(-952) 2024-07-27 12:26:28.173 [INFO] database P0000076312 T0000000000000076312 INI parameter DPC_2PC changed, the original value 1, new value 0 2024-07-27 12:26:28.203 [FATAL] database P0000076312 T0000000000000076312 dmserver startup failed, code = -952 [archive_dest can not be self instance] 2024-07-27 12:26:28.204 [FATAL] database P0000076312 T0000000000000076312 nsvr_ini_file_read failed, [code: -952] é¢ã€‚ã€‚ã€‚\nè¿™ä¸ªä¹ŸæŠ¥é”™äº†ï¼Œçœ‹æ—¥å¿—é‡Œçš„ ERROR\n1 database P0000076312 T0000000000000076312 Read ini file(/home/dmdba/ADDTEST_data/ADDTEST/dmarch.ini) error in line 13, code(-952) åˆå¿˜è®°ä¿®æ”¹äº†ï¼Œdmarch.ini å½’æ¡£é…ç½®æ–‡ä»¶é‡Œï¼Œå¤åˆ¶è´´è´´ä¸»åº“çš„é…ç½®ï¼Œæ²¡æœ‰ä¿®æ”¹å®æ—¶å½’æ¡£çš„ç›®æ ‡å®ä¾‹ä¸ºä¸»åº“\nä¿®æ”¹ ARCH_DEST = GRP_ADDTEST_01\né‡æ–°å¯åŠ¨\n1 2 [dmdba@linux2 bin]$ ./DmServiceGRP_ADDTEST_02 start Starting DmServiceGRP_ADDTEST_02: [ OK ] ä¿®æ”¹å‚æ•°ï¼ŒOGUID å’Œæ•°æ®åº“æ¨¡å¼\nè¿™é‡Œä¿®æ”¹ä¸ºå¤‡åº“\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [dmdba@linux2 bin]$ ./disql SYSDBA/SYSDBA@192.168.163.10:5237 æœåŠ¡å™¨[192.168.163.10:5237]:å¤„äºæ™®é€šé…ç½®çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 11.200(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 47.346(æ¯«ç§’). æ‰§è¡Œå·:1. SQL\u0026gt; SP_SET_OGUID(45332); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 8.650(æ¯«ç§’). æ‰§è¡Œå·:2. SQL\u0026gt; ALTER DATABASE STANDBY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 20.649(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 33.556(æ¯«ç§’). æ‰§è¡Œå·:3. å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹\rA ã€ B æœºå™¨éƒ½å¯åŠ¨\n1 2 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcherADDTEST start Starting DmWatcherServiceWatcherADDTEST: [ OK ] å¯åŠ¨ç›‘è§†å™¨\rç›‘è§†å™¨æ˜¯é…ç½®åœ¨ A æœºå™¨ä¸Šï¼Œå³ä¸»åº“çš„æœºå™¨ä¸Šçš„\n1 2 [dmdba@linux1 bin]$ ./DmMonitorServiceMonitorADDTEST start Starting DmMonitorServiceMonitorADDTEST: [ FAILED ] å¥½äº†ï¼Œç›‘è§†å™¨å¯åŠ¨ä¹ŸæŠ¥é”™\næ—¥å¿—ä¹Ÿæ²¡æœ‰ï¼Œå¥‡æ€ªäº†ï¼Œé€šè¿‡å‰å°å¯åŠ¨çœ‹çœ‹\n1 2 3 4 5 [dmdba@linux1 bin]$ ./dmmonitor /home/dmdba/ADDTEST_data/ADDTEST/dmmonitor.ini Invalid [group_name] or the file contains unrecognized characters! Read ini file(/home/dmdba/ADDTEST_data/ADDTEST/dmmonitor.ini) error in line 1, code(-803) DMMONITOR[4.0] V8 Read ini failed, please check the ini path(/home/dmdba/ADDTEST_data/ADDTEST/dmmonitor.ini) or invalid configuration or permission denied! é…ç½®æ— æ•ˆæˆ–è€…æƒé™è¢«æ‹’ç»\nåˆæ˜¯å¤åˆ¶è´´è´´çš„æŠ¥é”™ï¼Œå¤åˆ¶è¿›SHELLé‡Œï¼Œå¤´ä¸¤ä¸ªå­—æ¯è¢«åæ‰äº†\n1 2 [dmdba@linux1 bin]$ ./DmMonitorServiceMonitorADDTEST start Starting DmMonitorServiceMonitorADDTEST: [ OK ] éªŒè¯è¿æ¥\råœ¨è¾¾æ¢¦æ•°æ®åº“æœåŠ¡å™¨ä¸Šé…ç½® dm_svc.conf ï¼ŒåŒæ—¶åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šé…ç½® dm_svc.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 TIME_ZONE=(480) LANGUAGE=(CN) GRP1=(192.168.163.9:5236,192.168.163.10:5236) GRP2=(192.168.163.9:5237,192.168.163.10:5237) # æœåŠ¡é…ç½® [GRP1] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(0) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) [GRP2] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(0) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) ä½¿ç”¨è¾¾æ¢¦ç®¡ç†å·¥å…·è¿æ¥ï¼Œä¸€åˆ‡æ­£å¸¸\næ³¨æ„\råœ¨æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨åå°è¿è¡Œçš„æ–¹å¼ï¼Œå³è¾¾æ¢¦é€šè¿‡æ³¨å†ŒæœåŠ¡åç”Ÿæˆçš„ DmServiceXXXX``DmWatcherXXXX``DmMonitorXXXX æ–‡ä»¶å»å¯åŠ¨\nå½“å¦‚æœè¿™ä¸ªæ–¹å¼å¯åŠ¨å‡ºç°æŠ¥é”™æ—¶ï¼Œä½†æ˜¯æ—¥å¿—åˆæ²¡æœ‰è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨å‰å°å‘½ä»¤å¯åŠ¨ï¼Œè®©å‰å°ç›´æ¥æ‰“å°å¯åŠ¨è¿‡ç¨‹çš„ä¿¡æ¯\n1 2 cd /home/dmdba/dmdbms/bin ./dmserver /path/to/dm.ini # dmwatcher.ini dmmonitor.ini ","date":"2024-08-19T20:02:15+08:00","permalink":"http://localhost:1313/posts/2024/08/%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-%E6%96%B0%E5%A2%9E%E8%BE%BE%E6%A2%A6%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%AE%9E%E6%97%B6%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4%E4%B8%89/","title":"ä¸»å¤‡é›†ç¾¤ æ–°å¢è¾¾æ¢¦å®ä¾‹å¹¶é…ç½®å®æ—¶ä¸»å¤‡é›†ç¾¤ï¼ˆä¸‰ï¼‰"},{"content":"é—®é¢˜ä¸€ï¼šéæ­£å¸¸æ—¶é—´æ ¼å¼è½¬æ¢é—®é¢˜\rèƒŒæ™¯\ræœ€è¿‘åœ¨é¡¹ç›®ä¸Šï¼Œä½¿ç”¨ETLå·¥å…·é…ç½®ä»»åŠ¡ï¼Œå°†ä¸Šæ¸¸æ•°æ®ç›´æ¥æ¨é€åˆ°kafka topic ä¸­ï¼Œè®©å¦ä¸€ä¸ªç³»ç»Ÿå»æ¶ˆè´¹è¿™äº›å®æ—¶æˆäº¤çš„æ•°æ®ã€‚\nä¹‹å‰ç»éªŒçš„ä¸è¶³ï¼Œæ²¡æœ‰å¯¹æ¨é€çš„æ•°æ®åšé™åˆ¶ï¼Œå¯¼è‡´æ¯æ¬¡æ¨é€åˆ°topic é‡Œéƒ½æ˜¯å…¨é‡æ•°æ®ï¼Œå‡ ç™¾ä¸‡çš„æ•°æ®è¢«åå¤æ¨é€åˆ°topicé‡Œã€‚éœ€è¦å¯¹æ¨é€çš„ä»»åŠ¡è¿›è¡Œä¿®æ”¹ï¼Œå¢é‡æ¨é€æ•°æ®åˆ°kafkaï¼Œç»è¿‡å’¨è¯¢ï¼Œä½¿ç”¨å•è°ƒé€’å¢çš„æµæ°´å­—æ®µå»é…ç½®ï¼Œæ¨é€è¿‡çš„æ•°æ®å°±ä¸å†åå¤æ¨é€ã€‚\nå¹¶ä¸”ä¸ºäº†é¿å…æ•°æ®çš„é‡å¤ï¼Œè¿˜éœ€è¦è®¾ç½®ä¸»é”®ï¼Œç¡®ä¿æ¯ä¸€æ¡æ•°æ®éƒ½æ˜¯ä¸ºå”¯ä¸€ã€‚\né—®é¢˜\ræˆ‘ä½¿ç”¨æ¯ç¬”äº¤æ˜“çš„æ—¶é—´å»åšæµæ°´å­—æ®µï¼Œç®€å•çš„è¿›è¡Œäº†to_date()ï¼Œå‘ç°æŠ¥é”™äº†ï¼šéæ³•çš„æ—¶é—´æ—¥æœŸç±»å‹æ•°æ®ã€‚\næŸ¥çœ‹ä¸Šæ¸¸çš„æ•°æ®ï¼Œäº¤æ˜“æ—¶é—´ä¸ºï¼š\næˆ‘ä»¬æƒ³è¦çš„æ—¶é—´æ˜¯ 15:05:17 09:31:58 æ—¶åˆ†ç§’æ ¼å¼çš„ï¼Œå¹¶ä¸”å¦ä¸€ä¸ªç³»ç»Ÿæ‰€éœ€è¦çš„ä¸ºå­—ç¬¦ä¸²ç±»å‹\nè§£å†³\ré¦–å…ˆï¼Œå¯¹äº10ç‚¹ä¹‹å‰çš„æ•°æ®è‚¯å®šè¦åœ¨å‰è¾¹è¡¥å……ä¸€ä¸ª0ï¼Œè®©å®ƒæ˜¯æ­£å¸¸çš„æ—¶é—´æ•°æ®æ ¼å¼ï¼Œä½¿ç”¨lpad å‡½æ•°\nç„¶åå†å°†åˆ©ç”¨to_date è¿›è¡Œè½¬æ¢\nto_date è½¬æ¢æ˜¯é»˜è®¤åŠ ä¸Šäº†å¹´æœˆæ—¥çš„ï¼Œè¿˜éœ€è¦å†è¿›è¡Œä¸€æ¬¡to_charè½¬æ¢ï¼Œè½¬æ¢ä¸ºéœ€è¦ç”¨åˆ°çš„å­—ç¬¦ä¸²æ ¼å¼\né—®é¢˜äºŒï¼šä¸Šä¸‹æ¸¸ç¼–ç ä¸ä¸€è‡´äº§ç”Ÿçš„æ—¥æœŸæ ¼å¼è½¬æ¢é—®é¢˜\rèƒŒæ™¯\råœ¨æŸåˆè§„ç³»ç»Ÿï¼Œåˆ©å®³å…³ç³»äººçš„æ•°æ®æºå˜æ›´ï¼Œæˆ‘ä»¬é‡‡é›†çš„ä¸Šæ¸¸ç”±æ•°æ®åº“Aå˜æ›´ä¸ºæ•°æ®åº“Bï¼ŒåŸå…ˆå†™çš„SPè½¬æ¢çªç„¶å°±æŠ¥é”™äº†ï¼Œå…¶ä¸­æœ‰ä¸€æ®µæ—¥æœŸè½¬æ¢å‡ºé”™äº†ï¼Œç»è¿‡æŸ¥çœ‹é‡‡é›†è¿‡æ¥çš„æ•°æ®ï¼Œå‘ç°Båº“çš„æ—¥æœŸæ ¼å¼ä¸Aåº“çš„æ—¥æœŸæ ¼å¼ä¸ä¸€è‡´ã€‚\nåŸå…ˆAåº“çš„æ—¥æœŸæ ¼å¼æ˜¯YYYY-MM-DD HH24.MI.SS.FF\nä½†æ˜¯å˜æ›´æºåº“åï¼Œè¡¨çš„æ—¥æœŸæ ¼å¼æ˜¯YY-MON-DD HH.MI.SS.FF9 PMçš„æ ¼å¼\né—®é¢˜\råŸå…ˆï¼Œæˆ‘ä»¬ç³»ç»Ÿé‡Œï¼Œåªéœ€è¦å°†æ—¥æœŸåšå¦‚ä¸‹çš„è½¬æ¢å³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 insert into CMSCONFIG.T_XXX_REPORT_XXX (app_no , app_emp_no , emp_no , report_type2 , status , app_time , approve_time ) select a.id, a.brokerid, a.brokerid, \u0026#39;1\u0026#39;, \u0026#39;1\u0026#39;, to_date(to_char(to_timestamp(a.updatetime,\u0026#39;yyyy-mm-dd hh24:mi:ss.ff\u0026#39;),\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;),\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;), to_date(to_char(to_timestamp(a.updatetime,\u0026#39;yyyy-mm-dd hh24:mi:ss.ff\u0026#39;),\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;),\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;) from NC11.ST_EM_XXXXXXON a where not exists (select 1 from CMSCONFIG.T_XXX_REPORT_XXX t where a.id = t.app_no and t.report_type2 = \u0026#39;1\u0026#39;); 1 2 3 4 5 select to_date(to_char(to_timestamp(\u0026#39;2024-6-1 17.38.54.000000000\u0026#39;, \u0026#39;yyyy-mm-dd hh24:mi:ss.ff\u0026#39;), \u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;), \u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;) as datetime from dual; ä½†æ˜¯æ¢åº“ä¹‹åï¼Œæ—¥æœŸæ ¼å¼æ”¹å˜äº†ï¼Œå˜ä¸ºäº†å¦‚ä¸‹å½¢å¼ï¼š\n1 \u0026#39;18-MAR-24 03.44.12.000000000 PM\u0026#39; æ­¤æ—¶ï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨ä¸Šè¿°çš„SQLè¿›è¡Œæ—¥æœŸè½¬æ¢ï¼Œåˆ™ä¼šæŠ¥é”™æ— æ•ˆçš„æœˆä»½\nå½“æ—¶å°è¯•äº†å¾ˆå¤š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 -- åœ¨Oracleä¸­æŠ¥é”™æ—¥æœŸæ ¼å¼æ— æ³•è¯†åˆ« SELECT TO_DATE(\u0026#39;18-MAR-24 03.44.12.000000000 PM\u0026#39;, \u0026#39;YY-MON-DD HH.MI.SS.FF9 PM\u0026#39;) AS datetime FROM dual; -- åœ¨Oracleä¸­æŠ¥é”™æ— æ•ˆçš„æœˆä»½ SELECT TO_TIMESTAMP(\u0026#39;18-MAR-24 03.44.12.000000000 PM\u0026#39;, \u0026#39;YY-MON-DD HH.MI.SS.FF9 PM\u0026#39;) AS datetime FROM dual; -- åœ¨Oracleä¸­æŠ¥é”™è¦æ±‚AM/A.M.æˆ–PM/P.M. SELECT TO_TIMESTAMP(\u0026#39;18-3-24 03.44.12.000000000 PM\u0026#39;, \u0026#39;YY-MM-DD HH.MI.SS.FF9 PM\u0026#39;) AS datetime FROM dual; åˆ°åº•åº”è¯¥å¦‚ä½•å°† \u0026lsquo;18-MAR-24 03.44.12.000000000 PM\u0026rsquo; è½¬æ¢ä¸º \u0026lsquo;2024/3/18 15:44:12\u0026rsquo; å‘¢ï¼Ÿï¼Ÿï¼Ÿ\nå½“æ—¶ç™¾åº¦äº†å¾ˆå¤šè·¯å­ï¼Œè¯•è¿‡å¾ˆå¤šæ–¹æ³•ï¼Œåœ¨ä¸€ç¯‡å¸–å­ä¸Šçœ‹åˆ°å¯èƒ½è·ŸNLS_LANGUAGEæœ‰å…³ï¼Œéšåå»ORACLEå®˜ç½‘çœ‹ç›¸å…³è§£ç­”ï¼š\nè¯­è¨€ç¯å¢ƒçš„ä¸ä¸€è‡´å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œæœ‰å¯èƒ½è¿™ä¸ªåŸå› \nè§£å†³\ræœ‰äº†æ–¹å‘åï¼Œå¼€å§‹å°è¯•\næŸ¥çœ‹æœ¬åœ°åº“çš„NLS_LANGUAGEå‚æ•°\nä¸Šæ¸¸çš„åº“NLS_LANGUAGEï¼Œè®©å®¢æˆ·å¸®å¿™å’¨è¯¢ï¼Œæ˜¯american\nåœ¨æœ¬åœ°å°è¯•\n1 2 3 4 5 6 select to_date( to_char( to_timestamp(\u0026#39;18-MAR-24 03.44.12.000000000 PM\u0026#39;, \u0026#39;DD-MON-RR HH.MI.SS.FF AM\u0026#39;, \u0026#39;NLS_DATE_LANGUAGE = AMERICAN\u0026#39;), \u0026#39;YYYY/MM/DD HH24:MI:SS\u0026#39;), \u0026#39;YYYY/MM/DD HH24:MI:SS\u0026#39;) AS datetime from dual; å¯ä»¥è½¬æ¢å‡ºç»“æœï¼Œæ²¡é—®é¢˜ã€‚å°±æ˜¯è¿™æ ·ï¼Œåœ¨to_timestampé‡ŒåŠ å…¥NLS_LANGUAGE=AMERICAN å‚æ•°å¯ä»¥è§£å†³ã€‚\næŠŠè¿™æ®µé€»è¾‘æ›¿æ¢åˆ°SPå¯¹åº”çš„ä»£ç é‡Œï¼ŒæˆåŠŸè§£å†³æ—¥æœŸæŠ¥é”™çš„é—®é¢˜ã€‚\n","date":"2024-08-15T21:02:51+08:00","permalink":"http://localhost:1313/posts/2024/08/sql-%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98/","title":"SQL æ—¥æœŸæ—¶é—´è½¬æ¢é—®é¢˜"},{"content":"æ›´æ–°\r20240909\nä¼˜åŒ–äº†ç›‘æ§æ—¥å¿—æŒ‰ç…§ å¹´æœˆ ç›®å½•å­˜æ”¾ æ–°å¢å¯¹åŒä¸€ä¸ªæ•°æ®åº“å¤šå®ä¾‹æƒ…å†µçš„å·¡æ£€ ç®€è¦è¯´æ˜\rè¿™ä¸ª shell è„šæœ¬ç”¨äºæ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„æ—¥å¸¸æ£€æŸ¥ï¼š\nç³»ç»Ÿæ£€æŸ¥ï¼šç³»ç»Ÿæ—¶é—´ã€CPUã€å†…å­˜ã€ç£ç›˜ã€IO è¾¾æ¢¦æ•°æ®åº“æœåŠ¡ï¼šå®ä¾‹ã€æ•°æ®å®ˆæŠ¤ã€é›†ç¾¤çŠ¶æ€ å®ä¾‹æ£€æŸ¥ï¼šæ—¥å¿—æ˜¯å¦å‡ºç° ERROR \\ FATAL ç­‰æŠ¥é”™ï¼Œå‡ºç°æŠ¥é”™åˆ™å°†æŠ¥é”™ä¿¡æ¯é‡å®šå‘åˆ°å­˜æ”¾æŠ¥é”™çš„æ–‡ä»¶ è¿™ä¸ª shell è„šæœ¬ä½¿ç”¨çš„å‘½ä»¤éƒ½æ˜¯å¹³æ—¶å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„å‘½ä»¤\nç‰¹åˆ«æ˜¯æŸ¥çœ‹æ–‡ä»¶å†…å®¹å¹¶è¾“å‡ºæŒ‡å®šçš„å†…å®¹ï¼Œä½¿ç”¨ grep awk sed cut ç­‰å‘½ä»¤ç»“åˆã€‚\nä¾‹å¦‚ awk '/^avg-cpu/ {getline; print$6}' æ‰¾åˆ° avg-cpuå¼€å¤´çš„è¡Œï¼Œç„¶åä½¿ç”¨ getlineè¯»å–ä¸‹ä¸€è¡Œåˆ—çš„å†…å®¹å¹¶è¾“å‡ºç¬¬ 6 åˆ—\nä¾‹å¦‚ grep -e ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼\nä¾‹å¦‚ awk -v ä½¿ç”¨å˜é‡\nè¿˜æœ‰ä½¿ç”¨ while å¾ªç¯æ‰“å°å†…å®¹ï¼Œif è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œè¿˜æœ‰å¯¹ |ç®¡é“ç¬¦çš„ç”¨æ³•ï¼Œå®ƒå¯ä»¥å°†ä¸Šä¸€ä¸ªå‘½ä»¤è¿”å›çš„å†…å®¹ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤\nå¤ç”¨æ€§\ræ­¤è„šæœ¬ç›´æ¥æ‹¿åˆ°æ–°æœºå™¨æ‰§è¡Œï¼Œåªéœ€è¦ä¿®æ”¹ å®ä¾‹æ•°æ®æ–‡ä»¶ çš„è·¯å¾„å°±å¯ä»¥äº†ï¼Œè™½ç„¶åœ¨è„šæœ¬é‡Œå¯ä»¥å®ç°æŸ¥æ‰¾å®ä¾‹æ•°æ®æ–‡ä»¶ï¼Œè€ƒè™‘åˆ°æœ‰çš„æœåŠ¡å™¨ä¸Šæ–‡ä»¶ç‰¹åˆ«å¤šï¼Œæ¯æ¬¡æ‰§è¡Œè„šæœ¬éƒ½æŸ¥æ‰¾ä¸€éï¼Œæ•ˆç‡ä¸å¥½ï¼ˆè™½ç„¶ä¹Ÿä¸å·®è¿™å‡ ç§’ï¼‰ã€‚\næ­¤å¤–ï¼Œè¾¾æ¢¦æ•°æ®åº“çš„é…ç½®æ–‡ä»¶åç§°å…¶å®éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸éœ€è¦ä¿®æ”¹\nè„šæœ¬\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 #!/bin/bash #################################################################################################### # Author:\tWei Qi # Remark:\t1.ç³»ç»Ÿæ£€æŸ¥ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€IOã€ç½‘ç»œã€ç³»ç»Ÿæ—¶é—´ # 2.æ•°æ®åº“æœåŠ¡æ£€æŸ¥ï¼šå®ä¾‹ã€å®ˆæŠ¤ã€ç›‘è§†å™¨ # 3.å®ä¾‹æ£€æŸ¥ï¼šæ—¥å¿—ã€ä¼šè¯ # å…¨å±€å˜é‡ä½¿ç”¨ VarName æ–¹å¼å‘½åï¼Œå±€éƒ¨å˜é‡ä½¿ç”¨ var_name æ–¹å¼å‘½å # CreateDate:\t2024-07-23 # Version:\t1.0 # ModifyDate: # ModifyRemark: #################################################################################################### ###################################### å…¨å±€å˜é‡ æ‰‹åŠ¨ä¿®æ”¹ ############################################ # æœåŠ¡ã€å®ä¾‹å…¨å±€å˜é‡ # æœåŠ¡é…ç½®æ–‡ä»¶å DmIniName=\u0026#34;dm.ini\u0026#34; DmWatcherIniName=\u0026#34;dmwatcher.ini\u0026#34; DmMonitorIniName=\u0026#34;dmmonitor.ini\u0026#34; DmMalIniName=\u0026#34;dmmal.ini\u0026#34; # é…ç½®å¤‡åº“ IP PORT # TelnetIP=\u0026#34;10.xx.xx.xxx\u0026#34; # TelnetPORT=\u0026#34;5236\u0026#34; ## æŸ¥æ‰¾ æ•°æ®åº“ç”¨æˆ· çš„ä¸»ç›®å½• ## cut -d: æ˜¯æ ¹æ® : è¿›è¡Œåˆ†å‰²\t-f6 æ˜¯è¿”å›åˆ†å‰²åçš„ç¬¬6åˆ— # UserHomePath=$(getent passwd dmdba | cut -d: -f6) # æœ‰çš„å®ä¾‹æ•°æ®æ–‡ä»¶ä¸åœ¨ä¸»ç›®å½•ä¸‹ï¼Œæ‰‹åŠ¨é…ç½® UserHomePath=\u0026#34;/u01/dmdata/zgfxq\u0026#34; # å®šä¹‰å˜é‡ï¼Œå®ä¾‹é…ç½®æ–‡ä»¶è·¯å¾„ FindDmIniPath=$(find ${UserHomePath} -name ${DmIniName}) DmIniPath=${FindDmIniPath} # DmIniPath=$(find / -name \u0026#34;dm.ini\u0026#34;) # FindDmWatcherIniPath=$(find ${UserHomePath} -name ${DmWatcherIniName}) # DmWatcherIniPath=${FindDmWatcherIniPath} # FindDmMonitorIniPath=$(find ${UserHomePath} -name ${DmMonitorIniName}) # DmMonitorIniPath=${FindDmMonitorIniPath} FindDmMalIniPath=$(find ${UserHomePath} -name ${DmMalIniName}) DmMalIniPath=${FindDmMalIniPath} echo \u0026#34;DmIniPath : ${DmIniPath}\u0026#34; echo \u0026#34;DmMalIniPath : ${DmMalIniPath}\u0026#34; # å®šä¹‰è¾¾æ¢¦å„æœåŠ¡ç«¯å£å˜é‡ # grep -w ä½¿ç”¨ç²¾å‡†åŒ¹é… AllDmServicePort=$(cat \u0026#34;${DmIniPath}\u0026#34; | grep -w PORT_NUM | awk \u0026#39;{print $3}\u0026#39;)\t# æ•°æ®å®ä¾‹ç«¯å£ AllDmWatcherPort=$(cat \u0026#34;${DmMalIniPath}\u0026#34; | grep -w MAL_DW_PORT | awk \u0026#39;{print $3}\u0026#39;)\t# æ•°æ®å®ˆæŠ¤è¿›ç¨‹ç«¯å£ echo \u0026#34;AllDmServicePort : ${AllDmServicePort}\u0026#34; echo \u0026#34;AllDmWatcherPort : ${AllDmWatcherPort}\u0026#34; # è·å–å®ä¾‹åç§° DmInstanceName=$(cat \u0026#34;${DmIniPath}\u0026#34; | grep -w INSTANCE_NAME | awk \u0026#39;{print $3}\u0026#39;) # è·å–å½“å‰ IP # GetSystemIp=$(hostname -I) #################################################################################################### # å·¡æ£€å¼€å§‹ echo \u0026#34;å·¡æ£€è„šæœ¬å¼€å§‹\u0026#34; ########################################## ç³»ç»Ÿå·¡æ£€ ################################################ # ç³»ç»Ÿæ—¶é—´æ£€æŸ¥ getSystemTime() { current_time=$(date) echo \u0026#34;å½“å‰ç³»ç»Ÿæ—¶é—´: ${current_time}\u0026#34; echo \u0026#34;\u0026#34; } # å½“å‰ç³»ç»Ÿä¿¡æ¯ getOsSystem() { os_type=$(uname) os_hostname=$(hostname) os_ip=$(hostname -I | awk \u0026#39;{print $1}\u0026#39;) echo \u0026#34;å½“å‰æœºå™¨ï¼š${os_type} | ${os_hostname} | ${os_ip}\u0026#34; echo \u0026#34;\u0026#34; } # è·å–CPUä½¿ç”¨ç‡ getCpuUsage() { # ä½¿ç”¨ bn1 è·å–å›ºå®šçš„ top è¾“å‡º cpu_usage=$(top -bn1 | grep \u0026#34;Cpu(s)\u0026#34; | sed \u0026#34;s/.*, *\\([0-9.]*\\)%* id.*/\\1/\u0026#34; | awk \u0026#39;{print 100 - $1}\u0026#39;) echo \u0026#34;CPUä½¿ç”¨ç‡: ${cpu_usage}%\u0026#34; echo \u0026#34;\u0026#34; } # è·å–å†…å­˜ä½¿ç”¨ç‡ getMemUsage() { mem_total=$(free -h | grep Mem | awk \u0026#39;{print $2}\u0026#39;) mem_used=$(free -h | grep Mem | awk \u0026#39;{print $3}\u0026#39;) mem_usage=$(free -h | grep Mem | awk \u0026#39;{print$3/$2 * 100.0}\u0026#39;) echo \u0026#34;å†…å­˜æ€»é‡ï¼š${mem_total}; å†…å­˜ä½¿ç”¨ï¼š${mem_used}; å†…å­˜ä½¿ç”¨ç‡: ${mem_usage}%\u0026#34; echo \u0026#34;\u0026#34; } # è·å–ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ getDiskUsage() { echo \u0026#34;ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š\u0026#34; # è·å–æ ‡é¢˜è¡Œ # df -h | head -n 1 # æ’é™¤è¿™äº›ç›˜ï¼Œå¹¶å¾ªç¯æ‰“å°æ’é™¤åçš„æ¯ä¸€è¡Œ df -h | grep -vE \u0026#39;^Filesystem|tmpfs|cdrom\u0026#39; | while read line do echo \u0026#34;${line}\u0026#34; done echo \u0026#34;\u0026#34; } # è·å–ç£ç›˜IOç›‘æ§æ•°æ® getIoStat() { echo \u0026#34;ç£ç›˜IOæƒ…å†µ: \u0026#34; iostat # åˆ¤æ–­ iowait å€¼ iostatIowait=$(iostat | awk \u0026#39;/^avg-cpu/ {getline; print$4 * 100.0}\u0026#39;) if [[ $iostatIowait -ge 80 ]]; then echo \u0026#34;ç£ç›˜ IO ${iostatIowait}% å¤§äº 80%ï¼Œå¯èƒ½å­˜åœ¨ IO ç“¶é¢ˆ\u0026#34; else echo \u0026#34;ç£ç›˜ IO ${iostatIowait}% æ­£å¸¸\u0026#34; fi # åˆ¤æ–­ idel å€¼ iostatIdel=$(iostat | awk \u0026#39;/^avg-cpu/ {getline; print$6}\u0026#39;) # bash åªæ”¯æŒæ•´æ•°æ¯”è¾ƒ, é‡‡ç”¨ bc è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸º true, true = 1 åˆ™è¿”å› # if [[ $iostatIdel -ge 80 ]]; then if [[ $(echo \u0026#34;$iostatIdel \u0026gt;= 80\u0026#34; | bc) -eq 1 ]]; then echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºå……è¶³\u0026#34; elif [[ $(echo \u0026#34;$iostatIdel \u0026lt;= 10\u0026#34;| bc) -eq 1 ]]; then echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºç´§å¼ \u0026#34; else echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºé€‚ä¸­\u0026#34; fi echo \u0026#34;\u0026#34; } # è·å–ç½‘ç»œèµ„æºç›‘æ§æ•°æ® # getNetwork() { # echo \u0026#34;ç½‘ç»œæ¥å£æµé‡ç»Ÿè®¡(å•ä½: KB/s): \u0026#34; # sar -n DEV 1 1 | grep Average # echo \u0026#34;\u0026#34; # } ########################################## æœåŠ¡å·¡æ£€ ################################################ echo \u0026#34;æœåŠ¡æ£€æŸ¥å¼€å§‹ --------------------------- \u0026#34; # è¾¾æ¢¦æ•°æ®åº“æœåŠ¡ getDatabaseService() { dm_service=$(ps -ef | grep dmserver | grep \u0026#34;${DmIniName}\u0026#34; | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) dm_service_port=$(netstat -nltp | grep \u0026#34;${AllDmServicePort}\u0026#34; | awk \u0026#39;{print $4}\u0026#39; | cut -d: -f4) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_service}\u0026#34; ] \u0026amp;\u0026amp; [ -n \u0026#34;${dm_service_port}\u0026#34; ]; then echo \u0026#34;å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_service}, ç«¯å£ï¼š${dm_service_port} | dm æ­£å¸¸\u0026#34; else echo \u0026#34;æ²¡æœ‰æ‰¾åˆ° è¾¾æ¢¦æœåŠ¡ è¿›ç¨‹\u0026#34; fi } # è¾¾æ¢¦æ•°æ®å®ˆæŠ¤æœåŠ¡ getDatabaseWatcher() { dm_watcher=$(ps -ef | grep \u0026#34;${DmWatcherIniName}\u0026#34; | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) dm_watcher_port=$(netstat -nltp | grep \u0026#34;${AllDmWatcherPort}\u0026#34; | awk \u0026#39;{print $4}\u0026#39; | cut -d: -f4) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_watcher}\u0026#34; ] \u0026amp;\u0026amp; [ -n \u0026#34;${dm_watcher_port}\u0026#34; ]; then echo \u0026#34;å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_watcher} | dmwatcher æ­£å¸¸\u0026#34; else echo \u0026#34;æ²¡æœ‰æ‰¾åˆ° è¾¾æ¢¦æ•°æ®å®ˆæŠ¤ è¿›ç¨‹\u0026#34; fi } # è¾¾æ¢¦ç¡®è®¤ç›‘è§†å™¨æœåŠ¡ getDatabaseMonitor() { dm_monitor=$(ps -ef | grep ${DmMonitorIniName} | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_monitor}\u0026#34; ]; then echo \u0026#34;å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_monitor} | dmmonitor æ­£å¸¸\u0026#34; else echo \u0026#34;æ²¡æœ‰æ‰¾åˆ° è¾¾æ¢¦ç›‘è§†å™¨ è¿›ç¨‹\u0026#34; fi } # ä¸»å¤‡ç½‘ç»œè¿é€š # getDatabaseTelnetIpPort() { # telnet \u0026#34;${TelnetIP}\u0026#34; \u0026#34;${TelnetPORT}\u0026#34; # if [ $? -eq 0 ]; then # echo \u0026#34;è¾¾æ¢¦ç«¯å£è¿é€šæ­£å¸¸\u0026#34; # else # echo \u0026#34;è¾¾æ¢¦ç«¯å£è¿é€šå¤±è´¥ï¼ï¼ï¼\u0026#34; # fi # } ########################################## å®ä¾‹å·¡æ£€ ################################################ # æ—¥å¿—æ£€æŸ¥ # å˜é‡ # å®ä¾‹è·¯å¾„ï¼ˆç”¨æˆ·ä¸»ç›®å½•ï¼‰ DmServicePath=$(getent passwd dmdba | cut -d: -f6) # è·å–å½“å‰ç›®å½• PwdPath=$(cd \u0026#34;$(dirname \u0026#34;$0\u0026#34;)\u0026#34; || exit; pwd) echo \u0026#34;PwdPath : ${PwdPath}\u0026#34; # è·å–å½“å‰æ—¥æœŸ CurrentYearMonth=$(date +%Y%m) CurrentYearMonthDay=$(date +%Y-%m-%d) # æ£€æŸ¥ç›®å½•æ–‡ä»¶æ˜¯å¦å­˜åœ¨, ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œç”¨äºå­˜æ”¾ ErrorLog LogPathName=\u0026#34;dmErrorLog\u0026#34; LogFileName=\u0026#34;dm_error_log_$(date +%Y%m%d).log\u0026#34; # åˆ¤æ–­ç›®å½•æ–‡ä»¶ getCreateDir() { if [ ! -d \u0026#34;${PwdPath}/${LogPathName}\u0026#34; ]; then mkdir -p \u0026#34;${PwdPath}/${LogPathName}\u0026#34; echo \u0026#34;æ—¥å¿—ç›®å½•å·²åˆ›å»º\u0026#34; else echo \u0026#34;æ—¥å¿—ç›®å½•å·²å­˜åœ¨\u0026#34; fi } getCreateFile() { if [ ! -f \u0026#34;${PwdPath}/${LogPathName}/${LogFileName}\u0026#34; ]; then touch \u0026#34;${PwdPath}/${LogPathName}/${LogFileName}\u0026#34; echo \u0026#34;æ—¥å¿—æ–‡ä»¶å·²åˆ›å»º\u0026#34; else echo \u0026#34;æ—¥å¿—æ–‡ä»¶å·²å­˜åœ¨\u0026#34; fi } echo \u0026#34;å®ä¾‹æ£€æŸ¥å¼€å§‹ --------------------------- \u0026#34; # ä¼šè¯æ•°é‡ getMaxSession() { max_session=$(netstat -nat | awk \u0026#39;{print $4}\u0026#39; | grep 5236 | wc -l) # å¼•ç”¨é…ç½®æ–‡ä»¶è·¯å¾„å˜é‡ cat_dmini_max_session=$(cat ${DmIniPath} | grep MAX_SESSIONS | awk \u0026#39;{print $3}\u0026#39;) echo \u0026#34;å½“å‰ä¼šè¯æ•°é‡ï¼š${max_session}, è¾¾æ¢¦æœ€å¤§ä¼šè¯æ•°é‡ï¼š${cat_dmini_max_session}, æ´»åŠ¨ä¼šè¯å æ¯”ï¼š${max_session}/${cat_dmini_max_session}\u0026#34; echo \u0026#34;\u0026#34; } # å®ä¾‹æ—¥å¿— getDmServiceLog() { dmservice_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log/dm_${DmInstanceName}_${CurrentYearMonth}.log\u0026#34; cat_dmservice_error_log=$(cat ${dmservice_log_full_path} | grep -e \u0026#39;\\[ERROR]\u0026#39; -e \u0026#39;\\[FATAL]\u0026#39; | grep ${CurrentYearMonthDay}) if [ $? -eq 0 ]; then save_dmserver_error_log=\u0026#34;${PwdPath}/${LogPathName}/${LogFileName}\u0026#34; echo \u0026#34;${cat_dmservice_error_log}\u0026#34; \u0026gt;\u0026gt; \u0026#34;${save_dmserver_error_log}\u0026#34; if [ -s \u0026#34;${save_dmserver_error_log}\u0026#34; ]; then echo \u0026#34;è­¦å‘Šï¼šä»Šå¤© ${CurrentYearMonthDay} æ•°æ®åº“å®ä¾‹æ—¥å¿—å·²å†™å…¥\u0026#34; echo \u0026#34;================ ${CurrentYearMonthDay} : dm_${DmInstanceName}_${CurrentYearMonth}.log å†™å…¥å®Œæˆ =======================\u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} else echo \u0026#34;æ•°æ®åº“å®ä¾‹æ—¥å¿—æ— æ–°å†…å®¹\u0026#34; fi\telse echo \u0026#34;æ­£å¸¸ï¼š${CurrentYearMonthDay} æ•°æ®åº“å®ä¾‹æ—¥å¿— dm_server æ—  Error or Fatal\u0026#34; fi # echo \u0026#34;\u0026#34; } # æ•°æ®å®ˆæŠ¤æ—¥å¿— getDmWatcherLog() { dmwatcher_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log/dm_dmwatcher_${DmInstanceName}_${CurrentYearMonth}.log\u0026#34; cat_dmwatcher_error_log=$(cat ${dmwatcher_log_full_path} | grep -e \u0026#39;\\[ERROR]\u0026#39; -e \u0026#39;\\[FATAL]\u0026#39; | grep ${CurrentYearMonthDay}) # æœ‰è¾“å‡ºå†…å®¹åˆ™è¿”å›çŠ¶æ€ç  0 ï¼Œè¡¨ç¤ºæˆåŠŸåŒ¹é…åˆ°äº†ç›¸åº”çš„å†…å®¹ if [ $? -eq 0 ]; then save_dmserver_error_log=\u0026#34;${PwdPath}/${LogPathName}/${LogFileName}\u0026#34; echo \u0026#34;${cat_dmwatcher_error_log}\u0026#34; \u0026gt;\u0026gt; \u0026#34;${save_dmserver_error_log}\u0026#34; if [ -s \u0026#34;${save_dmserver_error_log}\u0026#34; ]; then echo \u0026#34;è­¦å‘Šï¼šä»Šå¤© ${CurrentYearMonthDay} æ•°æ®å®ˆæŠ¤æ—¥å¿—å·²å†™å…¥\u0026#34; echo \u0026#34;================= ${CurrentYearMonthDay} : dm_dmwatcher_${DmInstanceName}_${CurrentYearMonth}.log å†™å…¥å®Œæˆ ======================= \u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} else echo \u0026#34;æ•°æ®å®ˆæŠ¤æ—¥å¿—æ— æ–°å†…å®¹\u0026#34; fi else echo \u0026#34;æ­£å¸¸ï¼š${CurrentYearMonthDay} æ•°æ®å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— dm_watcher æ—  Error or Fatal\u0026#34; fi\t# echo \u0026#34;\u0026#34; } # ç›‘è§†å™¨ï¼ˆæ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼‰ getDmMonitorLog() { dmmonitor_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log/\u0026#34; save_dmserver_error_log=\u0026#34;${PwdPath}/${LogPathName}/${LogFileName}\u0026#34; # ls -lt æŒ‰ä¿®æ”¹æ—¶é—´ï¼Œæ­£åºæ’åºï¼Œ head -n 1 æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆæœ€æ–°æ–‡ä»¶ï¼‰ dmmonitor_log_new_head=$(ls -lt \u0026#34;${dmmonitor_log_full_path}\u0026#34; | grep dmmonitor | head -n 1 | awk \u0026#39;{print $9}\u0026#39;) # ä» dmmal.ini è·å–é›†ç¾¤å„ä¸ªèŠ‚ç‚¹IP # grep -n æ‰“å°è¡Œå·ï¼Œ -w è¾“å‡ºç›¸å…³çš„è¡Œå†…å®¹ get_dmgroup_ip_a=$(cat \u0026#34;${DmMalIniPath}\u0026#34; | grep -n MAL_INST_HOST | grep -w 8 | awk \u0026#39;{print $3}\u0026#39;) get_dmgroup_ip_b=$(cat \u0026#34;${DmMalIniPath}\u0026#34; | grep -n MAL_INST_HOST | grep -w 18 | awk \u0026#39;{print $3}\u0026#39;) # éœ€è¦ç»å¯¹è·¯å¾„ï¼Œä¸ç„¶æ‰¾ä¸åˆ°è¿™ä¸ªæ—¥å¿—å cat_dmmonit_status=$(tail -n 35 \u0026#34;${dmmonitor_log_full_path}/${dmmonitor_log_new_head}\u0026#34;) # awk ä½¿ç”¨ ip1 å’Œ ip2 å­˜å‚¨ é›†ç¾¤IP ä¿¡æ¯ï¼Œæ‰¾åˆ°ç¬¬ 5 åˆ— ISTATUS çš„å€¼ # ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼ä¼ é€’å˜é‡ç»™ awk\tã€‚ è¿™é‡Œå°†è¿™ä¸ªå˜é‡çš„è¾“å‡ºå†…å®¹ \u0026lt;\u0026lt;\u0026lt; ä¼ ç»™ awk å‘½ä»¤ check_dmmonitor_status=$(awk -v ip1=\u0026#34;${get_dmgroup_ip_a}\u0026#34; -v ip2=\u0026#34;${get_dmgroup_ip_b}\u0026#34; \u0026#39;$1 == ip1 { istatus1 = $5 }$1 == ip2 { istatus2 = $5 } END { print istatus1, istatus2 }\u0026#39; \u0026lt;\u0026lt;\u0026lt; \u0026#34;${cat_dmmonit_status}\u0026#34;) # æ£€æŸ¥ istatus1 å’Œ istatus2 çš„å€¼ if [[ $check_dmmonitor_status == *\u0026#34;OPEN\u0026#34;* ]]; then echo \u0026#34;æ­£å¸¸ï¼šé›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€ä¸º OPEN\u0026#34; else echo \u0026#34;è­¦å‘Šï¼šé›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€ä¸ä¸º OPEN\u0026#34; # å¦‚æœæœåŠ¡å¼‚å¸¸ï¼Œå°†çŠ¶æ€å†™å…¥æ—¥å¿—æ–‡ä»¶ echo \u0026#34;è­¦å‘Šï¼š${CurrentYearMonthDay} é›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€å¼‚å¸¸ -${check_dmmonitor_status}\u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} echo \u0026#34;================= ${CurrentYearMonthDay} : dmmonitor_${DmInstanceName}_${CurrentYearMonth}.log å†™å…¥å®Œæˆ ======================= \u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} fi echo \u0026#34;\u0026#34; } # ä¿å­˜å·¡æ£€æŠ¥å‘Š report_file=\u0026#34;/opt/checkDayBash/log/system_check_$(date +%Y%m%d%H%M%S).log\u0026#34; { echo \u0026#34;============================== ç³»ç»Ÿå·¡æ£€ ==============================\u0026#34; getSystemTime\t# ok getOsSystem\t# ok getCpuUsage\t# ok getMemUsage\t# ok getDiskUsage\t# ok getIoStat\t# ok # getNetwork\t# ok echo \u0026#34;\u0026#34; echo \u0026#34;=========================== æ•°æ®åº“æœåŠ¡å·¡æ£€ ===========================\u0026#34; getDatabaseService\t# ok getDatabaseWatcher\t# ok getDatabaseMonitor\t# ok # getDatabaseTelnetIpPort\t# ok echo \u0026#34;\u0026#34; echo \u0026#34;============================== å®ä¾‹å·¡æ£€ ==============================\u0026#34; getCreateDir getCreateFile echo \u0026#34;æ—¥å¿—æ£€æŸ¥: \u0026#34; echo \u0026#34;\u0026#34; getDmServiceLog\t# ok getDmWatcherLog\t# ok getDmMonitorLog # ok getMaxSession\t# ok } \u0026gt; \u0026#34;${report_file}\u0026#34; echo \u0026#34;å·¡æ£€è„šæœ¬ç»“æŸ\u0026#34; echo \u0026#34;å·¡æ£€æŠ¥å‘Šå·²ä¿å­˜è‡³ ${report_file}\u0026#34; æ•ˆæœ\ræŸ¥çœ‹å·¡æ£€æŠ¥å‘Š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 ============================== ç³»ç»Ÿå·¡æ£€ ============================== å½“å‰ç³»ç»Ÿæ—¶é—´: 2024å¹´ 07æœˆ 26æ—¥ æ˜ŸæœŸäº” 08:37:26 CST å½“å‰æœºå™¨ï¼šLinux | YD-FXQDB01-3-161 | 1X.XXX.XXX.161 CPUä½¿ç”¨ç‡: 0.2% å†…å­˜æ€»é‡ï¼š254Gi; å†…å­˜ä½¿ç”¨ï¼š37Gi; å†…å­˜ä½¿ç”¨ç‡: 14.5669% ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ /dev/mapper/klas-root 860G 107G 754G 13% / /dev/sda2 1014M 194M 821M 20% /boot /dev/sda1 511M 6.5M 505M 2% /boot/efi /dev/loop0 1.1G 1.1G 0 100% /mnt/dmrom ç£ç›˜IOæƒ…å†µ: Linux 4.19.90-24.4.v2101.ky10.aarch64 (YD-FXQDB01-3-161) 2024å¹´07æœˆ26æ—¥ _aarch64_ (64 CPU) avg-cpu: %user %nice %system %iowait %steal %idle 0.03 0.00 0.02 0.00 0.00 99.95 Device tps kB_read/s kB_wrtn/s kB_dscd/s kB_read kB_wrtn kB_dscd dm-0 6.61 0.23 369.90 0.00 863876 1365033852 0 loop0 0.00 0.46 0.00 0.00 1686907 0 0 sda 6.39 0.24 369.90 0.00 887725 1365036529 0 ç£ç›˜ IO 0% æ­£å¸¸ å½“å‰ CPU 99.95% èµ„æºå……è¶³ =========================== æ•°æ®åº“æœåŠ¡å·¡æ£€ =========================== å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2834456, ç«¯å£ï¼š5236 | dm æ­£å¸¸ å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2616858 | dmwatcher æ­£å¸¸ å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2617379 | dmmonitor æ­£å¸¸ ============================== å®ä¾‹å·¡æ£€ ============================== æ—¥å¿—ç›®å½•å·²å­˜åœ¨ æ—¥å¿—æ–‡ä»¶å·²åˆ›å»º æ—¥å¿—æ£€æŸ¥: æ­£å¸¸ï¼š2024-07-26 æ•°æ®åº“å®ä¾‹æ—¥å¿— dm_server æ—  Error or Fatal æ­£å¸¸ï¼š2024-07-26 æ•°æ®å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— dm_watcher æ—  Error or Fatal æ­£å¸¸ï¼šé›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€ä¸º OPEN å½“å‰ä¼šè¯æ•°é‡ï¼š79, è¾¾æ¢¦æœ€å¤§ä¼šè¯æ•°é‡ï¼š5000, æ´»åŠ¨ä¼šè¯å æ¯”ï¼š79/5000 è„šæœ¬ 20240911\råœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥ä¼ å…¥æ•°ç»„é‡Œçš„å˜é‡ï¼Œå®ç°å¾ªç¯çš„æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 #!/bin/bash ##################################################################################### # Author:\tWei Qi # Remark:\t1.ç³»ç»Ÿæ£€æŸ¥ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€IOã€ç½‘ç»œã€ç³»ç»Ÿæ—¶é—´ # 2.æ•°æ®åº“æœåŠ¡æ£€æŸ¥ï¼šå®ä¾‹ã€å®ˆæŠ¤ã€ç›‘è§†å™¨ # 3.å®ä¾‹æ£€æŸ¥ï¼šæ—¥å¿—ã€ä¼šè¯ # å…¨å±€å˜é‡ä½¿ç”¨ VarName æ–¹å¼å‘½åï¼Œå±€éƒ¨å˜é‡ä½¿ç”¨ var_name æ–¹å¼å‘½å # CreateDate:\t2024-07-23 # Version:\t2.0 # Modifyï¼š 2024-09-11 1.é‡‡ç”¨å¾ªç¯ä¼ å‚çš„æ–¹å¼ï¼Œå¢åŠ æ£€æŸ¥ç¬¬äºŒä¸ªæ•°æ®åº“å®ä¾‹çš„æ•°æ®åº“æœåŠ¡çŠ¶æ€ã€æ—¥å¿—ã€ä¼šè¯ # 2.ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼Œä»¥å¹´æœˆä¸ºä¸€ä¸ªç›®å½•å­˜æ”¾ ##################################################################################### ################################ å…¨å±€å˜é‡ æ‰‹åŠ¨ä¿®æ”¹ ##################################### # æ•°æ®åº“å®ä¾‹ DBInstanceName=(\u0026#34;AMOP\u0026#34; \u0026#34;zgfxq\u0026#34; ) # æ•°æ®åº“å®ä¾‹é…ç½®æ–‡ä»¶ DmIniName=\u0026#34;dm.ini\u0026#34; DmWatcherIniName=\u0026#34;dmwatcher.ini\u0026#34; DmMalIniName=\u0026#34;dmmal.ini\u0026#34; DmMonitorIniName=\u0026#34;dmmonitor.ini\u0026#34; # æ•°æ®åº“æœåŠ¡è·¯å¾„ DmServicePath=$(getent passwd dmdba | cut -d: -f6) ############################### åˆ¤æ–­ç›®å½•æ˜¯å¦åˆ›å»º ##################################### # åˆ›å»ºå­˜æ”¾æ—¥å¿—çš„æ–‡ä»¶ # è·å–å½“å‰ç›®å½• PwdPath=$(cd \u0026#34;$(dirname \u0026#34;$0\u0026#34;)\u0026#34; || exit; pwd) # è·å–å½“å‰æ—¥æœŸ CurrentYearMonth=$(date +%Y%m) CurrentYearMonthDay=$(date +%Y-%m-%d) # æ£€æŸ¥ç›®å½•æ–‡ä»¶æ˜¯å¦å­˜åœ¨, ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œç”¨äºå­˜æ”¾ ErrorLog LogPathName=\u0026#34;dmErrorLog\u0026#34; LogFileName=\u0026#34;dm_error_log_$(date +%Y%m%d).log\u0026#34; # åˆ›å»ºå­˜æ”¾è¾¾æ¢¦æ—¥å¿—çš„é”™è¯¯è¾“å‡ºæ–‡ä»¶ getCreateDirDm() { if [ ! -d \u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}\u0026#34; ]; then mkdir -p \u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}\u0026#34; echo \u0026#34;[OK] è¾¾æ¢¦æ—¥å¿—è®°å½•ç›®å½•å·²åˆ›å»º\u0026#34; else echo \u0026#34;[WARNING] è¾¾æ¢¦æ—¥å¿—è®°å½•ç›®å½•å·²åˆ›å»º\u0026#34; fi } getCreateFileDm() { if [ ! -f \u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}/${LogFileName}\u0026#34; ]; then touch \u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}/${LogFileName}\u0026#34; echo \u0026#34;[OK] è¾¾æ¢¦æ—¥å¿—æ–‡ä»¶å·²åˆ›å»º\u0026#34; else echo \u0026#34;[WARNING] è¾¾æ¢¦æ—¥å¿—æ–‡ä»¶å·²å­˜åœ¨\u0026#34; fi } # åˆ›å»ºå­˜æ”¾å·¡æ£€æ—¥å¿—çš„æ–‡ä»¶ getCreateDirLog() { if [ ! -d \u0026#34;${PwdPath}/log/${CurrentYearMonth}\u0026#34; ]; then mkdir -p \u0026#34;${PwdPath}/log/${CurrentYearMonth}\u0026#34; echo \u0026#34;[OK] å·¡æ£€æ—¥å¿—ç›®å½•å·²åˆ›å»º\u0026#34; else echo \u0026#34;[WARNING] å·¡æ£€æ—¥å¿—ç›®å½•å·²å­˜åœ¨\u0026#34; fi } #################################### æœåŠ¡å·¡æ£€ ######################################### # è¾¾æ¢¦æ•°æ®åº“æœåŠ¡ getDatabaseService() { local service=$1 local service_port=$2 dm_service=$(ps -ef | grep ${service} | grep \u0026#34;${DmIniName}\u0026#34; | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) dm_service_port=$(netstat -nltp | grep \u0026#34;${service_port}\u0026#34; | awk \u0026#39;{print $4}\u0026#39; | cut -d: -f4) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_service}\u0026#34; ] \u0026amp;\u0026amp; [ -n \u0026#34;${dm_service_port}\u0026#34; ]; then echo \u0026#34;[OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_service}, ç«¯å£ï¼š${dm_service_port} | dm æ­£å¸¸\u0026#34; else echo \u0026#34;[WARNING] æ²¡æœ‰æ‰¾åˆ°è¾¾æ¢¦æœåŠ¡è¿›ç¨‹\u0026#34; fi } # è¾¾æ¢¦æ•°æ®å®ˆæŠ¤æœåŠ¡ getDatabaseWatcher() { local service=$1 local service_port=$2 dm_watcher=$(ps -ef | grep ${service} | grep \u0026#34;${DmWatcherIniName}\u0026#34; | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) dm_watcher_port=$(netstat -nltp | grep \u0026#34;${service_port}\u0026#34; | awk \u0026#39;{print $4}\u0026#39; | cut -d: -f4) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_watcher}\u0026#34; ] \u0026amp;\u0026amp; [ -n \u0026#34;${dm_watcher_port}\u0026#34; ]; then echo \u0026#34;[OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_watcher} | dmwatcher æ­£å¸¸\u0026#34; else echo \u0026#34;[WARNING] æ²¡æœ‰æ‰¾åˆ°è¾¾æ¢¦æ•°æ®å®ˆæŠ¤è¿›ç¨‹\u0026#34; fi } # è¾¾æ¢¦ç¡®è®¤ç›‘è§†å™¨æœåŠ¡ getDatabaseMonitor() { local service=$1 # æ£€æŸ¥è¾¾æ¢¦ç¡®è®¤ç›‘è§†å™¨è¿›ç¨‹ dm_monitor=$(ps -ef | grep ${service} | grep ${DmMonitorIniName} | grep -v grep | awk \u0026#39;{print $1,$2}\u0026#39;) # æ£€æŸ¥å˜é‡æ˜¯å¦éç©º if [ -n \u0026#34;${dm_monitor}\u0026#34; ]; then echo \u0026#34;[OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : ${dm_monitor} | dmmonitor æ­£å¸¸\u0026#34; else echo \u0026#34;[WARNING] æ²¡æœ‰æ‰¾åˆ°è¾¾æ¢¦ç›‘è§†å™¨è¿›ç¨‹\u0026#34; fi } #################################### å®ä¾‹å·¡æ£€ ######################################### # ä¼šè¯æ•°é‡ getMaxSession() { local DBServicePort=$1 max_session=$(netstat -nat | awk \u0026#39;{print $4}\u0026#39; | grep \u0026#34;${DBServicePort}\u0026#34; | wc -l) # å¼•ç”¨é…ç½®æ–‡ä»¶è·¯å¾„å˜é‡ cat_dmini_max_session=$(cat \u0026#34;${DBInstanceNameProfilePath}/${DmIniName}\u0026#34; | grep MAX_SESSIONS | awk \u0026#39;{print $3}\u0026#39;) echo \u0026#34;å½“å‰ä¼šè¯æ•°é‡ï¼š${max_session}, è¾¾æ¢¦æœ€å¤§ä¼šè¯æ•°é‡ï¼š${cat_dmini_max_session}, æ´»åŠ¨ä¼šè¯å æ¯”ï¼š${max_session}/${cat_dmini_max_session}\u0026#34; echo \u0026#34;\u0026#34; } # å®ä¾‹æ—¥å¿— getDmServiceLog() { local DBInstanceName=$1 dmservice_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log/dm_${DBInstanceName}_${CurrentYearMonth}.log\u0026#34; cat_dmservice_error_log=$(cat ${dmservice_log_full_path} | grep -e \u0026#39;\\[ERROR]\u0026#39; -e \u0026#39;\\[FATAL]\u0026#39; | grep ${CurrentYearMonthDay}) if [ $? -eq 0 ]; then save_dmserver_error_log=\u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}/${LogFileName}\u0026#34; echo \u0026#34;${cat_dmservice_error_log}\u0026#34; \u0026gt;\u0026gt; \u0026#34;${save_dmserver_error_log}\u0026#34; if [ -s \u0026#34;${save_dmserver_error_log}\u0026#34; ]; then echo \u0026#34;[WARNING] ä»Šå¤© ${CurrentYearMonthDay} æ•°æ®åº“å®ä¾‹æ—¥å¿—å·²å†™å…¥\u0026#34; echo \u0026#34;================ ${CurrentYearMonthDay} : dm_${DBInstanceName}_${CurrentYearMonth}.log å†™å…¥å®Œæˆ =======================\u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} else echo \u0026#34;æ•°æ®åº“å®ä¾‹æ—¥å¿—æ— æ–°å†…å®¹\u0026#34; fi\telse echo \u0026#34;[OK] ${CurrentYearMonthDay} æ•°æ®åº“å®ä¾‹æ—¥å¿— dm_server æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: ${dmservice_log_full_path}\u0026#34; fi # echo \u0026#34;\u0026#34; } # æ•°æ®å®ˆæŠ¤æ—¥å¿— getDmWatcherLog() { local DBInstanceName=$1 dmwatcher_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log/dm_dmwatcher_${DBInstanceName}_${CurrentYearMonth}.log\u0026#34; cat_dmwatcher_error_log=$(cat ${dmwatcher_log_full_path} | grep -e \u0026#39;\\[ERROR]\u0026#39; -e \u0026#39;\\[FATAL]\u0026#39; | grep ${CurrentYearMonthDay}) # æœ‰è¾“å‡ºå†…å®¹åˆ™è¿”å›çŠ¶æ€ç  0 ï¼Œè¡¨ç¤ºæˆåŠŸåŒ¹é…åˆ°äº†ç›¸åº”çš„å†…å®¹ if [ $? -eq 0 ]; then save_dmserver_error_log=\u0026#34;${PwdPath}/${LogPathName}/${CurrentYearMonth}/${LogFileName}\u0026#34; echo \u0026#34;${cat_dmwatcher_error_log}\u0026#34; \u0026gt;\u0026gt; \u0026#34;${save_dmserver_error_log}\u0026#34; if [ -s \u0026#34;${save_dmserver_error_log}\u0026#34; ]; then echo \u0026#34;[WARNING] ä»Šå¤© ${CurrentYearMonthDay} æ•°æ®å®ˆæŠ¤æ—¥å¿—å·²å†™å…¥\u0026#34; echo \u0026#34;================= ${CurrentYearMonthDay} : dm_dmwatcher_${DBInstanceName}_${CurrentYearMonth}.log å†™å…¥å®Œæˆ ======================= \u0026#34; \u0026gt;\u0026gt; ${save_dmserver_error_log} else echo \u0026#34;æ•°æ®å®ˆæŠ¤æ—¥å¿—æ— æ–°å†…å®¹\u0026#34; fi else echo \u0026#34;[OK] ${CurrentYearMonthDay} æ•°æ®å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— dm_watcher æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: ${dmwatcher_log_full_path}\u0026#34; fi\t# echo \u0026#34;\u0026#34; } # ç›‘è§†å™¨ï¼ˆæ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼‰ getDmMonitorLog() { dmmonitor_log_full_path=\u0026#34;${DmServicePath}/dmdbms/log\u0026#34; # ls -lt æŒ‰ä¿®æ”¹æ—¶é—´ï¼Œæ­£åºæ’åºï¼Œ head -n 1 æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆæœ€æ–°æ–‡ä»¶ï¼‰ dmmonitor_log_new_head=$(ls -lt \u0026#34;${dmmonitor_log_full_path}\u0026#34; | grep dmmonitor | head -n 1 | awk \u0026#39;{print $9}\u0026#39;) # ä» dmmal.ini è·å–é›†ç¾¤å„ä¸ªèŠ‚ç‚¹IP # grep -n æ‰“å°è¡Œå·ï¼Œ -w è¾“å‡ºç›¸å…³çš„è¡Œå†…å®¹ get_dmgroup_ip_a=$(cat \u0026#34;${DBInstanceNameProfilePath}${DmMalIniName}\u0026#34; | grep -n MAL_INST_HOST | grep -w 8 | awk \u0026#39;{print $3}\u0026#39;) get_dmgroup_ip_b=$(cat \u0026#34;${DBInstanceNameProfilePath}${DmMalIniName}\u0026#34; | grep -n MAL_INST_HOST | grep -w 18 | awk \u0026#39;{print $3}\u0026#39;) # éœ€è¦ç»å¯¹è·¯å¾„ï¼Œä¸ç„¶æ‰¾ä¸åˆ°è¿™ä¸ªæ—¥å¿—å cat_dmmonit_status=$(tail -n 35 \u0026#34;${dmmonitor_log_full_path}/${dmmonitor_log_new_head}\u0026#34;) # awk ä½¿ç”¨ ip1 å’Œ ip2 å­˜å‚¨ é›†ç¾¤IP ä¿¡æ¯ï¼Œæ‰¾åˆ°ç¬¬ 5 åˆ— ISTATUS çš„å€¼ # ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼ä¼ é€’å˜é‡ç»™ awk\tã€‚ è¿™é‡Œå°†è¿™ä¸ªå˜é‡çš„è¾“å‡ºå†…å®¹ \u0026lt;\u0026lt;\u0026lt; ä¼ ç»™ awk å‘½ä»¤ check_dmmonitor_status=$(awk -v ip1=\u0026#34;${get_dmgroup_ip_a}\u0026#34; -v ip2=\u0026#34;${get_dmgroup_ip_b}\u0026#34; \u0026#39;$1 == ip1 { istatus1 = $5 }$1 == ip2 { istatus2 = $5 } END { print istatus1, istatus2 }\u0026#39; \u0026lt;\u0026lt;\u0026lt; \u0026#34;${cat_dmmonit_status}\u0026#34;) # æ£€æŸ¥ istatus1 å’Œ istatus2 çš„å€¼ if [[ $check_dmmonitor_status == *\u0026#34;OPEN\u0026#34;* ]]; then echo \u0026#34;[OK] é›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€ä¸º OPEN\u0026#34; else echo \u0026#34;[WARNING] é›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€: é OPEN çŠ¶æ€\u0026#34; fi echo \u0026#34;\u0026#34; } #################################### ç³»ç»Ÿå·¡æ£€ ######################################## # ç³»ç»Ÿæ—¶é—´æ£€æŸ¥ getSystemTime() { current_time=$(date) echo \u0026#34;å½“å‰ç³»ç»Ÿæ—¶é—´: ${current_time}\u0026#34; echo \u0026#34;\u0026#34; } # å½“å‰ç³»ç»Ÿä¿¡æ¯ getOsSystem() { os_type=$(uname) os_hostname=$(hostname) os_ip=$(hostname -I | awk \u0026#39;{print $1}\u0026#39;) echo \u0026#34;å½“å‰æœºå™¨ï¼š${os_type} | ${os_hostname} | ${os_ip}\u0026#34; echo \u0026#34;\u0026#34; } # è·å–CPUä½¿ç”¨ç‡ getCpuUsage() { # ä½¿ç”¨ bn1 è·å–å›ºå®šçš„ top è¾“å‡º cpu_usage=$(top -bn1 | grep \u0026#34;Cpu(s)\u0026#34; | sed \u0026#34;s/.*, *\\([0-9.]*\\)%* id.*/\\1/\u0026#34; | awk \u0026#39;{print 100 - $1}\u0026#39;) echo \u0026#34;CPUä½¿ç”¨ç‡: ${cpu_usage}%\u0026#34; echo \u0026#34;\u0026#34; } # è·å–å†…å­˜ä½¿ç”¨ç‡ getMemUsage() { mem_total=$(free -h | grep Mem | awk \u0026#39;{print $2}\u0026#39;) mem_used=$(free -h | grep Mem | awk \u0026#39;{print $3}\u0026#39;) mem_usage=$(free -h | grep Mem | awk \u0026#39;{print$3/$2 * 100.0}\u0026#39;) echo \u0026#34;å†…å­˜æ€»é‡ï¼š${mem_total}; å†…å­˜ä½¿ç”¨ï¼š${mem_used}; å†…å­˜ä½¿ç”¨ç‡: ${mem_usage}%\u0026#34; echo \u0026#34;\u0026#34; } # è·å–ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ getDiskUsage() { echo \u0026#34;ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š\u0026#34; # è·å–æ ‡é¢˜è¡Œ # df -h | head -n 1 # æ’é™¤è¿™äº›ç›˜ï¼Œå¹¶å¾ªç¯æ‰“å°æ’é™¤åçš„æ¯ä¸€è¡Œ df -h | grep -vE \u0026#39;^Filesystem|tmpfs|cdrom\u0026#39; | while read line do echo \u0026#34;${line}\u0026#34; done echo \u0026#34;\u0026#34; } # è·å–ç£ç›˜IOç›‘æ§æ•°æ® getIoStat() { echo \u0026#34;ç£ç›˜IOæƒ…å†µ: \u0026#34; iostat # åˆ¤æ–­ iowait å€¼ iostatIowait=$(iostat | awk \u0026#39;/^avg-cpu/ {getline; print$4 * 100.0}\u0026#39;) if [[ $iostatIowait -ge 80 ]]; then echo \u0026#34;ç£ç›˜ IO ${iostatIowait}% å¤§äº 80%ï¼Œå¯èƒ½å­˜åœ¨ IO ç“¶é¢ˆ\u0026#34; else echo \u0026#34;ç£ç›˜ IO ${iostatIowait}% æ­£å¸¸\u0026#34; fi # åˆ¤æ–­ idel å€¼ iostatIdel=$(iostat | awk \u0026#39;/^avg-cpu/ {getline; print$6}\u0026#39;) # bash åªæ”¯æŒæ•´æ•°æ¯”è¾ƒ, é‡‡ç”¨ bc è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸º true, true = 1 åˆ™è¿”å› # if [[ $iostatIdel -ge 80 ]]; then if [[ $(echo \u0026#34;$iostatIdel \u0026gt;= 80\u0026#34; | bc) -eq 1 ]]; then echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºå……è¶³\u0026#34; elif [[ $(echo \u0026#34;$iostatIdel \u0026lt;= 10\u0026#34;| bc) -eq 1 ]]; then echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºç´§å¼ \u0026#34; else echo \u0026#34;å½“å‰ CPU ${iostatIdel}% èµ„æºé€‚ä¸­\u0026#34; fi echo \u0026#34;\u0026#34; } #################################### è„šæœ¬è¿è¡Œ ######################################### echo \u0026#34;è„šæœ¬å¼€å§‹ $(date +%Y-%m-%d_%H:%M:%S)\u0026#34; getCreateDirDm getCreateFileDm getCreateDirLog report_file=\u0026#34;/opt/checkDayBash/log/${CurrentYearMonth}/system_check_$(date +%Y%m%d_%H%M%S).log\u0026#34; { echo \u0026#34;============================== ç³»ç»Ÿå·¡æ£€ ==============================\u0026#34; getSystemTime getOsSystem getCpuUsage getMemUsage getDiskUsage getIoStat echo \u0026#34;============================== æ•°æ®åº“å·¡æ£€ ==============================\u0026#34; for service in \u0026#34;${DBInstanceName[@]}\u0026#34;; do # å½“å‰å®ä¾‹å echo \u0026#34;å½“å‰å®ä¾‹å ${service}: \u0026#34; \u0026gt;\u0026gt; \u0026#34;${report_file}\u0026#34; # å®ä¾‹é…ç½®æ–‡ä»¶è·¯å¾„ DBInstanceNameProfilePath=$(ps -ef | grep dmserver | grep \u0026#34;${service}\u0026#34; | grep -v grep | awk \u0026#39;{print $9}\u0026#39; | cut -d= -f2 | sed \u0026#39;s/\\dm.ini//\u0026#39;) # æ•°æ®åº“å®ä¾‹ç«¯å£ DBServicePort=$(cat \u0026#34;${DBInstanceNameProfilePath}${DmIniName}\u0026#34; | grep -w PORT_NUM | awk \u0026#39;{print $3}\u0026#39;) DBWatcherPort=$(cat \u0026#34;${DBInstanceNameProfilePath}${DmMalIniName}\u0026#34; | grep -w MAL_DW_PORT | awk \u0026#39;{print $3}\u0026#39;) # echo \u0026#34;æ•°æ®åº“å®ä¾‹ç«¯å£ï¼š${DBServicePort}\u0026#34; # echo \u0026#34;å®ˆæŠ¤ç«¯å£ï¼š${DBWatcherPort}\u0026#34; echo \u0026#34;# æœåŠ¡å·¡æ£€\u0026#34; getDatabaseService \u0026#34;${service}\u0026#34; \u0026#34;${DBServicePort}\u0026#34; getDatabaseWatcher \u0026#34;${service}\u0026#34; \u0026#34;${DBWatcherPort}\u0026#34; getDatabaseMonitor \u0026#34;${service}\u0026#34; echo \u0026#34;# å®ä¾‹å·¡æ£€\u0026#34; getMaxSession \u0026#34;${DBServicePort}\u0026#34; getDmServiceLog \u0026#34;${service}\u0026#34; getDmWatcherLog \u0026#34;${service}\u0026#34; getDmMonitorLog done } \u0026gt;\u0026gt; \u0026#34;${report_file}\u0026#34; echo \u0026#34;è„šæœ¬ç»“æŸ $(date +%Y-%m-%d_%H:%M:%S)\u0026#34; æ•ˆæœ\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 [root@YD-FXQDB01-3-161 202409]# cat system_check_20240913_090114.log ============================== ç³»ç»Ÿå·¡æ£€ ============================== å½“å‰ç³»ç»Ÿæ—¶é—´: 2024å¹´ 09æœˆ 13æ—¥ æ˜ŸæœŸäº” 09:01:14 CST å½“å‰æœºå™¨ï¼šLinux | YD-FXQDB01-3-161 | 1XX.XXX.XXX.161 CPUä½¿ç”¨ç‡: 0.2% å†…å­˜æ€»é‡ï¼š254Gi; å†…å­˜ä½¿ç”¨ï¼š49Gi; å†…å­˜ä½¿ç”¨ç‡: 19.2913% ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ /dev/mapper/klas-root 860G 127G 733G 15% / /dev/sda2 1014M 194M 821M 20% /boot /dev/sda1 511M 6.5M 505M 2% /boot/efi /dev/loop0 1.1G 1.1G 0 100% /mnt/dmrom ç£ç›˜IOæƒ…å†µ: Linux 4.19.90-24.4.v2101.ky10.aarch64 (YD-FXQDB01-3-161) 2024å¹´09æœˆ13æ—¥ _aarch64_ (64 CPU) avg-cpu: %user %nice %system %iowait %steal %idle 0.05 0.00 0.02 0.00 0.00 99.93 Device tps kB_read/s kB_wrtn/s kB_dscd/s kB_read kB_wrtn kB_dscd dm-0 8.32 0.11 501.58 0.00 868852 3975183572 0 loop0 0.00 0.21 0.00 0.00 1686907 0 0 sda 8.12 0.11 501.58 0.00 892701 3975186249 0 ç£ç›˜ IO 0% æ­£å¸¸ å½“å‰ CPU 99.93% èµ„æºå……è¶³ ============================== æ•°æ®åº“å·¡æ£€ ============================== å½“å‰å®ä¾‹å AMOP: # æœåŠ¡å·¡æ£€ [OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2750927, ç«¯å£ï¼š5237 | dm æ­£å¸¸ [WARNING] æ²¡æœ‰æ‰¾åˆ°è¾¾æ¢¦æ•°æ®å®ˆæŠ¤è¿›ç¨‹ [WARNING] æ²¡æœ‰æ‰¾åˆ°è¾¾æ¢¦ç›‘è§†å™¨è¿›ç¨‹ # å®ä¾‹å·¡æ£€ å½“å‰ä¼šè¯æ•°é‡ï¼š128, è¾¾æ¢¦æœ€å¤§ä¼šè¯æ•°é‡ï¼š10000, æ´»åŠ¨ä¼šè¯å æ¯”ï¼š128/10000 [OK] 2024-09-13 æ•°æ®åº“å®ä¾‹æ—¥å¿— dm_server æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: /home/dmdba/dmdbms/log/dm_AMOP_202409.log [OK] 2024-09-13 æ•°æ®å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— dm_watcher æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: /home/dmdba/dmdbms/log/dm_dmwatcher_AMOP_202409.log [WARNING] é›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€: é OPEN çŠ¶æ€ å½“å‰å®ä¾‹å zgfxq: # æœåŠ¡å·¡æ£€ [OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2834456, ç«¯å£ï¼š5236 | dm æ­£å¸¸ [OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2616858 | dmwatcher æ­£å¸¸ [OK] å½“å‰ç”¨æˆ·ã€è¿›ç¨‹ PID : dmdba 2617379 | dmmonitor æ­£å¸¸ # å®ä¾‹å·¡æ£€ å½“å‰ä¼šè¯æ•°é‡ï¼š110, è¾¾æ¢¦æœ€å¤§ä¼šè¯æ•°é‡ï¼š5000, æ´»åŠ¨ä¼šè¯å æ¯”ï¼š110/5000 [OK] 2024-09-13 æ•°æ®åº“å®ä¾‹æ—¥å¿— dm_server æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: /home/dmdba/dmdbms/log/dm_zgfxq_202409.log [OK] 2024-09-13 æ•°æ®å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— dm_watcher æ—  Error or Fatal. æ‰«ææ—¥å¿—æ–‡ä»¶: /home/dmdba/dmdbms/log/dm_dmwatcher_zgfxq_202409.log [OK] é›†ç¾¤èŠ‚ç‚¹æœåŠ¡çŠ¶æ€ä¸º OPEN ","date":"2024-07-23T10:02:49+08:00","permalink":"http://localhost:1313/posts/2024/07/shell-%E7%9B%91%E6%8E%A7%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81/","title":"Shell ç›‘æ§è¾¾æ¢¦æ•°æ®åº“æœåŠ¡ã€æ—¥å¿—å¥åº·çŠ¶æ€"},{"content":"â€‹\næŒ‚è½½ windows å…±äº«ç›®å½•\råœ¨ windows æœåŠ¡å™¨é‡Œé€‰æ‹©éœ€è¦å…±äº«çš„æ–‡ä»¶å¤¹ï¼Œå³é”® - å±æ€§ - å…±äº«ï¼ˆéœ€å¼€å¯ç½‘ç»œå…±äº«ï¼‰\nåœ¨ Linux æœåŠ¡å™¨è¿›è¡ŒæŒ‚è½½æ“ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç›®å½• mkdir /home/aml # æŒ‚è½½ - æ–¹å¼ä¸€ mount -t cifs -o username=@user, password=@password //IP/share_dir /home/aml # æŒ‚è½½ - æ–¹å¼äºŒ mount -t cifs -v -o credentials=/var/pwd //IP/d/data/output /home/aml/ Password for gmjjb,password=sxzq@123@//10.xxx.xxx.65/d/data/output: ******** # éªŒè¯ df -h # è‡ªåŠ¨æŒ‚è½½ vi /etc/fstab # åŠ å…¥ä»¥ä¸‹å†…å®¹ //IP/share_dir /home/aml cifs username=@user, password=@password 0 0 # æˆ–è€… //IP/share_dir /home/aml cifs credentials=/var/pwd 0 0 # ç„¶åç»™ç›®å½•è¯»å–çš„æƒé™ # chown -R aml:aml /home/aml chmod -R 444 /home/aml ä¸€èˆ¬å‘è¡Œç‰ˆLinuxéƒ½é»˜è®¤è£…äº† cifs æˆ–è€… samba ï¼Œå¯ä»¥è¿™ä¹ˆæŸ¥ï¼š\n1 2 3 4 5 [root@FXQ-YWYY-57-81 ~]# rpm -qa | grep samba samba-common-4.11.12-3.p01.ky10.aarch64 samba-client-4.11.12-3.p01.ky10.aarch64 [root@FXQ-YWYY-57-81 ~]# rpm -qa | grep cifs cifs-utils-6.10-0.ky10.aarch64 å¸è½½å…±äº«ç›®å½•\numount /home/aml\næŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿ\r1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºä¸€ä¸ªå…±äº«ç›®å½• mkdir /mnt/nfs # æŒ‚è½½ mount -t nfs ip:/path/to/share /mnt/nfs # éªŒè¯ df -h # è‡ªåŠ¨æŒ‚è½½ ip:/path/to/share /mnt/nfs nfs defaults 0 0 # å¸è½½ umount /mnt/nfs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 [root@kylinV10arm162 ~]# mount -t cifs -o username=gmjjb,password=sxzq@123,vers=2.0 //10.xxx.xxx.65/d/data/output /home/aml/99 mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) [root@kylinV10arm162 ~]# dmesg | grep mount [ 3.424827] XFS (dm-0): Ending clean mount [ 5.906981] audit: type=1130 audit(1717645025.410:51): pid=1 uid=0 auid=4294967295 ses=4294967295 msg=\u0026#39;unit=systemd-remount-fs comm=\u0026#34;systemd\u0026#34; exe=\u0026#34;/usr/lib/systemd/systemd\u0026#34; hostname=? addr=? terminal=? res=success\u0026#39; [ 6.702559] XFS (vda2): Ending clean mount [2777460.243716] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2778936.002401] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. Invalid argument sudo mount -t cifs -v -o \u0026#39;username=gmjjb,password=sxzq@123,vers=2.0\u0026#39; //10.xxx.xxx.65/d/data/output /home/aml/99/ mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d,vers=2.0,user=gmjjb,prefixpath=data/output,pass=******** mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) # æŸ¥çœ‹å†…æ ¸æ—¥å¿— [root@kylinV10arm162 ~]# sudo mount -t cifs -v -o \u0026#39;username=gmjjb,password=sxzq@123,vers=1.0\u0026#39; //10.xxx.xxx.65/d/data/output /home/aml/99/ mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d,vers=1.0,user=gmjjb,prefixpath=data/output,pass=******** mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) [root@kylinV10arm162 ~]# dmesg | grep mount [ 3.424827] XFS (dm-0): Ending clean mount [ 5.906981] audit: type=1130 audit(1717645025.410:51): pid=1 uid=0 auid=4294967295 ses=4294967295 msg=\u0026#39;unit=systemd-remount-fs comm=\u0026#34;systemd\u0026#34; exe=\u0026#34;/usr/lib/systemd/systemd\u0026#34; hostname=? addr=? terminal=? res=success\u0026#39; [ 6.702559] XFS (vda2): Ending clean mount [2777460.243716] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2778936.002401] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2781999.432132] CIFS: Unknown mount option \u0026#34;passowrd=sxzq@123\u0026#34; [root@kylinV10arm162 ~]# # [root@kylinV10arm162 ~]# mount -t cifs -v -o credentials=/var/pwd.txt //10.xxx.xxx.65/d/data/output /home/aml/99/ Password for gmjjb,password=sxzq@123@//10.xxx.xxx.65/d/data/output: ******** mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d,user=gmjjb,password=sxzq@123,prefixpath=data/output,pass=******** mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) [root@kylinV10arm162 ~]# dmesg | grep mount [ 3.424827] XFS (dm-0): Ending clean mount [ 5.906981] audit: type=1130 audit(1717645025.410:51): pid=1 uid=0 auid=4294967295 ses=4294967295 msg=\u0026#39;unit=systemd-remount-fs comm=\u0026#34;systemd\u0026#34; exe=\u0026#34;/usr/lib/systemd/systemd\u0026#34; hostname=? addr=? terminal=? res=success\u0026#39; [ 6.702559] XFS (vda2): Ending clean mount [2777460.243716] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2778936.002401] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2781999.432132] CIFS: Unknown mount option \u0026#34;passowrd=sxzq@123\u0026#34; [2783009.282175] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2783282.433585] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2783470.189648] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [root@kylinV10arm162 ~]# # [root@kylinV10arm162 ~]# vi /etc/samba/smb.conf # global åŠ å…¥ client min protocol = CORE client max protocol = SMB3 [root@kylinV10arm162 ~]# smbclient -L //10.xxx.xxx.65/ do_connect: Connection to 10.xxx.xxx.65 failed (Error NT_STATUS_IO_TIMEOUT) [root@kylinV10arm162 ~]# ping 10.xxx.xxx.65 PING 10.xxx.xxx.65 (10.xxx.xxx.65) 56(84) bytes of data. 64 bytes from 10.xxx.xxx.65: icmp_seq=1 ttl=125 time=1.77 ms 64 bytes from 10.xxx.xxx.65: icmp_seq=2 ttl=125 time=1.11 ms 64 bytes from 10.xxx.xxx.65: icmp_seq=3 ttl=125 time=0.870 ms 64 bytes from 10.xxx.xxx.65: icmp_seq=4 ttl=125 time=0.906 ms 64 bytes from 10.xxx.xxx.65: icmp_seq=5 ttl=125 time=0.897 ms ^C --- 10.xxx.xxx.65 ping statistics --- 5 packets transmitted, 5 received, 0% packet loss, time 4111ms rtt min/avg/max/mdev = 0.870/1.109/1.765/0.338 ms [root@kylinV10arm162 ~]# ç”Ÿäº§å®è·µ-æŒ‚è½½ windows å…±äº«ç›®å½•\rå› ä¸ºå¯†ç ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦ @ ï¼Œæ‰€ä»¥å»ºç«‹äº†ä¸€ä¸ªå­˜æ”¾ Windows å…±äº«ç›®å½•çš„ç”¨æˆ·å¯†ç çš„æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤ä¸­ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [root@kylinV10arm162 mnt]# cat /var/pwd user=gmjjb pass=sxzq@123 vers=1.0 [root@kylinV10arm162 mnt]# mount -t cifs -v -o credentials=/var/pwd //10.xxx.xxx.195/d/data/output /mnt/B9/ Credential formatted incorrectly: 1.0 mount.cifs kernel mount options: ip=10.xxx.xxx.195,unc=\\\\10.xxx.xxx.195\\d,user=gmjjb,prefixpath=data/output,pass=******** [root@kylinV10arm162 mnt]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 32G 0 32G 0% /dev tmpfs 32G 192K 32G 1% /dev/shm tmpfs 32G 1.5G 30G 5% /run tmpfs 32G 0 32G 0% /sys/fs/cgroup /dev/mapper/klas-root 483G 38G 446G 8% / tmpfs 32G 2.1M 32G 1% /tmp /dev/vda2 1014M 222M 793M 22% /boot /dev/vda1 599M 6.5M 593M 2% /boot/efi tmpfs 6.3G 0 6.3G 0% /run/user/993 tmpfs 6.3G 0 6.3G 0% /run/user/0 //10.xxx.xxx.195/d/data/output 500G 392G 109G 79% /mnt/B9\t# å·²ç»æŒ‚è½½å¥½äº† ç„¶ååˆ° /mnt/B9 ç›®å½•ä¸‹æŸ¥çœ‹å°±è¡Œäº†\nå¸è½½å…±äº«ç›®å½•\n1 umount /home/aml å¼ºåˆ¶å–æ¶ˆæŒ‚è½½æ—¶å‡ºç° Busy é—®é¢˜\ræˆ‘ä½¿ç”¨ umount -f /home/aml/B9 åï¼ŒB9ç›®å½•å°±å˜æˆäº†è¿™æ ·ï¼š\n1 2 3 4 5 6 7 8 d????????? ? ? ? ? ? B9 [root@kylinV10arm162 aml]# ll ls: cannot access \u0026#39;B9\u0026#39;: No such device total 8 drwxr-xr-x 2 root root 4096 Jul 12 10:10 3K drwxr-xr-x 2 root root 4096 Jul 12 10:12 99 d????????? ? ? ? ? ? B9 å¯¹è¿™å—ç›˜è¿›è¡Œé‡æ–°å–æ¶ˆæŒ‚è½½å³å¯\n1 [root@kylinV10arm162 aml]# umount -l B9 æŠ¥é”™ Operation now in progress\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 [root@kylinV10arm162 ~]# mount -t cifs -o username=gmjjb,password=sxzq@123,vers=1.0 //10.xxx.xxx.65/d/data/output /home/aml/99 mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) [root@kylinV10arm162 ~]# dmesg | grep mount [ 3.424827] XFS (dm-0): Ending clean mount [ 5.906981] audit: type=1130 audit(1717645025.410:51): pid=1 uid=0 auid=4294967295 ses=4294967295 msg=\u0026#39;unit=systemd-remount-fs comm=\u0026#34;systemd\u0026#34; exe=\u0026#34;/usr/lib/systemd/systemd\u0026#34; hostname=? addr=? terminal=? res=success\u0026#39; [ 6.702559] XFS (vda2): Ending clean mount [2777460.243716] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. [2778936.002401] No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3 (or SMB2.1) specify vers=1.0 on mount. # ä½¿ç”¨æ–‡ä»¶çš„å½¢å¼ä¹Ÿæ˜¯æŠ¥é”™ vi /var/pwd # åŠ å…¥ user=\u0026lt;username\u0026gt; pass=\u0026lt;password\u0026gt; vers=1.0 chown root:root /var/pwd chmod 600 /etc/pwd [root@kylinV10arm162 ~]# mount -t cifs -v -o credentials=/var/pwd //10.xxx.xxx.65/d/data/output /home/aml/99/ Password for gmjjb,password=sxzq@123@//10.xxx.xxx.65/d/data/output: ******** mount error(115): Operation now in progress Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) ping ipèƒ½é€šï¼Œä½†telnet ip 445ä¹Ÿä¸é€šï¼Œæ•…è¯¥æœåŠ¡å™¨è®¿é—®WindowsæœåŠ¡å™¨çš„å…±äº«ç›®å½•ç«¯å£æ˜¯ä¸é€šçš„ï¼Œéœ€è¦åœ¨é˜²ç«å¢™ä¸Šå¼€å¯ç«¯å£ï¼Œéœ€è¦è´Ÿè´£ç®¡ç†ç½‘ç»œè¿™å—çš„å»å¼€é€šã€‚\næŒ‚è½½å¦ä¸€å°æŠ¥é”™æ’æŸ¥åŠè§£å†³\rPermission denied\r1 2 3 4 [root@kylinV10arm162 ~]# mount -t cifs -v -o \u0026#39;username=gmjjb,password=sxzq@123,sec=ntlmssp,vers=1.0\u0026#39; //10.xxx.xxx.65/d/data/output /mnt/99/ mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d,sec=ntlmssp,vers=1.0,user=gmjjb,prefixpath=data/output,pass=******** mount error(13): Permission denied Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) ç«¯å£ 445 æ˜¯é€šçš„ å…±äº«è·¯å¾„ç¡®è®¤è¿‡æ˜¯æ­£ç¡®çš„ d/data/output ç”¨æˆ·å¯†ç ï¼Œä»¥åŠè¿™ä¸ªç”¨æˆ·èƒ½å¦è®¿é—®åˆ°ï¼Ÿç”¨æˆ·é”™äº† No such file or directory\ræ˜¯å› ä¸ºæ‰¾ä¸åˆ°å…±äº«çš„ç£ç›˜\nç¡®è®¤å…±äº«ç›®å½•æ˜¯ä»€ä¹ˆç›˜ï¼Œè¿™é‡Œå…±äº«çš„æ˜¯ d$/data/output ä¸æ˜¯ d/data/output 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 [root@kylinV10arm162 ~]# cat /var/pwd_65 username=zgyyb password=sxzq@123 vers=1.0 [root@kylinV10arm162 ~]# mount -t cifs -v -o credentials=/var/pwd_65 //10.xxx.xxx.65/d/data/output /mnt/99/ Credential formatted incorrectly: 1.0 mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d,user=zgyyb,prefixpath=data/output,pass=******** mount error(2): No such file or directory Refer to the mount.cifs(8) manual page (e.g. man mount.cifs) and kernel log messages (dmesg) # æŸ¥çœ‹å…±äº«ç›®å½•çš„ç›˜ æ³¨æ„è¿™é‡Œçš„ç›˜æ˜¯ d$ ä¸æ˜¯ d [root@kylinV10arm162 ~]# smbclient -L //10.xxx.xxx.65/ -U zgyyb Enter SAMBA\\zgyyb\\\u0026#39;s password: Sharename Type Comment --------- ---- ------- ADMIN$ Disk è¿œç¨‹ç®¡ç† C$ Disk é»˜è®¤å…±äº« D$ Disk é»˜è®¤å…±äº« Eç›˜ Disk I$ Disk é»˜è®¤å…±äº« IPC$ IPC è¿œç¨‹ IPC Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.xxx.xxx.65 failed (Error NT_STATUS_IO_TIMEOUT) Unable to connect with SMB1 -- no workgroup available # æŠŠè·¯å¾„æ¢æˆ d$ å°±å¯ä»¥äº† [root@kylinV10arm162 ~]# mount -t cifs -v -o credentials=/var/pwd_65 //10.xxx.xxx.65/d$/data/output /mnt/99/ Credential formatted incorrectly: 1.0 mount.cifs kernel mount options: ip=10.xxx.xxx.65,unc=\\\\10.xxx.xxx.65\\d$,user=zgyyb,prefixpath=data/output,pass=******** [root@kylinV10arm162 ~]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 32G 0 32G 0% /dev tmpfs 32G 192K 32G 1% /dev/shm tmpfs 32G 1.8G 30G 6% /run tmpfs 32G 0 32G 0% /sys/fs/cgroup /dev/mapper/klas-root 483G 38G 446G 8% / tmpfs 32G 2.2M 32G 1% /tmp /dev/vda2 1014M 222M 793M 22% /boot /dev/vda1 599M 6.5M 593M 2% /boot/efi tmpfs 6.3G 0 6.3G 0% /run/user/993 tmpfs 6.3G 0 6.3G 0% /run/user/0 //10.xxx.xxx.195/d/data/output 500G 395G 106G 79% /mnt/B9 //10.xxx.xxx.65/d$/data/output 200G 169G 32G 85% /mnt/99 [root@kylinV10arm162 ~]# æ€»ç»“\r99 æŒ‚è½½\n1 mount -t cifs -v -o credentials=/var/pwd_65 //10.xxx.xxx.65/d$/data/output /mnt/99/ B9 æŒ‚è½½\n1 mount -t cifs -v -o credentials=/var/pwd //10.xxx.xxx.195/d/data/output /mnt/B9/ å–æ¶ˆæŒ‚è½½\n1 2 umount /mnt/99 umount /mnt/B9 ","date":"2024-07-21T22:25:30+08:00","permalink":"http://localhost:1313/posts/2024/07/linux-%E6%8C%82%E8%BD%BD%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/linux-%E6%8C%82%E8%BD%BD%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/","title":"Linux æŒ‚è½½å…±äº«æ–‡ä»¶ç³»ç»Ÿ"},{"content":"å› ä¸ºä¹‹å‰å®æ–½éƒ¨ç½²è¾¾æ¢¦æ•°æ®åº“ï¼Œé€šå¸¸æ˜¯åªéƒ¨ç½²å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒï¼Œç”Ÿæˆç¯å¢ƒçš„æ•°æ®åº“å¹¶æ²¡æœ‰å®è·µåœ¨é¡¹ç›®ä¸­å®è·µè¿‡ï¼Œå—é™äºå·¥ä½œé¡¹ç›®ï¼Œå¼€å‘ã€æµ‹è¯•ç¯å¢ƒé€šå¸¸åªæœ‰ä¸€å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œéƒ¨ç½²çš„å•æœºç‰ˆã€‚\nå¯¹äºé›†ç¾¤ç‰ˆæœ¬ä¸€ç›´æ²¡æœ‰æœºä¼šå®è·µï¼Œæœ€è¿‘ä½¿ç”¨è™šæ‹Ÿæœºæ­å»ºäº†è¾¾æ¢¦å®æ—¶ä¸»å¤‡é›†ç¾¤ï¼Œå¹¶è¿›è¡Œå®æ—¶ä¸»å¤‡æ•°æ®åŒæ­¥ã€åˆ‡æ¢ä¸»å¤‡åº“çš„éªŒè¯ã€‚ç‰¹æ­¤åšæ€»ç»“ï¼ŒåŒ…æ‹¬ï¼šé›†ç¾¤æ­å»ºã€ç›‘è§†å™¨ã€æœåŠ¡åã€å®æ—¶åŒæ­¥æ•°æ®éªŒè¯ã€æ‰‹åŠ¨ä¸»å¤‡åˆ‡æ¢ä¸éªŒè¯ã€‚\nå®‰è£…å‰å‡†å¤‡è¯´æ˜\r1.éœ€è¦ linux é‡Œæœ‰ tar å‘½ä»¤åŒ…ï¼Œæ‰§è¡Œä¸‹è¾¹å‘½ä»¤éªŒè¯\n1 tar --version 2.éœ€è¦å…ˆå°†æœåŠ¡å™¨åŒæ­¥æ—¶é—´ï¼Œä¸€èˆ¬åŒæ­¥ ntp æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹\n1 2 date -s \u0026#34;yyyy-mm-dd HH:MM:SS\u0026#34; date -s 3.å…³é—­é˜²ç«å¢™å¹¶ç¦æ­¢è‡ªå¯\n1 2 systemctl stop firewalld systemctl disable firewalld 4.ç¡®ä¿ä¸»å¤‡æœåŠ¡å™¨ç½‘ç»œäº’é€šï¼Œé¿å…åŒæ­¥æ•°æ®å¤±æ•ˆï¼Œéœ€è¦äº’ç›¸ä¼  Redo æ—¥å¿—çš„\n5.è¾¾æ¢¦æ•°æ®åº“å®˜æ–¹æ˜¯å»ºè®®å…³é—­ SWAP åˆ†åŒºçš„ï¼Œå†…å­˜å……è¶³ä¹Ÿå¯ä¸å…³\n6.è°ƒæ•´ limit.sconf å‚æ•°\né›†ç¾¤è§„åˆ’\réœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¡®è®¤ç«¯å£ä¸ä¼šä¸å…¶ä»–æœåŠ¡è¿›ç¨‹å†²çª\néƒ¨ç½²ä¿¡æ¯\rAæœºå™¨ Bæœºå™¨ IP 192.168.163.9 192.168.163.10 å®ä¾‹å GRP_TEST_01 GRP_TEST_02 å®ä¾‹ç«¯å£ 5236 5236 å®ˆæŠ¤è¿›ç¨‹ç«¯å£ 5536 5536 MALç«¯å£ 5336 5336 å®ˆæŠ¤ç»„ GRP1 GPR1 å®‰è£…ç›®å½• /home/dmdba/dmdbms /home/dmdba/dmdbms å®ä¾‹ç›®å½• /home/dmdba/data /home/dmdba/data å½’æ¡£ä¸Šé™ 10240ï¼ˆç”Ÿäº§ä¸€èˆ¬ä¸è®¾ä¸Šé™ï¼Œç”±DBAè§„åˆ’ï¼‰ 10240 åˆ‡æ¢æ¨¡å¼\réœ€è¦è€ƒè™‘ ALTER_MODE_STATUS å‚æ•°æ˜¯å¤šå°‘ï¼š0-ä¸å¯ä¿®æ”¹ï¼Œ1-å¯ä¿®æ”¹\né›†ç¾¤æ­å»º\rå®‰è£…æ•°æ®åº“\ræ­¥éª¤å¯å‚ç…§ å®æ–½éƒ¨ç½²-è¾¾æ¢¦æ•°æ®åº“linuxç‰ˆçš„å®‰è£…ï¼ˆäºŒï¼‰ | WeiQi Blog (weiqifun.github.io)\næŒ‰ç…§ä¸‹è¾¹ä¹Ÿå¯ä»¥ï¼Œæ€»ä¹‹æ­¥éª¤éœ€è¦åˆ°åˆå§‹åŒ–å®ä¾‹\næ­å»ºé›†ç¾¤æ—¶ï¼Œæ¯å°éƒ½éœ€è¦åˆå§‹åŒ–å®ä¾‹ï¼ˆå³ 192.168.163.9 å’Œ 192.168.163.10 éƒ½éœ€è¦ï¼‰\næ³¨æ„ï¼šåœ¨ä½¿ç”¨ ./dminit åˆå§‹åŒ–å®ä¾‹æ—¶ï¼Œè¯·æ³¨æ„ä¿®æ”¹å®ä¾‹åï¼š\n192.168.163.9 \u0026gt; GRP_TEST_01\n192.168.163.10 \u0026gt; GRP_TEST_02\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 [root@linux1 soft]# groupadd dinstall [root@linux1 soft]# useradd -g dinstall -m -d /home/dmdba -s /bin/bash dmdba [root@linux1 soft]# passwd dmdba æ›´æ”¹ç”¨æˆ· dmdba çš„å¯†ç  ã€‚ æ–°çš„ å¯†ç ï¼š!@#$qwer é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š!@#$qwer passwdï¼šæ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚ [root@linux1 soft]# vi /etc/security/limits.conf # åœ¨confæ–‡ä»¶å†…å®¹çš„æœ€åæ·»åŠ  dmdba hard nofile 65536 dmdba soft nofile 65536 dmdba hard stack 32768 dmdba soft stack 16384 # :wq ä¿å­˜ [root@linux1 soft]# su - dmdba [dmdba@linux1 ~]$ ulimit -a core file size (blocks, -c) 0 data seg size (kbytes, -d) unlimited scheduling priority (-e) 0 file size (blocks, -f) unlimited pending signals (-i) 14989 max locked memory (kbytes, -l) 64 max memory size (kbytes, -m) unlimited open files (-n) 65536 pipe size (512 bytes, -p) 8 POSIX message queues (bytes, -q) 819200 real-time priority (-r) 0 stack size (kbytes, -s) 16384 cpu time (seconds, -t) unlimited max user processes (-u) 4096 virtual memory (kbytes, -v) unlimited file locks (-x) unlimited [root@linux1 soft]# chmod 755 dm8_20240408_x86_rh7_64.iso [root@linux1 soft]# mount -o loop dm8_20240408_x86_rh7_64.iso /mnt/ mount: /dev/loop0 å†™ä¿æŠ¤ï¼Œå°†ä»¥åªè¯»æ–¹å¼æŒ‚è½½ [root@linux1 soft]# su - dmdba ä¸Šä¸€æ¬¡ç™»å½•ï¼šå…­ 7æœˆ 20 23:55:52 CST 2024pts/0 ä¸Š [dmdba@linux1 ~]$ cd /mnt/ [dmdba@linux1 mnt]$ ll æ€»ç”¨é‡ 1057031 -r-xr-xr-x. 1 root root 2587699 3æœˆ 20 14:04 DM8 Install.pdf -r-xr-xr-x. 1 root root 1079810877 4æœˆ 8 13:35 DMInstall.bin [dmdba@linux1 mnt]$ ./DMInstall.bin -i å®‰è£…è¯­è¨€: [1]: ç®€ä½“ä¸­æ–‡ [2]: English è¯·é€‰æ‹©å®‰è£…è¯­è¨€ [1]:1 è§£å‹å®‰è£…ç¨‹åº......... æ¬¢è¿ä½¿ç”¨è¾¾æ¢¦æ•°æ®åº“å®‰è£…ç¨‹åº æ˜¯å¦è¾“å…¥Keyæ–‡ä»¶è·¯å¾„? (Y/y:æ˜¯ N/n:å¦) [Y/y]:n æ˜¯å¦è®¾ç½®æ—¶åŒº? (Y/y:æ˜¯ N/n:å¦) [Y/y]:y è®¾ç½®æ—¶åŒº: [ 1]: (GTM-12:00) æ—¥ç•Œçº¿è¥¿ [ 2]: (GTM-11:00) è¨æ‘©äºšç¾¤å²› [ 3]: (GTM-10:00) å¤å¨å¤· [ 4]: (GTM-09:00) é˜¿æ‹‰æ–¯åŠ  [ 5]: (GTM-08:00) å¤ªå¹³æ´‹æ—¶é—´ï¼ˆç¾å›½å’ŒåŠ æ‹¿å¤§ï¼‰ [ 6]: (GTM-07:00) äºšåˆ©æ¡‘é‚£ [ 7]: (GTM-06:00) ä¸­éƒ¨æ—¶é—´ï¼ˆç¾å›½å’ŒåŠ æ‹¿å¤§ï¼‰ [ 8]: (GTM-05:00) ä¸œéƒ¨éƒ¨æ—¶é—´ï¼ˆç¾å›½å’ŒåŠ æ‹¿å¤§ï¼‰ [ 9]: (GTM-04:00) å¤§è¥¿æ´‹æ—¶é—´ï¼ˆç¾å›½å’ŒåŠ æ‹¿å¤§ï¼‰ [10]: (GTM-03:00) å·´è¥¿åˆ©äºš [11]: (GTM-02:00) ä¸­å¤§è¥¿æ´‹ [12]: (GTM-01:00) äºšé€Ÿå°”ç¾¤å²› [13]: (GTM) æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ [14]: (GTM+01:00) è¨æ‹‰çƒ­çª [15]: (GTM+02:00) å¼€ç½— [16]: (GTM+03:00) è«æ–¯ç§‘ [17]: (GTM+04:00) é˜¿å¸ƒæ‰æ¯” [18]: (GTM+05:00) ä¼Šæ–¯å…°å ¡ [19]: (GTM+06:00) è¾¾å¡ [20]: (GTM+07:00) æ›¼è°·ï¼Œæ²³å†… [21]: (GTM+08:00) ä¸­å›½æ ‡å‡†æ—¶é—´ [22]: (GTM+09:00) é¦–å°” [23]: (GTM+10:00) å…³å²› [24]: (GTM+11:00) æ‰€ç½—é—¨ç¾¤å²› [25]: (GTM+12:00) æ–æµ [26]: (GTM+13:00) åŠªåº“é˜¿å‹’æ³• [27]: (GTM+14:00) åŸºé‡Œå·´æ–¯ è¯·é€‰æ‹©æ—¶åŒº [21]:21 å®‰è£…ç±»å‹: 1 å…¸å‹å®‰è£… 2 æœåŠ¡å™¨ 3 å®¢æˆ·ç«¯ 4 è‡ªå®šä¹‰ è¯·é€‰æ‹©å®‰è£…ç±»å‹çš„æ•°å­—åºå· [1 å…¸å‹å®‰è£…]:1 æ‰€éœ€ç©ºé—´: 2310M è¯·é€‰æ‹©å®‰è£…ç›®å½• [/home/dmdba/dmdbms]: å¯ç”¨ç©ºé—´: 29G æ˜¯å¦ç¡®è®¤å®‰è£…è·¯å¾„(/home/dmdba/dmdbms)? (Y/y:æ˜¯ N/n:å¦) [Y/y]: å®‰è£…å‰å°ç»“ å®‰è£…ä½ç½®: /home/dmdba/dmdbms æ‰€éœ€ç©ºé—´: 2310M å¯ç”¨ç©ºé—´: 29G ç‰ˆæœ¬ä¿¡æ¯: æœ‰æ•ˆæ—¥æœŸ: å®‰è£…ç±»å‹: å…¸å‹å®‰è£… æ˜¯å¦ç¡®è®¤å®‰è£…? (Y/y:æ˜¯ N/n:å¦):y 2024-07-21 00:02:02 [INFO] å®‰è£…è¾¾æ¢¦æ•°æ®åº“... 2024-07-21 00:02:02 [INFO] å®‰è£… åŸºç¡€ æ¨¡å—... 2024-07-21 00:02:13 [INFO] å®‰è£… æœåŠ¡å™¨ æ¨¡å—... 2024-07-21 00:02:17 [INFO] å®‰è£… å®¢æˆ·ç«¯ æ¨¡å—... 2024-07-21 00:02:23 [INFO] å®‰è£… é©±åŠ¨ æ¨¡å—... 2024-07-21 00:02:27 [INFO] å®‰è£… æ‰‹å†Œ æ¨¡å—... 2024-07-21 00:02:28 [INFO] å®‰è£… æœåŠ¡ æ¨¡å—... 2024-07-21 00:02:28 [INFO] ç§»åŠ¨æ—¥å¿—æ–‡ä»¶ã€‚ 2024-07-21 00:02:29 [INFO] å®‰è£…è¾¾æ¢¦æ•°æ®åº“å®Œæˆã€‚ è¯·ä»¥rootç³»ç»Ÿç”¨æˆ·æ‰§è¡Œå‘½ä»¤: /home/dmdba/dmdbms/script/root/root_installer.sh å®‰è£…ç»“æŸ [dmdba@linux1 mnt]$ su - root å¯†ç ï¼š ä¸Šä¸€æ¬¡ç™»å½•ï¼šå…­ 7æœˆ 20 23:57:11 CST 2024pts/0 ä¸Š [root@linux1 ~]# /home/dmdba/dmdbms/script/root/root_installer.sh ç§»åŠ¨ /home/dmdba/dmdbms/bin/dm_svc.conf åˆ°/etcç›®å½• åˆ›å»ºDmAPServiceæœåŠ¡ Created symlink from /etc/systemd/system/multi-user.target.wants/DmAPService.service to /usr/lib/systemd/system/DmAPService.service. åˆ›å»ºæœåŠ¡(DmAPService)å®Œæˆ å¯åŠ¨DmAPServiceæœåŠ¡ [root@linux1 ~]# su - dmdba ä¸Šä¸€æ¬¡ç™»å½•ï¼šæ—¥ 7æœˆ 21 00:00:02 CST 2024pts/0 ä¸Š [dmdba@linux1 ~]$ cd /home/dmdba/dmdbms/bin ########################################################## # ./dminit è¿™ä¸ªæ­¥éª¤è¦æ³¨æ„ï¼Œå®ä¾‹åè¦æœ‰åŒºåˆ† # # ./dminit å‚æ•°è¯¦è§ https://eco.dameng.com/document/dm/zh-cn/pm/dminit-parameters.html # å¦‚æœéœ€è¦å°†æ•°æ®æ–‡ä»¶æ”¾åˆ°å…¶ä»–åœ°æ–¹ï¼Œåˆ™ path å‚æ•°åº”ä¸ºå…·ä½“çš„è·¯å¾„ # ä¾‹å¦‚ï¼špath=/home/dmdba/data ï¼ˆæå‰å»ºå¥½ï¼‰ # å¦‚æœæ•°æ®åº“åè‡ªå®šä¹‰ï¼Œåˆ™ DM_NAME å‚æ•°åº”ä¸ºè‡ªå®šä¹‰åç§° # ä¾‹å¦‚ï¼šDB_NAME=TEST_DB # è¿™æ ·åˆ›å»ºå¥½çš„æ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œåˆ™ä¸ºï¼š/home/dmdba/data/TEST_DB ########################################################## [dmdba@linux1 bin]# ./dminit path=/home/dmdba/dmdbms PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=y CHARSET=0 DB_NAME=DMDB INSTANCE_NAME=GRP_TEST_01 PORT_NUM=5236 initdb V8 db version: 0x7000c file dm.key not found, use default license! License will expire on 2025-03-21 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL log file path: /home/dmdba/dmdbms/DMDB/DMDB01.log log file path: /home/dmdba/dmdbms/DMDB/DMDB02.log write to dir [/home/dmdba/dmdbms/DMDB]. create dm database success. 2024-07-21 00:06:03 åˆ°è¿™é‡Œï¼Œåˆå§‹åŒ–å®ä¾‹å®Œæˆï¼\né…ç½® A æœºå™¨\ræŠŠ 192.168.163.9 ä½œä¸ºä¸»åº“ï¼Œå³æ‰€è°“çš„ A æœºå™¨\nä»¥ä¸‹æ­¥éª¤éå¿…è¦è¯´æ˜ï¼Œå‡ä½¿ç”¨æ•°æ®åº“ç”¨æˆ· dmdba æ“ä½œ\nå…ˆæŠŠ A æœºå™¨çš„æ•°æ®åº“æœåŠ¡å¯åŠ¨\n1ï¼‰å¯åŠ¨å®ä¾‹æœåŠ¡\r1 2 3 # å‰å°å¯åŠ¨æœåŠ¡ [dmdba@linux1 ~]$ cd /home/dmdba/dmdbms/bin [dmdba@linux1 bin]$ ./dmserver /home/dmdba/dmdbms/DMDB/dm.ini å› ä¸ºè¿˜æ²¡æœ‰åœ¨ ../script/root æ‰§è¡Œåˆ›å»ºæœåŠ¡çš„å‘½ä»¤ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯æ²¡æœ‰åå°å¯åŠ¨æœåŠ¡çš„å‘½ä»¤çš„\n2ï¼‰å¼€å¯å½’æ¡£\rSPACE_LIMIT æ˜¯å½’æ¡£ç©ºé—´çš„æœ€å¤§é™åˆ¶ï¼Œç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå°†ä¹‹å‰æ—§çš„å½’æ¡£æ–‡ä»¶åˆ æ‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºæ™®é€šæ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 17.680(ms) disql V8 SQL\u0026gt; ALTER DATABASE MOUNT; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 3.546(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE ARCHIVELOG; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 17.101(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE ADD ARCHIVELOG \u0026#39;DEST=/home/dmdba/dmdbms/DMDB/arch, TYPE=LOCAL, FILE_SIZE=1024, SPACE_LIMIT=10240\u0026#39;; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 4.701(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE OPEN; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 16.531(æ¯«ç§’). æ‰§è¡Œå·:0. 3ï¼‰å¤‡ä»½æ•°æ®\r1 2 3 SQL\u0026gt; BACKUP DATABASE BACKUPSET \u0026#39;/home/dmdba/dmdbms/DMDB/bak/BACKUP_FILE\u0026#39;; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 00:00:08.767. æ‰§è¡Œå·:501. 4ï¼‰ä¿®æ”¹ dm.ini\r1 2 3 4 5 6 SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;PORT_NUM\u0026#39;,5236); #æ•°æ®åº“å®ä¾‹ç›‘å¬ç«¯å£ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;DW_INACTIVE_INTERVAL\u0026#39;,60); #æ¥æ”¶å®ˆæŠ¤è¿›ç¨‹æ¶ˆæ¯è¶…æ—¶æ—¶é—´ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); #ä¸å…è®¸æ‰‹å·¥æ–¹å¼ä¿®æ”¹å®ä¾‹æ¨¡å¼/çŠ¶æ€/OGUID SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;ENABLE_OFFLINE_TS\u0026#39;,2); #ä¸å…è®¸å¤‡åº“ OFFLINE è¡¨ç©ºé—´ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;MAL_INI\u0026#39;,1); #æ‰“å¼€ MAL ç³»ç»Ÿ SQL\u0026gt; SP_SET_PARA_VALUE (2,\u0026#39;RLOG_SEND_APPLY_MON\u0026#39;,64); #ç»Ÿè®¡æœ€è¿‘ 64 æ¬¡çš„æ—¥å¿—é‡æ¼”ä¿¡æ¯ 5ï¼‰é€€å‡ºå¹¶å…³é—­æ•°æ®åº“æœåŠ¡\r1 2 3 SQL\u0026gt; exit; # åˆ°å¼€å¯æœåŠ¡çš„linuxçª—å£ï¼Œç»ˆæ­¢å‰å°æœåŠ¡ 6ï¼‰ä¿®æ”¹ dmarch.ini\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [dmdba@linux1~]$ vi /home/dmdba/dmdbms/DMDB/dmarch.ini ARCH_WAIT_APPLY = 0 #0ï¼šé«˜æ€§èƒ½ 1ï¼šäº‹åŠ¡ä¸€è‡´ [ARCHIVE_LOCAL] ARCH_TYPE = LOCAL #æœ¬åœ°å½’æ¡£ç±»å‹ ARCH_DEST = /home/dmdba/dmdbms/DMDB/arch/ #æœ¬åœ°å½’æ¡£å­˜æ”¾è·¯å¾„ ARCH_FILE_SIZE = 1024 #å•ä¸ªå½’æ¡£å¤§å°ï¼Œå•ä½ MB ARCH_SPACE_LIMIT = 10240 #å½’æ¡£ä¸Šé™ï¼Œå•ä½ MB ARCH_FLUSH_BUF_SIZE = 0 ARCH_HANG_FLAG = 1 [ARCHIVE_REALTIME1] ARCH_TYPE = REALTIME #å®æ—¶å½’æ¡£ç±»å‹ ARCH_DEST = GRP_TEST_02 #å®æ—¶å½’æ¡£ç›®æ ‡å®ä¾‹å(å¤‡åº“å®ä¾‹å) 7ï¼‰åˆ›å»º dmmal.ini\råœ¨ dm.ini ç›¸åŒç›®å½•ä¸‹ï¼Œåˆ›å»º dmmal.ini\næ˜¯ä¸¤ä¸ªæœºå™¨ä¼  Redo æ—¥å¿—ã€å“åº”æ¶ˆæ¯çš„é…ç½®æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 vi /home/dmdba/dmdbms/DMDB/dmmal.ini MAL_CHECK_INTERVAL = 10 #MAL é“¾è·¯æ£€æµ‹æ—¶é—´é—´éš” MAL_CONN_FAIL_INTERVAL = 10 #åˆ¤å®š MAL é“¾è·¯æ–­å¼€çš„æ—¶é—´ MAL_TEMP_PATH = /home/dmdba/dmdbms/DMDB/malpath/ #ä¸´æ—¶æ–‡ä»¶ç›®å½• MAL_BUF_SIZE = 512 #å•ä¸ª MAL ç¼“å­˜å¤§å°ï¼Œå•ä½ MB MAL_SYS_BUF_SIZE = 2048 #MAL æ€»å¤§å°é™åˆ¶ï¼Œå•ä½ MB MAL_COMPRESS_LEVEL = 0 #MAL æ¶ˆæ¯å‹ç¼©ç­‰çº§ï¼Œ0 è¡¨ç¤ºä¸å‹ç¼© [MAL_INST1] MAL_INST_NAME = GRP_TEST_01 #å®ä¾‹åï¼Œå’Œ dm.ini çš„ INSTANCE_NAME ä¸€è‡´ MAL_HOST = 192.168.163.9 #MAL ç³»ç»Ÿç›‘å¬ TCP è¿æ¥çš„ IP åœ°å€ MAL_PORT = 5336 #MAL ç³»ç»Ÿç›‘å¬ TCP è¿æ¥çš„ç«¯å£ MAL_INST_HOST = 192.168.163.9 #å®ä¾‹çš„å¯¹å¤–æœåŠ¡ IP åœ°å€ MAL_INST_PORT = 5236 #å®ä¾‹å¯¹å¤–æœåŠ¡ç«¯å£ï¼Œå’Œ dm.ini çš„ PORT_NUM ä¸€è‡´ MAL_DW_PORT = 5436 #å®ä¾‹å¯¹åº”çš„å®ˆæŠ¤è¿›ç¨‹ç›‘å¬ TCP è¿æ¥çš„ç«¯å£ MAL_INST_DW_PORT = 5536 #å®ä¾‹ç›‘å¬å®ˆæŠ¤è¿›ç¨‹ TCP è¿æ¥çš„ç«¯å£ [MAL_INST2] MAL_INST_NAME = GRP_TEST_02 MAL_HOST = 192.168.163.10 MAL_PORT = 5336 MAL_INST_HOST = 192.168.163.10 MAL_INST_PORT = 5236 MAL_DW_PORT = 5436 MAL_INST_DW_PORT = 5536 8ï¼‰åˆ›å»º dmwatcher.ini\råœ¨ dm.ini ç›¸åŒç›®å½•ä¸‹ï¼Œåˆ›å»º dmwatcher.ini\n1 2 3 4 5 6 7 8 9 10 11 12 [GRP1] DW_TYPE = GLOBAL #å…¨å±€å®ˆæŠ¤ç±»å‹ DW_MODE = AUTO #MANUALï¼šæ•…éšœæ‰‹åˆ‡ AUTOï¼šæ•…éšœè‡ªåˆ‡ DW_ERROR_TIME = 20 #è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹æ•…éšœè®¤å®šæ—¶é—´ INST_ERROR_TIME = 20 #æœ¬åœ°å®ä¾‹æ•…éšœè®¤å®šæ—¶é—´ INST_RECOVER_TIME = 60 #ä¸»åº“å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ¢å¤çš„é—´éš”æ—¶é—´ INST_OGUID = 45331 #å®ˆæŠ¤ç³»ç»Ÿå”¯ä¸€ OGUID å€¼ INST_INI = /home/dmdba/dmdbms/DMDB/dm.ini #dm.ini æ–‡ä»¶è·¯å¾„ INST_AUTO_RESTART = 1 #æ‰“å¼€å®ä¾‹çš„è‡ªåŠ¨å¯åŠ¨åŠŸèƒ½ INST_STARTUP_CMD = /home/dmdba/dmdbms/bin/dmserver #å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨ RLOG_SEND_THRESHOLD = 0 #æŒ‡å®šä¸»åº“å‘é€æ—¥å¿—åˆ°å¤‡åº“çš„æ—¶é—´é˜ˆå€¼ï¼Œé»˜è®¤å…³é—­ RLOG_APPLY_THRESHOLD = 0 #æŒ‡å®šå¤‡åº“é‡æ¼”æ—¥å¿—çš„æ—¶é—´é˜ˆå€¼ï¼Œé»˜è®¤å…³é—­ 9ï¼‰æ‹·è´å¤‡ä»½æ–‡ä»¶åˆ°å¤‡åº“\r1 2 3 4 5 6 7 8 9 [dmdba@linux1 DMDB]$ scp -r /home/dmdba/dmdbms/DMDB/bak/BACKUP_FILE dmdba@192.168.163.10:/home/dmdba/dmdbms/DMDB/bak/ The authenticity of host \u0026#39;192.168.163.10 (192.168.163.10)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:xU91rJPNr+WlgJJ3xkHHHdDAo/vxPcgYj7U+VH4zLYg. ECDSA key fingerprint is MD5:1c:b2:a6:11:d1:b8:20:e7:c4:6d:a1:0b:df:2a:d0:1c. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added \u0026#39;192.168.163.10\u0026#39; (ECDSA) to the list of known hosts. dmdba@192.168.163.10\u0026#39;s password: BACKUP_FILE.bak 100% 27MB 20.5MB/s 00:01 BACKUP_FILE.meta 10ï¼‰æ³¨å†ŒæœåŠ¡\rä½¿ç”¨ root ç”¨æˆ·æ“ä½œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [root@linux1 ~]# cd /home/dmdba/dmdbms/script/root/ [root@linux1 root]# ll æ€»ç”¨é‡ 44 -rwxr-xr-x. 1 dmdba dinstall 25373 7æœˆ 21 00:02 dm_service_installer.sh -rwxr-xr-x. 1 dmdba dinstall 9214 7æœˆ 21 00:02 dm_service_uninstaller.sh -rwxr-xr-x. 1 dmdba dinstall 490 7æœˆ 21 00:02 root_installer.sh #################### # åˆ›å»ºæ•°æ®åº“æœåŠ¡ # -p å®ä¾‹å #################### [root@linux1 root]# ./dm_service_installer.sh -t dmserver -p GRP_TEST_01 -dm_ini /home/dmdba/dmdbms/DMDB/dm.ini -m mount Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceGRP_TEST_01.service to /usr/lib/systemd/system/DmServiceGRP_TEST_01.service. åˆ›å»ºæœåŠ¡(DmServiceGRP_TEST_01)å®Œæˆ #################### # åˆ›å»ºæ•°æ®å®ˆæŠ¤æœåŠ¡ #################### [root@linux1 root]# ./dm_service_installer.sh -t dmwatcher -p Watcher -watcher_ini /home/dmdba/dmdbms/DMDB/dmwatcher.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmWatcherServiceWatcher.service to /usr/lib/systemd/system/DmWatcherServiceWatcher.service. åˆ›å»ºæœåŠ¡(DmWatcherServiceWatcher)å®Œæˆ å¦‚æœéœ€è¦åˆ é™¤æœåŠ¡\r1 2 [root@~]# ./dm_service_uninstaller.sh -n DmServiceGRP_TEST_01 [root@~]# ./dm_service_uninstaller.sh -n DmWatcherServiceWatcher é…ç½® B æœºå™¨\r192.168.163.10 ä¸ºå¤‡åº“\nå› ä¸ºå®‰è£…æ•°æ®åº“çš„æ—¶å€™ï¼Œå·²ç»åˆå§‹åŒ–å®ä¾‹äº†\nç°åœ¨éœ€è¦åšçš„å°±æ˜¯åœ¨å¤‡åº“åŒæ­¥ä¸»åº“çš„æ•°æ®ï¼Œè®©ä¸»å¤‡ä¿æŒä¸€è‡´çš„çŠ¶æ€\n1ï¼‰å¤‡åº“æ¢å¤æ•°æ®\ræ‰§è¡Œä¸‹è¾¹ä¸¤æ¡ï¼Œæ³¨æ„ dm.ini çš„ä½ç½®å’Œå¤‡ä»½æ–‡ä»¶çš„ä½ç½®ï¼Œå¤‡ä»½æ–‡ä»¶æ˜¯ä» A æœºå™¨æ‹·è´è¿‡æ¥çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 ################### # è¿™æ­¥æ˜¯ RESTORE DATEBASE ################### [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RESTORE DATABASE \u0026#39;/home/dmdba/dmdbms/DMDB/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/dmdbms/DMDB/bak/BACKUP_FILE\u0026#39;\u0026#34; dmrman V8 RESTORE DATABASE \u0026#39;/home/dmdba/dmdbms/DMDB/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/dmdbms/DMDB/bak/BACKUP_FILE\u0026#39; file dm.key not found, use default license! Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL [Percent:100.00%][Speed:0.00M/s][Cost:00:00:03][Remaining:00:00:00] restore successfully. time used: 00:00:03.874 ################### # è¿™æ­¥æ˜¯ RECOVER DATEBASE ################### [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RECOVER DATABASE \u0026#39;/home/dmdba/dmdbms/DMDB/dm.ini\u0026#39; FROM BACKUPSET \u0026#39;/home/dmdba/dmdbms/DMDB/bak/BACKUP_FILE\u0026#39;\u0026#34; ################### # è¿™æ­¥æ˜¯ RECOVER DATEBASE UPDATE DM_MAGIC ################### [dmdba@linux2 bin]$ ./dmrman CTLSTMT=\u0026#34;RECOVER DATABASE \u0026#39;/home/dmdba/dmdbms/DMDB/dm.ini\u0026#39; UPDATE DB_MAGIC\u0026#34; dmrman V8 RECOVER DATABASE \u0026#39;/home/dmdba/dmdbms/DMDB/dm.ini\u0026#39; UPDATE DB_MAGIC file dm.key not found, use default license! Database mode = 2, oguid = 0 Normal of FAST Normal of DEFAULT Normal of RECYCLE Normal of KEEP Normal of ROLL EP[0]\u0026#39;s cur_lsn[42972], file_lsn[42972] recover successfully! time used: 00:00:01.421 2ï¼‰åˆ›å»º dmarch.ini\rA æœºå™¨å¼€å¯äº†å½’æ¡£ï¼ŒB æœºå™¨æ˜¯è¿˜æ²¡æœ‰å¼€å¯å½’æ¡£çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å½’æ¡£é…ç½®æ–‡ä»¶ dmarch.ini çš„ï¼Œåœ¨ B æœºå™¨åˆ›å»ºå®ƒ\næ³¨æ„ ARCH_DEST å‚æ•°ï¼Œä¸»åº“çš„ dmarch.ini æ–‡ä»¶å¡«å¤‡åº“çš„å®ä¾‹åï¼Œå¤‡åº“çš„ dmarch.ini æ–‡ä»¶å¡«ä¸»åº“çš„å®ä¾‹å\n1 2 3 4 5 6 7 8 9 10 11 12 13 ARCH_WAIT_APPLY = 0 #0ï¼šé«˜æ€§èƒ½ 1ï¼šäº‹åŠ¡ä¸€è‡´ [ARCHIVE_LOCAL] ARCH_TYPE = LOCAL #æœ¬åœ°å½’æ¡£ç±»å‹ ARCH_DEST = /home/dmdba/dmdbms/DMDB/arch/ #æœ¬åœ°å½’æ¡£å­˜æ”¾è·¯å¾„ ARCH_FILE_SIZE = 1024 #å•ä¸ªå½’æ¡£å¤§å°ï¼Œå•ä½ MB ARCH_SPACE_LIMIT = 10240 #å½’æ¡£ä¸Šé™ï¼Œå•ä½ MB ARCH_FLUSH_BUF_SIZE = 0 ARCH_HANG_FLAG = 1 [ARCHIVE_REALTIME1] ARCH_TYPE = REALTIME #å®æ—¶å½’æ¡£ç±»å‹ ARCH_DEST = GRP_TEST_01 #å®æ—¶å½’æ¡£ç›®æ ‡å®ä¾‹åï¼Œè¿™é‡Œåˆ™å¡«ä¸»åº“çš„å®ä¾‹ 3ï¼‰ä¿®æ”¹ dm.ini\råœ¨ B æœºå™¨ä¸Šä¿®æ”¹ dm.ini ï¼Œå®ƒæ¯” A æœºå™¨ä¸Šå¤šäº†ä¸€ä¸ªå‚æ•°ä¿®æ”¹ ARCH_INI = 1 æ‰“å¼€å½’æ¡£é…ç½®\nå› ä¸º A æœºå™¨æ˜¯é€šè¿‡ SQL çš„æ–¹å¼æ‰“å¼€å½’æ¡£çš„ï¼ŒB æœºå™¨è¿™é‡Œå¹¶æ²¡æœ‰å¯åŠ¨æœåŠ¡ï¼Œæ‰€ä»¥é€šè¿‡ä¿®æ”¹å‚æ•°æ–‡ä»¶çš„æ–¹å¼å¼€å¯\nå¹¶ä¸”ç¡®ä¿æ–‡ä»¶é‡Œçš„å®ä¾‹åä¸ºï¼šGRP_TEST_02\n1 2 3 4 5 6 7 8 9 10 [dmdba@linux2 DMDB]$ vi /home/dmdba/dmdbms/DMDB/dm.ini INSTANCE_NAME = GRP_TEST_02 PORT_NUM = 5236 #æ•°æ®åº“å®ä¾‹ç›‘å¬ç«¯å£ DW_INACTIVE_INTERVAL = 60 #æ¥æ”¶å®ˆæŠ¤è¿›ç¨‹æ¶ˆæ¯è¶…æ—¶æ—¶é—´ ALTER_MODE_STATUS = 0 #ä¸å…è®¸æ‰‹å·¥æ–¹å¼ä¿®æ”¹å®ä¾‹æ¨¡å¼/çŠ¶æ€/OGUID ENABLE_OFFLINE_TS = 2 #ä¸å…è®¸å¤‡åº“ OFFLINE è¡¨ç©ºé—´ MAL_INI = 1 #æ‰“å¼€ MAL ç³»ç»Ÿ ARCH_INI = 1 #æ‰“å¼€å½’æ¡£é…ç½® RLOG_SEND_APPLY_MON = 64 #ç»Ÿè®¡æœ€è¿‘ 64 æ¬¡çš„æ—¥å¿—é‡æ¼”ä¿¡æ¯ 4ï¼‰åˆ›å»º dmmal.ini\ré…ç½®å®ƒä¸ A æœºå™¨çš„å‚æ•°ç›¸åŒï¼ˆå³ä¿æŒä¸ä¸»åº“ä¸€è‡´ï¼‰ï¼Œç”¨ A æœºå™¨çš„ dmmal.ini é…ç½®å³å¯\n5ï¼‰åˆ›å»º dmwatcher.ini\ré…ç½®å®ƒä¸ A æœºå™¨çš„å‚æ•°ç›¸åŒï¼ˆå³ä¿æŒä¸ä¸»åº“ä¸€è‡´ï¼‰ï¼Œç”¨ A æœºå™¨çš„ dmwatcher.ini é…ç½®å³å¯\n6ï¼‰æ³¨å†ŒæœåŠ¡\rä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œï¼Œè·Ÿ A æœºå™¨çš„æ³¨å†ŒæœåŠ¡ç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ª GRP_TEST_02 å®ä¾‹æœåŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®å®ˆæŠ¤æœåŠ¡\n1 2 3 4 5 6 7 [root@linux2 root]# ./dm_service_installer.sh -t dmserver -p GRP_TEST_02 -dm_ini /home/dmdba/dmdbms/DMDB/dm.ini -m mount Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceGRP_TEST_02.service to /usr/lib/systemd/system/DmServiceGRP_TEST_02.service. åˆ›å»ºæœåŠ¡(DmServiceGRP_TEST_02)å®Œæˆ [root@linux2 root]# ./dm_service_installer.sh -t dmwatcher -p Watcher -watcher_ini /home/dmdba/dmdbms/DMDB/dmwatcher.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmWatcherServiceWatcher.service to /usr/lib/systemd/system/DmWatcherServiceWatcher.service. åˆ›å»ºæœåŠ¡(DmWatcherServiceWatcher)å®Œæˆ ã€æ³¨æ„ã€‘\rä¸€èˆ¬ç”Ÿäº§ä¸Šé€šå¸¸çš„é…ç½®ï¼Œæ˜¯ä¸¤å°ï¼Œä¸€ä¸»ä¸€å¤‡ï¼Œå¹¶æ²¡æœ‰ç»™é…ç½®ç›‘è§†å™¨çš„æœºå™¨ï¼Œæ‰€ä»¥ã€‚åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬çš„å®æ—¶ä¸»å¤‡å°±æ­å»ºå®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯åšå¯åŠ¨é›†ç¾¤æœåŠ¡ï¼Œå’ŒéªŒè¯æ˜¯å¦çœŸçš„å®æ—¶åŒæ­¥æ•°æ®ã€‚\nç›‘è§†å™¨\réœ€è¦ç›‘è§†å™¨çš„è¯´æ˜\rå¦‚æœéœ€è¦ç›‘è§†å™¨ï¼Œåˆ™åº”è¯¥å†ä½¿ç”¨ä¸€å°æœåŠ¡å™¨ï¼Œå•ç‹¬éƒ¨ç½²ç›‘è§†å™¨ï¼Œç”¨æ¥ç›‘æ§é›†ç¾¤æœåŠ¡ï¼Œä»¥åŠå®ç°è‡ªåŠ¨åˆ‡æ¢ä¸»å¤‡ã€‚ç°æœ‰æ¥è§¦åˆ°çš„é¡¹ç›®ï¼Œç›‘è§†å™¨ç›´æ¥éƒ¨ç½²åˆ°äº†ä¸»åº“æœåŠ¡å™¨ä¸Šäº†ã€‚\néœ€è¦ç›‘è§†å™¨ï¼Œåˆ™æŒ‰ç…§æ­¤æ­¥éª¤ç»§ç»­éƒ¨ç½²ç›‘è§†å™¨ï¼Œå¦åˆ™è¯·è·³è¿‡è¯¥æ­¥éª¤ï¼Œå¾€ä¸‹æ¥ã€3.5 å¯åŠ¨æœåŠ¡ã€‘æ­¥éª¤\nä¸ºäº†æ›´è´´è¿‘å®é™…é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘åœ¨ A æœºå™¨ï¼ˆ192.168.163.9ï¼‰ä¸Šå®‰è£…ï¼ˆåæ­£éšä¾¿è£…åœ¨ä¸€å°ä¸Šï¼‰ç›‘è§†å™¨\n1ï¼‰åˆ›å»º dmmonitor.ini\rè¿™ä¸ªæ˜¯ç¡®è®¤ç›‘è§†å™¨ï¼Œå°±æ˜¯MON_DW_CONFIRE=1\n1 2 3 4 5 6 7 8 9 10 11 12 [dmdba@linux1 DMDB]# vi dmmonitor.ini MON_DW_CONFIRM = 1 #0ï¼šéç¡®è®¤ï¼ˆæ•…éšœæ‰‹åˆ‡ï¼‰ 1ï¼šç¡®è®¤ï¼ˆæ•…éšœè‡ªåˆ‡ï¼‰ MON_LOG_PATH = ../log_monitor #ç›‘è§†å™¨æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„ MON_LOG_INTERVAL = 60 #æ¯éš” 60s å®šæ—¶è®°å½•ç³»ç»Ÿä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ MON_LOG_FILE_SIZE = 32 #å•ä¸ªæ—¥å¿—å¤§å°ï¼Œå•ä½ MB MON_LOG_SPACE_LIMIT = 1024 #æ—¥å¿—ä¸Šé™ï¼Œå•ä½ MB [GRP1] MON_INST_OGUID = 45331 #ç»„ GRP1 çš„å”¯ä¸€ OGUID å€¼ MON_DW_IP = 192.168.163.9:5436 #IP å¯¹åº” MAL_HOSTï¼ŒPORT å¯¹åº” MAL_DW_PORT MON_DW_IP = 192.168.163.10:5436 2ï¼‰åˆ›å»º dmmonitor_manual.ini\rå†é…ç½®ä¸€ä¸ªéç›‘è§†å™¨ï¼Œå°±æ˜¯ MON_DW_CONFIRE=0\nå®ƒå¯ä»¥åœ¨æ‰‹åŠ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œç›´æ¥é€šè¿‡è¿™ä¸ªéç›‘è§†å™¨å‘½ä»¤å»æ‰‹åŠ¨åˆ‡æ¢ï¼Œå°±ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦çš„åˆ‡æ¢ä¸»å¤‡æ•°æ®åº“æ¨¡å¼äº†\n1 2 3 4 5 6 7 8 9 10 11 12 [dmdba@linux1 DMDB]# vi dmmonitor_manaul.ini MON_DW_CONFIRM = 0 #0ï¼šéç¡®è®¤ï¼ˆæ•…éšœæ‰‹åˆ‡ï¼‰ 1ï¼šç¡®è®¤ï¼ˆæ•…éšœè‡ªåˆ‡ï¼‰ MON_LOG_PATH = ../log_monitor #ç›‘è§†å™¨æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„ MON_LOG_INTERVAL = 60 #æ¯éš” 60s å®šæ—¶è®°å½•ç³»ç»Ÿä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ MON_LOG_FILE_SIZE = 32 #å•ä¸ªæ—¥å¿—å¤§å°ï¼Œå•ä½ MB MON_LOG_SPACE_LIMIT = 1024 #æ—¥å¿—ä¸Šé™ï¼Œå•ä½ MB [GRP1] MON_INST_OGUID = 45331 #ç»„ GRP1 çš„å”¯ä¸€ OGUID å€¼ MON_DW_IP = 192.168.163.9:5436 #IP å¯¹åº” MAL_HOSTï¼ŒPORT å¯¹åº” MAL_DW_PORT MON_DW_IP = 192.168.163.10:5436 3ï¼‰æ³¨å†Œç›‘è§†å™¨æœåŠ¡\rã€æ³¨æ„ã€‘ç¡®è®¤ç›‘è§†å™¨éœ€è¦æ³¨å†ŒæœåŠ¡ï¼Œéç¡®è®¤ç›‘è§†å™¨ä¸éœ€è¦æ³¨å†ŒæœåŠ¡\n1 2 3 [root@linux1 root]# ./dm_service_installer.sh -t dmmonitor -p Monitor -monitor_ini /home/dmdba/dmdbms/DMDB/dmmonitor.ini Created symlink from /etc/systemd/system/multi-user.target.wants/DmMonitorServiceMonitor.service to /usr/lib/systemd/system/DmMonitorServiceMonitor.service. åˆ›å»ºæœåŠ¡(DmMonitorServiceMonitor)å®Œæˆ é™„ï¼šåˆ é™¤ç›‘è§†å™¨æœåŠ¡\r1 [root@linux1 root]# ./dm_service_uninstaller.sh -n DmMonitorServiceMonitor 4ï¼‰ç›‘è§†å™¨å¯åŠ¨\r1 2 [dmdba@linux1 bin]# ./DmMonitorServiceMonitor start Starting DmMonitorServiceMonitor: ä¸Šä¸€æ¬¡ç™»å½•ï¼šæ—¥ 7æœˆ 21 11:07:16 CST 2024pts/1 ä¸Š\t[OK] ç›‘è§†å™¨çš„å¯åŠ¨ï¼Œéœ€è¦åœ¨è¾¾æ¢¦æ•°æ®åº“æœåŠ¡å¯åŠ¨æ‰èƒ½å¯\n5ï¼‰éç¡®è®¤ç›‘è§†å™¨çš„ä½¿ç”¨\rç¡®è®¤ç›‘è§†å™¨ä¸ºè‡ªåŠ¨åˆ‡æ¢ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨å®ƒ\nåªæœ‰éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ä¸»å¤‡çš„æ—¶å€™ï¼Œä½¿ç”¨éç¡®è®¤ç›‘è§†å™¨å°±è¡Œ\n5.1ï¼‰è¿›å…¥éç¡®è®¤ç›‘è§†å™¨\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [dmdba@linux1 bin]$ ./dmmonitor ../DMDB/dmmonitor_manual.ini [monitor] 2024-07-22 21:44:14: DMMONITOR[4.0] V8 [monitor] 2024-07-22 21:44:15: DMMONITOR[4.0] IS READY. [monitor] 2024-07-22 21:44:15: #-----------------------------------------------------------------------------------------------# GET MONITOR CONNECT INFO FROM DMWATCHER(GRP_TEST_01), THE FIRST LINE IS SELF INFO. DW_CONN_TIME MON_CONFIRM MID MON_IP MON_VERSION 2024-07-22 21:44:15 FALSE 930807350 ::ffff:192.168.163.9 DMMONITOR[4.0] V8 2024-07-22 21:34:50 TRUE 826253418 ::ffff:192.168.163.9 DMMONITOR[4.0] V8 #-----------------------------------------------------------------------------------------------# [monitor] 2024-07-22 21:44:15: æ”¶åˆ°å®ˆæŠ¤è¿›ç¨‹(GRP_TEST_01)æ¶ˆæ¯ WTIME WSTATUS INST_OK INAME ISTATUS IMODE RSTAT N_OPEN FLSN CLSN 2024-07-22 21:44:15 OPEN OK GRP_TEST_01 OPEN STANDBY NULL 5 43526 43526 [monitor] 2024-07-22 21:44:15: æ”¶åˆ°å®ˆæŠ¤è¿›ç¨‹(GRP_TEST_02)æ¶ˆæ¯ WTIME WSTATUS INST_OK INAME ISTATUS IMODE RSTAT N_OPEN FLSN CLSN 2024-07-22 21:44:15 OPEN OK GRP_TEST_02 OPEN PRIMARY VALID 5 43526 43526 5.2ï¼‰ç›‘è§†å™¨å‘½ä»¤\rå‘½ä»¤ å«ä¹‰ list æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ show global info æŸ¥çœ‹æ‰€æœ‰å®ä¾‹ç»„çš„ä¿¡æ¯ tip æŸ¥çœ‹ç³»ç»Ÿå½“å‰å…è®¸çŠ¶æ€ login ç™»å½•ç›‘è§†å™¨ï¼Œä½¿ç”¨çš„å…·æœ‰ DBA æƒé™æ•°æ®åº“ç”¨æˆ·ï¼ŒéæœåŠ¡å™¨ç”¨æˆ· logout é€€å‡ºç™»å½• choose switchover GRP1 ä¸»æœºæ­£å¸¸æ—¶ï¼ŒæŸ¥çœ‹å¯åˆ‡æ¢ä¸ºä¸»æœºçš„å®ä¾‹ switchover GRP1.GRP_TEST_01 ä¸»æœºæ­£å¸¸æ—¶ï¼Œä½¿ç”¨æŒ‡å®šç»„.å®ä¾‹ åˆ‡æ¢ä¸ºä¸»æœº choose takeover GRP1 ä¸»æœºæ•…éšœæ—¶ï¼ŒæŸ¥çœ‹å¯åˆ‡æ¢ä¸ºä¸»æœºçš„å®ä¾‹ takeover GRP1.GRP_TEST_01 ä¸»æœºæ•…éšœæ—¶ï¼Œä½¿ç”¨æŒ‡å®šç»„.å®ä¾‹ åˆ‡æ¢ä¸ºä¸»æœº choose takeover force GRP1 æŸ¥çœ‹å¯å¼ºåˆ¶åˆ‡æ¢ä¸ºä¸»æœºçš„å®ä¾‹ takeover force GRP1.GRP_TEST_01 ä½¿ç”¨ç»„.å®ä¾‹ å¼ºåˆ¶åˆ‡æ¢ä¸ºä¸»æœº ä½¿ç”¨å‘½ä»¤ä¾‹å­ï¼šéƒ½æ˜¯è¿›å…¥ç›‘è§†å™¨åç›´æ¥è¾“å…¥å³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 login ç”¨æˆ·å:SYSDBA å¯†ç : [monitor] 2024-07-22 21:46:33: ç™»å½•ç›‘è§†å™¨æˆåŠŸ! tip [monitor] 2024-07-22 21:49:01: [!!! æç¤ºï¼šæœ¬ç›‘è§†å™¨ä¸æ˜¯ç¡®è®¤ç›‘è§†å™¨ï¼Œåœ¨æ•…éšœè‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ä¸‹å¦‚æœå‘ç”Ÿä¸»åº“æ•…éšœï¼Œæœ¬ç›‘è§†å™¨æ— æ³•æ‰§è¡Œè‡ªåŠ¨æ¥ç®¡ !!!] [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_02[PRIMARY, OPEN, ISTAT_SAME:TRUE]ä¸å¯åŠ å…¥å…¶ä»–å®ä¾‹ï¼Œå®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼šOPENï¼ŒOpenè®°å½•çŠ¶æ€ï¼šVALID [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_02[PRIMARY, OPEN, ISTAT_SAME:TRUE]å½“å‰æ²¡æœ‰å‘½ä»¤æ­£åœ¨æ‰§è¡Œ [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_02[PRIMARY, OPEN, ISTAT_SAME:TRUE]è¿è¡Œæ­£å¸¸, å®ˆæŠ¤è¿›ç¨‹æ˜¯OPENçŠ¶æ€ï¼Œå®ˆæŠ¤ç±»å‹æ˜¯GLOBAL [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_01[STANDBY, OPEN, ISTAT_SAME:TRUE]å¯åŠ å…¥å®ä¾‹GRP_TEST_02[PRIMARY, OPEN, ISTAT_SAME:TRUE] [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_01[STANDBY, OPEN, ISTAT_SAME:TRUE]å½“å‰æ²¡æœ‰å‘½ä»¤æ­£åœ¨æ‰§è¡Œ [monitor] 2024-07-22 21:49:01: å®ä¾‹GRP_TEST_01[STANDBY, OPEN, ISTAT_SAME:TRUE]è¿è¡Œæ­£å¸¸, å®ˆæŠ¤è¿›ç¨‹æ˜¯OPENçŠ¶æ€ï¼Œå®ˆæŠ¤ç±»å‹æ˜¯GLOBAL [monitor] 2024-07-22 21:49:01: ç»„(GRP1)å½“å‰æ´»åŠ¨å®ä¾‹è¿è¡Œæ­£å¸¸ [monitor] 2024-07-22 21:49:01: æ‰€æœ‰ç»„ä¸­çš„æ´»åŠ¨å®ä¾‹è¿è¡Œæ­£å¸¸ï¼ å¯åŠ¨æœåŠ¡\rå¯åŠ¨æ•°æ®åº“å¹¶ä¿®æ”¹å‚æ•°\rA æœºå™¨ï¼Œå¯åŠ¨æ•°æ®åº“å®ä¾‹æœåŠ¡ï¼Œå¹¶ä¿®æ”¹ OGUID ä¸º dmwatcher.ini é‡Œé…ç½®çš„ OGUID ä¸€è‡´ï¼Œå¹¶å°† A æœºå™¨çš„åº“è®¾ç½®ä¸º PRIMARY æ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 [dmdba@linux1 bin]$ ./DmServiceGRP_TEST_01 start Starting DmServiceGRP_TEST_01: [ OK ] [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºæ™®é€šé…ç½®çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 19.397(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 40.185(æ¯«ç§’). æ‰§è¡Œå·:1. ################ # ä¿®æ”¹ OGUID ################ SQL\u0026gt; SP_SET_OGUID(45331); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 10.529(æ¯«ç§’). æ‰§è¡Œå·:2. ######################### # ä¿®æ”¹ä¸ºä¸»åº“ä¸º PRIMARY æ¨¡å¼ ######################### SQL\u0026gt; ALTER DATABASE PRIMARY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 34.763(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 26.340(æ¯«ç§’). æ‰§è¡Œå·:3. B æœºå™¨ï¼Œå¯åŠ¨æ•°æ®åº“å®ä¾‹æœåŠ¡ï¼Œå¹¶ä¿®æ”¹ OGUID ä¸º dmwatcher.ini é‡Œé…ç½®çš„ OGUID ä¸€è‡´ï¼Œå¹¶å°† B æœºå™¨çš„åº“è®¾ç½®ä¸º STANDBY æ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [dmdba@linux2 bin]$ ./DmServiceGRP_TEST_02 start Starting DmServiceGRP_TEST_02: [ OK ] [dmdba@linux2 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºæ™®é€šé…ç½®çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 48.562(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 50.707(æ¯«ç§’). æ‰§è¡Œå·:1. SQL\u0026gt; SP_SET_OGUID(45331); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 8.188(æ¯«ç§’). æ‰§è¡Œå·:2. SQL\u0026gt; ALTER DATABASE STANDBY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 48.859(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 36.601(æ¯«ç§’). æ‰§è¡Œå·:3. å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹\ræœºå™¨ A å’Œ B éƒ½å¯åŠ¨æ•°æ®å®ˆæŠ¤è¿›ç¨‹\n1 2 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcher start Starting DmWatcherServiceWatcher: [ OK ] åˆ°è¿™é‡Œï¼Œæ•°æ®åº“æœåŠ¡å¯åŠ¨å®Œæ¯•ï¼\né™„ï¼šé›†ç¾¤å¯åœ\råœ¨åˆšéƒ¨ç½²æ—¶ï¼ŒæŒ‰ç…§ æ•°æ®åº“ \u0026raquo; æ•°æ®å®ˆæŠ¤ çš„é¡ºåºï¼Œå¦‚ä¸Š\nå¦‚æœéœ€è¦é‡å¯æ—¶ï¼Œåˆ™åº”è¯¥ï¼šæ•°æ®å®ˆæŠ¤åœæ­¢ \u0026raquo; æ•°æ®åº“é‡å¯ \u0026raquo; æ•°æ®å®ˆæŠ¤å¯åŠ¨\n1 2 3 4 cd /home/dmdba/dmdbms/bin ./DmWatcherServiceWatcher stop ./DmServiceGRP_TEST_01 restart ./DmWatcherServiceWatcher start å¦‚æœéœ€è¦åœæ­¢æ—¶ï¼Œåˆ™åº”è¯¥ï¼šæ•°æ®å®ˆæŠ¤åœæ­¢ \u0026raquo; æ•°æ®åº“åœæ­¢\n1 2 3 cd /home/dmdba/dmdbms/bin ./DmWatcherServiceWatcher stop ./DmServiceGRP_TEST_01 stop æœ‰ç›‘è§†å™¨çš„æƒ…å†µä¸‹ï¼š\nå¯åŠ¨ï¼šæ•°æ®åº“å®ä¾‹ \u0026raquo; æ•°æ®å®ˆæŠ¤ \u0026raquo; ç›‘è§†å™¨\nåœæ­¢ï¼šç›‘è§†å™¨ \u0026raquo; æ•°æ®å®ˆæŠ¤ \u0026raquo; æ•°æ®åº“å®ä¾‹\né‡å¯åŒä¸Š\né…ç½® dm_svc.conf\rè¾¾æ¢¦æ•°æ®åº“åœ¨å®‰è£…å®Œæˆåï¼Œåœ¨ /etc ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª dm_svc.conf æ–‡ä»¶ï¼Œç”¨äºå®ç°è¾¾æ¢¦é›†ç¾¤çš„æ•…éšœè‡ªåŠ¨é‡è¿ã€è¯»å†™åˆ†ç¦»\nå¹¶ä¸”å®ƒå¯ä»¥åœ¨ JDBC ä¸­ä½¿ç”¨ï¼Œè¿æ¥æ•°æ®åº“æ—¶æŒ‡å®šè¿æ¥æœåŠ¡åï¼Œæ¥å£ä¼šéšæœºé€‰æ‹© ä¸€ä¸ª IP è¿›è¡Œè¿æ¥ï¼Œå¦‚æœè¿æ¥ä¸æˆåŠŸæˆ–è€…æœåŠ¡å™¨çŠ¶æ€ä¸æ­£ç¡®ï¼Œåˆ™é¡ºåºè·å–ä¸‹ä¸€ä¸ª IP è¿›è¡Œè¿æ¥ï¼Œ ç›´è‡³è¿æ¥æˆåŠŸæˆ–è€…éå†äº†æ‰€æœ‰ IP ã€‚\nåœ¨ å®æ–½éƒ¨ç½²-è¾¾æ¢¦æ•°æ®åº“linuxç‰ˆçš„å®‰è£…ï¼ˆäºŒï¼‰ | WeiQi Blog (weiqifun.github.io) ä¹Ÿè®°å½•æ€»ç»“è¿‡\nå®˜æ–¹æ–‡æ¡£ã€ŠDM8ç³»ç»Ÿç®¡ç†å‘˜æ‰‹å†Œ.pdfã€‹2.1.1.4 ç« èŠ‚ä»‹ç»äº†è¿™ä¸ªæ–‡ä»¶é‡Œè¯¦ç»†çš„å‚æ•°\nå®æ—¶ä¸»å¤‡æœåŠ¡åé…ç½®\rè¿™ä¸ªæ˜¯éœ€è¦æ•°æ®åº“æœåŠ¡å™¨ä¸Šé…ç½®ï¼Œåº”ç”¨æœåŠ¡å™¨ä¸Šä¹Ÿè¦é…ç½®ï¼Œå³åº”ç”¨å¦‚æœæƒ³è¦é€šè¿‡æœåŠ¡åè¿æ¥æ•°æ®åº“ï¼Œåˆ™ä¹Ÿéœ€è¦é…ç½®è¿™ä¸ªæ–‡ä»¶ï¼ŒåŒæ–¹æ‰èƒ½äº’ç›¸é€šä¿¡\nlinux åœ¨ /etc/dm_svc.conf\nwindows åœ¨ C:\\Windows\\System32 ï¼ˆå¤šæ•° 64 ä½æœºå™¨æ˜¯è¿™ä¸ªä½ç½®ï¼Œåæ­£æ˜¯åœ¨ %SystemRoot%\\system32 ä¸‹ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 vi /etc/dm_svc.conf ###################### æ·»åŠ ä»¥ä¸‹å†…å®¹ ############################# # å…¨å±€é…ç½® TIME_ZONE=(480) # æ—¶åŒº +8:00 60ä¸€ä¸ªæ—¶åŒº LANGUAGE=(cn) GRP1=(192.168.163.9:5236,192.168.163.10:5236) # æœåŠ¡å = (å„ä¸ªæ•°æ®åº“çš„ IP:PORT ) é€—å·åˆ†å‰² # æœåŠ¡é…ç½® [GRP1] TIME+ZONE=(+480) # æŒ‡å®šä¼˜å…ˆç™»å½•çš„æœåŠ¡å™¨æ¨¡å¼ 0-ä¼˜å…ˆPRIMARY 1-åªè¿æ¥ä¸»åº“ 2-åªè¿æ¥å¤‡åº“ 3-ä¼˜å…ˆSTANDBY 4-ä¼˜å…ˆNORMALï¼ˆç¼ºçœé»˜è®¤ï¼‰ LOGIN_MODE=(1) SWITCH_TIME=(3) # ä»¥æœåŠ¡åè¿æ¥æ•°æ®åº“æ—¶ï¼Œå‘ç”Ÿæ•…éšœæ—¶ï¼Œå¤±è´¥é‡è¿æ¬¡æ•° SWITCH_INTERVAL=(200) # ä¸»å¤‡æœåŠ¡å™¨åˆ‡æ¢ã€é‡è¿ç­‰å¾…çš„æ—¶é—´é—´éš”ï¼Œæ¯«ç§’ ###################### ä»¥ä¸Šä¸ºå®æ—¶ä¸»å¤‡æ•°æ®å®ˆæŠ¤é…ç½® ##################################### # è¯»å†™åˆ†ç¦»é…ç½® RW_SEPARATE=(1) # å¯ç”¨è¯»å†™åˆ†ç¦»ï¼Œä½¿ç”¨æ­¤å‚æ•°æ—¶ï¼ŒLOGIN_MODE å‚æ•°å¤±æ•ˆ RW_PERCENT=(25) # è¯»å†™åˆ†ç¦»æ—¶ï¼Œè¯»å†™åˆ†ç¦»çš„åˆ†å‘æ¯”ä¾‹ JDBC è¿æ¥\r1 2 jdbc:dm://GRP1?schema=TEST jdbc:dm://GRP1?schema=TEST\u0026amp;columnNameUpperCase=false è¾¾æ¢¦ç®¡ç†å·¥å…·è¿æ¥\rå› ä¸ºç›®å‰æ‰‹ä¸Šçš„æœºå™¨ä¸º LINUX + WINDOWS ï¼Œåº”ç”¨åœ¨ WINDOWS ä¸Šï¼Œæ‰€ä»¥æˆ‘åœ¨ C:\\Windows\\System32 æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œç›¸åŒçš„é…ç½®ã€‚åº”ç”¨åœ¨ LINUX ä¸Šåˆ™åŒç†æ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„è·¯å¾„ã€‚\næŠŠå®¢æˆ·ç«¯é‡å¯ï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ\nåˆ°è¿™é‡Œä¹Ÿå°± OK äº†ï¼ŒæœåŠ¡åé…ç½®æˆåŠŸ\néªŒè¯-ä¸»åº“æŒ‚æ‰åæ˜¯å¦ä¼šè‡ªåŠ¨åˆ‡æ¢\r1ï¼‰åœæ­¢ä¸»åº“\ré‡‡ç”¨çš„æ–¹å¼ä¸ºåœæ­¢ä¸»åº“ï¼ˆå³æŠŠä¸»åº“çš„DmWatcherå®ˆæŠ¤è¿›ç¨‹æœåŠ¡ã€DmServiceæœåŠ¡åœæ­¢æ‰ï¼‰ï¼Œçœ‹çœ‹ä½¿ç”¨æœåŠ¡åæ˜¯å¦èƒ½è¿æ¥åˆ°å¤‡åº“\n1 2 3 4 5 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcher stop Stopping DmWatcherServiceWatcher: [ OK ] [dmdba@linux1 bin]$ ./DmServiceGRP_TEST_01 stop Stopping DmServiceGRP_TEST_01: [ OK ] æˆ‘æŠŠè¾¾æ¢¦å®¢æˆ·ç«¯é‡å¯ï¼Œé‡æ–°è¿æ¥ GRP1\næŠ¥é”™æœåŠ¡å™¨æ¨¡å¼ä¸åŒ¹é…ï¼Œå› ä¸º dm_svc.conf çš„ LOGIN_MODE = 1 åªè¿æ¥ PRIMARY åº“ï¼Œå› æ­¤ä¸»åº“æŒ‚æ‰åæ— æ³•è¿æ¥åˆ°å¤‡åº“\nä¿®æ”¹æ•°æ®åº“æœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨çš„ dm_svc.conf é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹é‡Œè¾¹çš„ LOGIN_MODE=0 ï¼Œä¼˜å…ˆè¿æ¥ PRIMARY\nå†é‡å¯å®¢æˆ·ç«¯ï¼Œé‡è¿ GRP1\nå—¯ï¼Œè¿™ä¸ªè¿æ¥è¿‡ç¨‹ä¼šæœ‰æ˜æ˜¾çš„å¡é¡¿äº†ä¸€ä¸‹ï¼Œä¼°è®¡æ˜¯åœ¨éå† GRP1 é‡Œçš„æ•°æ®åº“å®ä¾‹\nå½“å‰è¿çš„æ˜¯å¤‡åº“ï¼ˆå¤‡åº“æ˜¯ STANDBY æ¨¡å¼ï¼Œå› ä¸ºæ²¡æœ‰ç›‘è§†å™¨ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»å¤‡çš„ï¼Œæˆ‘è¿™è¾¹æ²¡æœ‰æ‰‹åŠ¨åˆ‡æ¢ï¼Œæ‰€ä»¥è¿æ¥åˆ°å¤‡åº“ï¼Œåªæä¾›åªè¯»æœåŠ¡ï¼‰\n2ï¼‰é‡å¯ä¸»åº“\ræŠŠä¸»åº“é‡æ–°å¯åŠ¨ï¼Œå†é‡å¯å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿æ¥æ­£å¸¸çš„\n1 2 SELECT NAME, INSTANCE_NAME, STATUS$, MODE$ FROM V$INSTANCE; -- MODE$ çš„å€¼ä¸º PRIMARY éªŒè¯å®æ—¶åŒæ­¥\réªŒè¯ä¸€ï¼šä¸»åº“æ“ä½œ\r1ï¼‰æ‰§è¡Œåˆ›å»ºè¡¨ç©ºé—´ã€ç”¨æˆ·ã€æˆæƒç­‰æ“ä½œ\ræ‰“å¼€è¾¾æ¢¦ç®¡ç†å·¥å…·ï¼Œè¿æ¥åˆ°ä¸»åº“ï¼ˆ192.168.163.9:5236ï¼‰ï¼Œé»˜è®¤çš„ç®¡ç†å‘˜ç”¨æˆ· SYSDBA/SYSDBA\n1 2 3 4 5 6 7 8 9 10 11 12 CREATE TABLESPACE \u0026#34;TS_TEST\u0026#34; DATAFILE \u0026#39;/home/dmdba/dmdbms/DMDB/TS_TEST.DBF\u0026#39; SIZE 500 AUTOEXTEND ON NEXT 40 MAXSIZE 2048; CREATE USER \u0026#34;TEST\u0026#34; IDENTIFIED BY \u0026#34;TEST123456\u0026#34; DEFAULT TABLESPACE \u0026#34;TS_TEST\u0026#34;; GRANT \u0026#34;DBA\u0026#34; TO \u0026#34;TEST\u0026#34;; GRANT DELETE ANY TABLE TO TEST; GRANT EXECUTE ANY PROCEDURE TO TEST; GRANT INSERT ANY TABLE TO TEST; GRANT SELECT ANY DICTIONARY TO TEST; GRANT SELECT ANY TABLE TO TEST; GRANT UNLIMITED TABLESPACE TO TEST; GRANT UPDATE ANY TABLE TO TEST; è¿æ¥å¤‡åº“ï¼ˆ192.168.163.10:5236ï¼‰ï¼ŒéªŒè¯æ˜¯å¦æœ‰åˆšåˆšåˆ›å»ºçš„è¡¨ç©ºé—´ã€ç”¨æˆ·\nä¸»å¤‡å®æ—¶åŒæ­¥æ­£å¸¸\n2ï¼‰åˆ›å»ºè¡¨ã€æ’å…¥æ•°æ®æ“ä½œ\ræ‰“å¼€è¾¾æ¢¦ç®¡ç†å·¥å…·ï¼Œè¿æ¥åˆ°ä¸»åº“ï¼ˆ192.168.163.9:5236ï¼‰ï¼Œé»˜è®¤çš„ç®¡ç†å‘˜ç”¨æˆ· SYSDBA/SYSDBA\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 CREATE TABLE \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; ( \u0026#34;BUSI_DATE\u0026#34; INTEGER, \u0026#34;NAME\u0026#34; VARCHAR2(20), \u0026#34;AGE\u0026#34; VARCHAR2(2), \u0026#34;SEX\u0026#34; VARCHAR2(1)) STORAGE(ON \u0026#34;TS_TEST\u0026#34;, CLUSTERBTR) ; COMMENT ON COLUMN \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34;.\u0026#34;SEX\u0026#34; IS \u0026#39;1-ç”·; 2-å¥³\u0026#39;; INSERT INTO \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; (\u0026#34;BUSI_DATE\u0026#34;, \u0026#34;NAME\u0026#34;, \u0026#34;AGE\u0026#34;, \u0026#34;SEX\u0026#34;) VALUES (20240702, \u0026#39;DY L\u0026#39;, \u0026#39;18\u0026#39;, \u0026#39;1\u0026#39;); INSERT INTO \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; (\u0026#34;BUSI_DATE\u0026#34;, \u0026#34;NAME\u0026#34;, \u0026#34;AGE\u0026#34;, \u0026#34;SEX\u0026#34;) VALUES (20240702, \u0026#39;DO W\u0026#39;, \u0026#39;19\u0026#39;, \u0026#39;1\u0026#39;); INSERT INTO \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; (\u0026#34;BUSI_DATE\u0026#34;, \u0026#34;NAME\u0026#34;, \u0026#34;AGE\u0026#34;, \u0026#34;SEX\u0026#34;) VALUES (20240702, \u0026#39;PE J\u0026#39;, \u0026#39;10\u0026#39;, \u0026#39;2\u0026#39;); INSERT INTO \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; (\u0026#34;BUSI_DATE\u0026#34;, \u0026#34;NAME\u0026#34;, \u0026#34;AGE\u0026#34;, \u0026#34;SEX\u0026#34;) VALUES (20240702, \u0026#39;DER K\u0026#39;, \u0026#39;52\u0026#39;, \u0026#39;1\u0026#39;); INSERT INTO \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_1\u0026#34; (\u0026#34;BUSI_DATE\u0026#34;, \u0026#34;NAME\u0026#34;, \u0026#34;AGE\u0026#34;, \u0026#34;SEX\u0026#34;) VALUES (20240702, \u0026#39;NC VC\u0026#39;, \u0026#39;60\u0026#39;, \u0026#39;2\u0026#39;); COMMIT; è¿æ¥å¤‡åº“ï¼ˆ192.168.163.10:5236ï¼‰ï¼ŒéªŒè¯æ˜¯å¦æœ‰åˆšåˆšåˆ›å»ºè¡¨å’Œæ•°æ®\n1 2 3 4 5 6 7 8 9 10 SELECT * FROM TEST.ST_TEST_1; BUSI_DATE NAME AGE SEX 20240702 DY L 18 1 20240702 DO W 19 1 20240702 PE J 10 2 20240702 DER K 52 1 20240702 NC VC 60 2 ä¸»å¤‡å®æ—¶åŒæ­¥æ­£å¸¸\néªŒè¯äºŒï¼šå¤‡åº“å†™æ“ä½œ\rå› ä¸ºå¤‡åº“æ˜¯ STANDBY æ¨¡å¼ï¼Œæä¾›åªè¯»æœåŠ¡ï¼Œæ˜¯ä¸èƒ½å¾€å¤‡åº“æ“ä½œå¯¹è±¡çš„ï¼Œæ‰€ä»¥çœ‹çœ‹æ˜¯å¦æ¨¡å¼ç”Ÿæ•ˆ\nè¿æ¥å¤‡åº“ï¼ˆ192.168.163.10:5236ï¼‰ï¼Œä½¿ç”¨ SYSDBA ç®¡ç†å‘˜ç”¨æˆ·è¯•å›¾åˆ›å»ºä¸€å¼ è¡¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [æ‰§è¡Œè¯­å¥1]: CREATE TABLE \u0026#34;TEST\u0026#34;.\u0026#34;ST_TEST_2\u0026#34; ( \u0026#34;BUSI_DATE\u0026#34; INTEGER, \u0026#34;NAME\u0026#34; VARCHAR2(20), \u0026#34;AGE\u0026#34; VARCHAR2(2), \u0026#34;SEX\u0026#34; VARCHAR2(1)) STORAGE(ON \u0026#34;TS_TEST\u0026#34;, CLUSTERBTR) ; æ‰§è¡Œå¤±è´¥(è¯­å¥1) -710: è¯•å›¾åœ¨STANDBYæ¨¡å¼ä¸‹ï¼Œä¿®æ”¹ç”¨æˆ·åº“ 1æ¡è¯­å¥æ‰§è¡Œå¤±è´¥ [æ‰§è¡Œè¯­å¥1]: DELETE FROM TEST.ST_TEST_1; æ‰§è¡Œå¤±è´¥(è¯­å¥1) -710: è¯•å›¾åœ¨STANDBYæ¨¡å¼ä¸‹ï¼Œä¿®æ”¹ç”¨æˆ·åº“ ä¸»å¤‡æ¨¡å¼æ­£å¸¸\næ— ç›‘è§†å™¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢\rå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œæ²¡æœ‰é…ç½®ç›‘è§†å™¨çš„å®æ—¶ä¸»å¤‡ï¼Œå¦‚ä½•è¿›è¡Œåˆ‡æ¢ä¸»å¤‡åº“ï¼Ÿ\nç›´æ¥ä½¿ç”¨ SQL è¿›è¡Œåˆ‡æ¢ï¼Œåˆ‡æ¢ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ VMware çš„å¿«ç…§åŠŸèƒ½å¤‡ä»½ä¸€ä¸‹å½“å‰çš„æœåŠ¡å™¨çŠ¶æ€ï¼Œå¢åŠ ä¸»å¤‡åˆ‡æ¢çš„å®¹é”™ï¼Œè®©è‡ªå·±èƒ½å¤Ÿä½¿ç”¨å¿«ç…§å¿«é€Ÿæ¢å¤åˆ°åˆšåˆšæ­å»ºå¥½é›†ç¾¤çš„çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 -- å…ˆå°†æ•°æ®åº“åˆ‡æ¢ä¸º Mount çŠ¶æ€ [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºä¸»åº“æ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 37.834(ms) disql V8 SQL\u0026gt; ALTER DATABASE MOUNT; ALTER DATABASE MOUNT; ç¬¬1 è¡Œé™„è¿‘å‡ºç°é”™è¯¯[-720]:å®ˆæŠ¤è¿›ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæˆ–å½“å‰é…ç½®(ALTER_MODE_STATUS)ä¸å…è®¸è¯¥æ“ä½œ. å·²ç”¨æ—¶é—´: 1.582(æ¯«ç§’). æ‰§è¡Œå·:0. ################################################## # éœ€è¦å…ˆå…³é—­æ•°æ®å®ˆæŠ¤ å’Œ ä¿®æ”¹ ALTER_MODE_STATUS å‚æ•° ################################################## éœ€è¦å°†å®ˆæŠ¤è¿›ç¨‹å…³æ‰å’Œæ¨¡å¼çš„å‚æ•°ä¿®æ”¹ä¸ºå¯ä¿®æ”¹ï¼Œæ‰èƒ½åˆ‡æ¢ï¼Œå…³æ‰å®ˆæŠ¤è¿›ç¨‹çš„é¡ºåºï¼š\nå¤‡åº“çš„å®ˆæŠ¤è¿›ç¨‹ \u0026raquo; ä¸»åº“çš„å®ˆæŠ¤è¿›ç¨‹ï¼ˆå…¶å®æ— æ‰€è°“ï¼‰\nã€æ³¨æ„ã€‘\réœ€è¦ç¡®ä¿æ•°æ®åº“ä¸­æ²¡æœ‰æ´»åŠ¨äº‹åŠ¡ï¼Œæ‰‹åŠ¨åˆ‡æ¢éœ€è¦å°†æ•°æ®åº“è°ƒæ•´ä¸º mount çŠ¶æ€ï¼Œå®ƒä¼šå›æ»šæ‰€ä»¥å¤„äºæ´»åŠ¨ä¸­çš„äº‹åŠ¡ï¼Œå·²æäº¤çš„äº‹åŠ¡ä¸å½±å“ã€‚\næ‰€ä»¥ç¡®ä¿ä¸€ä¸‹å½“ä¸‹æ•°æ®åº“äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰æ­£åœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œçš„ï¼Œå¼ºè¡Œè°ƒæ•´çš„è¯ï¼Œåç»­åˆ‡æ¢æˆåŠŸåï¼Œéœ€è¦æ‰‹åŠ¨é‡æ–°æ‰§è¡Œå¢åˆ æ”¹çš„äº‹åŠ¡ã€‚\nA æœºå™¨æ“ä½œï¼ˆä¸»åº“æ“ä½œï¼‰\rä¸»åº“åˆ‡æ¢ä¸º PRIMARY æ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcher stop Stopping DmWatcherServiceWatcher: [ OK ] [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºä¸»åº“æ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 20.108(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 37.106(æ¯«ç§’). æ‰§è¡Œå·:1001. SQL\u0026gt; ALTER DATABASE MOUNT; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 71.860(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE STANDBY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 73.077(æ¯«ç§’). æ‰§è¡Œå·:0. ################## # é NORMAL æ¨¡å¼éœ€è¦ OPEN FORCE å¼ºåˆ¶å¼€å¯ ################## SQL\u0026gt; ALTER DATABASE OPEN FORCE; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 33.830(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 36.470(æ¯«ç§’). æ‰§è¡Œå·:1002. B æœºå™¨æ“ä½œï¼ˆå¤‡åº“æ“ä½œï¼‰\rå¤‡åº“åˆ‡æ¢ä¸º STANDBY æ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 [dmdba@linux2 bin]$ ./DmWatcherServiceWatcher stop Stopping DmWatcherServiceWatcher: [ OK ] [dmdba@linux2 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºå¤‡åº“æ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 21.257(ms) disql V8 SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,1); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 36.238(æ¯«ç§’). æ‰§è¡Œå·:301. SQL\u0026gt; ALTER DATABASE MOUNT; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 20.816(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE PRIMARY; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 66.994(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE OPEN; ALTER DATABASE OPEN; ç¬¬1 è¡Œé™„è¿‘å‡ºç°é”™è¯¯[-516]:éNORMALæ¨¡å¼éœ€è¦OPEN FORCE. å·²ç”¨æ—¶é—´: 0.959(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; ALTER DATABASE OPEN FORCE; æ“ä½œå·²æ‰§è¡Œ å·²ç”¨æ—¶é—´: 93.506(æ¯«ç§’). æ‰§è¡Œå·:0. SQL\u0026gt; SP_SET_PARA_VALUE(1,\u0026#39;ALTER_MODE_STATUS\u0026#39;,0); DMSQL è¿‡ç¨‹å·²æˆåŠŸå®Œæˆ å·²ç”¨æ—¶é—´: 32.835(æ¯«ç§’). æ‰§è¡Œå·:302. å¯åŠ¨æ•°æ®å®ˆæŠ¤\rA \\ B æœºå™¨éƒ½å¯åŠ¨\n1 2 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcher start Starting DmWatcherServiceWatcher: [ OK ] éªŒè¯åˆ‡æ¢æ˜¯å¦æˆåŠŸ\ræŸ¥çœ‹å®ä¾‹çš„æ¨¡å¼\rA æœºå™¨æŸ¥çœ‹ï¼Œå› ä¸ºå·²ç»å°† A åˆ‡æ¢ä¸ºå¤‡åº“äº†ï¼Œæ‰€ä»¥ ./disql ä¼šæ˜¾ç¤ºå¤„äºå¤‡åº“æ‰“å¼€çŠ¶æ€\n1 2 3 4 5 6 7 8 9 10 11 12 [dmdba@linux1 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºå¤‡åº“æ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 18.106(ms) disql V8 SQL\u0026gt; SELECT NAME, INSTANCE_NAME, STATUS$, MODE$ FROM V$INSTANCE; è¡Œå· NAME INSTANCE_NAME STATUS$ MODE$ ---------- ----------- ------------- ------- ------- 1 GRP_TEST_01 GRP_TEST_01 OPEN STANDBY B æœºå™¨æŸ¥çœ‹ï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12 [dmdba@linux2 bin]$ ./disql SYSDBA/SYSDBA æœåŠ¡å™¨[LOCALHOST:5236]:å¤„äºä¸»åº“æ‰“å¼€çŠ¶æ€ ç™»å½•ä½¿ç”¨æ—¶é—´ : 31.640(ms) disql V8 SQL\u0026gt; SELECT NAME, INSTANCE_NAME, STATUS$, MODE$ FROM V$INSTANCE; è¡Œå· NAME INSTANCE_NAME STATUS$ MODE$ ---------- ----------- ------------- ------- ------- 1 GRP_TEST_02 GRP_TEST_02 OPEN PRIMARY åœ¨ä¸»åº“æ“ä½œ\rä¸»åº“æ‰§è¡Œ SQL\n1 2 3 CREATE TABLE \u0026#34;TEST\u0026#34;.\u0026#34;T_LISTAGG_TEST\u0026#34; ( \u0026#34;ID\u0026#34; INTEGER, \u0026#34;C1\u0026#34; VARCHAR(4000)) STORAGE(ON \u0026#34;TS_TEST\u0026#34;, CLUSTERBTR) ; åœ¨å¤‡åº“ä¸­æŸ¥çœ‹æ˜¯å¦åŒæ­¥ï¼Œå·²åŒæ­¥è¯æ˜æ²¡é—®é¢˜\nç¡®è®¤ç›‘è§†å™¨è‡ªåŠ¨åˆ‡æ¢éªŒè¯\råœ¨ã€6 æ— ç›‘è§†å™¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢ã€‘æ­¥éª¤ä¸­ï¼Œå·²ç»æŠŠ A æœºå™¨(GRP_TEST_01)åˆ‡æ¢ä¸ºå¤‡åº“ï¼ŒB æœºå™¨(GRP_TEST_02)åˆ‡æ¢ä¸ºä¸»åº“äº†ã€‚\næŠŠä¸»åº“ GRP_TEST_02 æŒ‚æ‰ï¼ˆå³æŠŠä¸»åº“çš„DmWatcherå®ˆæŠ¤è¿›ç¨‹æœåŠ¡ã€DmServiceæœåŠ¡åœæ­¢æ‰ï¼‰ï¼Œç„¶åä½¿ç”¨è¾¾æ¢¦ç®¡ç†å·¥å…·ä½¿ç”¨æœåŠ¡åè¿›å…¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿æ¥åˆ° GRP_TEST_01 å¹¶ä¸”å°†è¯¥æ•°æ®åº“æ˜¯æ¨¡å¼åˆ‡æ¢ä¸º PRIMARY\n1 2 3 4 [dmdba@linux2 bin]$ ./DmWatcherServiceWatcher stop Stopping DmWatcherServiceWatcher: [ OK ] [dmdba@linux2 bin]$ ./DmServiceGRP_TEST_02 stop Stopping DmServiceGRP_TEST_02: [ OK ] ç¡®è®¤æ˜¯è‡ªåŠ¨åˆ‡æ¢äº† OK\néç¡®è®¤ç›‘è§†å™¨åˆ‡æ¢\rè¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´æ˜äº†ï¼ŒæŠŠç¡®è®¤ç›‘è§†å™¨å¤±æ•ˆæ‰ï¼ˆæŠŠé‡Œè¾¹çš„ MON_DW_CONFIRM æ”¹ä¸º 1ï¼‰ï¼Œç„¶åä½¿ç”¨éç¡®è®¤ç›‘è§†å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å‰å°æ–¹å¼è¿›å…¥éç¡®è®¤ç›‘è§†å™¨ cd /home/dmdba/dmdbms/bin ./dmmonitor /home/dmdba/dmdbms/DMDB/dmmonitor_manual.ini # æ£€æŸ¥é›†ç¾¤çŠ¶æ€ tip # ç™»å½•éç¡®è®¤ç›‘è§†å™¨ï¼šä½¿ç”¨æœ‰ DBA æƒé™çš„ç”¨æˆ·ï¼Œæˆ‘ç”¨ SYSBDA login # æŸ¥çœ‹æ»¡è¶³åˆ‡æ¢æ¡ä»¶çš„å®ä¾‹ choose switchover GRP1 # è¿›è¡Œä¸»å¤‡åˆ‡æ¢ switchover GRP1.GRP_TEST_01 # åˆ‡æ¢æˆåŠŸï¼Œé€€å‡ºç›‘è§†å™¨ logout # å†æ¬¡æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ tip # æ­£å¸¸äº†ï¼Œé€€å‡ºéç¡®è®¤ç›‘è§†å™¨å³å¯ exit æŠ¥é”™é—®é¢˜\rä¸»è¦è¿˜æ˜¯æ­¥éª¤å¹¶æ²¡æœ‰æŒ‰é¡ºåºæ¥å¯¼è‡´çš„ï¼Œæˆ–è€…é…ç½®æ–‡ä»¶é‡Œé…ç½®é”™è¯¯å¯¼è‡´\nå¯åŠ¨æ•°æ®å®ˆæŠ¤æŠ¥é”™\r1 2 3 4 5 6 [dmdba@linux1 bin]$ ./dmwatcher /home/dmdba/dmdbms/DMDB/dmwatcher.ini DMWATCHER[4.0] V8 Invalid [mal_name] or the file contains unrecognized characters in [/home/dmdba/dmdbms/DMDB/dmmal.ini]! Read ini file(/home/dmdba/dmdbms/DMDB/dmmal.ini) error in line 1, code(-104) Read dm.ini(/home/dmdba/dmdbms/DMDB/dm.ini) failed, code = -104! fail to read ini file è¯»ä¸¤ä¸ªæ–‡ä»¶æŠ¥é”™äº†ï¼Œç¬¬ä¸€ä¸ªæŠ¥é”™ç»™å‡ºäº†æ˜ç¡®çš„åˆ—\ndmmal.ini çš„ç¬¬ä¸€åˆ—æŠ¥é”™ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹ï¼Œå¤åˆ¶è¿›shellçš„æ—¶å€™ï¼Œç¼ºå°‘äº† MA ä¸¤ä¸ªå­—æ¯ï¼Œè¡¥å……å½¢æˆå®Œæ•´çš„\nMAL_CHECK_INTERVAL å‚æ•°\n1 MAL_CHECK_INTERVAL = 10 #MAL é“¾è·¯æ£€æµ‹æ—¶é—´é—´éš” ç„¶åé‡æ–°å¯åŠ¨å°±æˆåŠŸäº†\n1 2 [dmdba@linux1 bin]$ ./DmWatcherServiceWatcher start Starting DmWatcherServiceWatcher: [ OK ] å¯åŠ¨æ•°æ®åº“å®ä¾‹æŠ¥é”™\r1 2 [dmdba@linux1 bin]$ ./DmServiceGRP_TEST_01 start Starting DmServiceGRP_TEST_01: [ FAILED ] æŸ¥çœ‹æ—¥å¿— dm_å®ä¾‹å_å¹´æœˆ.log\n1 2 2024-07-21 11:22:01.998 [INFO] database P0000036451 T0000000000000036513 utsk_tcp_conn_validate failed, seqno:0, from_name:, code:-9423! 2024-07-21 11:22:03.014 [INFO] database P0000036451 T0000000000000036513 Dmwatcher oguid(45331) is not match with local dmserver oguid(0), code -9423, cannot build connection! æŸ¥çœ‹æ•°æ®å®ˆæŠ¤çš„æ—¥å¿— dm_dmwatcher_å®ä¾‹å_å¹´æœˆ.log\n1 2024-07-21 11:26:58.830 [INFO] dmwatcher P0000036411 T0000000000000036416 dw2_tcp_conn_startup, oguid(45331) configured in dmwatcher.ini not equal with local dmserver\u0026#39;s oguid(0)! æ˜¯å› ä¸ºæ²¡æœ‰å¯åŠ¨æ•°æ®åº“ï¼Œå¹¶åˆ°æ•°æ®åº“é‡Œä¿®æ”¹ OGUID å‚æ•°å¯¼è‡´ã€‚çœ‹ä¸Šè¾¹å¯åŠ¨æœåŠ¡æ­¥éª¤ã€‚\n","date":"2024-07-21T22:10:12+08:00","permalink":"http://localhost:1313/posts/2024/07/%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-%E8%BE%BE%E6%A2%A6%E5%AE%9E%E6%97%B6%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5%E4%BA%8C/","title":"ä¸»å¤‡é›†ç¾¤ è¾¾æ¢¦å®æ—¶ä¸»å¤‡é›†ç¾¤æ­å»ºä¸ä¸»å¤‡åˆ‡æ¢å®è·µï¼ˆäºŒï¼‰"},{"content":"ä¸ºäº†å¼„æ¸…è¾¾æ¢¦çš„æ•°æ®å®ˆæŠ¤ï¼Œå®æ“ä¸»å¤‡é›†ç¾¤æ­å»ºå®è·µï¼Œåšæ¦‚å¿µçš„åŸºæœ¬äº†è§£ã€‚\næ€»ç»“ä¸€ç¯‡æ•°æ®å®ˆæŠ¤çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬æ•°æ®åº“æ¨¡å¼ã€æ•°æ®åº“çŠ¶æ€ã€å½’æ¡£ç­‰æ¦‚å¿µï¼Œåœ¨æ­å»ºä¸»å¤‡é›†ç¾¤æ—¶ï¼Œèƒ½æ¸…æ¥šçš„çŸ¥é“è‡ªå·±æ˜¯åœ¨åšä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšã€‚\nè¾¾æ¢¦æ•°æ®å®ˆæŠ¤æ¦‚å¿µ\rè¾¾æ¢¦æ•°æ®å®ˆæŠ¤ï¼Œä¸ºæ•°æ®åº“å®¹ç¾æ–¹æ¡ˆï¼Œé€šè¿‡æ•°æ®åº“ä¸»å¤‡é›†ç¾¤ï¼Œè¿›è¡Œå®æ—¶ä¸»å¤‡åˆ‡æ¢ï¼Œåœ¨ä¸»åº“å‡ºç°å¼‚å¸¸æ—¶ï¼Œè‡ªå¸¦åˆ‡æ¢å¤‡åº“å¯¹åº”ç”¨æä¾›æ•°æ®åº“æœåŠ¡ã€‚\næ•°æ®å®ˆæŠ¤åŸç†\rDMæ•°æ®å®ˆæŠ¤ DM DATA WATCH åŸç†ï¼š\nä¸»åº“äº§ç”Ÿçš„ Redo æ—¥å¿— \u0026raquo; ä¼ åˆ°å¤‡åº“ \u0026raquo; å¤‡åº“é‡æ¼” Redo æ—¥å¿—ï¼Œå®ç°ä¸»å¤‡åº“æ•°æ®åŒæ­¥\næ•°æ®å®ˆæŠ¤ç»„æˆ\rä¸»åº“\nå¤‡åº“\nRedo æ—¥å¿—\nRedo æ—¥å¿—ä¼ è¾“\nRedo æ—¥å¿—é‡æ¼”\nå®ˆæŠ¤è¿›ç¨‹ DmWatcher\nç›‘è§†å™¨ DmMonitor\nä¸»åº“\rä¸»åº“ä½¿ç”¨ Primary æ¨¡å¼ï¼Œæœ‰å®Œæ•´çš„æ•°æ®åº“æœåŠ¡\nå¤‡åº“\rä½¿ç”¨ Standby æ¨¡å¼ï¼Œæä¾›åªè¯»æœåŠ¡\nRedo æ—¥å¿—\rRedo æ—¥å¿—é‡Œï¼Œè®°å½•äº†ç‰©ç†æ•°æ®é¡µå†…å®¹å˜åŠ¨çš„æƒ…å†µï¼ˆåœ¨éƒ¨ç½²æ—¶ï¼Œç¡®å®šé¡µå¤§å°ï¼Œå°±æ˜¯ä¸ºäº†å•é¡µèƒ½å¤Ÿè®°å½•æ›´å¤šçš„å†…å®¹ï¼‰\nInert \\ Update \\ Delete \\ Create ç­‰ DML å’Œ DDL æ“ä½œéƒ½ä¼šè®°å½•åˆ° Redo æ—¥å¿—é‡Œ\nRedo æ—¥å¿—é‡æ¼”\rè¾¾æ¢¦æœ‰ä¸“é—¨çš„ Redo æ—¥å¿—é‡æ¼”çš„æœåŠ¡\nå®ˆæŠ¤è¿›ç¨‹\rDmWatcher ç”¨æ¥ç›‘æ§æ•°æ®åº“å®ä¾‹çš„è¿è¡ŒçŠ¶æ€å’Œä¸»å¤‡åº“åŒæ­¥æƒ…å†µçš„ï¼Œå®ƒæ¥æ”¶å„ç§æ¶ˆæ¯ï¼ˆæ•°æ®åº“å®ä¾‹ã€ç›‘è§†å™¨çš„æ¶ˆæ¯ï¼‰\nç›‘è§†å™¨\rDmMonitor ç”¨æ¥ç›‘æ§å®ˆæŠ¤è¿›ç¨‹ã€æ•°æ®åº“å®ä¾‹çš„ä¿¡æ¯ï¼Œç›‘æ§å®ä¾‹æ•…éšœã€è‡ªåŠ¨åˆ‡æ¢ä¸»å¤‡çš„ã€‚\nç°æœ‰çš„æ¥è§¦é¡¹ç›®çš„æƒ…å†µï¼Œæ˜¯æ²¡æœ‰è¿™ä¸ªçš„ï¼Œç›‘è§†å™¨éœ€è¦å•ç‹¬ä¸€å°æœåŠ¡å™¨ï¼Œæ¥ç›‘æ§æ•°æ®åº“å®ä¾‹å’Œå®ˆæŠ¤è¿›ç¨‹ã€‚\nä¸è¿‡è¦æ˜¯é…ç½®åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æœåŠ¡å™¨ä¸èƒ½å¼‚å¸¸å°±è¡Œï¼Œè¿™ç§æƒ…å†µåªå…è®¸è¿›ç¨‹å¼‚å¸¸ã€‚\næ™®é€šçš„é¡¹ç›®ï¼Œé€šå¸¸æ˜¯ä¸€ä¸»ä¸€å¤‡ï¼Œå¹¶æ²¡æœ‰å¤šä½™çš„æœºå™¨éƒ¨ç½² DmMonitor ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸èƒ½å®ç°ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢çš„ï¼Œåªèƒ½æ‰‹åŠ¨åˆ‡æ¢ä¸»å¤‡\næ•°æ®åº“ä¸æ•°æ®åº“å®ä¾‹\ræ•°æ®åº“æ˜¯ä¸€ä¸ªæ–‡ä»¶é›†åˆï¼ŒåŒ…æ‹¬æ•°æ®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€æ§åˆ¶æ–‡ä»¶ç­‰ï¼Œä¿å­˜åœ¨ç£ç›˜ä¸­\næ•°æ®åº“å®ä¾‹ï¼Œåˆ™æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿè¿›ç¨‹ã€‚é€šè¿‡æ•°æ®åº“å®ä¾‹æ¥æ“ä½œæ•°æ®åº“ï¼ˆè¯´ç™½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ“ä½œå®ä¾‹ï¼Œå®ä¾‹ä¼šå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼‰\næ•°æ®å®ˆæŠ¤éœ€è¦äº†è§£çš„åŸºæœ¬æ¦‚å¿µ\ræ•°æ®åº“æ¨¡å¼\rNormal æ¨¡å¼ Primary æ¨¡å¼ Standby æ¨¡å¼ Normal æ¨¡å¼\ræ­£å¸¸æ¨¡å¼ï¼Œæ“ä½œæ²¡æœ‰é™åˆ¶\nç”Ÿæˆæœ¬åœ°å½’æ¡£\nPrimary æ¨¡å¼\rä¸»åº“çš„æ¨¡å¼\nä¸æ”¯æŒä¿®æ”¹è¡¨ç©ºé—´æ–‡ä»¶åï¼Œä¸æ”¯æŒä¿®æ”¹å½’æ¡£ arch_ini å‚æ•°\nç”Ÿæˆæœ¬åœ°å½’æ¡£ï¼Œæ”¯æŒå®æ—¶å½’æ¡£ã€å³æ—¶å½’æ¡£ã€å¼‚æ­¥å½’æ¡£\nä¸´æ—¶è¡¨ç©ºé—´ä»¥å¤–çš„æ‰€æœ‰æ“ä½œéƒ½ç”Ÿæˆ Redo æ—¥å¿—\nStandby æ¨¡å¼\rå¤‡åº“æ¨¡å¼ï¼Œåªè¯»æ¨¡å¼\næ•°æ®åº“æ¨¡å¼åˆ‡æ¢\råœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œè¿›å…¥ disql as SYSDBA/SYSDBA ï¼Œä½¿ç”¨ SQL è¯­å¥åˆ‡æ¢\n1 2 3 4 5 6 7 8 9 10 11 12 -- å…ˆå°†æ•°æ®åº“åˆ‡æ¢ä¸º Mount çŠ¶æ€ ALTER DATABASE MOUNT; -- åˆ‡æ¢ä¸º Primary æ¨¡å¼ ALTER DATABASE PRIMARY; -- åˆ‡æ¢ä¸º Standby æ¨¡å¼ ALTER DATABASE STANDBY; -- åˆ‡æ¢ä¸º Normal æ¨¡å¼ ALTER DATABASE NORMAL; -- æ‰§è¡Œå®Œæ¯•åå°†æ•°æ®åº“å®ä¾‹æ‰“å¼€ ALTER DATABASE OPEN; æ•°æ®åº“çŠ¶æ€\rStartup çŠ¶æ€\nAfter Redo çŠ¶æ€\nOpen çŠ¶æ€\nMount çŠ¶æ€\nSuspend çŠ¶æ€\nShutdown çŠ¶æ€\nMount çŠ¶æ€\rè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ï¼Œä¸èƒ½è®¿é—®æ•°æ®åº“å¯¹è±¡\nå¯ä»¥æ‰§è¡Œä¿®æ”¹å½’æ¡£é…ç½®ã€æ§åˆ¶æ–‡ä»¶ã€ä¿®æ”¹æ•°æ®åº“æ¨¡å¼\nä¿®æ”¹ä¸º Mount çŠ¶æ€æ—¶ï¼Œä¼šå›æ»šæ‰€æœ‰æ´»åŠ¨äº‹åŠ¡ï¼Œå·²æäº¤äº‹åŠ¡ä¸å½±å“\nStartup çŠ¶æ€\ræ•°æ®åº“åˆšå¯åŠ¨æ—¶é»˜è®¤ä¸ºè¿™ä¸ªçŠ¶æ€\nOpen çŠ¶æ€\rè¿™ä¸ªçŠ¶æ€ï¼Œæ•°æ®åº“æ‰ä¼šæ­£å¸¸æä¾›æœåŠ¡\nè¿™ä¸ªçŠ¶æ€ä¸èƒ½å½’æ¡£æ“ä½œ\nSuspend çŠ¶æ€\rä¸€èˆ¬æ˜¯ä¿®æ”¹å½’æ¡£çŠ¶æ€ä¹‹å‰å°†ç³»ç»Ÿåˆ‡æ¢ä¸º Suspend çŠ¶æ€ï¼Œå®ƒä¸ä¼šåƒ Mount çŠ¶æ€é‚£æ ·å›æ»šæ‰€æœ‰æ´»åŠ¨äº‹åŠ¡ï¼Œè€Œæ˜¯åˆ‡æ¢åæ‰€æœ‰äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œ\nShutdown çŠ¶æ€\ræœåŠ¡é€€å‡º\næ•°æ®åº“çŠ¶æ€åˆ‡æ¢\rä¹Ÿæ˜¯é€šè¿‡ SQL è¯­å¥åˆ‡æ¢ï¼Œå…ˆè¿›å…¥ disql as SYSDBA/SYSDBA\n1 2 3 4 5 6 7 -- ä¿®æ”¹ä¸º Open çŠ¶æ€ ALTER DATABASE OPEN; -- å¦‚æœå½“å‰å¤„äº Primary \\ Standby æ¨¡å¼ï¼Œåˆ™éœ€è¦åŠ ä¸Š Force å­å¥ ALTER DATABASE OPEN FORCE; -- ä¿®æ”¹ä¸º Mount çŠ¶æ€ ALTER DATABASE MOUNT; Redo æ—¥å¿—\rå°±å‰è¾¹è¯´çš„ï¼ŒåŒ…æ‹¬äº† DML å’Œ DDL æ“ä½œçš„è®°å½•\nRedo æ—¥å¿—åŒ…\rRLOG_PKG Redoæ—¥å¿—åŒ…ï¼Œä¸»å¥å‘é€æ—¥å¿—åˆ°å¤‡åº“ï¼Œå°±æ˜¯é€šè¿‡æ—¥å¿—åŒ…çš„å½¢å¼å‘é€çš„\nè”æœº Redo æ—¥å¿—æ–‡ä»¶\rè¾¾æ¢¦æ•°æ®åº“åˆå§‹åŒ–å®ä¾‹åï¼Œæ˜¯é»˜è®¤æœ‰ä¸¤ä¸ªè”æœº Redo æ—¥å¿—æ–‡ä»¶ï¼šDAMENG01.log DAMENG02.log\n01 æ˜¯ Redo æ—¥å¿—ä¸»æ–‡ä»¶\nå½’æ¡£\ræœ¬åœ°å½’æ¡£ è¿œç¨‹å½’æ¡£ å®æ—¶å½’æ¡£ å³æ—¶å½’æ¡£ å¼‚æ­¥å½’æ¡£ åŒæ­¥å½’æ¡£ å½’æ¡£æ¨¡å¼çš„ä¸åŒï¼Œåªæ˜¯åœ¨äºå‘é€ Redo æ—¥å¿—åˆ°å¤‡åº“çš„æ—¶æœºä¸åŒ\næœ¬åœ°å½’æ¡£\rå½’æ¡£æ–‡ä»¶å…¶å®ä¿å­˜çš„å°±æ˜¯ Redo æ—¥å¿—\nåœ¨æœ¬åœ°å½’æ¡£æƒ…å†µä¸‹ï¼ŒNormal ã€Primary æ¨¡å¼åœ¨ Redo æ—¥å¿—å†™å…¥è”æœº Redo æ—¥å¿—æ–‡ä»¶åï¼Œç”± Redo æ—¥å¿—åŒ… RLOG_PKG\nå†™å…¥æœ¬åœ°å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒStandby æ¨¡å¼åˆ™æ˜¯ç›´æ¥å†™åˆ°æœ¬åœ°å½’æ¡£æ—¥å¿—ä¸­\nå½’æ¡£æ—¥å¿—ä¸€èˆ¬åœ¨ arch ç›®å½•ï¼Œé…ç½®äº†å½’æ¡£æ‰æœ‰\nå½’æ¡£æ—¥å¿—æ–‡ä»¶æ˜¯ä¸èƒ½è¦†ç›–çš„ï¼Œæ¯å¤©éƒ½ä¼šç”Ÿæˆå¾ˆå¤šä»½å½’æ¡£æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸”æ˜¯ä¸ä¼šä¸»åŠ¨åˆ æ‰çš„ï¼Œå¦‚æœåˆ æ‰æœ€å¥½é…ç½®å½’æ¡£æ—¥å¿—ç©ºé—´ä¸Šé™ï¼ˆé…ç½®åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ é™¤æ—©æœŸçš„å½’æ¡£æ—¥å¿—æ–‡ä»¶ï¼‰\nä½†æ˜¯åœ¨å®ˆæŠ¤ç³»ç»Ÿä¸­ï¼Œå¦‚æœåˆ é™¤å½’æ¡£æ–‡ä»¶ï¼Œéœ€è¦ä¸»å¤‡éƒ½åŒæ—¶åˆ ï¼Œå¦åˆ™ä¼šå‘ç”Ÿå¤‡åº“æ¥æ”¶åˆ°çš„æ—¥å¿—ç¼ºå¤±ï¼Œå¯¼è‡´ä¸»å¤‡åº“æ— æ³•æ­£å¸¸åŒæ­¥æ•°æ®\nå®æ—¶å½’æ¡£\ræœ¬åœ°å½’æ¡£æ˜¯å†™å…¥ç£ç›˜ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ˆæ¯”å¦‚ä¸Šæ–¹è¯´çš„DAMENG01.log DAMENG02.log ï¼‰\nå®æ—¶å½’æ¡£æ˜¯å°†ä¸»åº“äº§ç”Ÿçš„ Redo æ—¥å¿—é€šè¿‡ MAL ç³»ç»Ÿä¼ é€’åˆ°å¤‡åº“\næµç¨‹å¤§è‡´ï¼š\nä¸»åº“ Redo æ—¥å¿— \u0026raquo; å…ˆä¼ åˆ°å¤‡åº“å¹¶é‡æ¼” \u0026raquo; é‡æ¼”å®Œæˆåï¼Œå¤‡åº“å“åº”ä¸»åº“ \u0026raquo; ä¸»åº“å†æŠŠ Redo æ—¥å¿—å†™å…¥è”æœºæ—¥å¿—æ–‡ä»¶ï¼ˆæ¯”å¦‚ä¸Šæ–¹è¯´çš„DAMENG01.log DAMENG02.log ï¼‰\nå³æ—¶å½’æ¡£\rä¸»åº“æŠŠ Redo æ—¥å¿—å†™å…¥è”æœºæ—¥å¿—æ–‡ä»¶ \u0026raquo; ç„¶åå†é€šè¿‡ MAL å‘ç”Ÿ Redo æ—¥å¿—åˆ°å¤‡åº“\nè¾¾æ¢¦é…ç½®æ–‡ä»¶è¯´æ˜\nç«¯å£é…ç½®\råœ¨ dm.ini ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç”¨æ¥é…ç½®ç«¯å£ï¼šPORT_NUM DW_PORT\nPORT_NUM\rè¿™ä¸ªå‚æ•°æ˜¯å®ä¾‹çš„ç›‘å¬ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¿æ¥æ•°æ®åº“æ—¶ï¼Œéœ€è¦è¾“å…¥çš„ç«¯å£\nDW_PORT\rè¿™ä¸ªæ˜¯å®ˆæŠ¤è¿›ç¨‹çš„ç«¯å£ï¼Œç”¨äºå®ˆæŠ¤è¿›ç¨‹ç›‘å¬æ•°æ®åº“\næœåŠ¡åé…ç½®\rçœ‹ ã€ŠDM8æ•°æ®å®ˆæŠ¤ä¸è¯»å†™åˆ†ç¦»é›†ç¾¤V4.0.PDFã€‹ 5.8 ç« èŠ‚\næ•°æ®å®ˆæŠ¤çš„å¤šç§æ–¹æ¡ˆ\rå®æ—¶ä¸»å¤‡ MPPä¸»å¤‡ DMDSCä¸»å¤‡ è¯»å†™åˆ†ç¦»é›†ç¾¤ å®æ—¶ä¸»å¤‡\rå®æ—¶ä¸»å¤‡ç”±ä¸€ä¸ªä¸»åº“ã€ä¸€ä¸ªæˆ–å¤šä¸ªè¢«é…äº†å®æ—¶å½’æ¡£çš„å¤‡åº“ç»„æˆï¼Œä¿éšœæ•°æ®åº“çš„é«˜å¯ç”¨å’Œæ•°æ®çš„å®‰å…¨\nä¸»åº“æä¾›å®Œæ•´çš„æ•°æ®åº“æœåŠ¡ï¼Œè€Œå¤‡åº“æä¾›åªè¯»æœåŠ¡\nåœ¨ä¸»åº“ä¿®æ”¹çš„æ•°æ®ï¼Œä¼šäº§ç”Ÿ Redo æ—¥å¿—ï¼Œé€šè¿‡å®æ—¶å½’æ¡£æœºåˆ¶ï¼Œå‘é€åˆ°å¤‡åº“ï¼Œç„¶åå¤‡åº“é€šè¿‡é‡æ¼” Redo æ—¥å¿—ï¼Œå°†ä¿®æ”¹æ“ä½œåœ¨å¤‡åº“æ‰§è¡Œä¸€éï¼Œä¾æ¬¡ä¿æŒä¸ä¸»åº“çš„æ•°æ®åŒæ­¥\nå®æ—¶ä¸»å¤‡ç³»ç»Ÿä¸»è¦ç”±ï¼šä¸»åº“ã€å¤‡åº“ã€å®ˆæŠ¤è¿›ç¨‹ã€ç›‘è§†å™¨ç»„æˆ\nä½†æ˜¯å¤šæ•°é¡¹ç›®ä¸­ï¼Œå¹¶æ²¡æœ‰éƒ¨ç½²ç›‘è§†å™¨ï¼Œéƒ½æ˜¯ä¸»å¤‡åº“ + å®ˆæŠ¤è¿›ç¨‹çš„æ¨¡å¼\nç›‘è§†å™¨æ˜¯èƒ½åœ¨æ•…éšœå‘ç”Ÿæ—¶è‡ªåŠ¨åˆ‡æ¢ä¸»å¤‡çš„\n","date":"2024-07-20T22:00:31+08:00","permalink":"http://localhost:1313/posts/2024/07/%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E5%AE%88%E6%8A%A4%E4%B8%80/","title":"ä¸»å¤‡é›†ç¾¤ è¾¾æ¢¦æ•°æ®åº“æ•°æ®å®ˆæŠ¤ï¼ˆä¸€ï¼‰"},{"content":"å·¥ä½œä¸­æ•´ç†çš„å‘½ä»¤å¤§å…¨\nLINUXç›®å½•ç»“æ„\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 / - /bin\t# å­˜æ”¾å‘½ä»¤ï¼Œå¦‚ /bin/bash ping telnet mount ç­‰ï¼Œåªè¦æ˜¯å‘½ä»¤ï¼Œéƒ½ä¼šåœ¨è¿™é‡Œ - /boot\t# å†…æ ¸ã€ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶ - grub - /dev\t# ç¡¬ä»¶è®¾å¤‡æ–‡ä»¶ï¼Œæ¯”å¦‚ç£ç›˜åˆ†åŒºã€swapäº¤æ¢ç©ºé—´æ–‡ä»¶ - /etc\t# ç³»ç»Ÿé…ç½®æ–‡ä»¶ - /init.d - /sysconfig /home\t# å¤šä¸ºå­˜æ”¾ç”¨æˆ·çš„æ•°æ® /lib | lib64\t# å¿…è¦çš„è¿è¡Œåº“ï¼Œæ¯”å¦‚ xxx.so æ–‡ä»¶ï¼Œæ¯”å¦‚SElinuxçš„æ–‡ä»¶ - /modules /mnt\t# æŒ‚è½½ç›˜ /opt /proc\t# å­˜å‚¨è¿›ç¨‹ã€ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ cpuinfoã€versionã€swaps /root /sbin /srv /sys /tmp\t# ä¸´æ—¶æ–‡ä»¶ /usr\t# yum rpm ç­‰ å®‰è£…çš„åº”ç”¨ç¨‹åºçš„ä½ç½® - /bin - /share - /local /var - /log\t# ç³»ç»Ÿæ—¥å¿—ï¼Œå†…æ ¸æ—¥å¿— messages - /lib - /spool - /run LINUXå‘½ä»¤å¤§å…¨\r1 ç³»ç»Ÿä¿¡æ¯ç±»\r1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ uname -a # ç³»ç»Ÿæ¶æ„ä¿¡æ¯ uname -r # CPUä¿¡æ¯ cat /proc/cpuinfo # Swap äº¤æ¢ç©ºé—´ cat /proc/swaps swapon -s 1 2 # é‡å¯æœºå™¨ reboot 1.1 ç©ºé—´æƒ…å†µ\r1 2 3 4 5 6 7 8 9 10 11 12 # å®æ—¶æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨æƒ…å†µ top # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ df -h # æŸ¥çœ‹å†…å­˜ä½¿ç”¨ free -h # æŸ¥çœ‹å½“å‰ç›®å½•ç©ºé—´å¤§å° du -sh du -sh * | sort -n # æŸ¥çœ‹åˆ†åŒº fdisk -l 1.2 ç³»ç»ŸæœåŠ¡å‘½ä»¤\r1 2 3 4 5 6 7 8 9 10 11 12 13 # ç³»ç»Ÿå½¢å¼å¯åŠ¨ systemctl start service.service # åœæ­¢ systemctl stop service.service # æŸ¥çœ‹çŠ¶æ€ systemctl status service.service # é‡å¯ systemctl restart service.service # å¼€å¯è‡ªå¯ systemctl enable service.service # å–æ¶ˆå¼€å¯è‡ªå¯ systemctl disable service.service 1.3 æŸ¥çœ‹ç¯å¢ƒå˜é‡\r1 2 3 4 # åˆ—å‡ºç¯å¢ƒå˜é‡ env # æŸ¥çœ‹æŸä¸ªç¯å¢ƒå˜é‡ env | grep PATH 1.4 å†…æ ¸æ—¥å¿—\r1 2 3 4 5 6 7 # æŸ¥çœ‹å†…æ ¸æ—¥å¿— dmesg # æŸ¥çœ‹ç‰¹å®šçš„å†…æ ¸æ—¥å¿—ï¼Œæ¯”å¦‚æŒ‚è½½å¤±è´¥çš„æ—¥å¿— dmesg | grep mount # æˆ–è€…æŸ¥çœ‹ messages tail -fn 200 /var/log/messages 1.5 æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°\rä¸ºäº†é˜²æ­¢å¤±æ§çš„è¿›ç¨‹ç ´åç³»ç»Ÿçš„æ€§èƒ½ï¼Œlinux ä¼šè·Ÿè¸ªè¿›ç¨‹ä½¿ç”¨çš„å¤§éƒ¨åˆ†èµ„æºï¼Œå¹¶å…è®¸ç”¨æˆ·å’Œç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨å¯¹è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€‚ä¾‹å¦‚å¯¹æŸä¸ªç”¨æˆ·æ‰“å¼€ç³»ç»Ÿè¿›ç¨‹æ•°è¿›è¡Œé™åˆ¶ï¼Œä¸€èˆ¬é™åˆ¶åŒ…æ‹¬è½¯é™åˆ¶ã€ç¡¬é™åˆ¶ã€‚\né€šå¸¸åœ¨å®‰è£…æ•°æ®åº“çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªä¼šæœ‰è¦æ±‚ï¼Œå¯ä¼˜åŒ–æ•°æ®åº“çš„è¿è¡Œæ€§èƒ½ã€‚\n1 2 3 4 5 6 7 8 # ç¼–è¾‘ç›¸å…³æ–‡ä»¶ vi /etc/security/limits.conf # åœ¨æœ€åæ·»åŠ  # user_name user_name soft noproc 65535 user_name hard noproc 65535 user_name soft nofile 65535 user_name hard nofile 65535 1.6 æ—¶é—´ç®¡ç†\r1 2 3 4 5 # æŸ¥çœ‹æ—¶é—´è®¾ç½® timedatectl # æ‰‹å·¥è®¾ç½®æ—¶é—´ timedatectl set-time \u0026#34;YYYY-MM-DD HH:MM:SS\u0026#34; ntp åŒæ­¥æ—¶é—´\r1 2 3 4 5 6 7 8 # éœ€è¦æœåŠ¡å™¨é‡Œå®‰è£…äº† ntp # ä¸€èˆ¬çš„å‘è¡Œç‰ˆè‡ªå¸¦ # æŸ¥çœ‹æ˜¯å¦å®‰è£…äº† ntp rpm -qa | grep ntp # ä½¿ç”¨ timedatectl åŒæ­¥ Ntp æ—¶é—´ timedatectl set-ntp true 2 åˆ†åŒºã€æŒ‚è½½\r1 2 3 4 5 6 7 8 9 fdisk /dev/vda m # è·å– help d # åˆ é™¤åˆ†åŒº l # åˆ—å‡ºç°æœ‰åˆ†åŒº n # æ·»åŠ æ–°åˆ†åŒº p # æ‰“å°åˆ†åŒºè¡¨ä¿¡æ¯ t # æ›´æ”¹åˆ†åŒºçš„ç³»ç»Ÿç±»å‹ w # ä¿å­˜é€€å‡º q # é€€å‡ºè€Œä¸ä¿å­˜ 2.1 æ›´æ”¹åˆ†åŒº\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # åˆ—å‡ºåˆ†åŒº fdisk -l ################################# # åˆ é™¤åˆ†åŒº # ä½¿ç”¨ fdisk å‘½ä»¤ï¼Œåè¾¹æ¥ åˆ†åŒºå fdisk /dev/vda # åˆ—å‡ºå½“å‰åˆ†åŒºä¿¡æ¯ Command (m for help): p # åˆ é™¤å‘½ä»¤ï¼Œé€‰æ‹©ç¬¬å››ä¸ªåˆ†åŒºï¼ŒæŒ‰é¡ºåºæ¥çš„ Command (m for help): d Partition number (1-4, default 4): 4 # w æ˜¯ä¿å­˜é€€å‡º Command (m for help): w ################################# ################################# # æ–°å¢åˆ†åŒº fdisk /dev/vda # m å¸®åŠ© Command (m for help): m # æ–°å¢ n ï¼Œå†…å­˜å–é»˜è®¤å°±è¡Œ Command (m for help): n Partition number (4-128, default 4): 4 First sector (70436864-104857566, default 70436864): Last sector, +/-sectors or +/-size{K,M,G,T,P} (70436864-104857566, default 104857566): # ä¹Ÿå¯ä»¥å¡« +20G è¿™ç§ # é»˜è®¤ y Do you want to remove the signature? [Y]es/[N]o: y # ä¿å­˜ Command (m for help): w # è®©å†…æ ¸é‡æ–°è¯»å–åˆ†åŒºä¿¡æ¯ partprobe -s # æ ¼å¼åŒ–åˆ†åŒºï¼Œæ³¨æ„è¿™æ˜¯ filesystem ç±»å‹çš„åˆ†åŒºæ ¼å¼åŒ– mkfs.xfs -f /dev/vda4 ################################# 2.2 è°ƒæ•´åˆ†åŒºç±»å‹\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 fdisk /dev/vda # æ›´æ”¹åˆ†åŒºç±»å‹ä¸º swap Command (m for help): t Partition number (1-4, default 4): 4 Partition type (type L to list all types): 19 # 19 æ˜¯ swap ç±»å‹ï¼Œå…·ä½“å¯ä½¿ç”¨ L æŸ¥çœ‹æ›´å¤šç±»å‹ # ä¿å­˜ Command (m for help): w # è®©å†…æ ¸é‡æ–°è¯»å–åˆ†åŒºä¿¡æ¯ partprobe -s # æ ¼å¼åŒ–åˆ†åŒº mkswap /dev/vda4 # æŒ‚è½½åˆ†åŒº swapon /dev/vda4 # éªŒè¯ swapon --show # è®¾ç½®å¼€æœºè‡ªå¯ vi /etc/fstab # åŠ å…¥ UUID=9b6af8bf-5a7a-4e6b-8e2e-4afa78cf5bbc none swap defaults 0 0 # å¦‚æœä¸æ¸…æ¥š UUID å¯è®¾ç½®ä¸ºå®ƒæ–‡ä»¶çš„è·¯å¾„ /dev/vda4 none swap defaults 0 0 ### å¦‚ä¸‹æŸ¥çœ‹ UUID blkid /dev/vda4 2.3 è°ƒæ•´ Swap ç©ºé—´\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # æŸ¥çœ‹ swap åˆ†åŒºè·¯å¾„ cat /proc/swaps # ç¦ç”¨ swapoff /dev/dm-1 # ç¼–è¾‘ /etc/fstab åˆ æ‰ swap åˆ†åŒºçš„ä¿¡æ¯ vi /etc/fstab # åˆ æ‰ æ­¤swap åˆ†åŒºçš„ä¿¡æ¯ # åˆ›å»ºåˆ†åŒºæ–‡ä»¶ dd if=/dev/zero of=/swapfile bs=500M count=1 # /dev/zero æ˜¯ LINUX é‡Œä¸€ä¸ªç‰¹æ®Šå—è®¾å¤‡ï¼Œåœ¨æ¯æ¬¡è¯»å–æ—¶è¾“å‡ºé›¶å­—èŠ‚ # /swapfile å¯ä»¥æ˜¯ä»»æ„è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ªä¸ç”¨äº‹å…ˆåˆ›å»º # æˆæƒ chmod 600 swapfile # æ ¼å¼åŒ– swap åˆ†åŒº mkswap /swapfile # æ¿€æ´»è¯¥æ–‡ä»¶ï¼Œæ·»åŠ åˆ°äº¤æ¢æ± ä¸­ swapon /swapfile # éªŒè¯ swapon --show 2.4 æŒ‚è½½\r1 2 3 4 5 6 7 # æŒ‚è½½ Windows å…±äº«ç›®å½• mount -t cifs -o username=@user, password=@password //IP/share_dir /home/aml # æŒ‚è½½ä¸€ä¸ª iso é•œåƒæ–‡ä»¶ mount -o loop /path/to/file.iso /mnt # å¸è½½ umount /home/aml 3 ç”¨æˆ·ç›¸å…³\rè¯´æ˜\r3.1 ç”¨æˆ·ç»„\r1 2 3 4 5 6 7 8 9 # å¢åŠ ç”¨æˆ·ç»„ groupadd group_name # æ–°å¢æŒ‡å®šç”¨æˆ·ç»„IDçš„ç»„ groupadd -g GID group_name # åˆ é™¤ç”¨æˆ·ç»„ groupdel group_name # é‡å‘½åç”¨æˆ·ç»„ groupmod -n new_group_name old_group_name 3.2 ç”¨æˆ·\r1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºç”¨æˆ· useradd -u UID -g group_name -s /bin/bash -d /home/dir_name -m user_name # -uï¼šæŒ‡å®šç”¨æˆ·çš„ ID # -gï¼šæŒ‡å®šç”¨æˆ·æ‰€å±ç»„ # -sï¼šæŒ‡å®šç”¨æˆ·ç”¨çš„ shell # -dï¼šæŒ‡å®šç”¨æˆ·çš„æ ¹ç›®å½•è·¯å¾„ # -mï¼šåˆ›å»ºç”¨æˆ·çš„æ ¹ç›®å½• # ä¾‹å­,åˆ›å»º test ç”¨æˆ·ï¼Œå¹¶è®¾ç½®ç”¨æˆ· ID\\æ‰€å±ç»„\\æŒ‡å®š SHELL\\æŒ‡å®šæ ¹ç›®å½•å¹¶åˆ›å»ºæ ¹ç›®å½•ï¼š useradd -u 1001 -g dmdba -s /bin/bash -d /home/dm -m test # åˆ é™¤ç”¨æˆ· userdel -r user_name 3.3 ä¿®æ”¹ç”¨æˆ·å¯†ç \r1 2 3 4 # ä¿®æ”¹å¯†ç  passwd user_name # è®¾ç½®ç”¨æˆ·å£ä»¤çš„å¤±æ•ˆæœŸé™ chage -E 2024-12-12 user_name 3.4 ä¿®æ”¹ç”¨æˆ·æ‰€å±ä¸»ã€ç»„\r1 2 3 4 # ä¿®æ”¹ç”¨æˆ·æ‰€å±ä¸» usermod -g group_name user_name # ä¿®æ”¹ç”¨æˆ·æ‰€å±ç»„ usermod -G group_name user_name 4 æ–‡ä»¶ç›®å½•ç›¸å…³\r4.1 ç›®å½•\r4.1 .1 è¿›å…¥\r1 2 3 4 5 6 7 8 9 10 11 12 # è¿›å…¥ç›®å½• cd /home # è¿”å›ä¸Šä¸€çº§ç›®å½• cd .. # è¿”å›ä¸Šä¸¤çº§ç›®å½• cd ../.. # è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½• cd # è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½• cd ~user1 # è¿”å›ä¸Šæ¬¡æ‰€åœ¨çš„ç›®å½• cd - 4.1.2 æ˜¾ç¤ºå½“å‰è·¯å¾„\r1 pwd 4.1.3 æŸ¥çœ‹ç›®å½•\r1 2 3 4 5 6 7 8 9 10 11 12 13 # æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶ ls # æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶ ls -F # æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•çš„è¯¦ç»†èµ„æ–™ ls -l # æ˜¾ç¤ºéšè—æ–‡ä»¶ ls -a # æ˜¾ç¤ºåŒ…å«æ•°å­—çš„æ–‡ä»¶åå’Œç›®å½•å ls *[0-9]* # æŒ‰æ—¶é—´æ’åºæ˜¾ç¤ºæ–‡ä»¶ *** ls -lrt 4.1.4 åˆ›å»ºç›®å½•\r1 2 3 4 5 6 # åˆ›å»ºä¸€ä¸ªå«åš \u0026#39;dir1\u0026#39; çš„ç›®å½• mkdir dir1 # åŒæ—¶åˆ›å»ºä¸¤ä¸ªç›®å½• mkdir dir1 dir2 # é€’å½’åˆ›å»º mkdir -p /tmp/dir1/dir2 4.1.5 åˆ é™¤ç›®å½•\r1 2 3 # åˆ é™¤ç›®å½• rm -rf dir_name rmdir dir_name 4.2 æ–‡ä»¶\r1 2 3 4 5 6 # åˆ›å»ºæ–‡ä»¶ touch file_name # ä¸€èˆ¬å¯ä»¥ç›´æ¥ vi ä¿å­˜ä¸€ä¸ªç©ºæ–‡ä»¶æ¥åˆ›å»º vi file_name # åˆ é™¤æ–‡ä»¶ rm -rf file_name 4.2.1 æŸ¥çœ‹æ–‡ä»¶å†…å®¹\r1ï¼‰cat\r1 2 3 4 5 6 # æŸ¥çœ‹å†…å®¹ cat file_name # æŸ¥çœ‹å†…å®¹ï¼Œæ˜¾ç¤ºè¡Œå·ï¼ŒåŒ…æ‹¬ç©ºè¡Œ cat -n file_name # æŸ¥çœ‹å†…å®¹ï¼Œæ˜¾ç¤ºè¡Œå·ï¼Œä¸åŒ…æ‹¬ç©ºè¡Œ cat -b file_name cat é‡å®šå‘\r1 2 3 4 # å°†æ–‡ä»¶å†…å®¹è¿½åŠ åˆ° æ–°æ–‡ä»¶ä¸­ cat /etc/profile \u0026gt;\u0026gt; /home/test.txt # \u0026gt;\u0026gt; è¿½åŠ  # \u0026gt; è¦†ç›– 2ï¼‰åˆ†é¡µæŸ¥çœ‹ less åŠæ“ä½œ\r1 2 3 4 5 6 7 8 9 # åˆ†å±æ˜¾ç¤ºå†…å®¹ less -N file_name # æ“ä½œé”®\tåŠŸèƒ½ # ç©ºæ ¼é”®\tæ˜¾ç¤ºæ‰‹å†Œé¡µçš„ä¸‹ä¸€å±å¹• # Enter é”®\tä¸€æ¬¡æ»šåŠ¨æ‰‹å†Œé¡µçš„ä¸€è¡Œ # b\tå›æ»šä¸€å± å‘ä¸Šç¿»å± # f\tå‘å‰ä¸€å± å‘ä¸‹ç¿»å± # q\té€€å‡º # /word\tæœç´¢ word å­—ç¬¦ä¸²\tn å‘ä¸‹æ‰¾ N å‘ä¸Šæ‰¾ 3ï¼‰æŸ¥çœ‹å‰Nè¡Œå†…å®¹ head\r1 2 # çœ‹å‰ n è¡Œå†…å®¹ head -n file_name 4ï¼‰æŸ¥çœ‹æœ€åNè¡Œå†…å®¹ tail\r1 2 # æŸ¥çœ‹å 10 è¡Œå†…å®¹ï¼Œå¹¶è‡ªåŠ¨è¿½åŠ æ›´æ–°æ—¥å¿—ä¿¡æ¯ tail -fn 10 file_name 4.2.2 æŸ¥æ‰¾æ–‡ä»¶å†…å®¹\r1 2 3 # ä½¿ç”¨ grep grep \u0026#34;09:30*\u0026#34; /var/log/messages grep -10 \u0026#34;checkpoint\u0026#34; dm_DMSERVER_202407.log 1ï¼‰æ¸…ç©ºæ–‡ä»¶å†…å®¹\r1 2 3 4 # æ–¹å¼ä¸€ é‡å®šå‘è¦†ç›– \u0026gt;/path/to/file_name # æ–¹å¼äºŒ truncate -s 0 /path/to/file_name 4.2.3 æŸ¥æ‰¾æ–‡ä»¶\r1ï¼‰whereis \\ which\r1 2 3 4 5 6 7 8 [root@FXQ-YWYY-57-81 ~]# whereis java # ä½¿ç”¨ which java ä¹Ÿè¡Œ java: /usr/bin/java /usr/lib/java /etc/java /usr/share/java /usr/java/jdk1.8.0_231/bin/java /usr/share/man/man1/java.1.gz [root@FXQ-YWYY-57-81 ~]# ls -lrt /usr/bin/java lrwxrwxrwx 1 root root 22 Jun 6 2023 /usr/bin/java -\u0026gt; /etc/alternatives/java [root@FXQ-YWYY-57-81 ~]# ls -lrt /etc/alternatives/java lrwxrwxrwx 1 root root 73 Jun 6 2023 /etc/alternatives/java -\u0026gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64/jre/bin/java 2ï¼‰find\r1 2 3 4 5 6 7 8 9 10 [root@learning /]# find / -name \u0026#34;dm.ini\u0026#34; /home/dmdba/data/DAMENG/dm.ini find /path -option file_name # -option: # -name æ‰¾åå­— # -type æ‰¾ç±»å‹ # -size æ‰¾å¤§å° # åœ¨å½“å‰è·¯å¾„æŸ¥æ‰¾ find . -name *file_name* 4.2.4 åˆ›å»ºæ–‡ä»¶\r1 2 3 4 5 6 # é€’å½’åˆ›å»º touch -p /path/to/dir/file_name # åˆ›å»ºå¤šä¸ªæ–‡ä»¶ touch file_name_1 file_name_2 file_name_3 # ä½¿ç”¨ vi åˆ›å»ºç©ºæ–‡ä»¶ vi file_name 4.2.5 åˆ é™¤æ–‡ä»¶\r1 rm -rf file_name 4.3 å¤åˆ¶\r1 2 3 4 5 6 7 # å¤åˆ¶ç›®å½• cp /path/dir_name /path/to/new/dir_name # å¤åˆ¶åˆ°å½“å‰ç›®å½• cp /path/dir_name . # å¤åˆ¶æ–‡ä»¶ cp file_name file_new_name 4.4 ç§»åŠ¨ä¸é‡å‘½å\r1 2 3 4 # é‡å‘½å mv dir_name dir_new_name # ç§»åŠ¨åˆ°åˆ«å¤„ mv /path/to/dir_name /path/to/new/dir_name 4.5 è½¯ç¡¬é“¾æ¥\r1 2 3 4 # åˆ›å»ºä¸€ä¸ªæŒ‡å‘æ–‡ä»¶æˆ–ç›®å½•çš„è½¯é“¾æ¥ ln -s file_name lnk_name # åˆ›å»ºä¸€ä¸ªæŒ‡å‘æ–‡ä»¶æˆ–ç›®å½•çš„ç‰©ç†é“¾æ¥ ln file_name lnk_name 4.6 æƒé™ç›¸å…³\r4.6.1 æ›´æ”¹æ‰€å±ç»„\r1 2 # æ›´æ”¹æ‰€å±ä¸»ã€ç»„ï¼› -R é€’å½’ chown -R user_name:group_name dir_name 4.6.2 æ›´æ”¹ç›®å½•ã€æ–‡ä»¶æƒé™\r1 2 3 4 5 6 7 8 9 10 # r 4 # w 2 # x 1 ## drwxrwxrwx è¡¨ç¤ºï¼šæ‰€å±ä¸»ã€æ‰€å±ç»„ã€å…¶ä»–ç”¨æˆ·çš„æƒé™ # ç»™æ‰€å±ä¸»è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼Œæ‰€å±ç»„ç»™è¯»ã€æ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·ç»™è¯»ã€æ‰§è¡Œæƒé™ chmod 755 -R /path/to/dir_name # ç»™æ‰§è¡Œæƒé™ chmod +x file_name 4.7 æ‰“åŒ…ã€è§£åŒ…\r4.7.1 tarï¼ˆä¸å¸¸ç”¨ï¼‰\r1 2 3 4 5 6 7 8 9 # åˆ›å»º tar tar -cvf file_name.tar /path/to/dir_name # æŒ‡å®šå‹ç¼©æ–‡ä»¶ tar -cvf file_name.tar file1 file2 file3 # æŒ‡å®šå‹ç¼© DM8_ å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ tar -cvf file_name.tar DM8_* # è§£å‹ tar åˆ°æŒ‡å®šç›®å½• tar -xvf file_name.tar /path/to/dir 4.7.2 tar.gzï¼ˆå¸¸ç”¨ï¼‰\r1 2 3 4 5 6 7 8 9 10 11 # -z è¡¨ç¤ºä½¿ç”¨ gzip å‹ç¼© # å°† dir_name å‹ç¼©æˆ tar.gz tar -czvf file_name.tar.gz /path/to/dir_name # æŒ‡å®šå‹ç¼©æ–‡ä»¶ tar -czvf file_name.tar.gz file1 file2 file2 # æŒ‡å®šå‹ç¼© DM8_ å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ tar -czvf file_name.tar.gz DM8_* # è§£å‹ tar.gz åˆ°æŒ‡å®šç›®å½• tar -xzvf file_name.tar.gz /path/to/dir 4.7.3 tar.bz2ï¼ˆä¸å¸¸ç”¨ï¼‰\r1 2 3 4 5 6 7 8 9 10 11 # -j è¡¨ç¤ºä½¿ç”¨ bzip2 å‹ç¼© # å°† dir_name å‹ç¼©æˆ tar.bz2 tar -cjvf file_name.tar.bz2 /path/to/dir_name # æŒ‡å®šå‹ç¼©æ–‡ä»¶ tar -cjvf file_name.tar.bz2 file1 file2 file2 # æŒ‡å®šå‹ç¼© DM8_ å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ tar -cjvf file_name.tar.bz2 DM8_* # è§£å‹ tar åˆ°æŒ‡å®šç›®å½• tar -xjvf file_name.tar.bz2 /path/to/dir 4.7.4 zip\r1 2 3 4 5 6 7 # å‹ç¼©æˆ zip æ ¼å¼ zip file.zip /path/to/dir_name # å°†ç›®å½•ä¸€èµ·å‹ zip -r file.zip /path/to/dir_name # è§£å‹ zip unzip file.zip /path/to/dir_name 5 è¿›ç¨‹æœåŠ¡ç›¸å…³\r5.1 æŸ¥çœ‹è¿›ç¨‹\r1 2 3 4 5 6 # æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿›ç¨‹ ps -ef # æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹ ps -ef | grep server_name # æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹ ps -u user_name 5.2 ç»“æŸè¿›ç¨‹\r1 2 3 4 5 6 # ä¸€èˆ¬ä½¿ç”¨ kill # -9 å¼ºåˆ¶ç»“æŸ kill -9 server_pid # systemctl systemctl stop service.service 5.3 è®¾ç½®è‡ªå¯\r1 2 # systemctl systemctl enable server_name.service è®¾ç½®ä¹‹å‰ï¼Œéœ€è¦å°†æœåŠ¡åœ¨ç³»ç»Ÿé‡Œè¿›è¡Œæ³¨å†Œï¼Œéœ€è¦è‡ªå·±ç”Ÿæˆä¸€ä¸ªåç§°\n1 vi /etc/systemd/system/server_name.service å…·ä½“ç™¾åº¦ä¸€ä¸‹ï¼Œè¿˜æœ‰å…¶ä»–ä¸åŒçš„è‡ªå¯æ–¹å¼çš„\n5.4 å¯åŠ¨ jar åŒ…æœåŠ¡\r1 2 3 4 # ç›´æ¥å¯ç”¨ java -jar jar_name.jar # åŠ ä¸Š JVM å‚æ•° java -jar jar_name.jar -Xmx1024m -Xms512m 5.5 åå°è¿è¡Œ\r1 nohup server_name \u0026amp; 6 ç½‘ç»œç›¸å…³\rlinuxç½‘å¡é…ç½®æ–‡ä»¶é»˜è®¤åœ°å€ï¼š/etc/sysconfig/network-scripts/ifcfg-eth0 ï¼Œä¸€èˆ¬ifcfg-eth0è¡¨ç¤ºç¬¬ä¸€å—ç½‘å¡ï¼Œeth1 ä¸ºç¬¬äºŒå—ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n6.1 éªŒè¯ç½‘ç»œæ˜¯å¦é€š\r1 2 3 4 # ping ping ip # telnet ç”¨äºéªŒè¯ç«¯å£æ˜¯å¦æ‰“é€š telnet ip port 6.2 æŸ¥çœ‹ç½‘ç»œ\r1 systemctl status network æŸ¥çœ‹ IP\r1 2 3 4 5 6 7 8 9 10 11 12 13 ip addr # æœ‰çš„æ˜¯ ipconfig # æœ€å¿«çš„æ–¹å¼ [root@status shell]# hostname -I 172.16.101.182 # å¯ä»¥è¿™ä¹ˆæŸ¥ [root@kylinV10arm162 aml_updatePatch]# hostname -i | awk {\u0026#39;print $2\u0026#39;} 10.6.7.162 # ä¹Ÿå¯ä»¥è¿™ä¹ˆæŸ¥ ip -f inet addr | grep -v 127.0.0.1 | grep inet | grep -o \u0026#39;inet[^/]*\u0026#39; | awk {\u0026#39;print $2\u0026#39;} 6.3 æŸ¥çœ‹ç«¯å£å ç”¨\r1 netstat -nltp 6.4 æŸ¥çœ‹ä¸»æœºå\r1 hostname ä¿®æ”¹ä¸»æœºå\r1 2 3 4 5 6 vi /etc/hostname # æ‰¾åˆ°ä¸»æœºåçš„é‚£ä¸€è¡Œï¼Œä¿®æ”¹å®ƒ # éœ€è¦é‡å¯æœºå™¨ç”Ÿæ•ˆ # ä¸´æ—¶è®¾ç½®ä¸»æœºå host new_hostname 6.5 è®¾ç½® hosts\r1 2 3 4 5 6 7 8 vi /etc/hosts # æ·»åŠ ä»¥ä¸‹å†…å®¹ ip åŸŸå # æˆ–è€… ip hostname # å¯é‡å¯ç½‘ç»œï¼Œä¸è¿‡ä¸€èˆ¬å®ƒæ˜¯ç«‹å³ç”Ÿæ•ˆçš„ï¼Œä¸éœ€è¦é‡å¯ systemctl restart network 6.6 è®¾ç½® DNS\r1 2 3 4 5 vi /etc/resolv.conf # æ·»åŠ ï¼Œå…¶ä¸­ nameserver ä¸ºå›ºå®šå†™æ³• nameserver ip # ä¾‹å­ nameserver 8.8.8.8 6.7 é˜²ç«å¢™\r1 2 3 4 5 6 systemctl status firewalld\t# çŠ¶æ€ systemctl start firewalld\t# å¯åŠ¨ systemctl stop firewalld\t# åœæ­¢ systemctl restart firewalld\t# é‡å¯ systemctl disable firewalld\t# ç¦æ­¢è‡ªå¯ systemctl enable firewalld\t# å¼€æœºè‡ªå¯ å¯ä»¥è¿™ä¹ˆæ£€æŸ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 [root@learning ~]# systemctl status firewalld.service # çŠ¶æ€ â— firewalld.service - firewalld - dynamic firewall daemon Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled) Active: inactive (dead) Docs: man:firewalld(1) [root@learning ~]# firewall-cmd --list-all FirewallD is not running # æˆ–è€… [root@learning ~]# systemctl status firewalld.service # çŠ¶æ€ â— firewalld.service - firewalld - dynamic firewall daemon Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled) Active: inactive (dead) Docs: man:firewalld(1) 7 åŒ…ç®¡ç†\r7.1 rpm\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹å·²å®‰è£… rpm åŒ… rpm -qa # æŸ¥çœ‹ç‰¹å®šçš„åŒ… rpm -qa | grep rpm_name # å®‰è£… rpm åŒ…ï¼› -i æ˜¯ install çš„æ„æ€ï¼Œvhæ˜¯æ˜¾ç¤ºè¿›åº¦è¯¦æƒ… rpm -ivh rpm_name # å¿½ç•¥ä¾èµ–ï¼Œå¼ºåˆ¶å®‰è£…ï¼› --nodeps å¿½ç•¥ä»¥æ¥ --force å¼ºåˆ¶è¦†ç›– rpm -ivh --nodeps --force rpm_name # æ›´æ–° rpm åŒ… rpm -Uvh rpm_name # å¸è½½ rpm -e rpm_name # åˆ é™¤ç³»ç»Ÿè‡ªå¸¦ JDK ä¸ºä¾‹ rpm -qa | grep -i java | xargs -nl rpm -e --nodeps 7.2 yum\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ä¸‹è½½ yum install -y package_name # æ›´æ–° yum update package_name # å¸è½½ yum remove package_name # æœç´¢ yum search package_name # å·²å®‰è£…çš„æ¸…å• yum list installed [package_name] # å¯å®‰è£…çš„æ¸…å• yum list available [package_name] # å¯æ›´æ–°çš„æ¸…å• yum list updates # æ¸…é™¤ç¼“å­˜ yum clean all # åˆ·æ–°ç¼“å­˜ yum makecache # éªŒè¯ yum repolist 7.2.1 æ›´æ¢ yum æº\ré˜¿é‡Œäº‘ Centos 7.9 çš„åŒ…\nhttps://mirrors.aliyun.com/centos/7.9.2009/os/x86_64/Packages/?spm=a2c6h.25603864.0.0.23ca4ecbejPOxR\néœ€è¦ä½¿ç”¨ wgetå‘½ä»¤ä¸‹è½½ï¼Œå½“æœåŠ¡å™¨æ²¡æœ‰è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œåˆ°å¼€æºç«™ä¸‹è½½ wgetåŒ…\n1 2 3 4 5 6 # ä¸‹è½½ yum æº wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo # æ¸…ç¼“å­˜ yum clean all # é‡æ–°åŠ è½½ yum ç¼“å­˜ yum makecache 7.3 wget\r8 ä¸‰å‰‘å®¢ grep\\sed\\awk\r8.1 grep\rgrepæ˜¯Linuxé‡Œä¸€ä¸ªæ–‡æœ¬æœç´¢å·¥å…·ï¼Œèƒ½å¤Ÿä½¿ç”¨é€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬ï¼Œå¹¶å°†åŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥\n1 2 3 4 5 6 7 8 9 # ç»Ÿè®¡æ€»è¡Œæ•° [root@status log]# cat dm_DMSERVER_202407.log | grep -c INFO 28047 # ä¸åŒºåˆ†å¤§å°å†™æŸ¥æ‰¾ INFO cat dm_DMSERVER_202407.log | grep -i info # åŒ¹é…æ‰€æœ‰å«æœ‰å¤§å†™å­—æ¯å’Œæ•°å­—çš„è¡Œ cat dm_DMSERVER_202407.log | grep [A-Z][0-9] 8.1.1 å¸¸ç”¨å‚æ•°\r1 2 3 4 5 6 7 8 -a\t# ä»¥æ–‡æœ¬æ–‡ä»¶æ–¹å¼æœæœ -c\t# è®¡ç®—åŒ¹é…è¡Œçš„æ•°é‡ -i\t# å¿½ç•¥å¤§å°å†™ -n\t# è¾“å‡ºè¡Œå· -v\t# åå‘é€‰æ‹©ï¼Œå³æ’é™¤åŒ¹é…çš„è¡Œ -h\t# æŸ¥è¯¢å¤šæ–‡ä»¶æ—¶ä¸æ˜¾ç¤ºæ–‡ä»¶å -l\t# æŸ¥è¯¢å¤šæ–‡ä»¶æ—¶åªè¾“å‡ºåŒ…å«åŒ¹é…ç¬¦çš„æ–‡ä»¶å -s\t# ä¸æ˜¾ç¤ºä¸å­˜åœ¨æˆ–æ— åŒ¹é…æ–‡æœ¬çš„é”™è¯¯ä¿¡æ¯ ä¾‹å­ï¼š\n1 2 3 4 [root@status ~]# ps -ef | grep -in dm 73:dmdba 5510 1 0 Jun24 ? 00:01:19 /home/dmdba/dmdbms/bin/dmap 79:dmdba 16636 1 0 Jun24 ? 00:23:07 /home/dmdba/dmdbms/bin/dmserver path=/home/dmdba/data/DAMENG/dm.ini -noconsole 89:root 22552 22507 0 22:28 pts/0 00:00:00 grep --color=auto -in dm é€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ\n8.1.2 é€šé…ç¬¦\r1 2 3 4 5 6 7 8 *\t# è¡¨ç¤º N ä¸ªå­—ç¬¦ï¼ˆæ•°å­—ï¼‰ ?\t# åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ # # æ³¨é‡Š |\t# ç®¡é“ç¬¦ ;\t# å¤šä¸ªå‘½ä»¤è¿ç»­æ‰§è¡Œ \u0026amp;\t# åå°è¿è¡Œå‘½ä»¤ []\t# å†…å®¹èŒƒå›´ï¼ŒåŒ¹é…æ‹¬å·ä¸­çš„å†…å®¹ {}\t# å‘½ä»¤å—ï¼Œå¤šä¸ªå‘½ä»¤åŒ¹é… 8.1.3 æ­£åˆ™è¡¨è¾¾å¼\r1 2 3 4 5 6 7 8 9 10 *\t# åŒ¹é… n æ¬¡ .\t# åŒ¹é…é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ .*\t# ä»»æ„å­—ç¬¦ ^\t# åŒ¹é…è¡Œçš„å¼€å¤´ï¼Œå³ä»¥æŸä¸ªå­—ç¬¦å¼€å¤´ $\t# åŒ¹é…è¡Œçš„ç»“å°¾ï¼Œå³ä»¥æŸä¸ªå­—ç¬¦ç»“å°¾ []\t# åŒ¹é…æ‹¬å·é‡Œçš„ä»»æ„æŒ‡å®šå­—ç¬¦ï¼ˆåªåŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼‰ [^]\t# åŒ¹é…å‡ºäº†ä¸­æ‹¬å·ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ \\\t# è½¬ä¹‰ \\s\t# åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ \\d\t# åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ 8.2 sed\råŸå§‹test.shè„šæœ¬\n1 2 3 4 5 6 7 8 9 #!/bin/bash ############## # author: wq # create_date: 20240712 # mark: test ############## echo \u0026#34;localhost: 127.0.0.1\u0026#34; 8.2.1 æ›¿æ¢æ–‡æœ¬\r1 2 3 4 5 6 # æ¨¡æ¿ sed -i \u0026#39;s/old/new/g\u0026#39; file # ä¾‹å­ # å°†æ–‡ä»¶é‡Œçš„ 127.0.0.1æ›¿æ¢ä¸º 192.168.0.1 sed -i \u0026#39;s/127.0.0.1/192.168.0.1/g\u0026#39; test.sh 8.2.2 æ·»åŠ æ–‡æœ¬\raå‚æ•°è¡¨ç¤ºåœ¨å…¶ä¸‹ä¸€è¡Œæ·»åŠ å­—ç¬¦ä¸²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 sed -i \u0026#39;/text/a new_text\u0026#39; file # ä¾‹å­ # åœ¨æ–‡ä»¶é‡Œæ‰¾åˆ° localhost æ‰€åœ¨çš„è¡Œï¼Œå¹¶åœ¨å…¶ä¸‹ä¸€è¡Œæ·»åŠ # hello, world sed -i \u0026#39;/localhost/a # hello, world\u0026#39; test.sh # ä¾‹å­ # æ‰¾åˆ°çš„æ¯ä¸ªå­—ç¬¦ï¼Œéƒ½ä¼šåœ¨ä¸‹è¾¹åŠ æ–°çš„ [root@status log]# sed -i \u0026#39;/localhost/a # hello, world\u0026#39; test.sh [root@status log]# sed -i \u0026#39;/localhost/a # hello, world\u0026#39; test.sh [root@status log]# sed -i \u0026#39;/localhost/a # hello, Gopher \u0026#39; test.sh [root@status log]# sed -i \u0026#39;/hello/a # ??? \u0026#39; test.sh [root@status log]# vi test.sh #!/bin/bash ############## # author: wq # create_date: 20240712 # mark: test ############## echo \u0026#34;localhost: 192.168.0.1\u0026#34; # hello, Gopher # ??? # hello, world # ??? # hello, world # ??? iå‚æ•°è¡¨ç¤ºåœ¨å…¶ä¸Šä¸€è¡Œæ·»åŠ å­—ç¬¦ä¸²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [root@status log]# sed -i \u0026#39;/Go/i 111\u0026#39; test.sh [root@status log]# vi test.sh #!/bin/bash ############## # author: wq # create_date: 20240712 # mark: test ############## echo \u0026#34;localhost: 192.168.0.1\u0026#34; 111 # hello, Gopher # ??? # hello, world # ??? # hello, world # ??? 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $`è¡¨ç¤ºè¡Œå°¾ï¼Œ`\u0026amp;`è¡¨ç¤ºæ·»åŠ ã€‚åœ¨ `111` çš„è¡Œå°¾æ·»åŠ  `word [root@status log]# sed \u0026#39;s/111$/\u0026amp; word/g\u0026#39; test.sh #!/bin/bash ############## # author: wq # create_date: 20240712 # mark: test ############## echo \u0026#34;localhost: 192.168.0.1\u0026#34; 111 word # hello, Gopher # ??? # hello, world # ??? # hello, world # ??? ^è¡¨ç¤ºè¡Œé¦–ï¼Œ\u0026amp;è¡¨ç¤ºæ·»åŠ ï¼Œåœ¨ 111çš„è¡Œé¦–æ·»åŠ  #ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [root@status log]# sed \u0026#39;/111/s/^/\u0026amp;# /\u0026#39; test.sh #!/bin/bash ############## # author: wq # create_date: 20240712 # mark: test ############## echo \u0026#34;localhost: 192.168.0.1\u0026#34; # 111 # hello, Gopher # ??? # hello, world # ??? # hello, world # ??? 8.2.3 åˆ é™¤æ–‡æœ¬\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ é™¤ç¬¬1è¡Œ sed \u0026#39;1d\u0026#39; test.sh # åˆ é™¤ç¬¬3 - 8è¡Œ sed \u0026#39;3,8d\u0026#39; test.sh # åˆ é™¤æœ€åä¸€è¡Œ sed \u0026#39;$d\u0026#39; test.sh # åˆ é™¤åŒ¹é…111çš„é‚£ä¸€è¡Œ sed \u0026#39;/111/ d\u0026#39; test.sh # åˆ é™¤åŒ¹é…è¡Œåˆ°æœ€åä¸€è¡Œ sed \u0026#39;/111/ $d\u0026#39; test.sh 8.3 awk\ræ‰“å°è¾“å‡ºä¿¡æ¯ï¼Œå¹¶è¾“å‡ºç¬¬ä¸€åˆ—å‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@status log]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 868M 0 868M 0% /dev tmpfs 879M 0 879M 0% /dev/shm tmpfs 879M 556K 878M 1% /run tmpfs 879M 0 879M 0% /sys/fs/cgroup /dev/vda1 40G 8.7G 29G 24% / tmpfs 176M 0 176M 0% /run/user/0 [root@status log]# df -h | awk \u0026#39;{print $1}\u0026#39; Filesystem devtmpfs tmpfs tmpfs tmpfs /dev/vda1 tmpfs å¦‚æœæ˜¯æ‰“å°ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—ï¼Œåˆ™æ˜¯ awk '{print $1,$2}' ç”¨é€—å·åˆ†éš”\n9 VI ç¼–è¾‘å™¨\r1 2 3 4 5 6 7 8 9 10 11 12 # vi æˆ–è€… vim # åˆ†ä¸º3ä¸ªæ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼ã€è¾“å…¥æ¨¡å¼ã€åº•è¡Œæ¨¡å¼ # è¿›å…¥ vi çš„é»˜è®¤ç•Œé¢å°±æ˜¯ å‘½ä»¤æ¨¡å¼ i\t# è¿›å…¥è¾“å…¥æ¨¡å¼ï¼Œå…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦å¼€å§‹ a # åŒä¸Šï¼Œå…‰æ ‡åä¸€ä¸ªå­—ç¬¦å¼€å§‹ o # åŒä¸Šï¼Œåœ¨å…‰æ ‡çš„ä¸‹ä¸€è¡Œå¼€å§‹ esc # è¿”å›å‘½ä»¤æ¨¡å¼ :\t# è¿›å…¥åº•è¡Œæ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # å‘½ä»¤æ¨¡å¼ /find_text\t# æŸ¥æ‰¾æ–‡æœ¬ n\t# å‘ä¸‹æŸ¥æ‰¾ N\t# å‘ä¸ŠæŸ¥æ‰¾ # å¸¸ç”¨æ“ä½œ w\t# è·³åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å§‹ b\t# è·³åˆ°ä¸Šä¸€ä¸ªå•è¯çš„å¼€å§‹ # å¤åˆ¶è´´è´´ v\t# æŒ‰ v å¼€å§‹é€‰æ‹©ï¼Œé€‰æ‹©å y å¤åˆ¶ï¼Œ p è´´è´´ # åˆ é™¤ dd\t# åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ :n1,n2d\t# åˆ é™¤ n1 - n2 è¡Œ # ä¾‹å­ :3,7d # æ’¤é”€ u\t# æ’¤é”€æ“ä½œï¼Œè·Ÿ windows çš„ ctrl+z ä¸€æ ·æ•ˆæœ ctrl + r # é‡åšæ’¤é”€ # æ›¿æ¢ :n1,n2 s/old_text/new_text/g # ä¾‹å­ï¼šæ›¿æ¢11è¡Œçš„localhostä¸ºhostname\tå¦‚æœä¸åŠ è¡Œå·åˆ™ä¸ºå…¨å±€æ›¿æ¢ :11 s/localhost/hostname/g 1 2 3 4 5 6 # åº•è¡Œæ¨¡å¼ :set nu\t# æ˜¾ç¤ºè¡Œå· :set nonu\t# ä¸æ˜¾ç¤ºè¡Œå· :w\t# ä¿å­˜ :wq\t# ä¿å­˜å¹¶é€€å‡º :q!\t# ä¸ä¿å­˜å¹¶é€€å‡º 10 æ–‡ä»¶ä¼ è¾“\r1 2 3 4 scp /home/dm/dmdata/dm.ini ip:/home/dm/dmdata/ # å¤åˆ¶æ‰€æœ‰è¯¥ç›®å½•ä¸‹æ‰€æœ‰å†…å®¹ï¼Œé€’å½’ scp -r /home/dm/dmdata/dm.ini ip:/home/dm/dmdata/ å…¶ä»–\r1 ç®¡é“ç¬¦ |\r|å¯ä»¥å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥\nä¸¾ä¾‹ï¼š\n1 2 3 4 5 6 7 # æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ¢³ç† # é€šè¿‡ ls -l åˆ—å‡ºå½“å‰è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶ã€ç›®å½•ï¼Œè®©åè®¡ç®—å®ƒä»¬çš„æ•°é‡ ls -l | wc -l # æŸ¥çœ‹å½“å‰è¿è¡Œçš„dmè¿›ç¨‹ # -i ä¸åŒºåˆ†å¤§å°å†™ ps -ef | grep -i dm 2 é‡å®šå‘\r2.1 é‡å®šå‘æ¸…ç©ºæ–‡ä»¶å†…å®¹\r1 2 # æŠŠç©ºå†…å®¹è¦†ç›–å†™å…¥æ–‡ä»¶ï¼Œè¾¾åˆ°æ¸…ç©ºæ–‡ä»¶å†…å®¹çš„æ•ˆæœ \u0026gt;file_name 2.2 é‡å®šå‘ä»‹ç»\r1 2 3 \u0026lt;file_name\t# å°†æ–‡ä»¶å†…å®¹ä½œä¸ºæ ‡å‡†è¾“å…¥ä¼ é€’ç»™å‘½ä»¤ \u0026gt;file_name\t# å°†å‘½ä»¤çš„è¾“å‡ºè¦†ç›–å†™å…¥æ–‡ä»¶é‡Œ \u0026gt;\u0026gt;file_name\t# å°†å‘½ä»¤çš„è¾“å‡ºè¿½åŠ å†™å…¥æ–‡ä»¶é‡Œ 3 echo\rè¾“å‡ºå†…å®¹\n1 2 3 # è¾“å…¥å˜é‡ echo $JAVA_HOME echo $PATH 4 é…ç½®ç¯å¢ƒå˜é‡\rç¯å¢ƒå˜é‡é€šå¸¸é…ç½®åœ¨ /etc/profile``~/.bash_profileæ–‡ä»¶é‡Œ\n1 2 3 4 5 6 7 8 9 10 11 vi /etc/profile # æ·»åŠ  export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64 export JRE_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64/jre export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib export PATH=$JAVA_HOME/bin:$PATH # ä¿å­˜ååˆ·æ–°ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ source /etc/profile # éªŒè¯ echo $JAVA_HOME 5 å‘½ä»¤åˆ«å allas\ré…ç½® åˆ«å æ˜¯ä¸ºäº†æ–¹ä¾¿è‡ªå·±ï¼Œæ¯”å¦‚å¯¹å‘½ä»¤åˆ«åã€å°è£…å‡½æ•°ç­‰è¿›è¡Œé…ç½®ã€‚\nå®ƒæœ‰ä¸¤ä¸ªæ–‡ä»¶ /etc/bashrc ~/.bashrcï¼Œä¸€ä¸ªæ˜¯å…¨å±€ç”Ÿæ•ˆï¼Œä¸€ä¸ªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 # è¿›å…¥ç¼–è¾‘ vi /etc/bashrc # æ·»åŠ  alias llt=\u0026#39;ls -lrt\u0026#39; alias nst=\u0026#39;netstat -ntlp\u0026#39; # ä¿å­˜ååˆ·æ–° source /etc/bashrc # è¾“å…¥ lltï¼Œå°±ä¼šæ‰§è¡Œ ls -lrt å‘½ä»¤ï¼ˆè¯¥å‘½ä»¤ä¸ºå°†å½“å‰ç›®å½•çš„å†…å®¹å®‰è£…æ—¶é—´é¡ºåºæ˜¾ç¤ºå‡ºæ¥ï¼‰ # è¾“å…¥ nstï¼Œå°±ä¼šæ‰§è¡Œ netstat -ntlp # åˆ«åä¸èƒ½ä¸ç°æœ‰å‘½ä»¤é‡å¤ï¼Œåˆ«ååº”å½“å”¯ä¸€ # æŸ¥çœ‹æ‰€æœ‰çš„åˆ«å alias å°è£…å‡½æ•°çš„ç”¨æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è¿›å…¥ç¼–è¾‘ vi /etc/bashrc vi /etc/bashrc # æ·»åŠ  function func_name() { ps -ef | grep -i $1 } # ä¿å­˜ååˆ·æ–° source /etc/bashrc # è°ƒç”¨ func_name java # è°ƒç”¨å‡½æ•°ä¼šç›´æ¥æ˜¾ç¤º ps -ef | grep -i java å‘½ä»¤çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹è¾¹ UID PID PPID C STIME TTY TIME CMD user1 1234 1233 0 2023-09-14 10:00:00 pts/0 00:01:23 java -jar myapp.jar ","date":"2024-07-11T22:21:07+08:00","permalink":"http://localhost:1313/posts/2024/07/linux-%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86%E5%85%A8/","title":"Linux å‘½ä»¤æ•´ç†ï¼ˆå…¨ï¼‰"},{"content":"åœ¨ä¿¡åˆ›é¡¹ç›®ä¸Šï¼Œå› ä¸ºæœåŠ¡å™¨é€šå¸¸æ˜¯linux æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥å¯¹linuxå‘½ä»¤ä¹Ÿæ˜¯ç»å¸¸éœ€è¦ä½¿ç”¨ã€‚æ ¹æ®å®é™…çš„é¡¹ç›®é‡Œï¼Œéœ€è¦ç»å¸¸ä½¿ç”¨åˆ°çš„linux å‘½ä»¤ï¼Œåšä¸€ä¸ªæ€»ç»“ ã€‚\nlinuxåŸºç¡€å‘½ä»¤\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # dir æŒ‡ç›®å½• # file æŒ‡æ–‡ä»¶ # path æŒ‡è·¯å¾„ # åˆ—å‡ºå½“å‰ç›®å½•æ‰€æœ‰å†…å®¹ ll # ç§»åŠ¨ cd /path/dir_name # è¿”å›ä¸Šçº§ç›®å½• cd .. # è¿”å›ä¸Šä¸ªç›®å½• cd - # æ˜¾ç¤ºå½“å‰è·¯å¾„ pwd # æŸ¥çœ‹æ–‡ä»¶å†…å®¹ cat cat /path/file_name # æŸ¥çœ‹æ–‡ä»¶æœ«å°¾ N è¡Œå†…å®¹ï¼Œå¹¶å®æ—¶æ˜¾ç¤ºæ–‡ä»¶è¿½åŠ å†…å®¹ tail -fn N file_name # åˆ›å»ºç›®å½• mkdir -p /path/to/create_dir_name # åˆ›å»ºæ–‡ä»¶ touch file_name # å¯ä»¥ä½¿ç”¨ vi ç¼–è¾‘ç©ºæ–‡ä»¶ä¿å­˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ–°æ–‡ä»¶ vi file_name # åˆ é™¤ç›®å½•ã€æ–‡ä»¶ rm -rf dir_name rm -rf file_name # è§£å‹ tar.gz tar -xzvf file.tar.gz # å¤åˆ¶ cp /path/dir_name /path/to/new_dir_name cp -r /path/dir_name /path/to/new_dir_name # ç§»åŠ¨ mv /path/dir_name /new_path/to/dir_name # é‡å‘½å mv /path/dir_name /path/new_dir_name # æ€æ‰è¿›ç¨‹ kill -9 pid ä¸Šè¿°éƒ½æ˜¯åŸºç¡€ï¼Œå½“ç„¶ä¸‹è¾¹ä¹Ÿæ˜¯åŸºç¡€ã€‚\nä½†æ˜¯æ ¹æ®æˆ‘åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸€ä¸ªåº”ç”¨çš„éƒ¨ç½²è¿‡ç¨‹æ¥åšçš„æ€»ç»“ï¼ŒåŒ…æ‹¬å‰æœŸåº”ç”¨çš„æ­å»ºï¼Œåˆ°åæœŸåº”ç”¨æœåŠ¡è¿ç»´ï¼Œä»ä¸€æ•´ä¸ªé¡¹ç›®å®æ–½éƒ¨ç½²çš„è¿‡ç¨‹ï¼Œæ¥æ¢³ç†å®é™…å·¥ä½œä¸­åº”è¯¥æŒæ¡å“ªäº›å‘½ä»¤ã€‚\né¡¹ç›®è¿‡ç¨‹ä¸­å¸¸ç”¨å‘½ä»¤\réªŒè¯ç½‘ç»œ\rå…ˆéªŒè¯åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®åº“æœåŠ¡å™¨ç½‘ç»œæ˜¯å¦å¼€é€šï¼Œæ²¡æœ‰å¼€é€šåˆ™æ²Ÿé€šèµ°æµç¨‹å¼€é€š\n1 2 ping ip telnet ip port é…ç½® Hosts\rå½“ ping telnet æ— æ³•æ‰¾åˆ°å¯¹åº”çš„ä¸»æœºåæˆ–æœåŠ¡æ—¶ï¼Œå¯ä»¥é…ç½® hosts\n1 2 3 4 5 6 7 8 9 # è·å– ip ip addr # è·å–ä¸»æœºå hostname # ç¼–è¾‘ vi /etc/hosts # æ·»åŠ  ip hostname é…ç½® DNS\råœ¨é¡¹ç›®ä¸Šï¼Œæœ‰æ—¶å€™å®¢æˆ·ä¸æä¾› hostsï¼Œè€Œæ˜¯æä¾› DNSï¼Œæ¯”å¦‚å¯¹æ¥é‚®ç®±æœåŠ¡çš„æ—¶å€™æä¾›ä¸€ä¸ªé‚®ç®±æœåŠ¡å™¨çš„ DNSã€‚\n1 2 3 4 5 6 7 # ç¼–è¾‘ DNS æ–‡ä»¶ vi /etc/resolv.con # æ·»åŠ ï¼šnameserver ä¸ºå›ºå®šå†™æ³• nameserver ip # ä¾‹å­ nameserver 127.0.0.1 nameserver www.baidu.com åˆ›å»ºç”¨æˆ·\råœ¨é¡¹ç›®éƒ¨ç½²æ—¶ï¼Œå®¢æˆ·çš„ç”Ÿäº§ç¯å¢ƒæ˜¯ä¸ä¼šæä¾› root ç”¨æˆ·çš„ï¼Œæµ‹è¯•ç¯å¢ƒä¸Šï¼Œéœ€è¦è‡ªå·±åˆ›å»ºç›¸å…³çš„ä¸­é—´ä»¶ã€æ•°æ®åº“ç”¨æˆ·ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªç”¨æˆ·è¿›è¡Œæ“ä½œï¼Œèƒ½å¤Ÿä½¿åº”ç”¨æœåŠ¡åœ¨æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­ä¿æŒä¸€è‡´çš„è¿è¡Œæƒ…å†µã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1.åˆ›å»ºç”¨æˆ·ç»„ groupadd -g group_name # ä¾‹å­ groupadd -g dmdba # 2.åˆ›å»ºç”¨æˆ· useradd -g group_name -s /bin/bash -d /home/dir_name -m user_name # -gï¼šæŒ‡å®šç”¨æˆ·æ‰€å±ç»„ # -sï¼šæŒ‡å®šç”¨æˆ·ç”¨çš„ shell # -dï¼šæŒ‡å®šç”¨æˆ·çš„æ ¹ç›®å½•è·¯å¾„ # -mï¼šåˆ›å»ºç”¨æˆ·çš„æ ¹ç›®å½• # ä¾‹å­,åˆ›å»º dmdba ç”¨æˆ·ï¼Œå¹¶è®¾ç½®ç”¨æˆ· ID\\æ‰€å±ç»„\\æŒ‡å®š SHELL\\æŒ‡å®šæ ¹ç›®å½•å¹¶åˆ›å»ºæ ¹ç›®å½•ï¼š useradd -g dmdba -s /bin/bash -d /home/dm -m dmdba # 3.æ›´æ”¹ç”¨æˆ·ä¸»ã€ç»„ chown dmdba:dmdba /home/dm # 4.ä¿®æ”¹ç”¨æˆ·å¯†ç  passwd user_name ä¿®æ”¹æƒé™\råœ¨åˆ›å»ºç”¨æˆ·åï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€äº›ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾åº”ç”¨åŒ…ï¼Œæˆ–è€…ç”¨æ¥å®‰è£…åº”ç”¨æœåŠ¡ã€‚\nå¦‚æœä½¿ç”¨rootåˆ›å»ºäº†ç›®å½•ï¼Œæ˜¯éœ€è¦ä¿®æ”¹è¿™äº›ç›®å½•çš„æƒé™çš„\n1 2 3 4 5 6 # åˆ›å»ºç›®å½• mkdir -p /home/dm # æ›´æ”¹ç›®å½•æ‰€å±ä¸»ã€ç»„ chown dmdba:dmdba -R /home/dm # æ›´æ”¹ç›®å½•æƒé™ chmod 755 -R /home/dm è§£åŒ…\råœ¨åˆ›å»ºå¥½ç›®å½•åï¼Œä¸Šä¼ åº”ç”¨åŒ…ï¼Œä¸€èˆ¬ä¸ºtar.gz æˆ–è€… zip\n1 2 3 4 5 6 7 # è§£å‹ tar åŒ…åˆ°å½“å‰ç›®å½• tar -xzvf file.tar.gz # è§£å‹ tar åŒ…åˆ°æŒ‡å®šç›®å½• tar -xzvf file.tar.gz /path/to/dir_name # è§£å‹ zip åŒ… unzip file.zip æŒ‚è½½\rå› ä¸ºæœ‰çš„å®‰è£…åŒ…ï¼Œæ˜¯æä¾›ä¸€ä¸ª iso é•œåƒæ–‡ä»¶çš„ï¼Œåœ¨ linux é‡Œéœ€è¦å…ˆæŒ‚è½½ iso æ–‡ä»¶ï¼Œé‡Œè¾¹æœ‰å®‰è£… .sh è„šæœ¬\n1 2 # æŒ‚è½½ iso æ–‡ä»¶ï¼Œä¸»è¦æŒ‚è½½ç›®å½•éœ€è¦ç”¨æˆ·èƒ½è®¿é—®ï¼Œä¸€èˆ¬åœ¨åº”ç”¨ä¸»ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç›®å½• mount -o loop file_name.iso /home/dm/mnt é…ç½®ç¯å¢ƒå˜é‡\ré€šå¸¸çš„é¡¹ç›®æ˜¯ä¸ª java æ„å»ºçš„åº”ç”¨ï¼Œéœ€è¦ä½¿ç”¨ JDK ã€‚å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£… JDK åŒ…å°±éœ€è¦å…ˆå®‰è£…ï¼Œä¸è¿‡ç°åœ¨å‘è¡Œç‰ˆçš„LINUXéƒ½æ˜¯è‡ªå¸¦äº†openJDK ï¼Œéœ€è¦æ ¹æ®JDK çš„è·¯å¾„å»é…ç½®ç¯å¢ƒå˜é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ä¸€ä¸ªæ–°æœåŠ¡å™¨çš„javaå®‰è£…è·¯å¾„åœ¨å“ªé‡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥æ‰¾ # å…ˆçœ‹æ˜¯å¦å®‰è£… java -version # æœ‰åˆ™æ‰¾ java è·¯å¾„ï¼Œè¿™ä¹ˆæ‰¾ï¼š # whereis java æˆ–è€… which java éƒ½å¯ä»¥ [root@FXQ-YWYY-57-81 ~]# whereis java java: /usr/bin/java /usr/lib/java /etc/java /usr/share/java /usr/java/jdk1.8.0_231/bin/java /usr/share/man/man1/java.1.gz [root@FXQ-YWYY-57-81 ~]# ls -lrt /usr/bin/java lrwxrwxrwx 1 root root 22 Jun 6 2023 /usr/bin/java -\u0026gt; /etc/alternatives/java [root@FXQ-YWYY-57-81 ~]# ls -lrt /etc/alternatives/java lrwxrwxrwx 1 root root 73 Jun 6 2023 /etc/alternatives/java -\u0026gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64/jre/bin/java # çŸ¥é“äº† java çš„è·¯å¾„ï¼Œå°±å¯ä»¥é…ç½®ç¯å¢ƒå˜é‡ # é…ç½®ç¯å¢ƒå˜é‡æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š /etc/profile å…¨å±€ç¯å¢ƒå˜é‡ï¼› ~/.bash_profile å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ vi /etc/profile # æ·»åŠ  export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64 export JRE_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.aarch64/jre export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib export PATH=$JAVA_HOME/bin:$PATH # ä¿å­˜ååˆ·æ–°ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ source /etc/profile # éªŒè¯ echo $JAVA_HOME æœåŠ¡å¯åœ\rå¯åŠ¨æœåŠ¡\rä¸€èˆ¬å¤šæ˜¯ç”¨åå°å‘½ä»¤å¯åŠ¨\n1 nohup server_name \u0026amp; å¯åŠ¨ java ç¨‹åº\ræœ‰çš„é¡¹ç›®éœ€è¦å•ç‹¬å¯åŠ¨æŸä¸ª jar åŒ…\n1 java -jar file.jar æŸ¥çœ‹æœåŠ¡çŠ¶æ€\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ps -ef | grep app_name # ä¾‹å­ ps -ef | grep java # å°† ps -ef å‘½ä»¤çš„è¾“å‡ºç»“æœä½œä¸º grep java çš„è¾“å…¥ # ps -ef ä¼šæŸ¥å‡ºæ‰€æœ‰è¿è¡Œçš„è¿›ç¨‹ï¼Œgrep java åˆ™åœ¨è¿™äº›è¿›ç¨‹é‡ŒæŸ¥æ‰¾æœ‰å…³ java çš„è¿›ç¨‹ # è¿”å›çš„ä¿¡æ¯è§£é‡Š # user è¿›ç¨‹å½’å±ç”¨æˆ· # PID è¿›ç¨‹ ID # CPU CPU ä½¿ç”¨ç‡ # MEM å†…å­˜ä½¿ç”¨ç‡ # STAT è¿›ç¨‹çŠ¶æ€ï¼ˆR è¿è¡Œ S ç¡çœ  Z å¡æ­»ï¼‰ # START è¿›ç¨‹å¼€å§‹è¿è¡Œæ—¶é—´ # TIME è¿›ç¨‹è¿è¡Œæ—¶é—´ # COMMAND è¿›ç¨‹æ‰§è¡Œçš„å‘½ä»¤ å…³é—­é˜²ç«å¢™\råº”ç”¨æœåŠ¡å¦‚æœèµ·æ¥äº†ï¼Œä½†æ˜¯å‰å°åœ°å€æ‰“ä¸å¼€çš„æƒ…å†µï¼Œæ‹’ç»è®¿é—®æˆ–è€…æ— ç›¸åº”ã€‚éœ€è¦å…³é—­é˜²ç«å¢™\n1 2 3 4 # å…³é—­ systemctl stop firewalld # ç¦æ­¢è‡ªå¯ï¼ˆå¯æ“ä½œä¹Ÿå¯ä¸æ“ä½œï¼Œä¸æ“ä½œçš„è¯ï¼Œæœºå™¨é‡å¯ä¼šè‡ªå¯é˜²ç«å¢™ï¼‰ systemctl disable firewalld æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ\ré¡¹ç›®ä¸Šï¼Œå¯èƒ½å­˜åœ¨ç«¯å£å†²çªçš„æƒ…å†µï¼Œæ¯”å¦‚è¯´æŸä¸ªæœåŠ¡å…³é—­å¼‚å¸¸å¯¼è‡´æœåŠ¡å…³äº†ä½†æ˜¯ç«¯å£æ²¡é‡Šæ”¾ï¼Œå¯æ’æŸ¥ç«¯å£ç”±å“ªä¸ªpid å ç”¨ç€ï¼Œå°†å®ƒ kill æ‰é‡Šæ”¾ç«¯å£\n1 2 3 4 5 6 natstat -ntlp # -n æ˜¾ç¤ºåœ°å€ã€ç«¯å£å· # -t æ˜¾ç¤º tcp è¿æ¥ä¿¡æ¯ # -l æ˜¾ç¤ºç›‘å¬ # -p æ˜¾ç¤ºè¿›ç¨‹ è¿½è¸ªæ—¥å¿—\råœ¨æ’æŸ¥é—®é¢˜è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦çœ‹æ—¥å¿—ã€‚\nå¯ä»¥ç›´æ¥å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œçœ‹çœ‹å“ªä¸€æ­¥æŠ¥é”™\n1 tail -fn 200 file.log ä¹Ÿå¯ä»¥ä½¿ç”¨é‡å®šå‘ï¼Œå°†æ—¥å¿—å…ˆæ¸…ç©ºï¼Œé¿å…å†—ä½™ä¿¡æ¯è¿‡å¤šï¼Œç„¶åå†è¿½è¸ªæ—¥å¿—\n1 2 3 # \u0026gt; å…¶å®æ˜¯ä¸ªé‡å®šå‘ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯æŠŠå‰è¾¹çš„ç©ºå†…å®¹ä»¥è¦†ç›–çš„æ–¹å¼è¾“å…¥åˆ°æ–‡ä»¶é‡Œï¼Œè¾¾åˆ°åˆ é™¤æ•ˆæœ \u0026gt;file.log tail -fn 200 file.log æŸ¥çœ‹æœåŠ¡å™¨èµ„æºå ç”¨æƒ…å†µ\r1 2 3 4 5 6 # top å®æ—¶æŸ¥çœ‹èµ„æºæƒ…å†µ top # æŸ¥çœ‹å†…å­˜æƒ…å†µ free -h # æŸ¥çœ‹ç£ç›˜æƒ…å†µ df -h æŸ¥çœ‹å†å²å‘½ä»¤\r1 2 # æ˜¾ç¤ºå†å²æ‰§è¡Œè¿‡çš„å‘½ä»¤ history åˆ¤æ–­å‘½ä»¤æ˜¯å¦è¢«æ‹‰èµ·\r1 2 # æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œåˆ¤æ–­åº”ç”¨æ˜¯å¦è¢«æ‹‰èµ·ï¼Œå½“æ“ä½œæœºä¸æœåŠ¡å™¨å­˜åœ¨ç½‘ç»œé—®é¢˜æ—¶å¯ç”¨æ­¤åˆ¤æ–­ï¼Œå¦‚æœä¸èƒ½è®¿é—®ï¼Œæ’æŸ¥æ“ä½œæœºçš„ç½‘ç»œä¸æœåŠ¡å™¨ IP æ˜¯å¦é€š curl URL å¸¸è§æŠ¥é”™\rNo such file or directory\ræ‰§è¡Œ shell è„šæœ¬çš„æ˜¯ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªæŠ¥é”™ï¼Œå®Œæ•´çš„æŠ¥é”™ç±»ä¼¼ä¸‹è¾¹ï¼š\n1 2 3 /bin/sh: bad interpreter: No such file or directory # æˆ–è€… /usr/bin/env: \u0026#34;sh\\r\u0026#34;: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• æ˜¯å› ä¸ºç¼–å†™ shell è„šæœ¬æ—¶ï¼Œä½¿ç”¨çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå®ƒç”¨çš„æ¢è¡Œç¬¦æ˜¯ dos ï¼Œåœ¨ shell é‡Œçš„æ¢è¡Œç¬¦åº”è¯¥éœ€è¦æ›´æ”¹ä¸º unix ï¼Œå¦‚ä¸‹è®¾ç½®\n1 2 3 vi file.sh :set ff=unix\t# :set ff å¯ä»¥æŸ¥çœ‹å½“å‰ shell è„šæœ¬çš„æ¢è¡Œç¬¦æ˜¯ dos è¿˜æ˜¯ unix :wq\t# ä¿å­˜ Permission denied\rå°±æ˜¯å› ä¸ºæƒé™çš„åŸå› ã€‚åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨äº† root ç”¨æˆ·æ“ä½œï¼Œå…·æœ‰ç³»ç»Ÿæ‰€æœ‰æƒï¼Œæ‰€ä»¥æ“ä½œä»€ä¹ˆéƒ½ä¸ä¼šæŠ¥é”™ã€‚ä½†æ˜¯åˆ°äº†ç”Ÿäº§ç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯æ²¡æœ‰ root çš„æƒé™çš„ï¼Œæ‰€ä»¥å½“æ‰§è¡Œä¸€äº›éœ€è¦ç”¨åˆ° root æƒé™çš„å‘½ä»¤æ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚\né€šå¸¸æ˜¯å› ä¸º shell è„šæœ¬ä¸­ï¼Œå­˜åœ¨æˆæƒ chmod ã€åˆ›å»ºè½¯é“¾ ln -s ç­‰å‘½ä»¤ã€‚\nEND","date":"2024-07-10T21:25:13+08:00","permalink":"http://localhost:1313/posts/2024/07/linux-%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/linux-%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/","title":"Linux å·¥ä½œä¸­å¸¸ç”¨å‘½ä»¤æ€»ç»“ä¸å¸¸è§é”™è¯¯"},{"content":"ä¸€èˆ¬é€šè¿‡ä¿®æ”¹ç£ç›˜åˆ†åŒºæ¥å¢åŠ  swap åˆ†åŒºç©ºé—´ï¼Œåªæ˜¯å•çº¯çš„è°ƒæ•´swapç©ºé—´ä¼šå ç”¨ç‰©ç†å†…å­˜ã€‚\nä¿®æ”¹ç£ç›˜åˆ†åŒº\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # æŸ¥çœ‹å„åˆ†åŒºä¿¡æ¯ [root@FXQ-YWYY-57-81 dev]# fdisk --l Disk /dev/vda: 50 GiB, 53687091200 bytes, 104857600 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 55A9D713-559A-436B-BA30-299A54040073 Device Start End Sectors Size Type /dev/vda1 2048 1230847 1228800 600M EFI System /dev/vda2 1230848 3327999 2097152 1G Linux filesystem /dev/vda3 3328000 70436863 67108864 32G Linux filesystem /dev/vda4 70436864 103991295 33554432 16G Linux swap Disk /dev/vdb: 500 GiB, 536870912000 bytes, 1048576000 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x93389753 Device Boot Start End Sectors Size Id Type /dev/vdb1 2048 1048575999 1048573952 500G 83 Linux Disk /dev/loop0: 3.94 GiB, 4202692608 bytes, 8208384 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes 1 åˆ é™¤ç£ç›˜åˆ†åŒº\rå¦‚æœåˆ é™¤ç£ç›˜åˆ†åŒºï¼Œè¿™éƒ¨åˆ†ç©ºé—´å¹¶ä¸ä¼šè¢«æ˜¾ç¤ºï¼Œè€Œæ˜¯å±äºæœªä½¿ç”¨çš„çŠ¶æ€ï¼Œä¸ä¼šè®¡å…¥ df -h è¿”å›çš„ç»“æœï¼ˆå®ƒè¿”å›çš„æ˜¯å·²ç»æŒ‚è½½äº†çš„å¯ç”¨ç©ºé—´ï¼‰ã€‚éœ€å°†è¿™éƒ¨åˆ†ç©ºé—´é‡æ–°åˆ†é…åˆ°æ–°çš„åˆ†åŒºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # ä½¿ç”¨ fdisk å‘½ä»¤ï¼Œåè¾¹æ¥ åˆ†åŒºå [root@FXQ-YWYY-57-81 /]# fdisk /dev/vda Welcome to fdisk (util-linux 2.35.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. # åˆ—å‡ºå½“å‰åˆ†åŒºä¿¡æ¯ Command (m for help): p Disk /dev/vda: 50 GiB, 53687091200 bytes, 104857600 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 55A9D713-559A-436B-BA30-299A54040073 Device Start End Sectors Size Type /dev/vda1 2048 1230847 1228800 600M EFI System /dev/vda2 1230848 3327999 2097152 1G Linux filesystem /dev/vda3 3328000 70436863 67108864 32G Linux filesystem /dev/vda4 70436864 103991295 33554432 16G Linux swap # åˆ é™¤å‘½ä»¤ï¼Œé€‰æ‹©ç¬¬å››ä¸ªåˆ†åŒºï¼ŒæŒ‰é¡ºåºæ¥çš„ Command (m for help): d Partition number (1-4, default 4): 4 Partition 4 has been deleted. # w æ˜¯ä¿å­˜é€€å‡º Command (m for help): w The partition table has been altered. Syncing disks. 2 æ–°å¢ç£ç›˜åˆ†åŒº\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 # ä½¿ç”¨ fdisk ç£ç›˜ç®¡ç†å‘½ä»¤ [root@FXQ-YWYY-57-81 ~]# fdisk /dev/vda Welcome to fdisk (util-linux 2.35.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): p Disk /dev/vda: 50 GiB, 53687091200 bytes, 104857600 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 55A9D713-559A-436B-BA30-299A54040073 Device Start End Sectors Size Type /dev/vda1 2048 1230847 1228800 600M EFI System /dev/vda2 1230848 3327999 2097152 1G Linux filesystem /dev/vda3 3328000 70436863 67108864 32G Linux filesystem Command (m for help): m Help: GPT M enter protective/hybrid MBR Generic d delete a partition\t# åˆ é™¤ F list free unpartitioned space l list known partition types n add a new partition\t# æ–°å¢ p print the partition table t change a partition type\t# æ›´æ”¹åˆ†åŒºç±»å‹ v verify the partition table i print information about a partition Misc m print this menu x extra functionality (experts only) Script I load disk layout from sfdisk script file O dump disk layout to sfdisk script file Save \u0026amp; Exit w write table to disk and exit q quit without saving changes Create a new label g create a new empty GPT partition table G create a new empty SGI (IRIX) partition table o create a new empty DOS partition table s create a new empty Sun partition table # æ–°å¢ n ï¼Œå†…å­˜å–é»˜è®¤å°±è¡Œ Command (m for help): n Partition number (4-128, default 4): 4 First sector (70436864-104857566, default 70436864): Last sector, +/-sectors or +/-size{K,M,G,T,P} (70436864-104857566, default 104857566): Created a new partition 4 of type \u0026#39;Linux filesystem\u0026#39; and of size 16.4 GiB. Partition #4 contains a swap signature. # é»˜è®¤ y Do you want to remove the signature? [Y]es/[N]o: y The signature will be removed by a write command. # ä¿å­˜ Command (m for help): w The partition table has been altered. Syncing disks. # è®©å†…æ ¸é‡æ–°è¯»å–åˆ†åŒºä¿¡æ¯ [root@FXQ-YWYY-57-81 ~]# partprobe -s /dev/vdb: msdos partitions 1 Warning: Unable to open /dev/sr0 read-write (Read-only file system). /dev/sr0 has been opened read-only. /dev/sr0: msdos partitions /dev/vda: gpt partitions 1 2 3 4 # æ ¼å¼åŒ–åˆ†åŒºï¼Œæ³¨æ„è¿™æ˜¯ filesystem ç±»å‹çš„åˆ†åŒºæ ¼å¼åŒ– [root@FXQ-YWYY-57-81 dev]# mkfs.xfs -f /dev/vda4 meta-data=/dev/vda4 isize=512 agcount=4, agsize=1075647 blks = sectsz=512 attr=2, projid32bit=1 = crc=1 finobt=1, sparse=1, rmapbt=0 = reflink=1 data = bsize=4096 blocks=4302587, imaxpct=25 = sunit=0 swidth=0 blks naming =version 2 bsize=4096 ascii-ci=0, ftype=1 log =internal log bsize=4096 blocks=2560, version=2 = sectsz=512 sunit=0 blks, lazy-count=1 realtime =none extsz=4096 blocks=0, rtextents=0 2.1 è°ƒæ•´ç£ç›˜åˆ†åŒºä¸º swap åˆ†åŒº\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 [root@FXQ-YWYY-57-81 ~]# fdisk /dev/vda Welcome to fdisk (util-linux 2.35.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): p Disk /dev/vda: 50 GiB, 53687091200 bytes, 104857600 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 55A9D713-559A-436B-BA30-299A54040073 Device Start End Sectors Size Type /dev/vda1 2048 1230847 1228800 600M EFI System /dev/vda2 1230848 3327999 2097152 1G Linux filesystem /dev/vda3 3328000 70436863 67108864 32G Linux filesystem # æ›´æ”¹åˆ†åŒºç±»å‹ä¸º swap Command (m for help): t Partition number (1-4, default 4): 4 Partition type (type L to list all types): 19 # ä¿å­˜ Command (m for help): w The partition table has been altered. Syncing disks. # è®©å†…æ ¸é‡æ–°è¯»å–åˆ†åŒºä¿¡æ¯ [root@FXQ-YWYY-57-81 ~]# partprobe -s /dev/vdb: msdos partitions 1 Warning: Unable to open /dev/sr0 read-write (Read-only file system). /dev/sr0 has been opened read-only. /dev/sr0: msdos partitions /dev/vda: gpt partitions 1 2 3 4 # æ ¼å¼åŒ–åˆ†åŒº [root@FXQ-YWYY-57-81 dev]# mkswap /dev/vda4 # æŒ‚è½½åˆ†åŒº [root@FXQ-YWYY-57-81 dev]# swapon /dev/vda4 # éªŒè¯ [root@FXQ-YWYY-57-81 dev]# swapon --show NAME TYPE SIZE USED PRIO /dev/vda4 partition 16.4G 0B -2 # è®¾ç½®å¼€æœºè‡ªå¯ [root@FXQ-YWYY-57-81 dev]# vi /etc/fstab # åŠ å…¥ UUID=9b6af8bf-5a7a-4e6b-8e2e-4afa78cf5bbc none swap defaults 0 0 # å¦‚æœä¸æ¸…æ¥š UUID å¯è®¾ç½®ä¸ºå®ƒæ–‡ä»¶çš„è·¯å¾„ /dev/vda4 none swap defaults 0 0 # æŸ¥çœ‹ UUID ä¹Ÿæ˜¯å¯ä»¥çš„ [root@FXQ-YWYY-57-81 dev]# blkid /dev/vda4 /dev/vda4: UUID=\u0026#34;1be2cafb-87e7-4539-8035-76f6d6afe54b\u0026#34; TYPE=\u0026#34;swap\u0026#34; PARTUUID=\u0026#34;76bd885e-c19a-c04b-bdec-9374a1515872\u0026#34; æ›´æ”¹ swap åˆ†åŒºç©ºé—´\rå½“æœåŠ¡å™¨ä½¿ç”¨äº†é»˜è®¤çš„ swap äº¤æ¢åŒºï¼Œç©ºé—´è¿‡å¤§æ—¶ï¼Œä¸ºäº†é¿å…ç•™ç»™åº”ç”¨çš„ç‰©ç†å†…å­˜å¤ªå°å¯¼è‡´åº”ç”¨æœåŠ¡å™¨è¿è¡Œæ€§èƒ½ä¸å¥½ï¼Œå¯ä»¥å¦‚ä¸‹è¿›è¡Œæ“ä½œï¼Œå¯¹ swap åŒºè¿›è¡Œç¼©å‡ã€‚ç¼©å‡è¿˜æ˜¯å¢åŠ ï¼Œå…¶å®éƒ½æ˜¯é€šè¿‡æ–°å¢ä¸€ä¸ªå°ï¼ˆå¤§ï¼‰çš„æ–° swap æ–‡ä»¶ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶æ ¼å¼åŒ–ä¸º swap ç©ºé—´ï¼Œç„¶åå¸æ‰åŸæ¥çš„ swap ç©ºé—´ï¼Œå¯ç”¨æ–°çš„ swap ç©ºé—´ã€‚\nä½†æ˜¯å®ƒæœ¬èº«ä½¿ç”¨çš„æ˜¯ä¸€éƒ¨åˆ†ç‰©ç†ç£ç›˜ç©ºé—´ï¼Œç”¨ç£ç›˜ç©ºé—´è½¬ä¸ºè™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œè¿™ä¸ª swap è·Ÿ ç‰©ç†å†…å­˜å®é™…ä¸Šæ²¡æœ‰å…³ç³»ã€‚å¦‚æœä¸éœ€è¦åˆ†åŒºï¼Œåˆ™ç›´æ¥æŠŠè¿™ä¸ªåˆ†åŒºå¸æ‰ï¼Œç„¶åæŠŠå¯¹åº”çš„åˆ†åŒºæ–‡ä»¶åˆ é™¤å³å¯ã€‚\n1 ç¼©å° swap åˆ†åŒºç©ºé—´\r1.1 æŸ¥çœ‹ swap åˆ†åŒº\r1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ swap å…·ä½“æ˜¯å“ªä¸ª [root@linux1 ~]# swapon -s æ–‡ä»¶å ç±»å‹ å¤§å° å·²ç”¨ æƒé™ /dev/dm-1 partition 4063228 0 -2 # æˆ–è€…è¿™ä¹ˆæŸ¥ [root@linux1 ~]# cat /proc/swaps Filename Type Size Used Priority /dev/dm-1 partition 4063228 0 -2 èƒ½çœ‹å‡ºï¼Œswap äº¤æ¢åˆ†åŒºçš„è·¯å¾„æ˜¯ /dev/dm-1\n1.2 ç¦ç”¨ swap åˆ†åŒº\r1 2 3 4 # ç¦ç”¨ [root@linux1 ~]# swapoff /dev/dm-1 # ç¼–è¾‘ /etc/fstab åˆ æ‰ swap åˆ†åŒºçš„ä¿¡æ¯ vi /etc/fstab ç„¶åå¯ä»¥çœ‹åˆ° swap åˆ†åŒºå¯ç”¨ä¸º 0\n1 2 3 4 [root@linux1 ~]# free -h total used free shared buff/cache available Mem: 3.7G 284M 3.3G 11M 157M 3.2G Swap: 0B 0B 0B 1.3 é‡æ–°åˆ›å»º swap åˆ†åŒº\råˆ›å»º swap åˆ†åŒºæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # è¿›å…¥ /dev ç›®å½• [root@linux1 ~]# dd if=/dev/zero of=/swapfile bs=500M count=1 è®°å½•äº†1+0 çš„è¯»å…¥ è®°å½•äº†1+0 çš„å†™å‡º 524288000å­—èŠ‚(524 MB)å·²å¤åˆ¶ï¼Œ11.1731 ç§’ï¼Œ46.9 MB/ç§’ # /dev/zero æ˜¯ LINUX é‡Œä¸€ä¸ªç‰¹æ®Šå—è®¾å¤‡ï¼Œåœ¨æ¯æ¬¡è¯»å–æ—¶è¾“å‡ºé›¶å­—èŠ‚ # /swapfile å¯ä»¥æ˜¯ä»»æ„è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ªä¸ç”¨äº‹å…ˆåˆ›å»º # æˆæƒ [root@linux1 /]# chmod 600 swapfile # æŠŠè¿™ä¸ªæ–‡ä»¶æ ¼å¼åŒ–ä¸º swap ç©ºé—´ [root@linux1 /]# mkswap /swapfile æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 511996 KiB æ— æ ‡ç­¾ï¼ŒUUID=fef44c17-e76e-4d25-8607-1546968093c0 # æ¿€æ´»è¯¥æ–‡ä»¶ï¼Œæ·»åŠ åˆ°äº¤æ¢æ± ä¸­ [root@linux1 /]# swapon /swapfile # æ·»åŠ è¯¥ swap åˆ†åŒºåˆ°é…ç½®æ–‡ä»¶é‡Œ [root@linux1 /]# vi /etc/fstab # åŠ å…¥è¯¥ swap åˆ†åŒºä¿¡æ¯ /swapfile swap defaults 0 0 # éªŒè¯ [root@linux1 /]# swapon --show NAME TYPE SIZE USED PRIO /swapfile file 500M 0B -3 # åˆ é™¤æ—§çš„ swap åˆ†åŒºï¼Œä¸ç„¶è¿˜æ˜¯ä¼šå ç”¨å†…å­˜ç©ºé—´ rm -rf /dev/dm-1 1.3.1 å½“æ‰§è¡Œæ ¼å¼åŒ–swapç©ºé—´å‘½ä»¤æ—¶æŠ¥é”™\r1 2 3 4 5 6 7 8 9 10 11 [root@linux2 dev]# sudo mkswap swapfile mkswap: swapfile: warning: wiping old swap signature. æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 511996 KiB æ— æ ‡ç­¾ï¼ŒUUID=9db8a3f1-5bd5-4634-a659-94f849c0d98c mkswap: æ— æ³•å°† swapfile æ ‡ç­¾æ”¹ä¸º unconfined_u:object_r:swapfile_t:s0: æƒé™ä¸å¤Ÿ # ä¸´æ—¶å…³é—­ selinux å®‰å…¨æ¨¡å— setenforce 0 # æ ¼å¼åŒ–å®Œæˆè®°å¾—æŠŠå®ƒæ”¹æ‰“å¼€ setenforce 1 2 å¢åŠ  swap åˆ†åŒºç©ºé—´\rè¿™éƒ¨åˆ†å¦‚æœä¸æ˜¯ä½¿ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œä¼šä½¿ç”¨ç‰©ç†å†…å­˜ç©ºé—´è½¬ä¸º swap ç©ºé—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [root@linux2 dev]# dd if=/dev/zero of=/dev/dm-1 bs=100M count=1 è®°å½•äº†1+0 çš„è¯»å…¥ è®°å½•äº†1+0 çš„å†™å‡º 104857600å­—èŠ‚(105 MB)å·²å¤åˆ¶ï¼Œ0.20253 ç§’ï¼Œ518 MB/ç§’ [root@linux2 dev]# mkswap /dev/dm-1 æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 102396 KiB æ— æ ‡ç­¾ï¼ŒUUID=15a0fcd0-c122-4fd4-8ee1-c4709a3ae4a3 mkswap: æ— æ³•å°† /dev/dm-1 æ ‡ç­¾æ”¹ä¸º unconfined_u:object_r:swapfile_t:s0: æƒé™ä¸å¤Ÿ # å…³é—­ sellinux [root@linux2 dev]# setenforce 0 [root@linux2 dev]# mkswap /swapfile2 æ­£åœ¨è®¾ç½®äº¤æ¢ç©ºé—´ç‰ˆæœ¬ 1ï¼Œå¤§å° = 102396 KiB æ— æ ‡ç­¾ï¼ŒUUID=6f8da03d-85ab-4841-9508-1d5ed5937787 [root@linux2 dev]# swapon /swapfile2 swapon: /dev/dm-1ï¼šä¸å®‰å…¨çš„æƒé™ 0644ï¼Œå»ºè®®ä½¿ç”¨ 0600ã€‚ [root@linux2 dev]# chmod 600 /swapfile2 [root@linux2 dev]# free -h total used free shared buff/cache available Mem: 3.7G 291M 2.6G 111M 803M 3.1G Swap: 599M 0B 599M [root@linux2 dev]# setenforce 1 # å†™å…¥ /etc/fstab vi /etc/fstab # æ·»åŠ  /swapfile2 swap defaults 0 0 ","date":"2024-07-03T13:56:41+08:00","permalink":"http://localhost:1313/posts/2024/07/linux-%E6%9B%B4%E6%94%B9swap%E5%88%86%E5%8C%BA/","title":"Linux æ›´æ”¹swapåˆ†åŒº"},{"content":"æœ€è¿‘å¼‚å¸¸äº¤æ˜“çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨åˆ°äº†kafka ï¼Œç”¨æ¥å®æ—¶æ¨é€å®æ—¶æˆäº¤ã€å§”æ‰˜æµæ°´ã€ç»„åˆæŒä»“ã€è¡Œæƒ…ç­‰ç­‰æ•°æ®åˆ°è‡ªç ”çš„å¹³å°ä¸Šåšæ•°æ®ç›‘æ§ã€‚é‚£ä¹ˆæˆ‘è¿™è¾¹éœ€è¦åšçš„å†…å®¹ï¼šå°†ä¸Šæ¸¸çš„æ•°æ®ç›´æ¥æ¨é€åˆ°kafkaä¸Šï¼Œç»™ä¸‹æ¸¸çš„åº”ç”¨æ¶ˆè´¹kafkaæ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦kafka ï¼Œå¹³ä¸”æ˜¯åœ¨å®é™…çš„é¡¹ç›®ä¸­ä½¿ç”¨çš„ï¼Œè¿™é‡Œç»éªŒå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¾ˆå®è´µçš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåšä¸€ä¸ªåŸºç¡€çŸ¥è¯†ã€é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ã€å¯¹åº”çš„è§£å†³æ–¹æ¡ˆçš„è®°å½•ã€‚åœ¨é¡¹ç›®ä¸Šä¸»è¦æ˜¯ä½¿ç”¨kafka è¯»å–æ•°æ®ï¼Œåšä¸€ä¸ªæµå¼å¤„ç†ï¼Œä¾›ä¸‹æ¸¸åº”ç”¨ä½¿ç”¨æ•°æ®ã€‚\nkafka ä¸»è¦ç»„ä»¶\rbroker æœåŠ¡å™¨\rkafkaé›†ç¾¤çš„æœåŠ¡å™¨ï¼Œä¸€å°æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ª broker ã€‚\nproducer ç”Ÿäº§è€…\rproducer ä¸»è¦æ˜¯ç”¨äºç”Ÿäº§æ¶ˆæ¯ï¼Œæ˜¯ kafka å½“ä¸­çš„æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œç”Ÿäº§çš„æ¶ˆæ¯é€šè¿‡ topic è¿›è¡Œå½’ç±»ï¼Œä¿å­˜åˆ° kafka çš„ broker é‡Œé¢å»ã€‚\né¡¹ç›®ä¸Šæˆ‘ä»¬çš„æ•°æ®å¹³å°å°±æ˜¯ä½œä¸ºä¸€ä¸ªç”Ÿäº§è€…ï¼Œé€šè¿‡å°†ä¸Šæ¸¸æ•°æ®æ¨é€åˆ°topicé‡Œã€‚\ntopic ä¸»é¢˜\rkafka å°†æ¶ˆæ¯ï¼ˆæ•°æ®ï¼‰ä»¥ topic ä¸ºå•ä½è¿›è¡Œå½’ç±»ã€‚åœ¨é¡¹ç›®é‡Œè¾¹ï¼Œä¸€å¼ è¡¨æ¨åˆ°ä¸€ä¸ª topic ï¼Œéœ€è¦æ¨å‡ å¼ è¡¨å°±æ˜¯å»ºå‡ ä¸ª topic ã€‚\npartition åˆ†åŒº\rkafka é‡Œï¼Œä¸€ä¸ª topic æ˜¯å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚æ¯”å¦‚è¯´åˆ›å»ºä¸€ä¸ªæœ‰ 3 ä¸ªåˆ†åŒºçš„ topic ï¼Œé‚£ä¹ˆæ•´ä¸ª topic çš„æ•°æ®éƒ½å­˜æ”¾åœ¨è¿™ 3 ä¸ªåˆ†åŒºå†…ï¼ˆå°±æ˜¯è¯´æ¯ä¸ªåˆ†åŒºéƒ½å­˜æ”¾ä¸€éƒ¨åˆ† topic çš„æ•°æ®ï¼‰ã€‚\nconsumer æ¶ˆè´¹è€…\ræ¶ˆè´¹è€…ä¸»è¦å°±æ˜¯æ¶ˆè´¹ kafka topic é‡Œçš„æ•°æ®\nconsumer group æ¶ˆè´¹è€…\ræ¶ˆè´¹è€…ç»„é‡Œå¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒåŒä¸€ä¸ªç»„é‡Œçš„æ¶ˆè´¹è€…ï¼Œå¯¹äºåŒä¸€æ¡æ•°æ®ï¼Œåªèƒ½æ¶ˆè´¹ 1 æ¬¡ã€‚\næ¯”å¦‚ï¼šä¸€ä¸ªæ¶ˆè´¹è€…ç»„é‡Œæœ‰ A å’Œ B ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒA æ¶ˆè´¹äº† topic é‡Œçš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆ B å°±æ— æ³•æ¶ˆè´¹è¯¥ topic é‡Œçš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œå› ä¸ºå·²ç»è¢«æ¶ˆè´¹è¿‡äº†ã€‚\nä½†æ˜¯ä¸åŒçš„æ¶ˆè´¹è€…ç»„ï¼Œè¿˜æ˜¯å¯ä»¥å…±åŒæ¶ˆè´¹æŸä¸ª topic é‡Œçš„æ•°æ®çš„ã€‚\næ¶ˆè´¹è€…ç»„ä¸åˆ†åŒºçš„å…³ç³»\rå¦‚æœ topic åªæœ‰ 2 ä¸ªåˆ†åŒºï¼Œæ¶ˆè´¹è€…ç»„é‡Œæœ‰ 4 ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¹Ÿåªèƒ½ä¾› 2 ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚\nå¦‚æœ topic æœ‰ 4 ä¸ªåˆ†åŒºï¼Œæ¶ˆè´¹è€…ç»„é‡Œçš„ 4 ä¸ªæ¶ˆè´¹è€…éƒ½èƒ½æ¶ˆè´¹æ•°æ®ï¼Œå¹¶å‘é‡å°±ä¸Šæ¥äº†ã€‚\næ‰€ä»¥ topic é‡Œçš„åˆ†åŒºè¶Šå¤šï¼Œæ¶ˆè´¹çš„å¹¶å‘è¶Šé«˜ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿè¶Šå¿«ã€‚\npartition replicas åˆ†åŒºå‰¯æœ¬\ræ¯ä¸ªåˆ†åŒºçš„å‰¯æœ¬ï¼Œç”¨æ¥æ§åˆ¶æ•°æ®ä¿å­˜åœ¨å‡ ä¸ª broker æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸æ˜¯å‡ å° broker å°±è®¾ç½®å‡ ä¸ªå‰¯æœ¬ã€‚\nsegment æ–‡ä»¶\rä¸€ä¸ª partition åˆ†åŒºä¸­ç”±å¤šä¸ª segment æ–‡ä»¶ç»„æˆçš„ã€‚æ¯ä¸ª segment æ–‡ä»¶åˆåŒ…å«äº† .log æ–‡ä»¶å’Œ.index æ–‡ä»¶ï¼Œ.log æ–‡ä»¶æ˜¯å­˜æ”¾æ¨é€çš„æ•°æ®ï¼Œ.index æ–‡ä»¶å­˜æ”¾æ•°æ®çš„ç´¢å¼•å€¼ï¼Œç”¨æ¥åŠ å¿«æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦çš„ã€‚\n.index æ–‡ä»¶é‡Œå­˜çš„ç´¢å¼•å€¼ï¼Œæ˜¯ä¸.logæ–‡ä»¶é‡Œçš„æ•°æ®ä½ç½®æ˜¯å¯¹åº”çš„ã€‚\n1 2 3 4 # .index æ˜¯ key-value å­˜æ”¾æ–¹å¼ 1,0\t# å¯¹åº” .log çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œå€¼æ˜¯0 2,2\t# å¯¹åº” .log çš„ç¬¬äºŒæ¡æ•°æ®ï¼Œå€¼æ˜¯2 3,9\t# å¯¹åº” .log çš„ç¬¬ä¸‰æ¡æ•°æ®ï¼Œå€¼æ˜¯9 .log æ–‡ä»¶é‡Œä¼šè®°å½•offset åç§»é‡ï¼Œç”¨äºæ ‡è®°æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯çš„ä½ç½®ã€‚\nkafka åŸºç¡€æ“ä½œ\rkafkaå¯åœ\rkafka ä¸ zookeeper å¼ºä¾èµ–ï¼Œå¯åŠ¨ kafka ä¹‹å‰å¿…é¡»å…ˆå¯åŠ¨ zookeeper ï¼Œå¦åˆ™ä¼šæŠ¥é”™çš„\n1 2 3 4 5 6 7 8 9 # zookeeper å¯åŠ¨ï¼Œåè¾¹æ¥é…ç½®æ–‡ä»¶ ./zookeeper-server-start.sh ../config/zookeeper.properties # zookeeper åœæ­¢ ./zookeeper-server-stop.sh # kafka å¯åŠ¨ï¼Œåè¾¹æ¥é…ç½®æ–‡ä»¶ ./kafka-server-start.sh ../config/server.properties # kafka åœæ­¢ ./kafka-server-stop.sh åˆ›å»º topic\r1 2 3 4 5 # åˆ›å»ºè¯­å¥ æ¨¡æ¿ ./kafka-topics.sh --create --bootstrap-server 10.84.0.1:9092 --replication-factor 1 --partitions 1 --topic topic_name # bootstrap-server æŒ‡å®š kafka æœåŠ¡å™¨åœ°å€å’Œç«¯å£ # replication-factor æŒ‡å®šåˆ†åŒºçš„å‰¯æœ¬ä¸ªæ•° # partitions æŒ‡å®štopicçš„åˆ†åŒºä¸ªæ•° åˆ é™¤ topic\r1 ./kafka-topics.sh --bootstrap-server 10.84.0.1:2181 --delete --topic topic_name å¢åŠ  topic partition\r1 ./kafka-topics.sh --zookeeper 10.84.0.1:2181 --alter --topic topic_name --partition 2 æŸ¥çœ‹ topic æ•°æ®\r1 2 3 ./kafka-console-consumer.sh --bootstrap-server 10.84.0.1:9092 --topic your_topic_name --from-beginning [--max-messages 10] # --max-messages æŸ¥çœ‹å‡ æ¡æ¶ˆæ¯ # --from-beginning æŸ¥çœ‹æœ€æ–°çš„æ¶ˆæ¯ æŸ¥è¯¢ topic åˆ—è¡¨\r1 ./kafka-topics.sh --list --zookeeper localhost kafka ç›¸å…³é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ\ræŠ¥é”™ Error while fetching metadata with correlation id\rè¿™ä¸ªæŠ¥é”™æ˜¯åœ¨ kafka æŸ¥çœ‹ topic é‡Œçš„æ•°æ®æ—¶ï¼Œå‡ºç°çš„é”™è¯¯ã€‚æŸ¥äº†ä¸‹èµ„æ–™ï¼Œå®ƒæ˜¯æ— æ³•è¯†åˆ«åˆ° hostname å¯¼è‡´ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nä¿®æ”¹ server.properties é…ç½®æ–‡ä»¶ï¼Œå¢åŠ  listeners ã€‚é»˜è®¤çš„é…ç½®æ˜¯æ²¡æœ‰è¿™ä¸¤è¡Œçš„ï¼Œæ‰‹åŠ¨åŠ ä¸Šã€‚\næŠ¥é”™ exiting abnormally\rè¿™ä¸ªæ˜¯åœ¨å¯åŠ¨ zookeeper çš„æ—¶å€™å‡ºç°ï¼ŒæŠ¥é”™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè§£å†³æ–¹æ¡ˆï¼š\nåœ¨zookeeper.propertiesé…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸ª dataDir=/path ï¼ŒæŠŠ /path è·¯å¾„ä¸‹çš„version-2 æ–‡ä»¶å¤¹åˆ æ‰ï¼Œç„¶åé‡æ–°å¯åŠ¨å³å¯ã€‚\næŠ¥é”™ during kafkaserver startup\rå¯åŠ¨ kafka çš„æ—¶å€™å‡ºç°ï¼ŒæŠ¥é”™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\næ³¨æ„è¿™ä¸ªï¼š\nç”±äºå¯åŠ¨çš„ id å’Œ meta.properties é‡Œè¾¹çš„ id ä¸ä¸€è‡´å¯¼è‡´æŠ¥é”™ã€‚é€šå¸¸æ˜¯å› ä¸ºå…³é—­ kafka çš„æ—¶å€™å‡ºç°äº†å¼‚å¸¸ï¼ˆè™½ç„¶ä¸çŸ¥é“æœ‰ä»€ä¹ˆå¼‚å¸¸ï¼‰\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 # æ‰¾åˆ°è¯¥æ–‡ä»¶ find / -name \u0026#34;meta.properties\u0026#34; # ä¿®æ”¹é‡Œè¾¹çš„ cluster.id= ä¸€ä¸²å­—ç¬¦ä¸²id ä¿®æ”¹ä¸ºæŠ¥é”™é‡Œå‡ºç°çš„é‚£ä¸ªæ‹¬å·é‡Œçš„ä¸€ä¸²idå³å¯ã€‚\næ–°å¢æ¶ˆè´¹è€…ç»„æ—¶æ•°æ®æ˜¾ç¤ºä¸ä¸€è‡´\råœ¨åšè¿ç§»çš„æ—¶å€™ï¼Œä¸ºäº†å¯¹æ¯”è¿ç§»å‰åçš„æ•°æ®é‡æ˜¯å¦ä¸€è‡´ã€‚åœ¨è¿ç§»åçš„ç¯å¢ƒä¸­æ–°å¢ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ Bï¼Œç”¨æ¥æ¶ˆè´¹åŒä¸€ä¸ª topic æ•°æ®ï¼Œå‘ç°è·Ÿè¿ç§»å‰çš„æ¶ˆè´¹è€…ç»„ A çš„æ•°æ®ä¸ä¸€è‡´ã€‚\næ¶ˆè´¹è€…ç»„Açš„æ•°æ®æ˜¯å½“å¤©çš„æ•°æ®ï¼Œä½†æ˜¯æ¶ˆè´¹è€…ç»„Bçš„æ•°æ®å´æ˜¯å‡ å¤©å‰çš„ã€‚ä¸ºå•¥ï¼Ÿ\nkafkaæ¯ä¸ªæ¶ˆè´¹è€…ç»„éƒ½æ˜¯ç‹¬ç«‹æ¶ˆè´¹æ•°æ®ï¼Œåªè¦æ˜¯æ¶ˆè´¹åŒä¸€ä¸ª topicï¼Œé‚£ä¹ˆæ•°æ®è‚¯å®šæ˜¯ä¸€è‡´çš„ã€‚ç”±äºä¸€èˆ¬ kafka çš„é…ç½®æ˜¯ä¿ç•™ 7 å¤©çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ–°å¢çš„æ¶ˆè´¹è€…ç»„æ¶ˆè´¹åŒä¸€ä¸ª topic æ—¶ï¼Œå®ƒä¼šé‡å¤´å¼€å§‹æ¶ˆè´¹ï¼Œå³ä»æ‰€ä»¥å°±å‡ºç°äº†ï¼Œæ¶ˆè´¹è€…ç»„Bé‡Œæ˜¯å‡ å¤©å‰çš„æ•°æ®ï¼Œè¿™æ˜¯æ— å¯é¿å…çš„ã€‚\né…ç½®æµæ°´å­—æ®µ\rç”±äºå½“æ—¶ç¬¬ä¸€æ¬¡é…ç½®çš„æ—¶å€™ï¼Œæ²¡æœ‰é…ç½®æµæ°´å­—æ®µï¼Œå¯¼è‡´äº†æ¨é€æ•°æ®åˆ° kafka topic çš„ä»»åŠ¡ï¼Œæ¯æ¬¡å®æ—¶æ¨é€å…¨é‡æ•°æ®è¿‡å»ï¼Œå¯¼è‡´äº†æ•°æ®å¹³å°æ¯æ¬¡å¯åŠ¨æ¨é€ kafka çš„ä»»åŠ¡ï¼Œå°±ä¼šè¿…é€Ÿå æ»¡æœåŠ¡å™¨å†…å­˜ï¼Œç„¶ååº”ç”¨æŒ‚æ‰ã€‚\nåè¾¹åŠ å…¥æµæ°´å­—æ®µï¼Œå°†ä»»åŠ¡é…ç½®ä¸ºå¢é‡æ¨é€ï¼Œå†…å­˜å æ¯”å°±å¥½äº†å¾ˆå¤šã€‚\né€šå¸¸æ˜¯ç”¨çº¿æ€§é€’å¢çš„å­—æ®µï¼Œä½œä¸ºæµæ°´å­—æ®µã€‚æ¯”å¦‚ï¼Œå®æ—¶æˆäº¤è¡¨é‡Œæœ‰æˆäº¤æ—¶é—´ï¼Œå§”æ‰˜æµæ°´è¡¨é‡Œæœ‰å§”æ‰˜æ—¶é—´ã€‚\né…ç½®ä¸»é”®\ré€šè¿‡é…ç½®ä¸»é”®ç”¨æ¥å»é‡ï¼Œé¿å…æ¨é€é‡å¤æ•°æ®åˆ° topic é‡Œã€‚æ¯”å¦‚ï¼šå®æ—¶æˆäº¤è¡¨é‡Œçš„æˆäº¤ç¼–å·ï¼Œå§”æ‰˜æµæ°´è¡¨é‡Œçš„å§”æ‰˜ç¼–å·ï¼Œç¼–å·æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¼–å·ä½œä¸ºä¸»é”®ã€‚\n","date":"2024-06-24T22:03:22+08:00","permalink":"http://localhost:1313/posts/2024/06/kafka-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E4%B8%8E%E9%85%8D%E7%BD%AE/","title":"kafka åŸºç¡€çŸ¥è¯†ä¸å®é™…é¡¹ç›®çš„é—®é¢˜"},{"content":"æœ¬æ–‡æ€»ç»“Nginxåœ¨é¡¹ç›®ä¸Šçš„å®é™…åº”ç”¨ï¼Œæœ¬æ–‡åŒ…å«äº†Nginxçš„å¸¸ç”¨é…ç½®ä¸åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ã€‚ä¿¡åˆ›ç‰ˆæœ¬çš„è´Ÿè½½å‡è¡¡ä¸­é—´ä»¶å…¶å®ä¹Ÿæ˜¯ç±»ä¼¼äºNginxï¼Œä»¥å®å…°å¾·è´Ÿè½½å‡è¡¡ä¸­é—´ä»¶BWSä¸ºä¾‹ã€‚\nNginx è´Ÿè½½å‡è¡¡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¸¸å¸¸ä¼šç”¨åˆ°ã€‚ç®€å•é€šä¿—çš„æ¶æ„å¦‚ä¸‹ï¼š\nåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œé€šå¸¸å…·æœ‰å¤šå°åº”ç”¨æœåŠ¡å™¨ï¼ˆä¸€èˆ¬ä¸ºé›†ç¾¤ï¼‰ï¼Œé€šè¿‡ Nginx æœåŠ¡å™¨é…ç½®çš„åœ°å€å»è®¿é—®åŒä¸€ä¸ªåº”ç”¨ï¼Œé€šè¿‡ Ng å®ç°åº”ç”¨çš„é«˜å¹¶å‘ã€é«˜å¯ç”¨ã€‚\nNginxåŸºç¡€\rNginx çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯ Nginx_home/conf/nginx.conf æ–‡ä»¶ï¼Œå®ƒé‡Œè¾¹çš„ç»“æ„å—æ˜¯è¿™æ ·çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # å…¨å±€å— # user user_name; # è¿è¡Œ nginx è¿›ç¨‹çš„ç”¨æˆ·å ... # äº‹ä»¶å— events { ... } # http å— http { # http å…¨å±€å— ... # server å— server { # server å…¨å±€å— ... # upstream å— upstream name { ... } # location å— location [PATTERN] { ... } } } å…¨å±€å—\r1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å…¨å±€å—é€šå¸¸æ˜¯é…ç½®ç”¨æˆ·ã€æ—¥å¿—ã€è¿›ç¨‹ã€pid ç­‰ # æ³¨æ„ï¼Œå…¨å±€å—ä¸­æ¶‰åŠçš„è·¯å¾„ï¼Œéœ€ nginx æœ‰æƒé™è¯»å†™ã€‚ # è¿è¡Œ nginx è¿›ç¨‹çš„ç”¨æˆ·åï¼ŒæŒ‡ Linux ç”¨æˆ· user user_name; # è®¾ç½® nginx çš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º 1ï¼Œä¸€èˆ¬è¿›ç¨‹æ•°=CPU æ ¸æ•°å³å¯ã€‚åŒæ ¸é… 2ï¼Œ4 æ ¸é… 4. worker_processes 1; # nginx çš„å·¥ä½œç›®å½•ï¼Œä¸é…ç½®ï¼Œé»˜è®¤åœ¨ logs ä¸‹ working_directory nginx_path/logs; # è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šdebug\\info\\notice\\warn\\error\\critï¼ˆé«˜åˆ°ä½ï¼‰ error_log nginx_path/logs/error.log info; # ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤ï¼Œè®°å½• error error_log nginx_path/logs/error.log # pidï¼Œè®¾ç½® nginx è¿›ç¨‹çš„ pid æ–‡ä»¶è·¯å¾„å’Œåç§° pid nginx_path/logs/nginx.pid; å…¨å±€å—ï¼Œé€šå¸¸é…ç½® user worker_processes error_log pid å³å¯ã€‚\nè§£é‡Šä¸€ä¸‹ pidï¼Œè¿™ä¸ªä¸œè¥¿å°±æ˜¯ nginx è¿è¡Œæ—¶çš„è¿›ç¨‹ idï¼ˆLinux æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ idï¼Œå³ pidï¼‰ï¼Œé…ç½® pidï¼Œå°±æ˜¯ä¸ºäº†å°† nginx çš„è¿›ç¨‹ id å†™åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ä¸Šæ–¹çš„ nginx.pid æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ nginx æ˜¯å¦è¿è¡Œï¼Œé˜²æ­¢å¯åŠ¨å¤šä¸ª nginx è¿›ç¨‹çš„ã€‚\nç½‘ä¸Šçš„è¯´æ³•æ˜¯è¿™æ ·çš„ï¼šnginx å¯åŠ¨æ—¶ï¼Œä¼šå»æ‰¾è¿™ä¸ªè®¾ç½®çš„ pid æ–‡ä»¶ï¼Œä¸€æ˜¯çœ‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ŒäºŒæ˜¯çœ‹ pid æ–‡ä»¶ä¸­è®°å½•çš„ pid è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœ pid æ–‡ä»¶å­˜åœ¨å¹¶ä¸” pid è¿›ç¨‹ä¹Ÿå­˜åœ¨ï¼Œåˆ™è¯´æ˜ nginx å·²ç»å¯åŠ¨äº†ï¼Œé‚£ä¹ˆå¯åŠ¨å°±ä¼šæŠ¥é”™ï¼Œé˜²æ­¢å¯åŠ¨å¤šä¸ª nginx è¿›ç¨‹ã€‚\näº‹ä»¶å—\r1 2 3 4 5 6 7 8 9 10 # events å—ï¼Œæ˜¯ nginx å¤„ç†è¿æ¥çš„é…ç½®å— events { # é…ç½®æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ 1024 worker_connection 1024; # é¼“åŠ±æ¥æ”¶ï¼Œè¿™ä¸ªå¯ä¸é… multi_accept on; # å¤„ç†è¿æ¥çš„äº‹ä»¶æ¨¡å‹ï¼Œé»˜è®¤ epollï¼Œå¯ä¸é… use epoll; # å…¶ä»–å¯ç™¾åº¦ } å…¶å®åªéœ€è¦é…ç½®ä¸€ä¸ª worker_connection å³å¯\nhttp å—\r1 2 3 4 5 6 7 8 9 10 11 12 http { # http å…¨å±€å—å¸¸ç”¨é…ç½® include mime.types; # æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ default_type application/octet-stream; # é»˜è®¤æ–‡ä»¶ç±»å‹ access_log logs/access.log main; # æ—¥å¿—è·¯å¾„ã€æ ¼å¼ access_log on; # å¼€å¯æ—¥å¿—ï¼Œè®°å½•å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯ sendfile on; # å¼€å¯æ–‡ä»¶ä¼ è¾“åŠŸèƒ½ keepalive_timeout 65s; # ä¿æŒè¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å…³é—­ client_max_body_size 10m; # å…è®¸æ–‡ä»¶ä¼ è¾“çš„æœ€å¤§å€¼ï¼Œæ ¹æ®å®é™…æƒ…å†µè®¾ç½® client_header_buffer_size 4k; # å®¢æˆ·ç«¯è¯·æ±‚å¤´ç¼“å†²åŒºå¤§å°ï¼Œk(åƒå­—èŠ‚) client_body_buffer_size 8m; # å®¢æˆ·ç«¯è¯·æ±‚ä½“ç¼“å­˜åŒºå¤§å°ï¼Œm(MB) } client_max_body_size å‚æ•°ï¼Œå¯¹ä¼ è¾“çš„æ–‡ä»¶å¤§å°åšé™åˆ¶ client_header_buffer_size client_body_buffer_size å‚æ•°ï¼Œä¸ºäº†ç¡®ä¿è¯·æ±‚å¤´(ä½“)æ•°æ®ä¸ä¼šå› ä¸ºç¼“å†²åŒºå¤ªå°è€Œè¢«æˆªæ–­\nserver å—\rserver å—é‡ŒåŒ…å«äº† upstream å—ã€location å—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # è¯¥å—åœ¨ http å—ä¸‹ # é€šè¿‡é…ç½®çš„æœåŠ¡åå’Œç›‘å¬ç«¯å£å»è®¿é—®æ—¶ï¼Œæ ¹æ®ä¸åŒçš„æƒé‡éšæœºè·³è½¬åˆ°åº”ç”¨æœåŠ¡ç«¯ # è¿™é‡Œçš„é“¾è·¯å¤§æ¦‚å¦‚ä¸‹ï¼š # è®¿é—® ng åœ°å€ï¼šhttp://hello:80/app \u0026gt;\u0026gt;\u0026gt; è·³è½¬ http://fzjh/app # \u0026gt;\u0026gt;\u0026gt; æ ¹æ® upstream å—è·å– fzjh é…ç½®çš„ server # \u0026gt;\u0026gt;\u0026gt; æ ¹æ®æƒé‡è®¿é—® http://192.168.1.1:8080/app http://192.168.1.2:8080/app http { # http å…¨å±€å— ... # server å— server { listen 80; # ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 80ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ›´æ”¹ server_name hello; # ç”¨æ¥åšè·³è½¬åº”ç”¨çš„æœåŠ¡å # upstream å— è´Ÿè½½å‡è¡¡å…³é”®å— upstream fzjh { server 192.168.1.1:8080 weight=1; # æœåŠ¡å™¨ 1ï¼Œæƒé‡ 1 server 192.168.1.2:8080 weight=2; # æœåŠ¡å™¨ 2ï¼Œæƒé‡ 2 } # location å— åå‘ä»£ç†å…³é”®å— location /app { # æŒ‡å®šè®¿é—®çš„åç¼€ proxy_pass http://fzjh/app; # proxy_pass åå‘ä»£ç†å…³é”®å­— } } } è¯´æ˜ï¼šé€šå¸¸åªæ˜¯åšåå‘ä»£ç†çš„è¯ï¼Œæ˜¯ä¸éœ€è¦é…ç½® upstream å—çš„ï¼Œåªéœ€è¦é…ç½® location å—ã€‚\nè´Ÿè½½å‡è¡¡ç­–ç•¥\rè´Ÿè½½å‡è¡¡ç­–ç•¥çš„é—®é¢˜ï¼Œå…¶å®å°±æ˜¯åœ¨ upstream å—é‡Œè¾¹å»é…ç½®ã€‚æ¯”å¦‚æ­¥éª¤ã€4ï¼‰server å—ã€‘ä¸­çš„ upstream å—ç”¨æ³•å°±æ˜¯ä¸€ä¸ªåŠ æƒè½®è¯¢ç­–ç•¥ï¼Œweight=1 =2 å°±æ˜¯æœåŠ¡å™¨çš„æƒé‡ï¼Œé€šè¿‡ç»™æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œæƒé‡å¤§çš„æœåŠ¡å™¨å°†æ¥æ”¶æ›´å¤šçš„è¯·æ±‚ã€‚ï¼ˆæ•°å€¼è¶Šå¤§ï¼Œæƒé‡è¶Šé«˜ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # è½®è¯¢ upstream fzjh { server 192.168.1.1:8080; server 192.168.1.2:8080; server 192.168.1.3:8080; } # åŠ æƒè½®è¯¢ upstream fzjh { server 192.168.1.1:8080 weight=1; server 192.168.1.2:8080 weight=3; server 192.168.1.3:8080 weight=5; # æƒé‡è¶Šå¤§ï¼Œæ¥æ”¶è¯·æ±‚è¶Šå¤š } # ip hash upstream fzjh { ip_hash; # æ²¡é”™ï¼Œå°±æ˜¯åŠ ä¸Šè¿™ä¸ªå‚æ•°å³å¯ server 192.168.1.1:8080; server 192.168.1.2:8080; server 192.168.1.3:8080; } # æœ€å°‘è¿æ¥ upstream fzjh { least_conn; # æ²¡é”™ï¼Œä¹Ÿæ˜¯åŠ ä¸ªå‚æ•°å³å¯ server 192.168.1.1:8080; server 192.168.1.2:8080; server 192.168.1.3:8080; } Nginxå¯åœ\r1 2 3 4 5 6 # å¯åŠ¨ cd nginx_home/sbin \u0026amp;\u0026amp; ./nginx # åœæ­¢ pid æ–‡ä»¶çš„è·¯å¾„ä¸ºå…¨å±€å—ä¸­è®¾ç½® kill -QUIT `cat nginx_home/logs/nginx.pid` # é‡å¯ cd nginx_home/sbin \u0026amp;\u0026amp; ./nginx -s reload Nginxé‡åˆ°çš„é—®é¢˜\ræ–‡ä»¶ä¸Šä¼ è¶…é™\ré€šå¸¸åœ¨ä½¿ç”¨ ng è®¿é—®åº”ç”¨æ—¶ï¼Œåœ¨åº”ç”¨ä¸Šä¼ é™„ä»¶æ—¶ï¼Œä¼šé‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š\n1 request entity too large nginx è§£å†³æ–¹æ¡ˆ æ­¤é”™è¯¯æ˜¯ç”±äºä¸Šä¼ æ–‡ä»¶çš„å¤§å°è¶…è¿‡ nginx é…ç½®çš„æ–‡ä»¶ä¼ è¾“æœ€å¤§å€¼å¯¼è‡´ã€‚é€šè¿‡æ›´æ”¹ client_max_body_size çš„å¤§å°å³å¯ï¼ˆæ²¡æœ‰åˆ™åœ¨ HTTPå— æ–°å¢å³å¯ï¼‰ã€‚æ›´æ”¹å®Œéœ€è¦é‡å¯ nginx æœåŠ¡ã€‚\næ— æ³•æ˜¾ç¤ºéªŒè¯ç \råº”ç”¨çš„ç™»å½•é¡µé¢éœ€è¦è¾“å…¥éªŒè¯ç ï¼Œå½“é€šè¿‡Ngè·³è½¬åˆ°åº”ç”¨æ—¶ï¼Œä¸æ˜¾ç¤ºéªŒè¯ç ã€‚åœ¨upstream é‡ŒæŠŠè´Ÿè½½å‡è¡¡ç­–ç•¥æ”¹ä¸º IP HASH\né…ç½®æ¡ˆä¾‹\råå‘ä»£ç†\rè¯¥é…ç½®ä¸ºå®¡è®¡é¡¹ç›®å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒçš„å®é™…é…ç½®ã€‚å½“ç„¶ï¼Œä¿¡åˆ›ç‰ˆæœ¬ï¼Œä½¿ç”¨çš„æ˜¯ å®å…°å¾· BWS ä¸­é—´ä»¶ï¼ˆå›½äº§ç‰ˆçš„Nginxï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 user bes; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/bws.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log logs/access.log main; access_log on; sendfile on; keepalive_timeout 65s; server { #bws_http_server_name:server-tPegV0o6 #bws_http_server_type:reverseProxy listen 8070; server_name 192.168.XXX.56; location / { #type:static #bws_http_server_location_name:location-OsbKN52L index index.html index.htm; } location /app { proxy_pass http://192.168.XXX.59:18080/app; # æ­¤å¤„åˆ¤æ–­ï¼Œå…è®¸è·¨æºè¯·æ±‚ã€http æ–¹æ³•ã€å¸¦ cookie ä¿¡æ¯ï¼Œé€šç”¨é…ç½® -- å¼€å§‹ if ($request_method = \u0026#39;OPTIONS\u0026#39;) { add_header Access-Control-Allow-Origin \u0026#39;*\u0026#39;; add_header Access-Control-Allow-Headers \u0026#39;*\u0026#39;; add_header Access-Control-Allow-Methods \u0026#39;*\u0026#39;; add_header Access-Control-Allow-Credentials \u0026#39;true\u0026#39;; return 204; } proxy_http_version 1.1; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_set_header Origin \u0026#34;\u0026#34;; proxy_set_header Cookie $http_cookie; # é€šç”¨é…ç½® -- ç»“æŸ } location = /50x.html { #type:static #bws_http_server_location_name:location-8t7KLrfH root html; } location = /bws_status { #bws_http_server_location_name:monitor stub_status on; } error_page 500 502 503 504 /50x.html; } gzip off; gzip_comp_level 1; gzip_min_length 1k; client_max_body_size 1024m; client_header_buffer_size 4k; client_body_buffer_size 8m; } worker_processes 1; error_log logs/error.log info; è´Ÿè½½å‡è¡¡\rå®¡è®¡é¡¹ç›®ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼ˆå·²è„±æ•ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 #user nobody; worker_processes auto; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/bws.pid; events { worker_connections 512; use epoll; } http { include mime.types; default_type application/octet-stream; #log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; # \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; # \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; #access_log logs/access.log main; access_log off; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 75; #gzip on; server { listen 8080; server_name SJGL-JR2-JQ; #charset koi8-r; #access_log logs/host.access.log main; location /app { index index.html index.htm; proxy_cache off; concat off; sysguard off; proxy_pass http://app-8080/app; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; proxy_cache off; concat off; sysguard off; } } upstream app-8080 { server SJGL-YY1-JQ:8080; server SJGL-YY2-JQ:8080; server SJGL-YY3-JQ:8080; server SJGL-YY4-JQ:8080; ip_hash; check interval=30000 fall=3 rise=2 default_down=false timeout=1000 type=tcp port=8080; } } ","date":"2024-06-10T21:34:07+08:00","permalink":"http://localhost:1313/posts/2024/06/%E5%AE%9E%E6%96%BD%E9%83%A8%E7%BD%B2-nginx%E5%9C%A8%E4%BF%A1%E5%88%9B%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/","title":"å®æ–½éƒ¨ç½² Nginxåœ¨é¡¹ç›®ä¸Šçš„åº”ç”¨ä¸å¸¸è§é—®é¢˜ï¼ˆå››ï¼‰"},{"content":"æœ¬æ–‡æ€»ç»“åœ¨ä¿¡åˆ›é¡¹ç›®ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„ä¸­é—´ä»¶ï¼šä¸œæ–¹é€šã€å®å…°å¾·ã€‚\nåœ¨å®‰è£…ä¸­é—´ä»¶ä¹‹å‰ï¼Œåº”å…ˆåœ¨æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªåº”ç”¨ç”¨æˆ·ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¯´ä¸èƒ½ç”¨rootç”¨æˆ·å®‰è£…ï¼Œå¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥å®‰è£…ï¼Œä½†æ˜¯ç”Ÿäº§ä¸Šæ˜¯æ— ç‰¹æ®Šæƒ…å†µæ˜¯ä¸æä¾›rootç”¨æˆ·çš„ã€‚ä¸ºäº†é¿å…å› ä¸ºç”¨æˆ·å·®å¼‚å¯¼è‡´çš„æ–‡ä»¶æ‰§è¡Œé—®é¢˜ï¼Œè¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œä¸Šçº¿æ—¶ï¼Œå¯ä»¥ä¿è¯æˆ‘ä»¬çš„æ“ä½œä¸€è‡´ï¼Œä»¥åŠåç»­æ–¹ä¾¿æ’æŸ¥éƒ¨ç½²è¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„æŠ¥é”™ã€‚\nå®‰è£…å‰å‡†å¤‡\råˆ›å»ºä¸­é—´ä»¶ç”¨æˆ·\råœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šä½¿ç”¨rootç”¨æˆ·\n1 2 3 4 5 6 # åˆ›å»ºç”¨æˆ·ç»„ groupadd -g 1051 test # åˆ›å»ºç”¨æˆ· useradd -g test -m -d /home/test -s /bin/bash test # ä¿®æ”¹å¯†ç  passwd test hostsé…ç½®\r1 2 3 4 5 6 7 8 # æŸ¥çœ‹æœ¬æœºå hostname # æŸ¥çœ‹æœ¬æœºIP hostname -i # é…ç½®hosts vi /etc/hosts # æ·»åŠ  ip hostname ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æœ€å¤§æ•°\rè¯´æ˜ï¼šæ­¤æ­¥éª¤ï¼Œå®‰è£…ä¸œæ–¹é€šæ—¶å¯è·³è¿‡çš„ï¼Œå®å…°å¾·éœ€è¦æ“ä½œï¼ˆä»¥æˆ‘æ¥è§¦çš„é¡¹ç›®æƒ…å†µæ˜¯è¿™æ ·çš„ï¼‰\n1 2 3 4 5 6 vi /etc/security/limits.conf # æ·»åŠ  * soft nofile 65535 * hard nofile 65535 * soft nproc 65535 * hard nproc 65535 ä¿å­˜åé‡æ–°è¿æ¥æœåŠ¡å™¨\n1 2 # æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ ulimit -a é…ç½®JDK\ræ²¡æœ‰åˆ™å®‰è£…ï¼Œä¸€èˆ¬ä¿¡åˆ›çš„æœºå™¨æ˜¯è‡ªå¸¦çš„ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿è¿™ä¸ªç‰ˆæœ¬çš„JDKæ˜¯ä¸­é—´ä»¶ä»¥åŠåº”ç”¨æœåŠ¡éƒ½å¯ç”¨ï¼Œé‡‡ç”¨è‡ªå·±å®‰è£…ï¼Œå¤šä¸ºå®‰è£… JDK1.8 ç‰ˆæœ¬ï¼ˆè‡ªå·±å®‰è£…éœ€è¦ä¸Šä¼ jdkåˆ°æœåŠ¡å™¨å¹¶è§£å‹taråŒ…ï¼‰\n1 2 # æŸ¥çœ‹æ˜¯å¦å®‰è£… java -version å·²ç»æœ‰äº†ï¼Œåˆ™å¯ä»¥ç›´æ¥é…ç½®ç¯å¢ƒå˜é‡ï¼Œå½“ç„¶ï¼Œå¾—çŸ¥é“è·¯å¾„æ‰èƒ½é…ç½®ç¯å¢ƒå˜é‡\n1 2 3 4 # æŸ¥çœ‹ JDK çš„å®‰è£…è·¯å¾„ which java ls -l /usr/bin/java ls -l /etc/alternatives/java æœ€ä¸‹è¾¹è¿”å›çš„ï¼Œå°±æ˜¯ JDK çœŸæ˜¯çš„å®‰è£…è·¯å¾„\næ‰¾åˆ°JDKå®‰è£…è·¯å¾„åï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼š\n1 2 3 4 5 6 7 8 vi ~/.bashrc # åœ¨æœ«å°¾åŠ å…¥ export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-7.ky10.x86_64/jre export PATH=$JAVA_HOME/bin:$PATH # ä¿å­˜ååˆ·æ–°ç¯å¢ƒå˜é‡ source ~/.bashrc # è¾“å‡ºé…ç½®çš„ç¯å¢ƒå˜é‡ echo $JAVA_HOME é…ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œå°±å¯ä»¥è¿›è¡Œä¸­é—´ä»¶çš„å®‰è£…äº†\nä¸œæ–¹é€šéƒ¨ç½²åº”ç”¨\rä¸œæ–¹é€šä¸­é—´ä»¶éƒ¨ç½²åº”ç”¨çš„è¯¦ç»†æ­¥éª¤ï¼Œä»ä¸œæ–¹é€šå®‰è£…åˆ°ç®¡ç†æ§åˆ¶å°é…ç½®çš„è¿‡ç¨‹ã€‚\nä¸œæ–¹é€šçš„å®‰è£…\rä¸œæ–¹é€šåœ¨LINUXä¸Šå®‰è£…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤çš„æ–¹å¼å®‰è£…ã€‚ï¼ˆPSï¼šè¿™ä¸ªå·²ç»æ˜¯22å¹´çš„ç‰ˆæœ¬äº†ï¼Œå½“æ—¶æ¥è§¦ä¸œæ–¹é€šçš„æ—¶å€™ï¼Œå®‰è£…åŒ…æ˜¯ä¸€ä¸ª.binæ–‡ä»¶ï¼Œä½†æ˜¯åˆ°äº†23å¹´ï¼Œä¸œæ–¹é€šçš„å®‰è£…åŒ…åŸºæœ¬éƒ½æ˜¯æä¾›ä¸€ä¸ªtaråŒ…ï¼Œå®‰è£…åªéœ€è¦è§£å‹taråŒ…å³å¯ã€‚æ–¹ä¾¿å¾ˆå¤šï¼Œä½†æ˜¯æ—¢ç„¶æ˜¯è‡ªå·±å®‰è£…çš„ä¸­é—´ä»¶ï¼Œå½“ç„¶è¦è®°å½•å•¦ï¼‰\nbinåŒ…å®‰è£…\r1 2 3 4 # è¿è¡Œå®‰è£…åŒ… sh Install_TW7.*.*.*_Enterprise_Linux.bin -i console # é€‰æ‹©è¯­è¨€ ä¸­æ–‡ç®€ä½“ 1 2 3 4 5 6 # ä¸­é—´ä¼šå‡ºç° ã€æŒ‰å›è½¦é”®ç»§ç»­å®‰è£…ã€‘ã€PRESS \u0026lt;ENTER\u0026gt; TO CONTINUEã€‘ æŒ‰å›è½¦å°±è¡Œ # ç„¶åå›å‡ºç° ã€æ˜¯å¦æ¥å—æ­¤è®¸å¯åè®®æ¡æ¬¾ã€‘ y # é€‰æ‹© JDK é€‰æ‹©ç³»ç»Ÿè‡ªå¸¦çš„ JDK å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±å®‰è£…çš„ï¼Œå›¾ä¸Šæ˜¯ä½¿ç”¨è‡ªå·±å®‰è£…çš„ï¼ˆæœ€å¥½æ˜¯é€‚é…åº”ç”¨çš„ JDK ç‰ˆæœ¬ï¼‰ 1 2 # é€‰æ‹©å®‰è£…ä½ç½® è¾“å…¥ä¸€ä¸ªå®‰è£…è·¯å¾„ 1 2 # é€‰æ‹©é“¾æ¥ä½ç½® è¿™é‡Œå¸¸é“¾æ¥åˆ°ä¸»æ–‡ä»¶å¤¹ä¸­ 1 2 # å‡ºç°é¢„å®‰è£…ä¿¡æ¯ å›è½¦å³å¯ 1 2 3 4 5 # ä¿®æ”¹ç«¯å£ æ­¤æ­¥éª¤ï¼Œå¯ä¿®æ”¹å¯ä¸æ”¹ã€‚æ— ç‰¹æ®Šè¦æ±‚å¯ç›´æ¥ä½¿ç”¨é»˜è®¤ï¼ˆå›è½¦ï¼‰ã€‚æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåˆ™æ›´æ”¹ç«¯å£ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å®‰è£…å¥½ååœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼ˆ$TONGWEB_HOME/conf/tongweb.xml) é€šå¸¸æˆ‘ä»¬å…³æ³¨ä»¥ä¸‹ä¸¤ä¸ª tong-http-listenerï¼Œæ­¤ä¸ºè®¿é—®åº”ç”¨ç«¯å£ system-http-listenerï¼Œæ­¤ä¸ºä¸œæ–¹é€šæ§åˆ¶å°ç«¯å£ å›è½¦åå°±å®‰è£…å®Œæˆäº†ã€‚\ntaråŒ…å®‰è£…\ræä¾›çš„taråŒ…ï¼Œåªéœ€è¦è§£å‹åˆ°ç›®æ ‡ç›®å½•å³å¯ã€‚å½“ç„¶ï¼Œtaræœ‰å¤šç§å‹ç¼©æ ¼å¼ï¼Œæœ€å¸¸ç¢°è§çš„å°±æ˜¯ tar.gz\n1 tar -xzvf tongweb_version_7.x.x.x /home/tongweb æˆæƒ\rå°†å®‰è£…åçš„ç›®å½•ï¼Œæˆæƒç»™ä¸­é—´ä»¶ç”¨æˆ·\n1 2 chown test:test -R /home/tongweb chmod 755 -R /home/tongweb å¯åŠ¨é…ç½®\rä»¥ä¸‹å¸¸è§é…ç½®ï¼Œå‡ä¸ºåœ¨é¡¹ç›®ä¸Šèƒ½å¤Ÿå®é™…é‡åˆ°çš„\nä¿®æ”¹ç«¯å£\ræ ¹æ®å®¢æˆ·è¦æ±‚ï¼Œæˆ–è€…åº”ç”¨è¦æ±‚ï¼Œé…ç½®æˆ‘ä»¬çš„åº”ç”¨ç«¯å£ã€‚ï¼ˆå¦‚æœæ˜¯ä½¿ç”¨é»˜è®¤ç«¯å£åˆ™ä¸éœ€è¦ä¿®æ”¹ï¼‰\n1 2 3 4 # å‡è®¾å®‰è£…åˆ° /home/tongweb vi /home/tongweb/conf/tongweb.xml # ä¿®æ”¹ tong-http-listener çš„ port port = 8080 å…³é—­é˜²ç«å¢™\råœ¨å¯åŠ¨ä¸œæ–¹é€šæ§åˆ¶å°ä¹‹å‰ï¼Œéœ€è¦å…³é—­é˜²ç«å¢™ï¼Œå¦åˆ™æ“ä½œæœºå™¨æ— æ³•è®¿é—®åˆ°æ§åˆ¶å°åœ°å€ã€‚ï¼ˆåœ¨ç¬¬ä¸€æ¬¡æ¥è§¦ä¸œæ–¹é€šçš„æ—¶å€™ï¼Œå½“æ—¶æœåŠ¡å·²ç»å¯åŠ¨äº†ï¼Œä½†æ˜¯æ‰“ä¸å¼€æ§åˆ¶å°ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯ç½‘ç»œæ²¡æ‰“é€šï¼Œç»“æœä¸€æŸ¥æ˜¯é˜²ç«å¢™å¯¼è‡´ï¼‰\n1 2 3 4 # å…³é—­é˜²ç«å¢™ systemctl stop firewalld # ç¦æ­¢é˜²ç«å¢™è‡ªå¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ç¦æ­¢ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°æœåŠ¡å™¨é‡å¯çš„æƒ…å†µï¼Œé¦–å…ˆè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å…³é—­ systemctl disable firewalld å¯åœæœåŠ¡\r1 2 3 4 5 6 7 8 9 10 # æ­£å¸¸å¯åŠ¨ cd /home/tongweb/bin \u0026amp;\u0026amp; ./startserver.sh # åå°å¯åŠ¨ï¼ˆå¸¸ç”¨ï¼‰ cd /home/tongweb/bin \u0026amp;\u0026amp; ./startservernohup.sh # åœæ­¢ cd /home/tongweb/bin \u0026amp;\u0026amp; ./stopserver.sh # æˆ–è€…æ‰‹åŠ¨ kill kill -9 {pid} # é‡å¯ cd /home/tongweb/bin \u0026amp;\u0026amp; ./startservernohup.sh restart æ‰“å¼€æ§åˆ¶å°\r1 http://ip:port/console æ§åˆ¶å°é…ç½®\rä¿®æ”¹æœåŠ¡å™¨å¯é€‰ç›®å½•\ræ­¤æ­¥éª¤æ˜¯ç¡®ä¿åœ¨éƒ¨ç½²åº”ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è®¿é—®åˆ°åº”ç”¨æ‰€åœ¨çš„ä½ç½®ï¼Œä¸ç„¶æ‰¾ä¸åˆ°\nJDBC é…ç½®\rJDBCé…ç½®å°±æ˜¯è®©ä¸­é—´ä»¶è¿æ¥åˆ°æ•°æ®åº“ï¼Œè®©åº”ç”¨èƒ½å¤Ÿä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚\néœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š\nè¾¾æ¢¦JDBCé©±åŠ¨ï¼Œæœ€å¥½ä½¿ç”¨æ–°ç‰ˆï¼Œæˆ–è€…åº”ç”¨åšäº†é€‚é…çš„ç‰ˆæœ¬ã€‚ JDBCè¿æ¥åç§°ï¼Œéœ€è¦ä¸åº”ç”¨ä¸­çš„jndiName ä¸€è‡´ï¼Œä¸€èˆ¬çš„javaæœåŠ¡ä¼šæœ‰ä¸€ä¸ªxmlæ–‡ä»¶é…ç½®dispatcher-servlet çš„åœ°æ–¹ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™åœ¨åº”ç”¨ä¸­æ‰¾ä¸åˆ° jndiName ã€‚ç‰¹åˆ«æ˜¯åœ¨åšä¿¡åˆ›è¿ç§»çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼štomcaté‡Œä½¿ç”¨çš„jndiNameä¸ä¸œæ–¹é€šé‡Œä½¿ç”¨çš„jndiNameåç§°ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„ä¿®æ”¹ä¸ºä¸€è‡´ã€‚ å¦å¤–ï¼ŒåŸºäºé¡¹ç›®ç»éªŒçŒœæµ‹ï¼ŒåŸºäº webbuilder çš„æ¡†æ¶ï¼Œéƒ½æœ‰ WEB-INF/dispatcher-servlet.xml æ–‡ä»¶ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿä¼šæœ‰å˜é‡é…ç½®ï¼Œå˜é‡é…ç½®å¯èƒ½æ˜¯è½åˆ°æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨ var.json æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚å·®å¼‚ä¸å¤§ï¼Œéƒ½æ˜¯ä¼šæœ‰ jndiName çš„é…ç½®\néƒ¨ç½²åº”ç”¨\rå¦‚æœæ²¡æœ‰ã€3.1ä¿®æ”¹æœåŠ¡å™¨å¯é€‰ç›®å½•ã€‘ï¼Œè¿™é‡Œæ˜¯è®¿é—®ä¸åˆ°åº”ç”¨æ‰€åœ¨çš„ç›®å½•çš„\nç‚¹å‡»å¼€å§‹éƒ¨ç½²ï¼Œä¸€èˆ¬è¿™é‡Œæ²¡ä»€ä¹ˆå¤šå¤§çš„é—®é¢˜ï¼Œéƒ½å–é»˜è®¤å³å¯ã€‚\nè®¿é—®åº”ç”¨\r1 http://ip:port/app_name å¤šç§éƒ¨ç½²æƒ…å†µè¯´æ˜\rä¸€ä¸ªä¸œæ–¹é€šéƒ¨ç½²å¤šä¸ªåº”ç”¨\ré‡åˆ°è¿‡å®¢æˆ·ä¸ºäº†èŠ‚çœå¼€å‘ç¯å¢ƒæˆ–è€…æµ‹è¯•ç¯å¢ƒçš„èµ„æºï¼Œä¼šè®©æˆ‘ä»¬åœ¨ä¸€ä¸ªä¸œæ–¹é€šéƒ¨ç½²å¤šä¸ªåº”ç”¨ï¼ˆå°±æ˜¯ä¸å…¶ä»–åº”ç”¨å…±äº«èµ„æºï¼‰ã€‚å¯¹äºä¸åŒçš„åº”ç”¨ï¼Œæ˜¯å¯ä»¥çš„ã€‚\né’ˆå¯¹æ˜¯éƒ¨ç½²ç›¸åŒçš„åº”ç”¨ï¼Œéœ€è¦\nå»ºç«‹æ–°çš„è¿æ¥æ± ï¼Œä¿®æ”¹jndiName ï¼Œä»¥é˜²åº”ç”¨è®¿é—®é”™æ•°æ®åº“ ç›´æ¥éƒ¨ç½²\rç›´æ¥éƒ¨ç½²åˆ™æŒ‰ç…§ã€3.1-3.3ã€‘æ­¥éª¤ï¼Œéƒ¨ç½²åº”ç”¨å³å¯\næ³¨æ„ï¼šç›´æ¥éƒ¨ç½²ï¼Œä¸œæ–¹é€šæ˜¯æŒ‰é¡ºåºæ‹‰èµ·åº”ç”¨çš„ï¼Œå¯åŠ¨ä¼šæ…¢ä¸€äº›ï¼Œå¹¶ä¸”å…¬ç”¨ IP å’Œ PORT ï¼Œä¸œæ–¹é€šæœåŠ¡åœæ‰ä¼šå½±å“æ‰€æœ‰åº”ç”¨ã€‚\nåŸŸéƒ¨ç½²\ré€šè¿‡åˆ›å»ºåŸŸï¼Œè®©å„ä¸ªåº”ç”¨å¯åŠ¨å’Œé…ç½®ä¸ç›¸äº’å½±å“ã€‚ä½¿ç”¨ TONGWEB_HOME/bin ä¸‹çš„å¯åœå‘½ä»¤ä¸ä¼šå½±å“åˆ°åŸŸé‡Œè¾¹çš„åº”ç”¨ï¼ŒåŸŸé‡Œçš„åº”ç”¨ç‹¬ç«‹å¯åœå’Œé…ç½®ï¼Œä¸”ç«¯å£ä¸ä¼šå†²çª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºåŸŸ cd TONGWEB_HOME/bin ./domain.sh create AppName # æ‰§è¡Œåï¼Œåœ¨ä¸œæ–¹é€šçš„æ ¹ç›®å½•ä¸‹ä¼šå‡ºç° domains ç›®å½•ï¼Œç›®å½•é‡Œè¾¹çš„ç»“æ„ä¸æ ¹ç›®å½•å®Œå…¨ä¸€è‡´ï¼Œæœ‰ /bin /conf /logs ç­‰ç­‰ # åŸŸçš„å¯åœï¼Œä¸ä¸œæ–¹é€šå®Œå…¨ä¸€è‡´ï¼Œä¸è¿‡æ˜¯åœ¨ /domains/bin ä¸‹ # é…ç½®æ–‡ä»¶ä¹Ÿåœ¨ /domains/conf ä¸‹ # é…ç½®åŸŸçš„ç«¯å£ cd TONGWEB_HOME/domains/conf vi tongweb.xml # åŸŸçš„é»˜è®¤ç«¯å£æ˜¯ä¸œæ–¹é€šé»˜è®¤çš„ç«¯å£+1 # å¯åœ cd TONGWEB_HOME/domains/bin ./startservernohup.sh # å¯åŠ¨ ./stopserver.sh # åœæ­¢ # é»˜è®¤çš„åŸŸç®¡ç†æ§åˆ¶å°ï¼š http://IP:PORT+1/console # æ¯”å¦‚ä¸œæ–¹é€šé»˜è®¤ç«¯å£ 9060ï¼ŒåŸŸç«¯å£åˆ™ä¸º 9061 # åº”ç”¨è®¿é—®ï¼š http://IP:PORT+1/app_name # æ¯”å¦‚åº”ç”¨é»˜è®¤ç«¯å£ 8088ï¼ŒåŸŸç«¯å£åˆ™ä¸º 8089 è®¾ç½®connection-timeout\ræœ‰äº›å®¢æˆ·ï¼Œåœ¨æ‰«ææ•´ä½“çš„å®‰å…¨æ¼æ´æ—¶ï¼Œä¼šæ£€æµ‹åˆ°ç›®æ ‡ä¸»æœºå¯èƒ½å­˜åœ¨ç¼“æ…¢çš„ HTTP æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œè¿™ä¸ªå°±æ˜¯ä¸­é—´ä»¶é‡Œé…ç½®connection-timeoutå³å¯ã€‚\nç®€å•æ¥è¯´ï¼Œé€šè¿‡å‘é€å¤§é‡çš„æ…¢é€Ÿæˆ–ä½é¢‘ç‡çš„ HTTP è¯·æ±‚æ¥å ç”¨ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºï¼Œå¯¼è‡´æœåŠ¡å™¨çš„è¿æ¥å’Œå†…å­˜èµ„æºè¢«æ¶æ„è¿æ¥å æ»¡ï¼Œæ— æ³•å¤„ç†æ–°çš„åˆæ³•è¯·æ±‚ã€‚\ntomcat å¯ä»¥é€šè¿‡ä¿®æ”¹ server.xml æ–‡ä»¶ä¸­çš„é…ç½®æ¥è®¾ç½® connectionTimeout å‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;Connector port=\u0026#34;8080\u0026#34; protocol=\u0026#34;HTTP/1.1\u0026#34; maxHttpHeaderSize=\u0026#34;8192\u0026#34; maxThreads=\u0026#34;100\u0026#34; minSpareThreads=\u0026#34;50\u0026#34; maxSpareThreads=\u0026#34;100\u0026#34; minProcessors=\u0026#34;50\u0026#34; maxProcessors=\u0026#34;100\u0026#34; enableLookups=\u0026#34;false\u0026#34; connectionTimeout=\u0026#34;8000\u0026#34; // ä¿®æ”¹æ­¤å¤„å€¼ acceptCount=\u0026#34;100\u0026#34; redirectPort=\u0026#34;8443\u0026#34; URIEncoding=\u0026#34;UTF-8\u0026#34;/\u0026gt; åŒæ ·çš„ï¼Œåœ¨ä¿¡åˆ›ä¸Šï¼Œä¸œæ–¹é€šä¸­é—´ä»¶ä¹Ÿå¯é€šè¿‡è®¾ç½®å¯¹åº”çš„è¯·æ±‚ï¼Œåœ¨ tongweb/conf/tongweb.xml é…ç½®æ–‡ä»¶ä¸­ï¼Œconnection-timeout å¯¹æ¥çš„å‰å°é¡µé¢å°±æ˜¯ http é€šé“é‡Œçš„ è¿æ¥è¶…æ—¶ ï¼Œä¿®æ”¹æ­¤å¤„å³å¯ï¼ˆé»˜è®¤ 60000 \u0026raquo; æ”¹ä¸º 8000ï¼‰\nå®å…°å¾·éƒ¨ç½²åº”ç”¨\rè¯¥æ­¥éª¤ä¸ºå®å…°å¾·é›†ç¾¤ç‰ˆæœ¬çš„å®‰è£…æ­¥éª¤ï¼Œéå•å®ä¾‹ã€‚é›†ç¾¤ç‰ˆæœ¬ï¼Œéœ€è¦é…ç½®èŠ‚ç‚¹ã€å®ä¾‹ã€‚å®ä¾‹çš„å¯åŠ¨ä¾èµ–äºèŠ‚ç‚¹çš„å¯åŠ¨ï¼ŒèŠ‚ç‚¹åœæ­¢åˆ™å®ä¾‹åœæ­¢ã€‚\næ­£ç¡®çš„å¯åŠ¨é¡ºåºï¼šé›†ç¾¤ \u0026raquo; èŠ‚ç‚¹ \u0026raquo; å®ä¾‹\nå®å…°å¾·çš„å®‰è£…\rå°†å®‰è£…ä»‹è´¨æ”¾å…¥æœåŠ¡å™¨ï¼Œå¹¶è§£å‹\n1 2 3 4 5 6 # ä½¿ç”¨ä¸­é—´ä»¶ç”¨æˆ· su - bes # è¿›å…¥ä»‹è´¨ç›®å½• cd /home/BES955 # è§£å‹ tar -zxvf BES-AppServer-Enterprise-9.5.5.6210-KYLIN10-X64.tar.gz -C /home/BES955/AdminServer å¦‚æœæœ‰è¡¥ä¸ï¼Œåˆ™éœ€è¦å‡çº§è¡¥ä¸ã€‚å°†è¡¥ä¸åŒ…æ”¾åˆ° patch ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ\n1 2 3 4 5 cd /home/BES955/AdminServer/bin # å‡çº§è¡¥ä¸ ./patch -path /home/jfcz/patch # æŸ¥çœ‹æ˜¯å¦å‡çº§å®Œæˆ ./patch -list åˆå§‹åŒ–å¹¶å¯åŠ¨\r1 2 3 4 5 6 # åœ¨binç›®å½•ä¸‹æ‰§è¡Œï¼Œåˆå§‹åŒ–ä¸­é—´ä»¶ ./initstore # å¯åŠ¨ç®¡ç†æ§åˆ¶å° ./startManagement # æŸ¥çœ‹æ˜¯å¦å¯åŠ¨ï¼Œå‡ºç°6900ç«¯å£ä¸ºå·²å¯åŠ¨ netstat -ntlp é…ç½®ä¸­é—´ä»¶\rè®¿é—®ç®¡ç†æ§åˆ¶å°\n1 http://IP:6900/console æ·»åŠ ä¸»æœº\rè¿›å…¥æ§åˆ¶å°åï¼Œç‚¹å‡»å·¦ä¾§ä¸»æœºç®¡ç†ï¼Œç‚¹å‡»æ·»åŠ ï¼š å¡«å†™åç§°ã€ä¸»æœºIPã€ç”¨æˆ·åã€å¯†ç ï¼Œä¿¡æ¯å¦‚å›¾\nå¯ä»¥ç‚¹å‡»pingï¼Œæµ‹è¯•æ˜¯å¦èƒ½è¿æ¥ã€‚ä¸èƒ½pingé€šè¯·æ£€æŸ¥IPã€ç”¨æˆ·ã€å¯†ç æ˜¯å¦æ­£ç¡®ã€‚\næ·»åŠ èŠ‚ç‚¹\rç‚¹å‡»å·¦ä¾§èŠ‚ç‚¹ç®¡ç†ï¼Œæ–°å»º\nå¡«å†™èŠ‚ç‚¹åç§°ã€èŠ‚ç‚¹ç›®å½•ï¼ˆé»˜è®¤å¡«å®å…°å¾·çš„å®‰è£…ç›®å½•ï¼‰ï¼ŒJAVA_HOMEå¯é»˜è®¤ä¸å¡«\nä¿å­˜åï¼Œå¯åŠ¨å®ƒã€‚\nç‚¹å‡»èŠ‚ç‚¹ï¼Œè¿›å…¥èŠ‚ç‚¹çš„é…ç½®ç•Œé¢ï¼Œå°†ã€å¯åŠ¨æ‰€æœ‰å®ä¾‹ã€åœæ­¢æ‰€æœ‰å®ä¾‹ã€‘æ‰“å‹¾åä¿å­˜ï¼ˆè¿™ä¸ªæ“ä½œå¯ä»¥åœ¨å¯åŠ¨èŠ‚ç‚¹çš„åŒæ—¶è‡ªåŠ¨å¯åŠ¨å®ä¾‹ï¼‰\nåˆ›å»ºé›†ç¾¤\rç‚¹å‡»å·¦ä¾§é›†ç¾¤ç®¡ç†ï¼Œç‚¹å‡»æ–°å»ºï¼šå¡«å†™ä¸ªé›†ç¾¤åç§°å³å¯ã€‚ä¿å­˜åé€‰ä¸­è¯¥é›†ç¾¤ç„¶åç‚¹å‡»å¯åŠ¨ã€‚\nåˆ›å»ºå®ä¾‹\rç‚¹å‡»å·¦ä¾§å®ä¾‹ç®¡ç†ï¼Œç‚¹å‡»æ–°å»ºï¼šå¡«å†™å¦‚å›¾ä¿¡æ¯ä¿å­˜å³å¯\nä¿®æ”¹å®ä¾‹ç«¯å£\rç‚¹å‡»å®ä¾‹ - ç³»ç»Ÿå±æ€§ http-listener-1_portï¼šä¿®æ”¹ä¸º8080ï¼ˆè¿™ä¸ªæ˜¯httpåè®®è®¿é—®ï¼‰ http-listener-2_portï¼šï¼ˆè¿™ä¸ªæ˜¯httpsåè®®è®¿é—®ï¼Œå¦‚éœ€è¦æ­¤è®¿é—®è¯·æ›´æ”¹ï¼‰\nOKï¼Œåˆ°è¿™é‡Œå°±æ˜¯å®å…°å¾·çš„åŸºç¡€é…ç½®å°±ç»“æŸäº†ã€‚\nåè¾¹å¯ä»¥è¿›è¡Œåº”ç”¨çš„éƒ¨ç½²äº†ã€‚\néƒ¨ç½²åº”ç”¨æ³¨æ„é¡¹\rBESé›†ç¾¤ä¸‹æœ‰å®ä¾‹ï¼Œåº”ç”¨æ˜¯åœ¨å®ä¾‹ä¸­ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥æ”¹åŠ¨åº”ç”¨çš„æ—¶å€™è¯·ç›´æ¥åˆ°å®ä¾‹ç›®å½•ä¸‹çš„applicationç›®å½•ä¸‹å»æ”¹ã€‚æ¯éƒ¨ç½²ä¸€æ¬¡åº”ç”¨ï¼Œå°±ä¼šæ‹·è´ä¸€æ¬¡åº”ç”¨ç›®å½•åˆ°å®ƒçš„å®ä¾‹node/applicationä¸‹ã€‚\né‡å¯å®ä¾‹å‡ºç°æŸä¸ªå®ä¾‹å¯åŠ¨å¤±è´¥\råœ¨åº”ç”¨æ— æŠ¥é”™çš„å‰æä¸‹ï¼Œ4ä¸ªå®ä¾‹ï¼Œæ­£å¸¸é‡å¯å®ä¾‹ï¼Œä¼šå‡ºç°1ä¸ªæˆ–è€…2ä¸ªå®ä¾‹å¯åŠ¨æŠ¥é”™ã€‚ä»åº”ç”¨çš„é”™è¯¯æ—¥å¿—ä¸­æŸ¥çœ‹åŸå› ï¼Œä¼šå‡ºç°ä¸€äº›è¿æ¥ä¸ä¸Šæ•°æ®æºçš„æŠ¥é”™ï¼Œå¯¼è‡´å®ä¾‹çš„é”™è¯¯æ—¥å¿—ä¼šæŠ›å‡ºåº”ç”¨é”™è¯¯ã€‚\nç”±äºæ•°æ®æºè¿æ¥æ•°é‡å¤ªå°‘å¯¼è‡´ï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦ä¸€å®šçš„è¿æ¥æ•°ã€‚æ­¤æ—¶ï¼Œéœ€è¦åˆ°ä¸­é—´ä»¶çš„JDBCæ•°æ®æºé…ç½®å¤„ï¼Œä¿®æ”¹æ± çš„è¿æ¥æ•°ã€‚ç”Ÿäº§ç¯å¢ƒä¸Šä¿®æ”¹ä¸ºé»˜è®¤çš„ä¸¤å€æ•°æ®ï¼Œå®ä¾‹å‡æ­£å¸¸å¯åŠ¨ã€‚åç»­å¦‚æœå‡ºç°æ­¤æƒ…å†µï¼Œå¯æ ¹æ®å®é™…æƒ…å†µï¼Œæ‰©å¤§è¿æ¥æ•°å³å¯ã€‚\n","date":"2024-06-07T17:51:06+08:00","permalink":"http://localhost:1313/posts/2024/06/%E5%AE%9E%E6%96%BD%E9%83%A8%E7%BD%B2-%E4%B8%9C%E6%96%B9%E9%80%9A%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/","title":"å®æ–½éƒ¨ç½² ä¸œæ–¹é€šä¸­é—´ä»¶ã€å®å…°å¾·éƒ¨ç½²åº”ç”¨ï¼ˆä¸‰ï¼‰"},{"content":"è¾¾æ¢¦æ•°æ®åº“çš„å®‰è£…\r*ä»…é€‚ç”¨äºLINUXå®‰è£…\nåœ¨æ­å»ºå®¢æˆ·çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒï¼Œæ•°æ®åº“å¤šä¸ºå®æ–½è‡ªè¡Œå®‰è£…ï¼Œå¹¶æ²¡æœ‰å¤ªå¤§çš„è¦æ±‚ï¼Œåªéœ€è¦æ³¨æ„ä¸€äº›å‚æ•°ï¼Œåˆ°æ—¶å€™ä¸ç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´å³å¯ã€‚ç”Ÿäº§ç¯å¢ƒï¼Œä¼šä¸å®¢æˆ·æ²Ÿé€šè¾¾æ¢¦æ•°æ®åº“çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼šé¡µå¤§å°ã€ç°‡å¤§å°ã€å­—ç¬¦é›†ã€å¤§å°å†™æ•æ„Ÿç­‰ä¸€äº›éœ€è¦åœ¨æ³¨å†Œå®ä¾‹æ—¶å°±é…ç½®çš„å‚æ•°ã€‚\nåœ¨ä¸Šä¸€æ–‡ç« ã€Šå®æ–½éƒ¨ç½²-ä¿¡åˆ›é¡¹ç›®ç¯å¢ƒæ­å»ºå‡†å¤‡ï¼ˆä¸€ï¼‰ã€‹å·²ç»æ²Ÿé€šè¿‡å‚æ•°äº†ï¼Œè¿™ç¯‡æ€»ç»“è¾¾æ¢¦æ•°æ®åº“çš„å®‰è£…å’Œåˆå§‹åŒ–å®ä¾‹çš„æ­¥éª¤ã€‚\nå…ˆè´´ä¸ªè¾¾æ¢¦å®˜ç½‘æŠ€æœ¯æ–‡æ¡£åœ°å€ï¼šï¼ˆæ­¥éª¤éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°çš„ï¼‰\nhttps://eco.dameng.com/document/dm/zh-cn/start/dm-install-linux.html\n1 æ–°å»ºDMDBAç”¨æˆ·\rè¿›å…¥LinuxæœåŠ¡å™¨ï¼Œç”¨rootç”¨æˆ·åˆ›å»ºï¼š\n1 2 3 4 5 6 # åˆ›å»ºç”¨æˆ·ç»„ groupadd dinstall # åˆ›å»ºç”¨æˆ· useradd -g dinstall -m -d /home/dmdba -s /bin/bash dmdba # ä¿®æ”¹ç”¨æˆ·å¯†ç  passwd dmdba 2 ä¿®æ”¹æ–‡ä»¶æ‰“å¼€æœ€å¤§æ•°\r1 2 3 4 5 6 7 vi /etc/security/limits.conf # åœ¨confæ–‡ä»¶å†…å®¹çš„æœ€åæ·»åŠ  dmdba hard nofile 65536 dmdba soft nofile 65536 dmdba hard stack 32768 dmdba soft stack 16384 # :wq ä¿å­˜ ä¿®æ”¹ååˆ‡æ¢åˆ°dmdbaç”¨æˆ·æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ\n1 2 su - dmdba ulimit -a 3 åˆ›å»ºæ•°æ®åº“å®‰è£…ç›®å½•\r1 2 3 4 5 6 7 # åˆ›å»ºç›®å½• cd /home mkdir dm # ä¿®æ”¹ç›®å½•æ‰€å±ä¸»ã€æ‰€å±ç»„ chown dmdba:dinstall -R dm # ç»™ç›®å½•æˆæƒ chmod -R 755 dm 4 æŒ‚è½½è¾¾æ¢¦é•œåƒ\rå°†è¾¾æ¢¦æ•°æ®åº“å®‰è£…åŒ….iso æ–‡ä»¶ä¸Šä¼ åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„ä»»æ„ä½ç½®ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 # åˆ›å»ºæŒ‚è½½ç›®å½• mkdir /mnt # ç»™æ‰§è¡Œæƒé™ chmod 755 è¾¾æ¢¦æ•°æ®åº“å®‰è£…åŒ….iso # æŒ‚è½½ mount -o loop /home/dmdba/dm8_20230713_FTarm_kylin10_sp1_64_include_symbols.iso /mnt 5 å®‰è£…æ•°æ®åº“\r1 2 3 4 5 6 # åˆ‡æ¢åˆ›å»ºå¥½çš„è¾¾æ¢¦æ•°æ®åº“ç”¨æˆ· su - dmdba # è¿›å…¥æŒ‚è½½ç›®å½• cd /mnt # å®‰è£… ./DMInstall.bin -i æ­¥éª¤å¦‚å›¾ï¼šï¼ˆå…¶ä¸­å®‰è£…ç›®å½•é€‰æ‹©åˆ›å»ºçš„è¾¾æ¢¦æ•°æ®åº“å®‰è£…ç›®å½•ï¼‰\næ˜¾ç¤ºå®‰è£…ç»“æŸåï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·\n1 2 3 su - root # æ‰§è¡Œ /home/dm/script/root/root_install.sh 6 æ³¨å†Œå®ä¾‹\rè¯´æ˜ï¼š\nè¾¾æ¢¦æ•°æ®åº“é¡µå¤§å°ã€ç°‡å¤§å°ã€å¤§å°å†™æ•æ„Ÿã€å­—ç¬¦é›†éƒ½ä¸ºæ³¨å†Œå®ä¾‹æ—¶éœ€è¦é…ç½®çš„ï¼Œè¿™äº›å‚æ•°ä¸€ç»æ³¨å†Œåä¸èƒ½ä¿®æ”¹ï¼Œé™¤éé‡æ–°æ³¨å†Œå®ä¾‹æˆ–è€…é‡è£…æ•°æ®åº“ã€‚å‚æ•°åœ¨ã€Šå®æ–½éƒ¨ç½²-ä¿¡åˆ›é¡¹ç›®ç¯å¢ƒæ­å»ºå‡†å¤‡ï¼ˆä¸€ï¼‰ã€‹å·²ç»åšäº†æ€»ç»“ã€‚\n6.1 ä½¿ç”¨é»˜è®¤å‚æ•°æ³¨å†Œ\r1 2 3 4 5 6 7 # åˆ‡æ¢åˆ°dmdbaç”¨æˆ· su - dmdba # è¿›å…¥dm/binç›®å½• cd /home/dm/bin # æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ ./dminit path=/home/dm/data # ç±»ä¼¼ä¸‹å›¾ 1 2 3 4 5 6 7 8 9 10 # åˆ‡æ¢rootç”¨æˆ· su - root # è¿›å…¥ç›¸å…³ç›®å½• cd /home/dm/script/root # æ‰§è¡Œæ³¨å†ŒæœåŠ¡å‘½ä»¤ ./dm_service_installer.sh -t dmserver -dm_ini /dm/data/DAMENG/dm.ini -p DMSERVER # -t dmserver å°±æ˜¯è¾¾æ¢¦è‡ªå·±çš„serveræœåŠ¡ # -p DMSERVER è¿™ä¸ªå°±æ˜¯æ•°æ®åº“æœåŠ¡çš„åç§°ï¼Œæ‰§è¡Œä¸Šè¾¹å‘½ä»¤å°±æ˜¯ç”Ÿæˆäº† DmServiceDMSERVER çš„å‘½ä»¤ # å¦‚æœ -p DMtest å°±ä¼šç”Ÿæˆ DmServiceDMtest çš„å‘½ä»¤ # ç±»ä¼¼ä¸‹å›¾ è¿™ä¸ªæ“ä½œå°†ç”Ÿæˆ dm.ini é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹æ³¨å†Œåˆ°å“ªä¸ªç›®å½•ï¼Œé…ç½®æ–‡ä»¶å°±åœ¨å“ªä¸ªç›®å½•\n6.2 ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°æ³¨å†Œ\ræ­¥éª¤ä¸ 6.1 ç›¸åŒï¼Œä¸åŒçš„æ­¥éª¤åªæœ‰ä¸€ä¸ªï¼Œåœ¨æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤æ—¶ï¼Œéœ€è¦åœ¨åè¾¹æ¥ä¸Šéœ€è¦è®¾ç½®çš„é¡µå¤§å°ã€ç°‡å¤§å°ã€å­—ç¬¦é›†ã€å¤§å°å†™æ•æ„Ÿç­‰ç­‰ç›¸å…³å‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 # å‚è€ƒ ./dminit path=/home/dm/data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=y CHARSET=0 DB_NAME=DMDB INSTANCE_NAME=DmDBSERVER PORT_NUM=5236 # å®ä¾‹çš„è·¯å¾„ path= # é¡µå¤§å° PAGE_SIZE # ç°‡å¤§å° EXTENT_SIZE # å¤§å°å†™æ•æ„Ÿ CASE_SENSITIVE # å­—ç¬¦é›† CHARSET # æ•°æ®åº“å DB_NAME\tä¹Ÿå°±æ˜¯è¾¾æ¢¦æ•°æ®æ–‡ä»¶çš„ç›®å½•åç§° # å®ä¾‹å INSTANCE_NAME # ç«¯å£ PORT_NUM 6.3 åˆ é™¤å®ä¾‹\rå¦‚æœåœ¨æ³¨å†Œå®ä¾‹æ—¶ï¼Œå·²ç»æ‰§è¡Œäº†åˆå§‹åŒ–å‘½ä»¤./dminitï¼Œå·²ç»ç”Ÿæˆäº†å®ä¾‹çš„æ•°æ®æ–‡ä»¶äº†ï¼Œè¿™æ—¶å€™æƒ³åˆ é™¤è¿™ä¸ªå®ä¾‹æ€ä¹ˆåŠï¼Ÿ\nè¿›å…¥åˆ°è¾¾æ¢¦çš„ ../script/root ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ ./dm_service_uninstaller.sh å‘½ä»¤ï¼Œæ¥åˆ é™¤è¿™ä¸ªå®ä¾‹\nå¿…é¡»ä½¿ç”¨ root ç”¨æˆ·ï¼Œå…ˆæŠŠæ•°æ®åº“æœåŠ¡å…ˆå…³æ‰\n./dm_service_uninstaller.sh -n DmServiceDMSERVER è¿™é‡Œçš„å®ä¾‹åï¼Œä¸»è¦æ˜¯çœ‹ bin ç›®å½•ä¸­æ˜¯ç”¨å“ªä¸ªå‘½ä»¤æ¥å¯åŠ¨çš„ï¼Œè¿™ä¸ªå‘½ä»¤é€šå¸¸å°±æ˜¯è¿™ä¸ªæœåŠ¡çš„åç§°\n1 2 3 4 5 6 7 8 [root@learning home]# cd /home/dmdba/dmdbms/script/root/ [root@learning root]# ls dm_service_installer.sh dm_service_uninstaller.sh root_installer.sh [root@learning root]# ./dm_service_uninstaller.sh -help Usage: dm_service_uninstaller.sh [-n service_name] -n æœåŠ¡å,åˆ é™¤æŒ‡å®šæœåŠ¡ -h å¸®åŠ© [root@learning root]# ./dm_service_uninstaller.sh -n DmServiceDMSERVER ç„¶åæŠŠå¯¹åº”çš„å®ä¾‹æ•°æ®ç›®å½•åˆ é™¤å³å¯\n7 å¯é€‰å‚æ•°é…ç½®\rå…·ä½“è§ã€Šå®æ–½éƒ¨ç½²-ä¿¡åˆ›é¡¹ç›®ç¯å¢ƒæ­å»ºå‡†å¤‡ï¼ˆä¸€ï¼‰ã€‹çš„1.4.2æ­¥éª¤\n8 æ›¿æ¢dm.key\ræ›¿æ¢ä¸ºæ­£å¼çš„dm.keyï¼Œå¯ç›´æ¥ä¸Šä¼ æ­£å¼çš„keyåˆ°dm/binç›®å½•ç›´æ¥æ›¿æ¢\næˆ–è€…ä¸Šä¼ ä»»æ„ç›®å½•ï¼Œä½¿ç”¨cpå‘½ä»¤æ›¿æ¢\n9 å¯åŠ¨æ•°æ®åº“\rå¼€å‘ã€æµ‹è¯•ç¯å¢ƒå¯åŠ¨\n1 2 # å¯åŠ¨æ•°æ®åº“æœåŠ¡ systemctl start DmServiceDMSERVER.service ç”Ÿäº§ä¸Šï¼Œä¸€èˆ¬ä¼šå®‰è£…è¾¾æ¢¦çš„ç›‘æ§å®ˆæŠ¤æ¨¡å¼\n1 2 3 cd /home/dm/bin DmServiceDM start DmWatcherServiceDM start 1 2 3 4 5 6 7 8 9 10 # å¼€å‘ã€æµ‹è¯•ç¯å¢ƒ # åœæ­¢ systemctl stop DmServiceDMSERVER.service # é‡å¯ systemctl restart DmServiceDMSERVER.service # ç”Ÿäº§ç¯å¢ƒ DmWatcherServiceDM stop # å…ˆåœç›‘æ§ DmServiceDM restart DmWatcherServiceDM start è¾¾æ¢¦é›†ç¾¤å®ˆæŠ¤\rè¾¾æ¢¦é›†ç¾¤å®ˆæŠ¤æ˜¯ç”Ÿäº§ä¸Šæ‰ä½¿ç”¨çš„ï¼Œä¸€èˆ¬ç”±DBAæ“ä½œã€‚\nç”Ÿäº§ç¯å¢ƒé‡‡ç”¨åŒæ´»å½¢å¼éƒ¨ç½²ï¼Œåº”ç”¨æœåŠ¡å™¨ä¸Šä½¿ç”¨è¾¾æ¢¦æ•°æ®åº“è¿æ¥æœåŠ¡åè¿›è¡Œè¿æ¥ã€‚è¾¾æ¢¦åœ¨å®‰è£…å®Œæˆæ—¶ä¼šåœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šç”Ÿäº§/etc/dm_svc.conf æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­è¿›è¡Œæ·»åŠ é…ç½®ï¼ŒåŒæ—¶éœ€è¦åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šã€/etc/dm_svc.confã€‘æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶ä¸ºæ–°å¢ï¼‰ä¸­é…ç½®ï¼š\n1 2 3 4 5 6 7 8 TIME_ZONE=(480) LANGUAGE=(cn) GRP1=(192.168.xxx.1:5236,192.168.xxx.2:5236) [GRP1] TIME+ZONE=(+480) LOGIN_MODE=(1) SWITCH_TIME=(3) SWITCH_INTERVAL=(200) é…ç½®è¯´æ˜å¦‚ä¸‹ï¼š\nLOGIN_MODE æœåŠ¡åæ–¹å¼ç™»å½•ï¼Œå§‹ç»ˆä¼šä¼˜å…ˆç™»å½•ä¸»åº“ï¼› LOGIN_MODE è¡¨ç¤ºæ˜¯å¦ä»…ç™»å½•ä¸»åº“æˆ–è€…å¤‡åº“ï¼Œå¯ä»¥é…ç½®ä¸º 0ã€1 æˆ– 2ã€‚2è¡¨ç¤ºä¸ç™»å½• Standby æ¨¡å¼çš„åº“ï¼Œå¦‚æœç³»ç»Ÿä¸­åªæœ‰ Standby æ¨¡å¼çš„åº“ï¼Œç™»å½•å¤±è´¥å¹¶æŠ¥é”™ã€‚ SWITCH_TIME æ£€æµ‹åˆ°æ•°æ®åº“å®ä¾‹æ•…éšœæ—¶ï¼Œæ¥å£åœ¨æœåŠ¡å™¨ä¹‹é—´åˆ‡æ¢çš„æ¬¡æ•°ï¼›è¶…è¿‡è®¾ç½®æ¬¡æ•°æ²¡æœ‰è¿æ¥åˆ°æœ‰æ•ˆæ•°æ®åº“æ—¶ï¼Œæ–­å¼€è¿æ¥å¹¶æŠ¥é”™ã€‚ SWITCH_INTERVAL è¡¨ç¤ºåœ¨æœåŠ¡å™¨ä¹‹é—´åˆ‡æ¢çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ ","date":"2024-06-06T23:22:03+08:00","permalink":"http://localhost:1313/posts/2024/06/%E5%AE%9E%E6%96%BD%E9%83%A8%E7%BD%B2-%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%89%E8%A3%85/","title":"å®æ–½éƒ¨ç½² è¾¾æ¢¦æ•°æ®åº“linuxç‰ˆçš„å®‰è£…ï¼ˆäºŒï¼‰"},{"content":"å‰è¨€\råœ¨åšäº¤ä»˜å·¥ä½œçš„æ—¶å€™ï¼Œç¯å¢ƒçš„æ­å»ºä¹Ÿæ˜¯å·¥ä½œçš„ä¸€ä¸ªé‡è¦ç¯èŠ‚ã€‚å…¬å¸ç°åœ¨ä¸€ä¸ªäº§å“çš„æ¶æ„ï¼šB/Sæ¶æ„ï¼Œé‡‡ç”¨çš„æŠ€æœ¯è·¯åŸºæœ¬æ˜¯ä½ä»£ç å¹³å° + JAVAåç«¯ï¼šä½ä»£ç å¹³å°é‡Œä½¿ç”¨ javascrpit åšåŠŸèƒ½é¡µé¢çš„å¼€å‘ï¼Œå¯¹äºJAVAç±»ä¹Ÿåªæ˜¯è°ƒç”¨ï¼›ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹ä¸­ã€‚\né‚£è¿è¡Œäº§å“çš„ç¯å¢ƒçš„æ­å»ºå°±ä¸»è¦åŒ…æ‹¬ï¼šWEBæœåŠ¡çš„éƒ¨ç½²ã€æ•°æ®åº“çš„éƒ¨ç½²ã€‚å½“ç„¶ä¹Ÿæœ‰å…¶ä»–çš„æœåŠ¡ï¼Œä½†å…¶ä»–æœåŠ¡éœ€è¦æ ¹æ®äº§å“çš„éœ€è¦è¿›è¡Œéƒ¨ç½²çš„ã€‚æˆ‘ä¸»è¦è´Ÿè´£ä¿¡åˆ›ç±»é¡¹ç›®çš„å®æ–½éƒ¨ç½²ï¼Œéƒ½æ˜¯åœ¨LINUXæœåŠ¡å™¨ä¸Šéƒ¨ç½²ã€‚\nä¸€ä¸ªç¯å¢ƒæ­å»ºçš„æ€è·¯ï¼š\nå‰æœŸç¯å¢ƒçš„å‡†å¤‡ \u0026raquo; æ•°æ®åº“éƒ¨ç½² \u0026raquo; ä¸­é—´ä»¶ä¸åº”ç”¨éƒ¨ç½² \u0026raquo; ETLå·¥å…·éƒ¨ç½²\næœ¬æ–‡æ€»ç»“å‰æœŸç¯å¢ƒçš„å‡†å¤‡\nä¿¡åˆ›é¡¹ç›®çŸ¥è¯†\rä¿¡åˆ›ç±»äº§å“çš„å®æ–½éƒ¨ç½²ä» 0 åˆ° 1 ï¼Œå®æ–½éƒ¨ç½²å‰æœŸéœ€è¦äº†è§£ä»€ä¹ˆï¼Œä½œä¸ºè·Ÿå®¢æˆ·æ²Ÿé€šçš„æŠ€æœ¯çŸ¥è¯†ä¿éšœã€‚\nä¿¡åˆ›è½¯ç¡¬ä»¶\ræ•°æ®åº“ï¼šè¾¾æ¢¦ ä¸­é—´ä»¶ï¼šä¸œæ–¹é€šã€å®å…°å¾· æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šéº’éºŸã€ç»Ÿä¿¡ ç¡¬ä»¶å¹³å°ï¼šé£è…¾ã€åä¸ºã€é¾™èŠ¯ã€æµ·å…‰ã€é²²é¹â€¦â€¦ å†…æ ¸ï¼šAMDã€ARM\nç¡®è®¤æœåŠ¡å™¨æ¶æ„ä¿¡æ¯\rä¿¡åˆ›ï¼Œäº§å“çš„æ¡†æ¶ä¸æ•°æ®å¹³å°å‡åšäº†é€‚é…ï¼Œéƒ½éœ€è¦æ ¹æ®å†…æ ¸æ¥ç¡®è®¤ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ã€‚\n1 2 3 4 5 6 7 8 9 10 # åœ¨LinuxæœåŠ¡å™¨ä¸Šè¾“å…¥å‘½ä»¤è·å–å†…æ ¸ä¿¡æ¯ï¼Œé€šå¸¸æœ‰3ç§æ–¹å¼ # è¿”å›ä¿¡æ¯ä¸­åŒ…å«äº† x86_64 è¡¨ç¤ºè¯¥æœåŠ¡å™¨å†…æ ¸ä¸º AMD # è¿”å›ä¿¡æ¯ä¸­åŒ…å« arrch64 æˆ–è€… arm64 è¡¨ç¤ºè¯¥æœåŠ¡å™¨å†…æ ¸ä¸º ARM # è¿”å›å†…æ ¸ç‰ˆæœ¬ã€æ¶æ„ uname -a # è¿”å›å†…æ ¸ç‰ˆæœ¬ cat /proc/version # è¿”å›ç³»ç»Ÿä¿¡æ¯ï¼ˆåŒ…æ‹¬å†…æ ¸ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼‰ hostnamectl ç¡®è®¤æœåŠ¡å™¨å†…å­˜ä¿¡æ¯\rJAVAæœåŠ¡ç«¯é€šå¸¸éœ€è¦è®¾ç½®æœåŠ¡çš„ JVM ï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸æ¨è JVM \u0026gt; 16G\nå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒ JVM å‡åŠä½œä¸ºå‚è€ƒå³å¯\næ¯”å¦‚ï¼šåœ¨éƒ¨ç½²ä¸­é—´ä»¶ã€å®å…°å¾·ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œé»˜è®¤çš„ JVM éƒ½æ˜¯ 2Gï¼Œæµ‹è¯•æœåŠ¡å™¨åªæœ‰8Gå†…å­˜çš„æƒ…å†µä¸‹ï¼Œä¸­é—´ä»¶çš„JVMä¿®æ”¹ä¸º4Gã€‚\nç¡®è®¤æ•°æ®åº“å‚æ•°\ræˆ‘æ‰€é‡åˆ°çš„ä¿¡åˆ›é¡¹ç›®ç§ï¼Œæ•°æ®åº“é€šå¸¸ä½¿ç”¨è¾¾æ¢¦æ•°æ®åº“ã€‚è¾¾æ¢¦æ•°æ®åº“ï¼Œæœ‰å‡ ä¸ªå‚æ•°æ˜¯åœ¨åˆå§‹åŒ–å®ä¾‹çš„æ—¶å€™å°±éœ€è¦ç¡®å®šçš„ï¼Œä¸”åˆå§‹åŒ–å®ä¾‹åæ— æ³•è¿›è¡Œä¿®æ”¹ï¼Œé™¤éé‡æ–°åˆå§‹åŒ–å®ä¾‹ï¼š\né¡µå¤§å° (page_size) ç°‡å¤§å° (extent_size) å¤§å°å†™æ•æ„Ÿ (case_sensitive) å­—ç¬¦é›† (charset) ä¸‹è¡¨ä¸ºè¿™å‡ ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ï¼š\nåç§° å«ä¹‰ å¯è®¾ç½®å€¼ page_size æ•°æ®æ–‡ä»¶ä½¿ç”¨çš„é¡µå¤§å° 4/8/16/32 extent_size ç°‡å¤§å°ï¼Œæ¯æ¬¡åˆ†é…æ–°çš„æ®µç©ºé—´æ—¶è¿ç»­çš„é¡µé¢ 16/32/64 case_sensitive æ ‡è¯†ç¬¦å¤§å°å†™æ•æ„Ÿã€‚å½“å¤§å°å†™æ•æ„Ÿæ—¶ï¼Œå°å†™çš„æ ‡è¯†ç¬¦è¦ç”¨åŒå¼•å·æ‹¬èµ·ï¼Œå¦åˆ™è¢«è½¬æ¢ä¸ºå¤§å†™ï¼›å½“å¤§å°å†™ä¸æ•æ„Ÿæ—¶ï¼Œç³»ç»Ÿä¸è‡ªåŠ¨è½¬æ¢æ ‡è¯†ç¬¦çš„å¤§å°å†™ï¼Œåœ¨æ ‡è¯†ç¬¦æ¯”è¾ƒæ—¶ä¹Ÿä¸åŒºåˆ†å¤§å°å†™ã€‚é»˜è®¤ Y ï¼ˆ1ï¼‰æ•æ„Ÿ Y/Nï¼ˆ1/0ï¼‰ charset å­—ç¬¦é›†é€‰é¡¹ï¼Œ0ï¼šGB18030ï¼›1ï¼šUTF-8ï¼ˆé»˜è®¤0ï¼‰ 0/1 length_in_char VARCHARç±»å‹é•¿åº¦æ˜¯å¦ä»¥å­—ç¬¦ä¸ºå•ä½ï¼ˆé»˜è®¤ä¸ºN 0 ï¼‰ Y/Nï¼ˆ1/0ï¼‰ é¡µå¤§å°ä¸å­—æ®µé•¿åº¦æœ‰å…³ï¼Œç°‡å¤§å°ä¸è¡¨ç©ºé—´æœ‰å…³ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªéƒ½ä¸æˆ‘ä»¬æ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„åªæœ‰ 2 ä¸ªï¼š\nå¤§å°å†™æ•æ„Ÿ å­—ç¬¦é›†ç¼–ç  äº§å“å¤šä¸ºoracleå¼€å‘ï¼Œä»oracleç§»æ¤è¿‡æ¥ï¼Œä¸ºäº†æ›´å¥½çš„å…¼å®¹ï¼Œé€šå¸¸å¼€å¯å¤§å°å†™æ•æ„Ÿï¼›å­—ç¬¦é›†ç¼–ç æ˜¯GB18030è¿˜æ˜¯UTF-8æ²¡å…³ç³»ï¼Œä½†æ˜¯å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒéœ€è¦å­—ç¬¦é›†ç¼–ç ä¸€è‡´ã€‚\nåœ¨å®é™…çš„é¡¹ç›®å®æ–½éƒ¨ç½²ä¸­ï¼Œå®¢æˆ·çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒé€šå¸¸ç”±æˆ‘ä»¬å‚å•†ç»´æŠ¤ï¼Œåªæœ‰ç”Ÿäº§ç¯å¢ƒæ˜¯ç”±DBAç»´æŠ¤ã€‚æ‰€ä»¥åœ¨å‰æœŸçš„æ²Ÿé€šä¸­ï¼Œæˆ‘ä»¬éœ€è¦è·ŸDBAç¡®è®¤å¥½è¾¾æ¢¦æ•°æ®åº“é‡Œçš„ä¸Šè¿°å‚æ•°ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´ã€‚\næ€»ç»“äº†ä¸€ä»½æ¨¡æ¿å¦‚ä¸‹ï¼Œé¡µå¤§å°å’Œç°‡å¤§å°æ ¹æ®åœ¨ç”Ÿäº§ä¸Šé€šå¸¸å»ºè®®è®¾ç½®ä¸º32\nå‚æ•°å¸¦æ¥çš„å½±å“\r1ï¼‰ç¼–ç ä¸ä¸€è‡´\rå½“å¼€å‘ç¯å¢ƒæˆ–è€…æµ‹è¯•ç¯å¢ƒï¼Œä¸ç”Ÿäº§ç¯å¢ƒçš„å­—ç¬¦é›†ç¼–ç ä¸ä¸€è‡´æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå­—ç¬¦ä¸²é•¿åº¦ç›¸å…³çš„æŠ¥é”™ã€‚\næ¯”å¦‚ï¼š\næµ‹è¯•ç¯å¢ƒä¸Šæ˜¯ GB18030 ç¼–ç ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸Šæ˜¯ UTF8 ç¼–ç ï¼Œå› ä¸º GB ç¼–ç å­˜ä¸€ä¸ªä¸­æ–‡éœ€è¦çš„ 1 ä¸ªå­—èŠ‚å°‘äº UTF8 å­˜ä¸€ä¸ªä¸­æ–‡éœ€è¦çš„ 3 ä¸ªå­—èŠ‚ï¼Œæµ‹è¯•åçš„äº§å“åŠŸèƒ½ä¸Šäº†ç”Ÿäº§ç¯å¢ƒå¯èƒ½ä¼šæŠ¥å‡ºå­—ç¬¦ä¸²æˆªæ–­çš„é”™è¯¯ã€‚\n2ï¼‰å¤§å°å†™æ•æ„Ÿä¸ä¸€è‡´\rå¤§å°å†™æ•æ„Ÿï¼šæŸ¥æ•°æ®å†…å®¹æ—¶ï¼ŒæŸ¥ a å°±æ˜¯ aï¼ŒæŸ¥ A å°±æ˜¯ A\nå¤§å°å†™ä¸æ•æ„Ÿï¼šæŸ¥æ•°æ®å†…å®¹æ—¶ï¼ŒæŸ¥ a è¿”å› Aã€a\nå¦‚æœä¸è®¾ç½®å¤§å°å†™æ•æ„Ÿï¼Œä¸ä»…æ˜¯åœ¨å†™æŸ¥è¯¢SQLçš„æ—¶å€™ä¼šå½±å“ï¼Œåœ¨åˆ›å»ºå¯¹è±¡ã€å†™å­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œå¯¹è±¡åç§°ã€å­—æ®µåç§°ä¹Ÿä¼šå—åˆ°å½±å“ã€‚æ¯”å¦‚ï¼š\n1 2 3 create table table_A (id varchar2(8)); insert table_a values(\u0026#39;001\u0026#39;); # insert å°±ä¼šæŠ¥é”™ï¼Œå› ä¸º table_a ä¸å­˜åœ¨ï¼Œå¿…é¡»ä¸åˆ›å»ºçš„è¡¨åä¸€æ¨¡ä¸€æ ·æ‰å¯ä»¥ å…¶ä»–å¯èƒ½éœ€è¦ä¿®æ”¹çš„å‚æ•°\ræ­¤å¤„çš„å‚æ•°æŒ‡ï¼Œè¾¾æ¢¦æ•°æ®åº“ dm.ini é…ç½®æ–‡ä»¶é‡Œçš„å‚æ•°ã€‚åœ¨å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå¯ç”±è‡ªå·±æ ¹æ®å®é™…æƒ…å†µæ›´æ”¹ï¼Œåœ¨ç”Ÿäº§ä¸Šå¿…é¡»ä¸DBAæ²Ÿé€šåè¿›è¡Œæ›´æ”¹ï¼Œä¹Ÿéœ€è¦ä¿æŒä¸‰ä¸ªç¯å¢ƒä¸­å‚æ•°çš„ä¸€è‡´æ€§ã€‚\ndm.ini é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰é™æ€å‚æ•°ã€åŠ¨æ€å‚æ•°ã€‚é™æ€å‚æ•°éœ€è¦é‡å¯æ•°æ®åº“æœåŠ¡åæ‰ç”Ÿæ•ˆï¼Œåœ¨ç”Ÿäº§ä¸Šé‡å¯æ•°æ®åº“æ˜¯ä¸€ä»¶ä¸¥è‚ƒçš„äº‹æƒ…ï¼Œéœ€è¦ä¿®æ”¹çš„å‚æ•°éœ€è¦è‡ªå·±åšå¥½éªŒè¯æ˜¯å¦èƒ½å¤Ÿè§£å†³å®é™…çš„æƒ…å†µã€‚\n1ï¼‰COMPATIBLE_MODE\rè¯¥å‚æ•°ç”¨äºæ§åˆ¶è¾¾æ¢¦æ•°æ®åº“åœ¨éƒ¨åˆ†åŠŸèƒ½å¤„ç†æ—¶ä¸å…¶ä»–æ•°æ®åº“çš„å…¼å®¹æ¨¡å¼ã€‚å¸¸ç”¨è®¾ç½®ï¼š\n0 - ä¸å…¼å®¹ 1 - å…¼å®¹SQL92æ ‡å‡† 2 - å…¼å®¹ORACLE 3 - å…¼å®¹SQL SERVER 4 - å…¼å®¹MYSQL é€šå¸¸é¡¹ç›®ä¸Šï¼Œæ­¤å‚æ•°è®¾ç½®ä¸º2ï¼Œå¯ä»¥æ›´å¥½çš„é€‚é…åŸºäºORACLEå¼€å‘çš„äº§å“ä»£ç ã€‚\nã€ä¾‹å­ã€‘\rè¾¾æ¢¦æ•°æ®åº“é»˜è®¤NULL ä¸ç©ºå€¼æ˜¯ä¸ç­‰ä»·çš„ï¼ŒNULLå°±æ˜¯NULLï¼Œç©ºå€¼å°±æ˜¯ç©ºå€¼ã€‚æŸä¸ªåŠŸèƒ½æŸ¥è¯¢éœ€è¦åŒæ—¶æ»¡è¶³å®ƒä»¬ï¼Œéœ€è¦è¿™æ ·å†™ï¼š\n1 2 3 4 select col_A from table_A where col_A is null or col_A = \u0026#39;\u0026#39; ; ORACLEä¸­é»˜è®¤NULL å’Œç©ºå€¼æ˜¯ç­‰ä»·çš„ï¼ŒåŒæ—¶æ»¡è¶³åªéœ€è¦ï¼š\n1 2 3 4 select col_A from table_A where col_A = \u0026#39;\u0026#39; ; ä¿®æ”¹COMPATIBLE_MODEå‚æ•°ä¸º2å³å¯è·Ÿåœ¨ORACLEä¸Šçš„æŸ¥è¯¢å†™æ³•ä¸€è‡´ã€‚\n2ï¼‰PK_WITH_CLUSTER\rè¯¥å‚æ•°é»˜è®¤ä¸º1\nè¯¥å‚æ•°ä¸å»ºè¡¨æ—¶çš„ä¸»é”®ç´¢å¼•æœ‰å…³ï¼Œè¾¾æ¢¦æ•°æ®åº“åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œå¦‚æœåˆ›å»ºä¸»é”®ï¼Œåˆ™é»˜è®¤ä¸»é”®æ˜¯èšç°‡ç´¢å¼•é”®ã€‚å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œåˆ™é»˜è®¤rowid ä½œä¸ºèšç°‡ç´¢å¼•é”®\nã€ä¾‹å­ã€‘\rå½“åœ¨è¾¾æ¢¦æ•°æ®å»ºè¡¨æ—¶ï¼ŒåŒæ—¶å‡ºç°ä¸»é”®ã€å­—æ®µä¸ºå¤§å­—æ®µCLOBç±»å‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼š\n1 2 3 4 5 6 7 create table table_A( id varchar2(8) primary key, name varchar2(20), addr clob ); -- è¯¥è¯­å¥ä¼šæŠ¥é”™ï¼šè¡¨[xxxxxx]ä¸­ä¸èƒ½åŒæ—¶åŒ…å«èšé›† KEY å’Œå¤§å­—æ®µ æ­¤æ—¶ï¼Œä¿®æ”¹å‚æ•°PK_WITH_CLUSTER=0 ï¼Œå†åˆ›å»ºæœ‰ä¸»é”®ã€å­—æ®µä¸ºCLOBç±»å‹çš„è¡¨ï¼Œå°±å¯ä»¥åˆ›å»ºæˆåŠŸã€‚\nã€å…³äºèšç°‡ç´¢å¼•ã€‘\rè¡¨ï¼ˆåˆ—å­˜å‚¨è¡¨å’Œå †è¡¨é™¤å¤–ï¼‰éƒ½æ˜¯ä½¿ç”¨ B+æ ‘(ä»¥ä¸‹ç®€ç§° B æ ‘)ç´¢å¼•ç»“æ„ç®¡ç†çš„ï¼Œæ¯ä¸€ä¸ªæ™®é€šè¡¨éƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼Œæ•°æ®é€šè¿‡èšé›†ç´¢å¼•é”®æ’åºï¼Œæ ¹æ®èšé›†ç´¢å¼•é”®å¯ä»¥å¿«é€ŸæŸ¥è¯¢ä»»ä½•è®°å½•ã€‚ï¼ˆå³è¡¨æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•åç§°å«èšé›†ç´¢å¼•ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ›å»ºä¸€ä¸ªè¡¨åï¼Œå°†æ‰€æœ‰å­—æ®µæ”¾åœ¨ä¸€èµ·å»ºç«‹ä¸€ä¸ªå¤åˆç´¢å¼•ï¼Œåªä¸è¿‡è¿™ä¸ªä¸éœ€è¦æˆ‘ä»¬æ¥åˆ›å»ºï¼Œç³»ç»Ÿè‡ªåŠ¨ç»™æˆ‘ä»¬ç»´æŠ¤äº†ä¸€ä¸ªï¼‰\nå½“å»ºè¡¨è¯­å¥æœªæŒ‡å®šèšé›†ç´¢å¼•é”®ï¼ŒDM çš„é»˜è®¤èšé›†ç´¢å¼•é”®æ˜¯ ROWIDï¼Œå³è®°å½•é»˜è®¤ä»¥ ROWID åœ¨é¡µé¢ä¸­æ’åºã€‚ROWID æ˜¯ B æ ‘ä¸ºè®°å½•ç”Ÿæˆçš„é€»è¾‘é€’å¢åºå·ï¼Œè¡¨ä¸Šä¸åŒè®°å½•çš„ ROWID æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¹¶ä¸”æœ€æ–°æ’å…¥çš„è®°å½• ROWID æœ€å¤§ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä»¥ ROWID å»ºçš„é»˜è®¤èšé›†ç´¢å¼•å¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå› ä¸ºå®é™…æƒ…å†µä¸‹å¾ˆå°‘äººæ ¹æ® ROWID æ¥æŸ¥æ‰¾æ•°æ®ã€‚\nåŸæ–‡é“¾æ¥ï¼š https://blog.csdn.net/sinat_32856657/article/details/125410328\n3ï¼‰CALS_AS_DECIMAL\rè¯¥å‚æ•°æ˜¯æ§åˆ¶ æ•´æ•°é™¤æ³•è¿ç®—æ˜¯å¦èˆå¼ƒå°æ•°ã€‚\nåœ¨è¾¾æ¢¦æ•°æ®åº“ä¸­ï¼Œæ•´æ•°ç›¸é™¤æˆ–è€…ä½¿ç”¨ROUNDå‡½æ•°ï¼Œç»“æœå¦‚æœæœ‰å°æ•°ä½ï¼Œä¼šè¢«ç›´æ¥èˆå¼ƒï¼Œè¿”å›æ•´æ•°ã€‚\næ¯”å¦‚\n1 2 select 9/2 from dual; -- ä¼šè¿”å›4 å¯ä¿®æ”¹CALC_AS_DECIMAL=1 è®©è¿ç®—ä¸èˆå¼ƒå°æ•°ä½\nå…³äºå‚æ•°ä¿®æ”¹æ–¹å¼\rç¬¬ä¸€ç§ï¼šé€šè¿‡dm.ini ä¿®æ”¹å‚æ•°\nç¬¬äºŒç§ï¼šåœ¨è¾¾æ¢¦SQLçª—å£ä¸­ï¼Œæ‰§è¡Œï¼š\n1 2 3 4 sp_set_para_value(old_values, \u0026#39;param_name\u0026#39;, new_values); -- ä¾‹å¦‚ sp_set_para_value(1,\u0026#39;PK_WITH_CLUSTER\u0026#39;,0); ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æƒé™\räº§å“éœ€è¦çš„ç”¨æˆ·å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä½¿ç”¨äº†DBAè§’è‰²çš„æƒé™ï¼Œä½†æ˜¯åœ¨é¡¹ç›®å®æ–½æ—¶ï¼ˆç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼‰ï¼Œä¼šæœ‰éƒ¨åˆ†å®¢æˆ·è®¤ä¸ºäº§å“ä¸Š DBA æƒé™ä¸åˆç†ï¼Œä¹Ÿä¼šæœ‰éƒ¨åˆ†å®¢æˆ·æˆæƒ DBA æ˜¯éœ€è¦èµ°æµç¨‹ç”³è¯·ã€‚\næ‰€ä»¥è¿™ä¸€ç‚¹åœ¨å‰æœŸå°±éœ€è¦è·Ÿå®¢æˆ·ç¡®è®¤ï¼Œç”¨æˆ·æƒé™èƒ½å¦æˆäºˆDBAæƒé™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -- åˆ›å»ºè¾¾æ¢¦ç”¨æˆ·è„šæœ¬ -- åˆ›å»ºè¡¨ç©ºé—´ -- é»˜è®¤åˆå§‹å¤§å° 500MBï¼Œæ¯æ¬¡è‡ªå¢ 40MBï¼Œæœ€å¤§ 10G create tablespace \u0026#34;TS_TEST\u0026#34; datafile \u0026#39;/dm8/data/DAMENG/TS_TEST.DBF\u0026#39; size 500 autoextend on next 40 maxsize 10240; -- ç”Ÿäº§ä¸Šå¯æ‰©å±•ä¸º unlimited create user \u0026#34;test\u0026#34; identified by \u0026#34;testdata123\u0026#34; default tablespace TS_test; grant \u0026#34;DBA\u0026#34; to \u0026#34;test\u0026#34;; grant delete any table to test; grant execute any procedure to test; grant insert any table to test; grant select any dictionary to test; grant select any table to test; grant unlimited tablespace to test; grant update any table to test; ç”šè‡³æœ‰çš„å®¢æˆ·ï¼ˆæˆ‘é‡åˆ°çš„ä¸€ä¸ªï¼‰ï¼Œè®¤ä¸ºANYæƒé™ä¹Ÿæ˜¯æœ‰å¤§éšæ‚£çš„ï¼Œéœ€è¦é’ˆå¯¹åˆ°å…·ä½“è¡¨åçš„æƒé™ã€‚\n1 2 3 4 GRANT DELETE ANY TABLE TO TEST; GRANT SELECT ANY TABLE TO TEST; GRANT UPDATE ANY TABLE TO TEST; GRANT INSERT ANY TABLE TO TEST; è¿™ç§æƒ…å†µå°±æ²¡åŠæ³•äº†ï¼Œå¾ˆéº»çƒ¦ï¼Œä¸€ä¸ªæˆç†Ÿä¸”åŠŸèƒ½å¤æ‚çš„äº§å“ï¼Œå¯èƒ½æ ‡å‡†ç‰ˆåˆå§‹çš„è¡¨å°±æœ‰ä¸Šåƒå¼ ï¼ˆè¿˜ä¸åŒ…æ‹¬åç»­çš„å¼€å‘æ–°çš„åŠŸèƒ½è¡¨ï¼‰ï¼Œå­˜å‚¨è¿‡ç¨‹ã€è‡ªå®šä¹‰å‡½æ•°ç­‰ç­‰ä¹Ÿæœ‰ä¸Šåƒä¸ªã€‚æ¯ä¸ªå­˜å‚¨è¿‡ç¨‹ç”¨åˆ°çš„è¡¨éƒ½ä¸ä¸€æ ·ï¼Œè¦ä¸€ä¸€æ¢³ç†å“ªäº›ç”¨æˆ·selectï¼Œå“ªä¸ªç”¨æˆ·è¦deleteç­‰ç­‰ï¼ŒåæœŸå°±éœ€è¦é¢å¤–çš„èŠ±æ—¶é—´å»è¿›è¡Œæ¢³ç†ã€‚ï¼ˆè™½ç„¶æ›´å®‰å…¨ã€åˆè§„ï¼Œä½†æ˜¯éº»çƒ¦çš„æ˜¯æˆ‘~åæ§½ä¸€ä¸‹ï¼‰\nè¾¾æ¢¦æƒé™è¯´æ˜\ré€šå¸¸æˆ‘ä»¬åœ¨éƒ¨ç½²æ—¶ï¼ŒJDBC ä¸­çš„è¿æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ WOLF WOLFDATA ç”¨æˆ·å»è¿æ¥ï¼Œæˆ–è€…ä½¿ç”¨ WOLF å»é…ç½®ä¸¤ä¸ª JDBC è¿æ¥ï¼ŒæŒ‡å‘ WOLF WOLFDATA æ¨¡å¼ï¼ˆè¾¾æ¢¦ä¸­ schema çš„æ¦‚å¿µï¼Œå¯ä»¥æŠŠå®ƒå½“æˆ oracle çš„å®ä¾‹æ¦‚å¿µï¼‰ã€‚\nä½¿ç”¨äº† WOLF ç”¨æˆ·å»é…ç½® JDBC è¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œåœ¨ç³»ç»Ÿè¿›è¡Œæ—¥å¸¸æ“ä½œçš„æ—¶å€™ï¼Œåœ¨æ•°æ®åº“ä¸­å°±æ˜¯åŸºäº WOLF ç”¨æˆ·å¯¹å¯¹å„ä¸ªå¯¹è±¡ï¼ˆTABLE \\ SP \\ FUNCTION \\ VIEW \\ TYPE \\ PACKAGE ç­‰ï¼‰è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæ¡†æ¶æä¾›çš„é»˜è®¤æƒé™è„šæœ¬æƒé™å¤šå« DBA æˆ–è€… ANY æƒé™ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå…¶å®æ˜¯ä¸è¢«å…è®¸çš„ã€‚åœ¨ç”¨æˆ·å…·å¤‡ DBA \\ DROP ANY OBJECTS çš„æƒ…å†µï¼Œèƒ½åšçš„äº‹æƒ…æ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬äº†å¯¹è¡¨ç©ºé—´ï¼ˆæ•°æ®æ–‡ä»¶ï¼‰çš„æ›´æ”¹ã€è·¨ç”¨æˆ·åˆ é™¤è¡¨ ç­‰å±é™©æ“ä½œã€‚\nå› æ­¤åœ¨æƒé™ä¸Šï¼Œæœ‰çš„å®¢æˆ·ä¼šè¦æ±‚æ¢³ç†åˆ°å…·ä½“çš„è¡¨éœ€è¦ä»€ä¹ˆæƒé™ã€‚\n1 2 3 4 5 6 7 8 9 1.é™¤äº†æœ¬èº«çš„ ROURCE è§’è‰²å¤–ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¡¨çš„æŸ¥è¯¢æƒé™ï¼ŒSOV\\SVI è§’è‰² 2.éœ€è¦å¯¹ WOLFDATA å…·æœ‰å®Œå…¨æ‰§è¡Œæƒï¼ŒWOLFDATA ä¸‹ä¸€èˆ¬åªæœ‰è¡¨ï¼Œå¯¹è¿™äº›è¡¨æœ‰å¢åˆ æ”¹æŸ¥å³å¯ 3.å¯¹äº§å“ç”¨æˆ·çš„å¯¹è±¡ï¼šï¼ˆä¸åŒ…å«è¾¾æ¢¦è‡ªèº«ç”¨æˆ·çš„å¯¹è±¡ï¼‰ æ‰€æœ‰ TABLE æœ‰ INSERT \\ DELETE \\ UPDATE \\ SELECT æƒé™ æ‰€æœ‰ VIEW æœ‰ SELECT æƒé™ æ‰€æœ‰ SP æœ‰ EXECUTE æƒé™ æ‰€æœ‰çš„ FUNC æœ‰ EXECUTE æ‰€æœ‰çš„ PACKAGE æœ‰ EXECUTE ï¼ˆè¾¾æ¢¦çš„ TYPE ç±»å‹é›†åˆåˆ°äº† PACKAGE é‡Œï¼‰ æ‰€æœ‰çš„ CLASS æœ‰ EXECUTE 1 2 3 4 5 6 7 å…¶ä»–çš„äº§å“ç”¨æˆ·ï¼Œæƒé™åˆ™éœ€è¦æœ‰è‡ªèº«çš„ RESOURCE ç”¨æˆ·å¤–ï¼Œ è¿˜åº”è¯¥ä»è‡ªèº«çš„ SP ä¸­é€ä¸€æ’æŸ¥éœ€è¦çš„ è·¨ç”¨æˆ·å¯¹è±¡çš„æŸä¸ªæƒé™ æ¯”å¦‚ RISKCONFIG çš„ SP ä¸­é€šå¸¸å«æœ‰å¯¹ä¸­é—´å±‚è¡¨çš„ DELETE \\ INSERT \\ SELECT \\ UPDATE åˆ™åº”è¯¥ä¸º RISKCONFIG ç”¨æˆ·èµ‹äºˆä¸­é—´å±‚è¡¨çš„ DELETE \\ INSERT \\ SELECT \\ UPDATE æƒé™ã€‚ ä¸éœ€è¦ WOLF å¯¹ä¸­é—´å±‚è¡¨æœ‰æƒé™ï¼ŒWOLF åªéœ€è¦æœ‰æ‰§è¡Œè¯¥ SP çš„æƒé™å³å¯ã€‚ å‰æœŸå°†è¿™äº›æ²Ÿé€šå¥½ï¼Œç­‰å®¢æˆ·ç»™æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå°±å¯ä»¥å¼€å§‹ç€æ‰‹å‡†å¤‡å®æ–½éƒ¨ç½²äº§å“äº†ã€‚\n","date":"2024-06-01T21:41:26+08:00","permalink":"http://localhost:1313/posts/2024/06/%E5%AE%9E%E6%96%BD%E9%83%A8%E7%BD%B2-%E4%BF%A1%E5%88%9B%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%96%BD%E5%87%86%E5%A4%87/","title":"å®æ–½éƒ¨ç½² ä¿¡åˆ›é¡¹ç›®ç¯å¢ƒæ­å»ºå‡†å¤‡ï¼ˆä¸€ï¼‰"},{"content":"é—®é¢˜\rå®é™…çš„é¡¹ç›®ä¸­ï¼Œé‡‡é›†ä¸Šæ¸¸æ•°æ®åˆ°æ•°æ®é›†å¸‚çš„è´´æºå±‚ \u0026raquo; è·‘æ•°æ®è½¬æ¢ä»»åŠ¡ï¼Œå°†æ•°æ®å†™å…¥åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡è¡¨ï¼Œåœ¨è·‘è½¬æ¢ä»»åŠ¡çš„æ—¶å€™ï¼Œæ—¶ä¸æ—¶ä¼šæŠ¥é”™ä¸»é”®å†²çªã€‚è½¬æ¢é‡Œï¼Œé€šå¸¸å†™ç€insert update è¯­å¥ï¼Œå½“å‘è¡¨æ‰§è¡Œæ’å…¥å’Œæ›´æ–°æ“ä½œï¼Œæ—¶ä¸æ—¶å‡ºç°æŠ¥é”™ï¼šè¿åè¡¨çš„å”¯ä¸€çº¦æŸæ¡ä»¶ã€‚\nå› ä¸ºåœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œä¸­é—´å±‚æˆ–è€…ä¸šåŠ¡å±‚è¡¨ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å…·æœ‰ä¸»é”®çš„ï¼ˆå¯èƒ½æ˜¯å•ä¸€ä¸»é”®ï¼Œå¯èƒ½æ˜¯å¤åˆä¸»é”®ï¼‰ã€‚\nå¸¸è§çš„ä¸¤ç§æƒ…å†µ\r1ï¼‰ç›®æ ‡è¡¨é‡Œå·²ç»æœ‰äº†ä¸€æ¡æ•°æ®Aï¼Œä½†æ˜¯è½¬æ¢ä»»åŠ¡åˆå¾€ç›®æ ‡è¡¨é‡Œå†™å…¥ä¸€æ¡æ•°æ®Aï¼Œå¯¼è‡´çš„æŠ¥é”™ï¼›\n2ï¼‰ç›®æ ‡è¡¨é‡Œæ²¡æœ‰æ•°æ®ï¼Œä½†æ˜¯è½¬æ¢é‡Œï¼Œä½¿ç”¨çš„å…³è”æ¡ä»¶äº§ç”Ÿäº†å¤šæ¡é‡å¤æ•°æ®ï¼Œå¯¼è‡´çš„æŠ¥é”™ã€‚\næ ¹æ®è¿™ä¸¤ç§æƒ…å†µå¯¹æ•°æ®è¿›è¡Œæ’æŸ¥ï¼Œçœ‹çœ‹æ˜¯å“ªäº›æ•°æ®é‡å¤äº†ã€‚\næ€è·¯\r1.æ ¹æ®æŠ¥é”™çš„ä¸»é”®åç§°ï¼ŒæŸ¥æ‰¾è¯¥ç´¢å¼•åæ˜¯å“ªå¼ è¡¨çš„ä¸»é”®å\n1 2 3 select * from all_indexes a where a.index_name = \u0026#39;æŠ¥é”™çš„ä¸»é”®å\u0026#39;; 2.æŸ¥çœ‹è¯¥è¡¨ï¼ŒæŸ¥çœ‹è¯¥ä¸»é”®ç”±å“ªäº›å­—æ®µç»„æˆ\n3.å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæ ¹æ®è¿™äº›å­—æ®µï¼Œå°†ç›®æ ‡è¡¨ä¸è½¬æ¢é‡Œæºè¡¨è¿›è¡Œjoinï¼Œå¯¹ç´¢å¼•å­—æ®µè¿›è¡Œcountï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é‡å¤æ•°æ®\nä¾‹å¦‚è¿™å¼ è¡¨åœ¨è½¬æ¢é‡Œæºè¡¨ï¼ˆfromçš„è¡¨ï¼‰ä¸º ct.st_xxxï¼Œé‚£ä¹ˆå¯ä»¥å¦‚ä¸‹ï¼ŒæŸ¥åˆ°é‡å¤çš„æ•°æ®\n1 2 3 4 5 6 7 select a.contract_no, a.stock_account, count(*) from sett.t_ref_contract a join ct.st_xxx b on a.contract_no = b.jys -- å…³è”å­—æ®µ and a.stock_account = b.zqzh group by a.contract_no, a.stock_account having count(*) \u0026gt; 1; ç„¶åï¼Œå¯¹æ¯”è¯¥æ•°æ®ï¼Œæ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆå› ä¸ºæ•°æ®å¯èƒ½å‡ºç°åªæœ‰ä¸»é”®å­—æ®µæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å…¶ä»–å­—æ®µä¸åŒçš„æƒ…å†µï¼‰\n1 2 3 4 5 6 7 8 select a.* from sett.t_ref_contract a join ct.st_xxx b on a.contract_no = b.jys -- å…³è”å­—æ®µ and a.stock_account = b.zqzh where a.contract_no = \u0026#39;æŸ¥åˆ°çš„contract_no\u0026#39; and a.stock_account = \u0026#39;æŸ¥åˆ°çš„stock_account\u0026#39; group by a.contract_no, a.stock_account; 3.1ï¼‰è‹¥ä¸€è‡´ï¼Œåˆ™å¯å°†ç›®æ ‡è¡¨é‡Œçš„æ•°æ®åˆ æ‰\n3.2ï¼‰è‹¥ä¸ä¸€è‡´ï¼Œåº”å’¨è¯¢ä¸šåŠ¡ï¼Œå®ƒä»¬æ˜¯å¦æœ‰åŒºåˆ«ï¼Œæ ¹æ®ä¸šåŠ¡æ²Ÿé€šåçš„æ–¹æ¡ˆï¼Œå°†æ•°æ®å¤‡ä»½åï¼Œå¯¹å…¶æ›´æ”¹æˆ–åˆ é™¤ç­‰æ“ä½œ\n4.å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œåˆ™éœ€è¦çœ‹è½¬æ¢é‡Œï¼Œå®ƒçš„insert æˆ–è€…update çš„é€»è¾‘ï¼Œç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 insert table_a ( col_1, col_2, ... ) select col_a, col_b, ... from table_b t1 join table_c t2 on t1.col_a = t2.col_a and t1.col_b = t2.col_b; ç„¶åå¯¹å…³è”æ¡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å…³è”æ¡ä»¶å‡ºç°äº† 1:N N:N çš„æƒ…å†µï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ ¹æ®ä»£ç çš„é€»è¾‘ï¼Œå¯¹è¯¥æ•°æ®äº§ç”Ÿçš„åŸå› è¿›è¡Œå®šä½ï¼Œæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè§£å†³ã€‚\n","date":"2024-05-20T20:26:17+08:00","permalink":"http://localhost:1313/posts/2024/05/","title":"SQL è¿åè¡¨çš„å”¯ä¸€çº¦æŸæ¡ä»¶ï¼ˆä¸»é”®å†²çªï¼‰é—®é¢˜"}]